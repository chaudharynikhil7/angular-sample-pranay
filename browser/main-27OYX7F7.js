var sw=Object.defineProperty,aw=Object.defineProperties;var cw=Object.getOwnPropertyDescriptors;var hp=Object.getOwnPropertySymbols;var lw=Object.prototype.hasOwnProperty,uw=Object.prototype.propertyIsEnumerable;var dp=(t,e,n)=>e in t?sw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Te=(t,e)=>{for(var n in e||={})lw.call(e,n)&&dp(t,n,e[n]);if(hp)for(var n of hp(e))uw.call(e,n)&&dp(t,n,e[n]);return t},mt=(t,e)=>aw(t,cw(e));var $=(t,e,n)=>new Promise((i,r)=>{var a=y=>{try{v(n.next(y))}catch(C){r(C)}},d=y=>{try{v(n.throw(y))}catch(C){r(C)}},v=y=>y.done?i(y.value):Promise.resolve(y.value).then(a,d);v((n=n.apply(t,e)).next())});var fp=null;var nu=1,pp=Symbol("SIGNAL");function Ke(t){let e=fp;return fp=t,e}var gp={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function hw(t){if(!(ou(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===nu)){if(!t.producerMustRecompute(t)&&!iu(t)){t.dirty=!1,t.lastCleanEpoch=nu;return}t.producerRecomputeValue(t),t.dirty=!1,t.lastCleanEpoch=nu}}function mp(t){return t&&(t.nextProducerIndex=0),Ke(t)}function vp(t,e){if(Ke(e),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(ou(t))for(let n=t.nextProducerIndex;n<t.producerNode.length;n++)ru(t.producerNode[n],t.producerIndexOfThis[n]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function iu(t){wa(t);for(let e=0;e<t.producerNode.length;e++){let n=t.producerNode[e],i=t.producerLastReadVersion[e];if(i!==n.version||(hw(n),i!==n.version))return!0}return!1}function yp(t){if(wa(t),ou(t))for(let e=0;e<t.producerNode.length;e++)ru(t.producerNode[e],t.producerIndexOfThis[e]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function ru(t,e){if(dw(t),wa(t),t.liveConsumerNode.length===1)for(let i=0;i<t.producerNode.length;i++)ru(t.producerNode[i],t.producerIndexOfThis[i]);let n=t.liveConsumerNode.length-1;if(t.liveConsumerNode[e]=t.liveConsumerNode[n],t.liveConsumerIndexOfThis[e]=t.liveConsumerIndexOfThis[n],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,e<t.liveConsumerNode.length){let i=t.liveConsumerIndexOfThis[e],r=t.liveConsumerNode[e];wa(r),r.producerIndexOfThis[i]=e}}function ou(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function wa(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function dw(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function fw(){throw new Error}var pw=fw;function _p(t){pw=t}function Me(t){return typeof t=="function"}function Fr(t){let n=t(i=>{Error.call(i),i.stack=new Error().stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Ca=Fr(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:
${n.map((i,r)=>`${r+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=n});function $o(t,e){if(t){let n=t.indexOf(e);0<=n&&t.splice(n,1)}}var wt=class t{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(let a of n)a.remove(this);else n.remove(this);let{initialTeardown:i}=this;if(Me(i))try{i()}catch(a){e=a instanceof Ca?a.errors:[a]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let a of r)try{wp(a)}catch(d){e=e??[],d instanceof Ca?e=[...e,...d.errors]:e.push(d)}}if(e)throw new Ca(e)}}add(e){var n;if(e&&e!==this)if(this.closed)wp(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}}_hasParent(e){let{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){let{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){let{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&$o(n,e)}remove(e){let{_finalizers:n}=this;n&&$o(n,e),e instanceof t&&e._removeParent(this)}};wt.EMPTY=(()=>{let t=new wt;return t.closed=!0,t})();var su=wt.EMPTY;function Ea(t){return t instanceof wt||t&&"closed"in t&&Me(t.remove)&&Me(t.add)&&Me(t.unsubscribe)}function wp(t){Me(t)?t():t.unsubscribe()}var wn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var kr={setTimeout(t,e,...n){let{delegate:i}=kr;return i?.setTimeout?i.setTimeout(t,e,...n):setTimeout(t,e,...n)},clearTimeout(t){let{delegate:e}=kr;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Ia(t){kr.setTimeout(()=>{let{onUnhandledError:e}=wn;if(e)e(t);else throw t})}function zo(){}var Cp=au("C",void 0,void 0);function Ep(t){return au("E",void 0,t)}function Ip(t){return au("N",t,void 0)}function au(t,e,n){return{kind:t,value:e,error:n}}var rr=null;function Br(t){if(wn.useDeprecatedSynchronousErrorHandling){let e=!rr;if(e&&(rr={errorThrown:!1,error:null}),t(),e){let{errorThrown:n,error:i}=rr;if(rr=null,n)throw i}}else t()}function bp(t){wn.useDeprecatedSynchronousErrorHandling&&rr&&(rr.errorThrown=!0,rr.error=t)}var or=class extends wt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Ea(e)&&e.add(this)):this.destination=vw}static create(e,n,i){return new jr(e,n,i)}next(e){this.isStopped?lu(Ip(e),this):this._next(e)}error(e){this.isStopped?lu(Ep(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?lu(Cp,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},gw=Function.prototype.bind;function cu(t,e){return gw.call(t,e)}var uu=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:n}=this;if(n.next)try{n.next(e)}catch(i){ba(i)}}error(e){let{partialObserver:n}=this;if(n.error)try{n.error(e)}catch(i){ba(i)}else ba(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(n){ba(n)}}},jr=class extends or{constructor(e,n,i){super();let r;if(Me(e)||!e)r={next:e??void 0,error:n??void 0,complete:i??void 0};else{let a;this&&wn.useDeprecatedNextContext?(a=Object.create(e),a.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&cu(e.next,a),error:e.error&&cu(e.error,a),complete:e.complete&&cu(e.complete,a)}):r=e}this.destination=new uu(r)}};function ba(t){wn.useDeprecatedSynchronousErrorHandling?bp(t):Ia(t)}function mw(t){throw t}function lu(t,e){let{onStoppedNotification:n}=wn;n&&kr.setTimeout(()=>n(t,e))}var vw={closed:!0,next:zo,error:mw,complete:zo};var Vr=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Gt(t){return t}function hu(...t){return du(t)}function du(t){return t.length===0?Gt:t.length===1?t[0]:function(n){return t.reduce((i,r)=>r(i),n)}}var ot=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){let i=new t;return i.source=this,i.operator=n,i}subscribe(n,i,r){let a=_w(n)?n:new jr(n,i,r);return Br(()=>{let{operator:d,source:v}=this;a.add(d?d.call(a,v):v?this._subscribe(a):this._trySubscribe(a))}),a}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return i=Dp(i),new i((r,a)=>{let d=new jr({next:v=>{try{n(v)}catch(y){a(y),d.unsubscribe()}},error:a,complete:r});this.subscribe(d)})}_subscribe(n){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(n)}[Vr](){return this}pipe(...n){return du(n)(this)}toPromise(n){return n=Dp(n),new n((i,r)=>{let a;this.subscribe(d=>a=d,d=>r(d),()=>i(a))})}}return t.create=e=>new t(e),t})();function Dp(t){var e;return(e=t??wn.Promise)!==null&&e!==void 0?e:Promise}function yw(t){return t&&Me(t.next)&&Me(t.error)&&Me(t.complete)}function _w(t){return t&&t instanceof or||yw(t)&&Ea(t)}function fu(t){return Me(t?.lift)}function Ye(t){return e=>{if(fu(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Xe(t,e,n,i,r){return new pu(t,e,n,i,r)}var pu=class extends or{constructor(e,n,i,r,a,d){super(e),this.onFinalize=a,this.shouldUnsubscribe=d,this._next=n?function(v){try{n(v)}catch(y){e.error(y)}}:super._next,this._error=r?function(v){try{r(v)}catch(y){e.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(v){e.error(v)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:n}=this;super.unsubscribe(),!n&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function Ur(){return Ye((t,e)=>{let n=null;t._refCount++;let i=Xe(e,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){n=null;return}let r=t._connection,a=n;n=null,r&&(!a||r===a)&&r.unsubscribe(),e.unsubscribe()});t.subscribe(i),i.closed||(n=t.connect())})}var Hr=class extends ot{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,fu(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new wt;let n=this.getSubject();e.add(this.source.subscribe(Xe(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=wt.EMPTY)}return e}refCount(){return Ur()(this)}};var Sp=Fr(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Bt=(()=>{class t extends ot{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){let i=new Da(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new Sp}next(n){Br(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let i of this.currentObservers)i.next(n)}})}error(n){Br(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;let{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){Br(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){let{hasError:i,isStopped:r,observers:a}=this;return i||r?su:(this.currentObservers=null,a.push(n),new wt(()=>{this.currentObservers=null,$o(a,n)}))}_checkFinalizedStatuses(n){let{hasError:i,thrownError:r,isStopped:a}=this;i?n.error(r):a&&n.complete()}asObservable(){let n=new ot;return n.source=this,n}}return t.create=(e,n)=>new Da(e,n),t})(),Da=class extends Bt{constructor(e,n){super(),this.destination=e,this.source=n}next(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,e)}error(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,e)}complete(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)}_subscribe(e){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&i!==void 0?i:su}};var xt=class extends Bt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let n=super._subscribe(e);return!n.closed&&e.next(this._value),n}getValue(){let{hasError:e,thrownError:n,_value:i}=this;if(e)throw n;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}};var Wt=new ot(t=>t.complete());function Tp(t){return t&&Me(t.schedule)}function xp(t){return t[t.length-1]}function Ap(t){return Me(xp(t))?t.pop():void 0}function Ii(t){return Tp(xp(t))?t.pop():void 0}function Op(t,e,n,i){function r(a){return a instanceof n?a:new n(function(d){d(a)})}return new(n||(n=Promise))(function(a,d){function v(b){try{C(i.next(b))}catch(T){d(T)}}function y(b){try{C(i.throw(b))}catch(T){d(T)}}function C(b){b.done?a(b.value):r(b.value).then(v,y)}C((i=i.apply(t,e||[])).next())})}function Mp(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function sr(t){return this instanceof sr?(this.v=t,this):new sr(t)}function Rp(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,a=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),v("next"),v("throw"),v("return",d),r[Symbol.asyncIterator]=function(){return this},r;function d(O){return function(L){return Promise.resolve(L).then(O,T)}}function v(O,L){i[O]&&(r[O]=function(P){return new Promise(function(Y,H){a.push([O,P,Y,H])>1||y(O,P)})},L&&(r[O]=L(r[O])))}function y(O,L){try{C(i[O](L))}catch(P){M(a[0][3],P)}}function C(O){O.value instanceof sr?Promise.resolve(O.value.v).then(b,T):M(a[0][2],O)}function b(O){y("next",O)}function T(O){y("throw",O)}function M(O,L){O(L),a.shift(),a.length&&y(a[0][0],a[0][1])}}function Lp(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Mp=="function"?Mp(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(a){n[a]=t[a]&&function(d){return new Promise(function(v,y){d=t[a](d),r(v,y,d.done,d.value)})}}function r(a,d,v,y){Promise.resolve(y).then(function(C){a({value:C,done:v})},d)}}var Sa=t=>t&&typeof t.length=="number"&&typeof t!="function";function Ta(t){return Me(t?.then)}function xa(t){return Me(t[Vr])}function Aa(t){return Symbol.asyncIterator&&Me(t?.[Symbol.asyncIterator])}function Ma(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function ww(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Oa=ww();function Ra(t){return Me(t?.[Oa])}function La(t){return Rp(this,arguments,function*(){let n=t.getReader();try{for(;;){let{value:i,done:r}=yield sr(n.read());if(r)return yield sr(void 0);yield yield sr(i)}}finally{n.releaseLock()}})}function Na(t){return Me(t?.getReader)}function St(t){if(t instanceof ot)return t;if(t!=null){if(xa(t))return Cw(t);if(Sa(t))return Ew(t);if(Ta(t))return Iw(t);if(Aa(t))return Np(t);if(Ra(t))return bw(t);if(Na(t))return Dw(t)}throw Ma(t)}function Cw(t){return new ot(e=>{let n=t[Vr]();if(Me(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Ew(t){return new ot(e=>{for(let n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function Iw(t){return new ot(e=>{t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,Ia)})}function bw(t){return new ot(e=>{for(let n of t)if(e.next(n),e.closed)return;e.complete()})}function Np(t){return new ot(e=>{Sw(t,e).catch(n=>e.error(n))})}function Dw(t){return Np(La(t))}function Sw(t,e){var n,i,r,a;return Op(this,void 0,void 0,function*(){try{for(n=Lp(t);i=yield n.next(),!i.done;){let d=i.value;if(e.next(d),e.closed)return}}catch(d){r={error:d}}finally{try{i&&!i.done&&(a=n.return)&&(yield a.call(n))}finally{if(r)throw r.error}}e.complete()})}function jt(t,e,n,i=0,r=!1){let a=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(a),!r)return a}function Pa(t,e=0){return Ye((n,i)=>{n.subscribe(Xe(i,r=>jt(i,t,()=>i.next(r),e),()=>jt(i,t,()=>i.complete(),e),r=>jt(i,t,()=>i.error(r),e)))})}function Fa(t,e=0){return Ye((n,i)=>{i.add(t.schedule(()=>n.subscribe(i),e))})}function Pp(t,e){return St(t).pipe(Fa(e),Pa(e))}function Fp(t,e){return St(t).pipe(Fa(e),Pa(e))}function kp(t,e){return new ot(n=>{let i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function Bp(t,e){return new ot(n=>{let i;return jt(n,e,()=>{i=t[Oa](),jt(n,e,()=>{let r,a;try{({value:r,done:a}=i.next())}catch(d){n.error(d);return}a?n.complete():n.next(r)},0,!0)}),()=>Me(i?.return)&&i.return()})}function ka(t,e){if(!t)throw new Error("Iterable cannot be null");return new ot(n=>{jt(n,e,()=>{let i=t[Symbol.asyncIterator]();jt(n,e,()=>{i.next().then(r=>{r.done?n.complete():n.next(r.value)})},0,!0)})})}function jp(t,e){return ka(La(t),e)}function Vp(t,e){if(t!=null){if(xa(t))return Pp(t,e);if(Sa(t))return kp(t,e);if(Ta(t))return Fp(t,e);if(Aa(t))return ka(t,e);if(Ra(t))return Bp(t,e);if(Na(t))return jp(t,e)}throw Ma(t)}function Ct(t,e){return e?Vp(t,e):St(t)}function Oe(...t){let e=Ii(t);return Ct(t,e)}function Gr(t,e){let n=Me(t)?t:()=>t,i=r=>r.error(n());return new ot(e?r=>e.schedule(i,0,r):i)}function gu(t){return!!t&&(t instanceof ot||Me(t.lift)&&Me(t.subscribe))}var ti=Fr(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function qe(t,e){return Ye((n,i)=>{let r=0;n.subscribe(Xe(i,a=>{i.next(t.call(e,a,r++))}))})}var{isArray:Tw}=Array;function xw(t,e){return Tw(e)?t(...e):t(e)}function Up(t){return qe(e=>xw(t,e))}var{isArray:Aw}=Array,{getPrototypeOf:Mw,prototype:Ow,keys:Rw}=Object;function Hp(t){if(t.length===1){let e=t[0];if(Aw(e))return{args:e,keys:null};if(Lw(e)){let n=Rw(e);return{args:n.map(i=>e[i]),keys:n}}}return{args:t,keys:null}}function Lw(t){return t&&typeof t=="object"&&Mw(t)===Ow}function Gp(t,e){return t.reduce((n,i,r)=>(n[i]=e[r],n),{})}function Ba(...t){let e=Ii(t),n=Ap(t),{args:i,keys:r}=Hp(t);if(i.length===0)return Ct([],e);let a=new ot(Nw(i,e,r?d=>Gp(r,d):Gt));return n?a.pipe(Up(n)):a}function Nw(t,e,n=Gt){return i=>{Wp(e,()=>{let{length:r}=t,a=new Array(r),d=r,v=r;for(let y=0;y<r;y++)Wp(e,()=>{let C=Ct(t[y],e),b=!1;C.subscribe(Xe(i,T=>{a[y]=T,b||(b=!0,v--),v||i.next(n(a.slice()))},()=>{--d||i.complete()}))},i)},i)}}function Wp(t,e,n){t?jt(n,t,e):e()}function $p(t,e,n,i,r,a,d,v){let y=[],C=0,b=0,T=!1,M=()=>{T&&!y.length&&!C&&e.complete()},O=P=>C<i?L(P):y.push(P),L=P=>{a&&e.next(P),C++;let Y=!1;St(n(P,b++)).subscribe(Xe(e,H=>{r?.(H),a?O(H):e.next(H)},()=>{Y=!0},void 0,()=>{if(Y)try{for(C--;y.length&&C<i;){let H=y.shift();d?jt(e,d,()=>L(H)):L(H)}M()}catch(H){e.error(H)}}))};return t.subscribe(Xe(e,O,()=>{T=!0,M()})),()=>{v?.()}}function Et(t,e,n=1/0){return Me(e)?Et((i,r)=>qe((a,d)=>e(i,a,r,d))(St(t(i,r))),n):(typeof e=="number"&&(n=e),Ye((i,r)=>$p(i,r,t,n)))}function mu(t=1/0){return Et(Gt,t)}function zp(){return mu(1)}function Wr(...t){return zp()(Ct(t,Ii(t)))}function ja(t){return new ot(e=>{St(t()).subscribe(e)})}function Cn(t,e){return Ye((n,i)=>{let r=0;n.subscribe(Xe(i,a=>t.call(e,a,r++)&&i.next(a)))})}function bi(t){return Ye((e,n)=>{let i=null,r=!1,a;i=e.subscribe(Xe(n,void 0,void 0,d=>{a=St(t(d,bi(t)(e))),i?(i.unsubscribe(),i=null,a.subscribe(n)):r=!0})),r&&(i.unsubscribe(),i=null,a.subscribe(n))})}function Yp(t,e,n,i,r){return(a,d)=>{let v=n,y=e,C=0;a.subscribe(Xe(d,b=>{let T=C++;y=v?t(y,b,T):(v=!0,b),i&&d.next(y)},r&&(()=>{v&&d.next(y),d.complete()})))}}function $r(t,e){return Me(e)?Et(t,e,1):Et(t,1)}function Di(t){return Ye((e,n)=>{let i=!1;e.subscribe(Xe(n,r=>{i=!0,n.next(r)},()=>{i||n.next(t),n.complete()}))})}function ni(t){return t<=0?()=>Wt:Ye((e,n)=>{let i=0;e.subscribe(Xe(n,r=>{++i<=t&&(n.next(r),t<=i&&n.complete())}))})}function vu(t){return qe(()=>t)}function Va(t=Pw){return Ye((e,n)=>{let i=!1;e.subscribe(Xe(n,r=>{i=!0,n.next(r)},()=>i?n.complete():n.error(t())))})}function Pw(){return new ti}function Yo(t){return Ye((e,n)=>{try{e.subscribe(n)}finally{n.add(t)}})}function Fn(t,e){let n=arguments.length>=2;return i=>i.pipe(t?Cn((r,a)=>t(r,a,i)):Gt,ni(1),n?Di(e):Va(()=>new ti))}function zr(t){return t<=0?()=>Wt:Ye((e,n)=>{let i=[];e.subscribe(Xe(n,r=>{i.push(r),t<i.length&&i.shift()},()=>{for(let r of i)n.next(r);n.complete()},void 0,()=>{i=null}))})}function yu(t,e){let n=arguments.length>=2;return i=>i.pipe(t?Cn((r,a)=>t(r,a,i)):Gt,zr(1),n?Di(e):Va(()=>new ti))}function _u(t,e){return Ye(Yp(t,e,arguments.length>=2,!0))}function wu(...t){let e=Ii(t);return Ye((n,i)=>{(e?Wr(t,n,e):Wr(t,n)).subscribe(i)})}function En(t,e){return Ye((n,i)=>{let r=null,a=0,d=!1,v=()=>d&&!r&&i.complete();n.subscribe(Xe(i,y=>{r?.unsubscribe();let C=0,b=a++;St(t(y,b)).subscribe(r=Xe(i,T=>i.next(e?e(y,T,b,C++):T),()=>{r=null,v()}))},()=>{d=!0,v()}))})}function Cu(t){return Ye((e,n)=>{St(t).subscribe(Xe(n,()=>n.complete(),zo)),!n.closed&&e.subscribe(n)})}function At(t,e,n){let i=Me(t)||e||n?{next:t,error:e,complete:n}:t;return i?Ye((r,a)=>{var d;(d=i.subscribe)===null||d===void 0||d.call(i);let v=!0;r.subscribe(Xe(a,y=>{var C;(C=i.next)===null||C===void 0||C.call(i,y),a.next(y)},()=>{var y;v=!1,(y=i.complete)===null||y===void 0||y.call(i),a.complete()},y=>{var C;v=!1,(C=i.error)===null||C===void 0||C.call(i,y),a.error(y)},()=>{var y,C;v&&((y=i.unsubscribe)===null||y===void 0||y.call(i)),(C=i.finalize)===null||C===void 0||C.call(i)}))}):Gt}var Ae=class extends Error{constructor(e,n){super(Ch(e,n)),this.code=e}};function Ch(t,e){return`${`NG0${Math.abs(t)}`}${e?": "+e:""}`}function uc(t){return{toString:t}.toString()}var Ua="__parameters__";function Fw(t){return function(...n){if(t){let i=t(...n);for(let r in i)this[r]=i[r]}}}function Sg(t,e,n){return uc(()=>{let i=Fw(e);function r(...a){if(this instanceof r)return i.apply(this,a),this;let d=new r(...a);return v.annotation=d,v;function v(y,C,b){let T=y.hasOwnProperty(Ua)?y[Ua]:Object.defineProperty(y,Ua,{value:[]})[Ua];for(;T.length<=b;)T.push(null);return(T[b]=T[b]||[]).push(d),y}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=t,r.annotationCls=r,r})}var Xo=globalThis;function at(t){for(let e in t)if(t[e]===at)return e;throw Error("Could not find renamed property on target object.")}function $t(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map($t).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let e=t.toString();if(e==null)return""+e;let n=e.indexOf(`
`);return n===-1?e:e.substring(0,n)}function Xp(t,e){return t==null||t===""?e===null?"":e:e==null||e===""?t:t+" "+e}var kw=at({__forward_ref__:at});function Tg(t){return t.__forward_ref__=Tg,t.toString=function(){return $t(this())},t}function cn(t){return xg(t)?t():t}function xg(t){return typeof t=="function"&&t.hasOwnProperty(kw)&&t.__forward_ref__===Tg}function Re(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function hc(t){return qp(t,Mg)||qp(t,Og)}function Ag(t){return hc(t)!==null}function qp(t,e){return t.hasOwnProperty(e)?t[e]:null}function Bw(t){let e=t&&(t[Mg]||t[Og]);return e||null}function Zp(t){return t&&(t.hasOwnProperty(Kp)||t.hasOwnProperty(jw))?t[Kp]:null}var Mg=at({\u0275prov:at}),Kp=at({\u0275inj:at}),Og=at({ngInjectableDef:at}),jw=at({ngInjectorDef:at}),nt=class{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof n=="number"?this.__NG_ELEMENT_ID__=n:n!==void 0&&(this.\u0275prov=Re({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function Rg(t){return t&&!!t.\u0275providers}var Vw=at({\u0275cmp:at}),Uw=at({\u0275dir:at}),Hw=at({\u0275pipe:at}),Gw=at({\u0275mod:at}),Xa=at({\u0275fac:at}),qo=at({__NG_ELEMENT_ID__:at}),Qp=at({__NG_ENV_ID__:at});function Lg(t){return typeof t=="string"?t:t==null?"":String(t)}function Ww(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():Lg(t)}function $w(t,e){let n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new Ae(-200,t)}function Eh(t,e){throw new Ae(-201,!1)}var Ge=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(Ge||{}),Ru;function Ng(){return Ru}function an(t){let e=Ru;return Ru=t,e}function Pg(t,e,n){let i=hc(t);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(n&Ge.Optional)return null;if(e!==void 0)return e;Eh(t,"Injector")}var zw={},Zo=zw,Lu="__NG_DI_FLAG__",qa="ngTempTokenPath",Yw="ngTokenPath",Xw=/\n/gm,qw="\u0275",Jp="__source",Zr;function Zw(){return Zr}function Si(t){let e=Zr;return Zr=t,e}function Kw(t,e=Ge.Default){if(Zr===void 0)throw new Ae(-203,!1);return Zr===null?Pg(t,void 0,e):Zr.get(t,e&Ge.Optional?null:void 0,e)}function Ze(t,e=Ge.Default){return(Ng()||Kw)(cn(t),e)}function Ie(t,e=Ge.Default){return Ze(t,dc(e))}function dc(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Nu(t){let e=[];for(let n=0;n<t.length;n++){let i=cn(t[n]);if(Array.isArray(i)){if(i.length===0)throw new Ae(900,!1);let r,a=Ge.Default;for(let d=0;d<i.length;d++){let v=i[d],y=Qw(v);typeof y=="number"?y===-1?r=v.token:a|=y:r=v}e.push(Ze(r,a))}else e.push(Ze(i))}return e}function Fg(t,e){return t[Lu]=e,t.prototype[Lu]=e,t}function Qw(t){return t[Lu]}function Jw(t,e,n,i){let r=t[qa];throw e[Jp]&&r.unshift(e[Jp]),t.message=e0(`
`+t.message,r,n,i),t[Yw]=r,t[qa]=null,t}function e0(t,e,n,i=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==qw?t.slice(2):t;let r=$t(e);if(Array.isArray(e))r=e.map($t).join(" -> ");else if(typeof e=="object"){let a=[];for(let d in e)if(e.hasOwnProperty(d)){let v=e[d];a.push(d+":"+(typeof v=="string"?JSON.stringify(v):$t(v)))}r=`{${a.join(", ")}}`}return`${n}${i?"("+i+")":""}[${r}]: ${t.replace(Xw,`
  `)}`}var Ih=Fg(Sg("Optional"),8);var kg=Fg(Sg("SkipSelf"),4);function Qr(t,e){let n=t.hasOwnProperty(Xa);return n?t[Xa]:null}function t0(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){let r=t[i],a=e[i];if(n&&(r=n(r),a=n(a)),a!==r)return!1}return!0}function n0(t){return t.flat(Number.POSITIVE_INFINITY)}function bh(t,e){t.forEach(n=>Array.isArray(n)?bh(n,e):e(n))}function Bg(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Za(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}var Ko={},Jr=[],eo=new nt(""),jg=new nt("",-1),Vg=new nt(""),Ka=class{get(e,n=Zo){if(n===Zo){let i=new Error(`NullInjectorError: No provider for ${$t(e)}!`);throw i.name="NullInjectorError",i}return n}},Ug=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Ug||{}),jn=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(jn||{}),xi=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(xi||{});function i0(t,e,n){let i=t.length;for(;;){let r=t.indexOf(e,n);if(r===-1)return r;if(r===0||t.charCodeAt(r-1)<=32){let a=e.length;if(r+a===i||t.charCodeAt(r+a)<=32)return r}n=r+1}}function Pu(t,e,n){let i=0;for(;i<n.length;){let r=n[i];if(typeof r=="number"){if(r!==0)break;i++;let a=n[i++],d=n[i++],v=n[i++];t.setAttribute(e,d,v,a)}else{let a=r,d=n[++i];o0(a)?t.setProperty(e,a,d):t.setAttribute(e,a,d),i++}}return i}function r0(t){return t===3||t===4||t===6}function o0(t){return t.charCodeAt(0)===64}function Dh(t,e){if(!(e===null||e.length===0))if(t===null||t.length===0)t=e.slice();else{let n=-1;for(let i=0;i<e.length;i++){let r=e[i];typeof r=="number"?n=r:n===0||(n===-1||n===2?eg(t,n,r,null,e[++i]):eg(t,n,r,null,null))}}return t}function eg(t,e,n,i,r){let a=0,d=t.length;if(e===-1)d=-1;else for(;a<t.length;){let v=t[a++];if(typeof v=="number"){if(v===e){d=-1;break}else if(v>e){d=a-1;break}}}for(;a<t.length;){let v=t[a];if(typeof v=="number")break;if(v===n){if(i===null){r!==null&&(t[a+1]=r);return}else if(i===t[a+1]){t[a+2]=r;return}}a++,i!==null&&a++,r!==null&&a++}d!==-1&&(t.splice(d,0,e),a=d+1),t.splice(a++,0,n),i!==null&&t.splice(a++,0,i),r!==null&&t.splice(a++,0,r)}var Hg="ng-template";function s0(t,e,n,i){let r=0;if(i){for(;r<e.length&&typeof e[r]=="string";r+=2)if(e[r]==="class"&&i0(e[r+1].toLowerCase(),n,0)!==-1)return!0}else if(Sh(t))return!1;if(r=e.indexOf(1,r),r>-1){let a;for(;++r<e.length&&typeof(a=e[r])=="string";)if(a.toLowerCase()===n)return!0}return!1}function Sh(t){return t.type===4&&t.value!==Hg}function a0(t,e,n){let i=t.type===4&&!n?Hg:t.value;return e===i}function c0(t,e,n){let i=4,r=t.attrs,a=r!==null?h0(r):0,d=!1;for(let v=0;v<e.length;v++){let y=e[v];if(typeof y=="number"){if(!d&&!In(i)&&!In(y))return!1;if(d&&In(y))continue;d=!1,i=y|i&1;continue}if(!d)if(i&4){if(i=2|i&1,y!==""&&!a0(t,y,n)||y===""&&e.length===1){if(In(i))return!1;d=!0}}else if(i&8){if(r===null||!s0(t,r,y,n)){if(In(i))return!1;d=!0}}else{let C=e[++v],b=l0(y,r,Sh(t),n);if(b===-1){if(In(i))return!1;d=!0;continue}if(C!==""){let T;if(b>a?T="":T=r[b+1].toLowerCase(),i&2&&C!==T){if(In(i))return!1;d=!0}}}}return In(i)||d}function In(t){return(t&1)===0}function l0(t,e,n,i){if(e===null)return-1;let r=0;if(i||!n){let a=!1;for(;r<e.length;){let d=e[r];if(d===t)return r;if(d===3||d===6)a=!0;else if(d===1||d===2){let v=e[++r];for(;typeof v=="string";)v=e[++r];continue}else{if(d===4)break;if(d===0){r+=4;continue}}r+=a?1:2}return-1}else return d0(e,t)}function u0(t,e,n=!1){for(let i=0;i<e.length;i++)if(c0(t,e[i],n))return!0;return!1}function h0(t){for(let e=0;e<t.length;e++){let n=t[e];if(r0(n))return e}return t.length}function d0(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){let i=t[n];if(typeof i=="number")return-1;if(i===e)return n;n++}return-1}function tg(t,e){return t?":not("+e.trim()+")":e}function f0(t){let e=t[0],n=1,i=2,r="",a=!1;for(;n<t.length;){let d=t[n];if(typeof d=="string")if(i&2){let v=t[++n];r+="["+d+(v.length>0?'="'+v+'"':"")+"]"}else i&8?r+="."+d:i&4&&(r+=" "+d);else r!==""&&!In(d)&&(e+=tg(a,r),r=""),i=d,a=a||!In(i);n++}return r!==""&&(e+=tg(a,r)),e}function p0(t){return t.map(f0).join(",")}function g0(t){let e=[],n=[],i=1,r=2;for(;i<t.length;){let a=t[i];if(typeof a=="string")r===2?a!==""&&e.push(a,t[++i]):r===8&&n.push(a);else{if(!In(r))break;r=a}i++}return{attrs:e,classes:n}}function Mi(t){return uc(()=>{let e=Yg(t),n=mt(Te({},e),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Ug.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||jn.Emulated,styles:t.styles||Jr,_:null,schemas:t.schemas||null,tView:null,id:""});Xg(n);let i=t.dependencies;return n.directiveDefs=ig(i,!1),n.pipeDefs=ig(i,!0),n.id=y0(n),n})}function m0(t){return lr(t)||Gg(t)}function v0(t){return t!==null}function ng(t,e){if(t==null)return Ko;let n={};for(let i in t)if(t.hasOwnProperty(i)){let r=t[i],a,d,v=xi.None;Array.isArray(r)?(v=r[0],a=r[1],d=r[2]??a):(a=r,d=r),e?(n[a]=v!==xi.None?[i,v]:i,e[a]=d):n[a]=i}return n}function fc(t){return uc(()=>{let e=Yg(t);return Xg(e),e})}function lr(t){return t[Vw]||null}function Gg(t){return t[Uw]||null}function Wg(t){return t[Hw]||null}function $g(t){let e=lr(t)||Gg(t)||Wg(t);return e!==null?e.standalone:!1}function zg(t,e){let n=t[Gw]||null;if(!n&&e===!0)throw new Error(`Type ${$t(t)} does not have '\u0275mod' property.`);return n}function Yg(t){let e={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:t.inputs||Ko,exportAs:t.exportAs||null,standalone:t.standalone===!0,signals:t.signals===!0,selectors:t.selectors||Jr,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ng(t.inputs,e),outputs:ng(t.outputs),debugInfo:null}}function Xg(t){t.features?.forEach(e=>e(t))}function ig(t,e){if(!t)return null;let n=e?Wg:m0;return()=>(typeof t=="function"?t():t).map(i=>n(i)).filter(v0)}function y0(t){let e=0,n=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(let r of n)e=Math.imul(31,e)+r.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function Th(t){return{\u0275providers:t}}function _0(...t){return{\u0275providers:qg(!0,t),\u0275fromNgModule:!0}}function qg(t,...e){let n=[],i=new Set,r,a=d=>{n.push(d)};return bh(e,d=>{let v=d;Fu(v,a,[],i)&&(r||=[],r.push(v))}),r!==void 0&&Zg(r,a),n}function Zg(t,e){for(let n=0;n<t.length;n++){let{ngModule:i,providers:r}=t[n];xh(r,a=>{e(a,i)})}}function Fu(t,e,n,i){if(t=cn(t),!t)return!1;let r=null,a=Zp(t),d=!a&&lr(t);if(!a&&!d){let y=t.ngModule;if(a=Zp(y),a)r=y;else return!1}else{if(d&&!d.standalone)return!1;r=t}let v=i.has(r);if(d){if(v)return!1;if(i.add(r),d.dependencies){let y=typeof d.dependencies=="function"?d.dependencies():d.dependencies;for(let C of y)Fu(C,e,n,i)}}else if(a){if(a.imports!=null&&!v){i.add(r);let C;try{bh(a.imports,b=>{Fu(b,e,n,i)&&(C||=[],C.push(b))})}finally{}C!==void 0&&Zg(C,e)}if(!v){let C=Qr(r)||(()=>new r);e({provide:r,useFactory:C,deps:Jr},r),e({provide:Vg,useValue:r,multi:!0},r),e({provide:eo,useValue:()=>Ze(r),multi:!0},r)}let y=a.providers;if(y!=null&&!v){let C=t;xh(y,b=>{e(b,C)})}}else return!1;return r!==t&&t.providers!==void 0}function xh(t,e){for(let n of t)Rg(n)&&(n=n.\u0275providers),Array.isArray(n)?xh(n,e):e(n)}var w0=at({provide:String,useValue:at});function Kg(t){return t!==null&&typeof t=="object"&&w0 in t}function C0(t){return!!(t&&t.useExisting)}function E0(t){return!!(t&&t.useFactory)}function ku(t){return typeof t=="function"}var pc=new nt(""),Ha={},I0={},Eu;function Ah(){return Eu===void 0&&(Eu=new Ka),Eu}var un=class{},Qo=class extends un{get destroyed(){return this._destroyed}constructor(e,n,i,r){super(),this.parent=n,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ju(e,d=>this.processProvider(d)),this.records.set(jg,Yr(void 0,this)),r.has("environment")&&this.records.set(un,Yr(void 0,this));let a=this.records.get(pc);a!=null&&typeof a.value=="string"&&this.scopes.add(a.value),this.injectorDefTypes=new Set(this.get(Vg,Jr,Ge.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let e=Ke(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let n=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of n)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ke(e)}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let n=Si(this),i=an(void 0),r;try{return e()}finally{Si(n),an(i)}}get(e,n=Zo,i=Ge.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(Qp))return e[Qp](this);i=dc(i);let r,a=Si(this),d=an(void 0);try{if(!(i&Ge.SkipSelf)){let y=this.records.get(e);if(y===void 0){let C=A0(e)&&hc(e);C&&this.injectableDefInScope(C)?y=Yr(Bu(e),Ha):y=null,this.records.set(e,y)}if(y!=null)return this.hydrate(e,y)}let v=i&Ge.Self?Ah():this.parent;return n=i&Ge.Optional&&n===Zo?null:n,v.get(e,n)}catch(v){if(v.name==="NullInjectorError"){if((v[qa]=v[qa]||[]).unshift($t(e)),a)throw v;return Jw(v,e,"R3InjectorError",this.source)}else throw v}finally{an(d),Si(a)}}resolveInjectorInitializers(){let e=Ke(null),n=Si(this),i=an(void 0),r;try{let a=this.get(eo,Jr,Ge.Self);for(let d of a)d()}finally{Si(n),an(i),Ke(e)}}toString(){let e=[],n=this.records;for(let i of n.keys())e.push($t(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ae(205,!1)}processProvider(e){e=cn(e);let n=ku(e)?e:cn(e&&e.provide),i=D0(e);if(!ku(e)&&e.multi===!0){let r=this.records.get(n);r||(r=Yr(void 0,Ha,!0),r.factory=()=>Nu(r.multi),this.records.set(n,r)),n=e,r.multi.push(e)}this.records.set(n,i)}hydrate(e,n){let i=Ke(null);try{return n.value===Ha&&(n.value=I0,n.value=n.factory()),typeof n.value=="object"&&n.value&&x0(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{Ke(i)}}injectableDefInScope(e){if(!e.providedIn)return!1;let n=cn(e.providedIn);return typeof n=="string"?n==="any"||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(e){let n=this._onDestroyHooks.indexOf(e);n!==-1&&this._onDestroyHooks.splice(n,1)}};function Bu(t){let e=hc(t),n=e!==null?e.factory:Qr(t);if(n!==null)return n;if(t instanceof nt)throw new Ae(204,!1);if(t instanceof Function)return b0(t);throw new Ae(204,!1)}function b0(t){if(t.length>0)throw new Ae(204,!1);let n=Bw(t);return n!==null?()=>n.factory(t):()=>new t}function D0(t){if(Kg(t))return Yr(void 0,t.useValue);{let e=S0(t);return Yr(e,Ha)}}function S0(t,e,n){let i;if(ku(t)){let r=cn(t);return Qr(r)||Bu(r)}else if(Kg(t))i=()=>cn(t.useValue);else if(E0(t))i=()=>t.useFactory(...Nu(t.deps||[]));else if(C0(t))i=()=>Ze(cn(t.useExisting));else{let r=cn(t&&(t.useClass||t.provide));if(T0(t))i=()=>new r(...Nu(t.deps));else return Qr(r)||Bu(r)}return i}function Yr(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function T0(t){return!!t.deps}function x0(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function A0(t){return typeof t=="function"||typeof t=="object"&&t instanceof nt}function ju(t,e){for(let n of t)Array.isArray(n)?ju(n,e):n&&Rg(n)?ju(n.\u0275providers,e):e(n)}function gr(t,e){t instanceof Qo&&t.assertNotDestroyed();let n,i=Si(t),r=an(void 0);try{return e()}finally{Si(i),an(r)}}function M0(){return Ng()!==void 0||Zw()!=null}function O0(t){return typeof t=="function"}var oi=0,Fe=1,xe=2,Mt=3,bn=4,Dn=5,Qa=6,Jo=7,Vn=8,to=9,Un=10,Ft=11,es=12,rg=13,cs=14,Hn=15,ls=16,Xr=17,ii=18,gc=19,Qg=20,Ti=21,Iu=22,ur=23,Gn=25,Jg=1;var hr=7,Ja=8,no=9,Vt=10,Mh=function(t){return t[t.None=0]="None",t[t.HasTransplantedViews=2]="HasTransplantedViews",t}(Mh||{});function ar(t){return Array.isArray(t)&&typeof t[Jg]=="object"}function si(t){return Array.isArray(t)&&t[Jg]===!0}function em(t){return(t.flags&4)!==0}function mc(t){return t.componentOffset>-1}function Oh(t){return(t.flags&1)===1}function us(t){return!!t.template}function R0(t){return(t[xe]&512)!==0}var Vu=class{constructor(e,n,i){this.previousValue=e,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}};function tm(t,e,n,i){e!==null?e.applyValueToInputSignal(e,i):t[n]=i}function vc(){return nm}function nm(t){return t.type.prototype.ngOnChanges&&(t.setInput=N0),L0}vc.ngInherit=!0;function L0(){let t=rm(this),e=t?.current;if(e){let n=t.previous;if(n===Ko)t.previous=e;else for(let i in e)n[i]=e[i];t.current=null,this.ngOnChanges(e)}}function N0(t,e,n,i,r){let a=this.declaredInputs[i],d=rm(t)||P0(t,{previous:Ko,current:null}),v=d.current||(d.current={}),y=d.previous,C=y[a];v[a]=new Vu(C&&C.currentValue,n,y===Ko),tm(t,e,r,n)}var im="__ngSimpleChanges__";function rm(t){return t[im]||null}function P0(t,e){return t[im]=e}var og=null;var kn=function(t,e,n){og?.(t,e,n)},F0="svg",k0="math",B0=!1;function j0(){return B0}function Wn(t){for(;Array.isArray(t);)t=t[oi];return t}function V0(t,e){return Wn(e[t])}function Sn(t,e){return Wn(e[t.index])}function Rh(t,e){return t.data[e]}function Oi(t,e){let n=e[t];return ar(n)?n:n[oi]}function U0(t){return(t[xe]&4)===4}function Lh(t){return(t[xe]&128)===128}function H0(t){return si(t[Mt])}function ec(t,e){return e==null?null:t[e]}function om(t){t[Xr]=0}function G0(t){t[xe]&1024||(t[xe]|=1024,Lh(t)&&ts(t))}function Nh(t){return!!(t[xe]&9216||t[ur]?.dirty)}function Uu(t){t[Un].changeDetectionScheduler?.notify(1),Nh(t)?ts(t):t[xe]&64&&(j0()?(t[xe]|=1024,ts(t)):t[Un].changeDetectionScheduler?.notify())}function ts(t){t[Un].changeDetectionScheduler?.notify();let e=ns(t);for(;e!==null&&!(e[xe]&8192||(e[xe]|=8192,!Lh(e)));)e=ns(e)}function sm(t,e){if((t[xe]&256)===256)throw new Ae(911,!1);t[Ti]===null&&(t[Ti]=[]),t[Ti].push(e)}function W0(t,e){if(t[Ti]===null)return;let n=t[Ti].indexOf(e);n!==-1&&t[Ti].splice(n,1)}function ns(t){let e=t[Mt];return si(e)?e[Mt]:e}var Qe={lFrame:fm(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function $0(){return Qe.lFrame.elementDepthCount}function z0(){Qe.lFrame.elementDepthCount++}function Y0(){Qe.lFrame.elementDepthCount--}function am(){return Qe.bindingsEnabled}function X0(){return Qe.skipHydrationRootTNode!==null}function q0(t){return Qe.skipHydrationRootTNode===t}function Z0(){Qe.skipHydrationRootTNode=null}function ut(){return Qe.lFrame.lView}function ai(){return Qe.lFrame.tView}function Tn(){let t=cm();for(;t!==null&&t.type===64;)t=t.parent;return t}function cm(){return Qe.lFrame.currentTNode}function K0(){let t=Qe.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}function hs(t,e){let n=Qe.lFrame;n.currentTNode=t,n.isParent=e}function lm(){return Qe.lFrame.isParent}function Q0(){Qe.lFrame.isParent=!1}function J0(){let t=Qe.lFrame,e=t.bindingRootIndex;return e===-1&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}function eC(t){return Qe.lFrame.bindingIndex=t}function Ph(){return Qe.lFrame.bindingIndex++}function tC(){return Qe.lFrame.inI18n}function nC(t,e){let n=Qe.lFrame;n.bindingIndex=n.bindingRootIndex=t,Hu(e)}function iC(){return Qe.lFrame.currentDirectiveIndex}function Hu(t){Qe.lFrame.currentDirectiveIndex=t}function um(){return Qe.lFrame.currentQueryIndex}function Fh(t){Qe.lFrame.currentQueryIndex=t}function rC(t){let e=t[Fe];return e.type===2?e.declTNode:e.type===1?t[Dn]:null}function hm(t,e,n){if(n&Ge.SkipSelf){let r=e,a=t;for(;r=r.parent,r===null&&!(n&Ge.Host);)if(r=rC(a),r===null||(a=a[cs],r.type&10))break;if(r===null)return!1;e=r,t=a}let i=Qe.lFrame=dm();return i.currentTNode=e,i.lView=t,!0}function kh(t){let e=dm(),n=t[Fe];Qe.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function dm(){let t=Qe.lFrame,e=t===null?null:t.child;return e===null?fm(t):e}function fm(t){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=e),e}function pm(){let t=Qe.lFrame;return Qe.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var gm=pm;function Bh(){let t=pm();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function jh(){return Qe.lFrame.selectedIndex}function dr(t){Qe.lFrame.selectedIndex=t}function oC(){let t=Qe.lFrame;return Rh(t.tView,t.selectedIndex)}function sC(){return Qe.lFrame.currentNamespace}var mm=!0;function Vh(){return mm}function Uh(t){mm=t}function aC(t,e,n){let{ngOnChanges:i,ngOnInit:r,ngDoCheck:a}=e.type.prototype;if(i){let d=nm(e);(n.preOrderHooks??=[]).push(t,d),(n.preOrderCheckHooks??=[]).push(t,d)}r&&(n.preOrderHooks??=[]).push(0-t,r),a&&((n.preOrderHooks??=[]).push(t,a),(n.preOrderCheckHooks??=[]).push(t,a))}function Hh(t,e){for(let n=e.directiveStart,i=e.directiveEnd;n<i;n++){let a=t.data[n].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:v,ngAfterViewInit:y,ngAfterViewChecked:C,ngOnDestroy:b}=a;d&&(t.contentHooks??=[]).push(-n,d),v&&((t.contentHooks??=[]).push(n,v),(t.contentCheckHooks??=[]).push(n,v)),y&&(t.viewHooks??=[]).push(-n,y),C&&((t.viewHooks??=[]).push(n,C),(t.viewCheckHooks??=[]).push(n,C)),b!=null&&(t.destroyHooks??=[]).push(n,b)}}function Ga(t,e,n){vm(t,e,3,n)}function Wa(t,e,n,i){(t[xe]&3)===n&&vm(t,e,n,i)}function bu(t,e){let n=t[xe];(n&3)===e&&(n&=16383,n+=1,t[xe]=n)}function vm(t,e,n,i){let r=i!==void 0?t[Xr]&65535:0,a=i??-1,d=e.length-1,v=0;for(let y=r;y<d;y++)if(typeof e[y+1]=="number"){if(v=e[y],i!=null&&v>=i)break}else e[y]<0&&(t[Xr]+=65536),(v<a||a==-1)&&(cC(t,n,e,y),t[Xr]=(t[Xr]&4294901760)+y+2),y++}function sg(t,e){kn(4,t,e);let n=Ke(null);try{e.call(t)}finally{Ke(n),kn(5,t,e)}}function cC(t,e,n,i){let r=n[i]<0,a=n[i+1],d=r?-n[i]:n[i],v=t[d];r?t[xe]>>14<t[Xr]>>16&&(t[xe]&3)===e&&(t[xe]+=16384,sg(v,a)):sg(v,a)}var Kr=-1,is=class{constructor(e,n,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}};function lC(t){return t instanceof is}function uC(t){return(t.flags&8)!==0}function hC(t){return(t.flags&16)!==0}function ym(t){return t!==Kr}function tc(t){return t&32767}function dC(t){return t>>16}function nc(t,e){let n=dC(t),i=e;for(;n>0;)i=i[cs],n--;return i}var Gu=!0;function ag(t){let e=Gu;return Gu=t,e}var fC=256,_m=fC-1,wm=5,pC=0,Bn={};function gC(t,e,n){let i;typeof n=="string"?i=n.charCodeAt(0)||0:n.hasOwnProperty(qo)&&(i=n[qo]),i==null&&(i=n[qo]=pC++);let r=i&_m,a=1<<r;e.data[t+(r>>wm)]|=a}function Cm(t,e){let n=Em(t,e);if(n!==-1)return n;let i=e[Fe];i.firstCreatePass&&(t.injectorIndex=e.length,Du(i.data,t),Du(e,null),Du(i.blueprint,null));let r=Gh(t,e),a=t.injectorIndex;if(ym(r)){let d=tc(r),v=nc(r,e),y=v[Fe].data;for(let C=0;C<8;C++)e[a+C]=v[d+C]|y[d+C]}return e[a+8]=r,a}function Du(t,e){t.push(0,0,0,0,0,0,0,0,e)}function Em(t,e){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||e[t.injectorIndex+8]===null?-1:t.injectorIndex}function Gh(t,e){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let n=0,i=null,r=e;for(;r!==null;){if(i=Tm(r),i===null)return Kr;if(n++,r=r[cs],i.injectorIndex!==-1)return i.injectorIndex|n<<16}return Kr}function mC(t,e,n){gC(t,e,n)}function Im(t,e,n){if(n&Ge.Optional||t!==void 0)return t;Eh(e,"NodeInjector")}function bm(t,e,n,i){if(n&Ge.Optional&&i===void 0&&(i=null),!(n&(Ge.Self|Ge.Host))){let r=t[to],a=an(void 0);try{return r?r.get(e,i,n&Ge.Optional):Pg(e,i,n&Ge.Optional)}finally{an(a)}}return Im(i,e,n)}function Dm(t,e,n,i=Ge.Default,r){if(t!==null){if(e[xe]&2048&&!(i&Ge.Self)){let d=wC(t,e,n,i,Bn);if(d!==Bn)return d}let a=Sm(t,e,n,i,Bn);if(a!==Bn)return a}return bm(e,n,i,r)}function Sm(t,e,n,i,r){let a=yC(n);if(typeof a=="function"){if(!hm(e,t,i))return i&Ge.Host?Im(r,n,i):bm(e,n,i,r);try{let d;if(d=a(i),d==null&&!(i&Ge.Optional))Eh(n);else return d}finally{gm()}}else if(typeof a=="number"){let d=null,v=Em(t,e),y=Kr,C=i&Ge.Host?e[Hn][Dn]:null;for((v===-1||i&Ge.SkipSelf)&&(y=v===-1?Gh(t,e):e[v+8],y===Kr||!lg(i,!1)?v=-1:(d=e[Fe],v=tc(y),e=nc(y,e)));v!==-1;){let b=e[Fe];if(cg(a,v,b.data)){let T=vC(v,e,n,d,i,C);if(T!==Bn)return T}y=e[v+8],y!==Kr&&lg(i,e[Fe].data[v+8]===C)&&cg(a,v,e)?(d=b,v=tc(y),e=nc(y,e)):v=-1}}return r}function vC(t,e,n,i,r,a){let d=e[Fe],v=d.data[t+8],y=i==null?mc(v)&&Gu:i!=d&&(v.type&3)!==0,C=r&Ge.Host&&a===v,b=$a(v,d,n,y,C);return b!==null?io(e,d,b,v):Bn}function $a(t,e,n,i,r){let a=t.providerIndexes,d=e.data,v=a&1048575,y=t.directiveStart,C=t.directiveEnd,b=a>>20,T=i?v:v+b,M=r?v+b:C;for(let O=T;O<M;O++){let L=d[O];if(O<y&&n===L||O>=y&&L.type===n)return O}if(r){let O=d[y];if(O&&us(O)&&O.type===n)return y}return null}function io(t,e,n,i){let r=t[n],a=e.data;if(lC(r)){let d=r;d.resolving&&$w(Ww(a[n]));let v=ag(d.canSeeViewProviders);d.resolving=!0;let y,C=d.injectImpl?an(d.injectImpl):null,b=hm(t,i,Ge.Default);try{r=t[n]=d.factory(void 0,a,t,i),e.firstCreatePass&&n>=i.directiveStart&&aC(n,a[n],e)}finally{C!==null&&an(C),ag(v),d.resolving=!1,gm()}}return r}function yC(t){if(typeof t=="string")return t.charCodeAt(0)||0;let e=t.hasOwnProperty(qo)?t[qo]:void 0;return typeof e=="number"?e>=0?e&_m:_C:e}function cg(t,e,n){let i=1<<t;return!!(n[e+(t>>wm)]&i)}function lg(t,e){return!(t&Ge.Self)&&!(t&Ge.Host&&e)}var cr=class{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,i){return Dm(this._tNode,this._lView,e,dc(i),n)}};function _C(){return new cr(Tn(),ut())}function Wh(t){return uc(()=>{let e=t.prototype.constructor,n=e[Xa]||Wu(e),i=Object.prototype,r=Object.getPrototypeOf(t.prototype).constructor;for(;r&&r!==i;){let a=r[Xa]||Wu(r);if(a&&a!==n)return a;r=Object.getPrototypeOf(r)}return a=>new a})}function Wu(t){return xg(t)?()=>{let e=Wu(cn(t));return e&&e()}:Qr(t)}function wC(t,e,n,i,r){let a=t,d=e;for(;a!==null&&d!==null&&d[xe]&2048&&!(d[xe]&512);){let v=Sm(a,d,n,i|Ge.Self,Bn);if(v!==Bn)return v;let y=a.parent;if(!y){let C=d[Qg];if(C){let b=C.get(n,Bn,i);if(b!==Bn)return b}y=Tm(d),d=d[cs]}a=y}return r}function Tm(t){let e=t[Fe],n=e.type;return n===2?e.declTNode:n===1?t[Dn]:null}function ug(t,e=null,n=null,i){let r=xm(t,e,n,i);return r.resolveInjectorInitializers(),r}function xm(t,e=null,n=null,i,r=new Set){let a=[n||Jr,_0(t)];return i=i||(typeof t=="object"?void 0:$t(t)),new Qo(a,e||Ah(),i||null,r)}var yc=(()=>{class t{static{this.THROW_IF_NOT_FOUND=Zo}static{this.NULL=new Ka}static create(n,i){if(Array.isArray(n))return ug({name:""},i,n,"");{let r=n.name??"";return ug({name:r},n.parent,n.providers,r)}}static{this.\u0275prov=Re({token:t,providedIn:"any",factory:()=>Ze(jg)})}static{this.__NG_ELEMENT_ID__=-1}}return t})();var CC="ngOriginalError";function Su(t){return t[CC]}var ri=class{constructor(){this._console=console}handleError(e){let n=this._findOriginalError(e);this._console.error("ERROR",e),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&Su(e);for(;n&&Su(n);)n=Su(n);return n||null}},Am=new nt("",{providedIn:"root",factory:()=>Ie(ri).handleError.bind(void 0)}),Mm=(()=>{class t{static{this.__NG_ELEMENT_ID__=EC}static{this.__NG_ENV_ID__=n=>n}}return t})(),$u=class extends Mm{constructor(e){super(),this._lView=e}onDestroy(e){return sm(this._lView,e),()=>W0(this._lView,e)}};function EC(){return new $u(ut())}function IC(){return ro(Tn(),ut())}function ro(t,e){return new Ri(Sn(t,e))}var Ri=(()=>{class t{constructor(n){this.nativeElement=n}static{this.__NG_ELEMENT_ID__=IC}}return t})();function bC(t){return t instanceof Ri?t.nativeElement:t}var zu=class extends Bt{constructor(e=!1){super(),this.destroyRef=void 0,this.__isAsync=e,M0()&&(this.destroyRef=Ie(Mm,{optional:!0})??void 0)}emit(e){let n=Ke(null);try{super.next(e)}finally{Ke(n)}}subscribe(e,n,i){let r=e,a=n||(()=>null),d=i;if(e&&typeof e=="object"){let y=e;r=y.next?.bind(y),a=y.error?.bind(y),d=y.complete?.bind(y)}this.__isAsync&&(a=Tu(a),r&&(r=Tu(r)),d&&(d=Tu(d)));let v=super.subscribe({next:r,error:a,complete:d});return e instanceof wt&&e.add(v),v}};function Tu(t){return e=>{setTimeout(t,void 0,e)}}var ln=zu;function DC(){return this._results[Symbol.iterator]()}var Yu=class t{get changes(){return this._changes??=new ln}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let n=t.prototype;n[Symbol.iterator]||(n[Symbol.iterator]=DC)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,n){return this._results.reduce(e,n)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,n){this.dirty=!1;let i=n0(e);(this._changesDetected=!t0(this._results,i,n))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function Om(t){return(t.flags&128)===128}var Rm=new Map,SC=0;function TC(){return SC++}function xC(t){Rm.set(t[gc],t)}function AC(t){Rm.delete(t[gc])}var hg="__ngContext__";function fr(t,e){ar(e)?(t[hg]=e[gc],xC(e)):t[hg]=e}function Lm(t){return Pm(t[es])}function Nm(t){return Pm(t[bn])}function Pm(t){for(;t!==null&&!si(t);)t=t[bn];return t}var Xu;function Fm(t){Xu=t}function MC(){if(Xu!==void 0)return Xu;if(typeof document<"u")return document;throw new Ae(210,!1)}var $h=new nt("",{providedIn:"root",factory:()=>OC}),OC="ng",zh=new nt(""),oo=new nt("",{providedIn:"platform",factory:()=>"unknown"});var Yh=new nt("",{providedIn:"root",factory:()=>MC().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var RC="h",LC="b";var NC=()=>null;function Xh(t,e,n=!1){return NC(t,e,n)}var km=!1,PC=new nt("",{providedIn:"root",factory:()=>km});function Bm(t){return t instanceof Function?t():t}var Li=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Li||{}),FC;function qh(t,e){return FC(t,e)}function qr(t,e,n,i,r){if(i!=null){let a,d=!1;si(i)?a=i:ar(i)&&(d=!0,i=i[oi]);let v=Wn(i);t===0&&n!==null?r==null?Hm(e,n,v):rc(e,n,v,r||null,!0):t===1&&n!==null?rc(e,n,v,r||null,!0):t===2?JC(e,v,d):t===3&&e.destroyNode(v),a!=null&&tE(e,t,a,n,r)}}function kC(t,e){return t.createText(e)}function BC(t,e,n){t.setValue(e,n)}function jm(t,e,n){return t.createElement(e,n)}function jC(t,e){Vm(t,e),e[oi]=null,e[Dn]=null}function VC(t,e,n,i,r,a){i[oi]=r,i[Dn]=e,_c(t,i,n,1,r,a)}function Vm(t,e){e[Un].changeDetectionScheduler?.notify(1),_c(t,e,e[Ft],2,null,null)}function UC(t){let e=t[es];if(!e)return xu(t[Fe],t);for(;e;){let n=null;if(ar(e))n=e[es];else{let i=e[Vt];i&&(n=i)}if(!n){for(;e&&!e[bn]&&e!==t;)ar(e)&&xu(e[Fe],e),e=e[Mt];e===null&&(e=t),ar(e)&&xu(e[Fe],e),n=e&&e[bn]}e=n}}function HC(t,e,n,i){let r=Vt+i,a=n.length;i>0&&(n[r-1][bn]=e),i<a-Vt?(e[bn]=n[r],Bg(n,Vt+i,e)):(n.push(e),e[bn]=null),e[Mt]=n;let d=e[ls];d!==null&&n!==d&&GC(d,e);let v=e[ii];v!==null&&v.insertView(t),Uu(e),e[xe]|=128}function GC(t,e){let n=t[no],r=e[Mt][Mt][Hn];e[Hn]!==r&&(t[xe]|=Mh.HasTransplantedViews),n===null?t[no]=[e]:n.push(e)}function Um(t,e){let n=t[no],i=n.indexOf(e);n.splice(i,1)}function ic(t,e){if(t.length<=Vt)return;let n=Vt+e,i=t[n];if(i){let r=i[ls];r!==null&&r!==t&&Um(r,i),e>0&&(t[n-1][bn]=i[bn]);let a=Za(t,Vt+e);jC(i[Fe],i);let d=a[ii];d!==null&&d.detachView(a[Fe]),i[Mt]=null,i[bn]=null,i[xe]&=-129}return i}function Zh(t,e){if(!(e[xe]&256)){let n=e[Ft];n.destroyNode&&_c(t,e,n,3,null,null),UC(e)}}function xu(t,e){if(e[xe]&256)return;let n=Ke(null);try{e[xe]&=-129,e[xe]|=256,e[ur]&&yp(e[ur]),$C(t,e),WC(t,e),e[Fe].type===1&&e[Ft].destroy();let i=e[ls];if(i!==null&&si(e[Mt])){i!==e[Mt]&&Um(i,e);let r=e[ii];r!==null&&r.detachView(t)}AC(e)}finally{Ke(n)}}function WC(t,e){let n=t.cleanup,i=e[Jo];if(n!==null)for(let a=0;a<n.length-1;a+=2)if(typeof n[a]=="string"){let d=n[a+3];d>=0?i[d]():i[-d].unsubscribe(),a+=2}else{let d=i[n[a+1]];n[a].call(d)}i!==null&&(e[Jo]=null);let r=e[Ti];if(r!==null){e[Ti]=null;for(let a=0;a<r.length;a++){let d=r[a];d()}}}function $C(t,e){let n;if(t!=null&&(n=t.destroyHooks)!=null)for(let i=0;i<n.length;i+=2){let r=e[n[i]];if(!(r instanceof is)){let a=n[i+1];if(Array.isArray(a))for(let d=0;d<a.length;d+=2){let v=r[a[d]],y=a[d+1];kn(4,v,y);try{y.call(v)}finally{kn(5,v,y)}}else{kn(4,r,a);try{a.call(r)}finally{kn(5,r,a)}}}}}function zC(t,e,n){return YC(t,e.parent,n)}function YC(t,e,n){let i=e;for(;i!==null&&i.type&40;)e=i,i=e.parent;if(i===null)return n[oi];{let{componentOffset:r}=i;if(r>-1){let{encapsulation:a}=t.data[i.directiveStart+r];if(a===jn.None||a===jn.Emulated)return null}return Sn(i,n)}}function rc(t,e,n,i,r){t.insertBefore(e,n,i,r)}function Hm(t,e,n){t.appendChild(e,n)}function dg(t,e,n,i,r){i!==null?rc(t,e,n,i,r):Hm(t,e,n)}function XC(t,e,n,i){t.removeChild(e,n,i)}function Kh(t,e){return t.parentNode(e)}function qC(t,e){return t.nextSibling(e)}function ZC(t,e,n){return QC(t,e,n)}function KC(t,e,n){return t.type&40?Sn(t,n):null}var QC=KC,fg;function Qh(t,e,n,i){let r=zC(t,i,e),a=e[Ft],d=i.parent||e[Dn],v=ZC(d,i,e);if(r!=null)if(Array.isArray(n))for(let y=0;y<n.length;y++)dg(a,r,n[y],v,!1);else dg(a,r,n,v,!1);fg!==void 0&&fg(a,i,e,n,r)}function za(t,e){if(e!==null){let n=e.type;if(n&3)return Sn(e,t);if(n&4)return qu(-1,t[e.index]);if(n&8){let i=e.child;if(i!==null)return za(t,i);{let r=t[e.index];return si(r)?qu(-1,r):Wn(r)}}else{if(n&32)return qh(e,t)()||Wn(t[e.index]);{let i=Gm(t,e);if(i!==null){if(Array.isArray(i))return i[0];let r=ns(t[Hn]);return za(r,i)}else return za(t,e.next)}}}return null}function Gm(t,e){if(e!==null){let i=t[Hn][Dn],r=e.projection;return i.projection[r]}return null}function qu(t,e){let n=Vt+t+1;if(n<e.length){let i=e[n],r=i[Fe].firstChild;if(r!==null)return za(i,r)}return e[hr]}function JC(t,e,n){let i=Kh(t,e);i&&XC(t,i,e,n)}function Jh(t,e,n,i,r,a,d){for(;n!=null;){let v=i[n.index],y=n.type;if(d&&e===0&&(v&&fr(Wn(v),i),n.flags|=2),(n.flags&32)!==32)if(y&8)Jh(t,e,n.child,i,r,a,!1),qr(e,t,r,v,a);else if(y&32){let C=qh(n,i),b;for(;b=C();)qr(e,t,r,b,a);qr(e,t,r,v,a)}else y&16?eE(t,e,i,n,r,a):qr(e,t,r,v,a);n=d?n.projectionNext:n.next}}function _c(t,e,n,i,r,a){Jh(n,i,t.firstChild,e,r,a,!1)}function eE(t,e,n,i,r,a){let d=n[Hn],y=d[Dn].projection[i.projection];if(Array.isArray(y))for(let C=0;C<y.length;C++){let b=y[C];qr(e,t,r,b,a)}else{let C=y,b=d[Mt];Om(i)&&(C.flags|=128),Jh(t,e,C,b,r,a,!0)}}function tE(t,e,n,i,r){let a=n[hr],d=Wn(n);a!==d&&qr(e,t,i,a,r);for(let v=Vt;v<n.length;v++){let y=n[v];_c(y[Fe],y,t,e,i,a)}}function nE(t,e,n){t.setAttribute(e,"style",n)}function Wm(t,e,n){n===""?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n)}function $m(t,e,n){let{mergedAttrs:i,classes:r,styles:a}=n;i!==null&&Pu(t,e,i),r!==null&&Wm(t,e,r),a!==null&&nE(t,e,a)}var ds={};function so(t=1){zm(ai(),ut(),jh()+t,!1)}function zm(t,e,n,i){if(!i)if((e[xe]&3)===3){let a=t.preOrderCheckHooks;a!==null&&Ga(e,a,n)}else{let a=t.preOrderHooks;a!==null&&Wa(e,a,0,n)}dr(n)}function Ni(t,e=Ge.Default){let n=ut();if(n===null)return Ze(t,e);let i=Tn();return Dm(i,n,cn(t),e)}function Ym(t,e,n,i,r,a){let d=Ke(null);try{let v=null;r&xi.SignalBased&&(v=e[i][pp]),v!==null&&v.transformFn!==void 0&&(a=v.transformFn(a)),r&xi.HasDecoratorInputTransform&&(a=t.inputTransforms[i].call(e,a)),t.setInput!==null?t.setInput(e,v,a,n,i):tm(e,v,i,a)}finally{Ke(d)}}function iE(t,e){let n=t.hostBindingOpCodes;if(n!==null)try{for(let i=0;i<n.length;i++){let r=n[i];if(r<0)dr(~r);else{let a=r,d=n[++i],v=n[++i];nC(d,a);let y=e[a];v(2,y)}}}finally{dr(-1)}}function wc(t,e,n,i,r,a,d,v,y,C,b){let T=e.blueprint.slice();return T[oi]=r,T[xe]=i|4|128|8|64,(C!==null||t&&t[xe]&2048)&&(T[xe]|=2048),om(T),T[Mt]=T[cs]=t,T[Vn]=n,T[Un]=d||t&&t[Un],T[Ft]=v||t&&t[Ft],T[to]=y||t&&t[to]||null,T[Dn]=a,T[gc]=TC(),T[Qa]=b,T[Qg]=C,T[Hn]=e.type==2?t[Hn]:T,T}function Cc(t,e,n,i,r){let a=t.data[e];if(a===null)a=rE(t,e,n,i,r),tC()&&(a.flags|=32);else if(a.type&64){a.type=n,a.value=i,a.attrs=r;let d=K0();a.injectorIndex=d===null?-1:d.injectorIndex}return hs(a,!0),a}function rE(t,e,n,i,r){let a=cm(),d=lm(),v=d?a:a&&a.parent,y=t.data[e]=uE(t,v,n,e,i,r);return t.firstChild===null&&(t.firstChild=y),a!==null&&(d?a.child==null&&y.parent!==null&&(a.child=y):a.next===null&&(a.next=y,y.prev=a)),y}function Xm(t,e,n,i){if(n===0)return-1;let r=e.length;for(let a=0;a<n;a++)e.push(i),t.blueprint.push(i),t.data.push(null);return r}function qm(t,e,n,i,r){let a=jh(),d=i&2;try{dr(-1),d&&e.length>Gn&&zm(t,e,Gn,!1),kn(d?2:0,r),n(i,r)}finally{dr(a),kn(d?3:1,r)}}function Zm(t,e,n){if(em(e)){let i=Ke(null);try{let r=e.directiveStart,a=e.directiveEnd;for(let d=r;d<a;d++){let v=t.data[d];if(v.contentQueries){let y=n[d];v.contentQueries(1,y,d)}}}finally{Ke(i)}}}function Km(t,e,n){am()&&(vE(t,e,n,Sn(n,e)),(n.flags&64)===64&&nv(t,e,n))}function Qm(t,e,n=Sn){let i=e.localNames;if(i!==null){let r=e.index+1;for(let a=0;a<i.length;a+=2){let d=i[a+1],v=d===-1?n(e,t):t[d];t[r++]=v}}}function Jm(t){let e=t.tView;return e===null||e.incompleteFirstPass?t.tView=ed(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):e}function ed(t,e,n,i,r,a,d,v,y,C,b){let T=Gn+i,M=T+r,O=oE(T,M),L=typeof C=="function"?C():C;return O[Fe]={type:t,blueprint:O,template:n,queries:null,viewQuery:v,declTNode:e,data:O.slice().fill(null,T),bindingStartIndex:T,expandoStartIndex:M,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof a=="function"?a():a,pipeRegistry:typeof d=="function"?d():d,firstChild:null,schemas:y,consts:L,incompleteFirstPass:!1,ssrId:b}}function oE(t,e){let n=[];for(let i=0;i<e;i++)n.push(i<t?null:ds);return n}function sE(t,e,n,i){let a=i.get(PC,km)||n===jn.ShadowDom,d=t.selectRootElement(e,a);return aE(d),d}function aE(t){cE(t)}var cE=()=>null;function lE(t,e,n,i){let r=ov(e);r.push(n),t.firstCreatePass&&sv(t).push(i,r.length-1)}function uE(t,e,n,i,r,a){let d=e?e.injectorIndex:-1,v=0;return X0()&&(v|=128),{type:n,index:i,insertBeforeIndex:null,injectorIndex:d,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:v,providerIndexes:0,value:r,attrs:a,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function pg(t,e,n,i,r){for(let a in e){if(!e.hasOwnProperty(a))continue;let d=e[a];if(d===void 0)continue;i??={};let v,y=xi.None;Array.isArray(d)?(v=d[0],y=d[1]):v=d;let C=a;if(r!==null){if(!r.hasOwnProperty(a))continue;C=r[a]}t===0?gg(i,n,C,v,y):gg(i,n,C,v)}return i}function gg(t,e,n,i,r){let a;t.hasOwnProperty(n)?(a=t[n]).push(e,i):a=t[n]=[e,i],r!==void 0&&a.push(r)}function hE(t,e,n){let i=e.directiveStart,r=e.directiveEnd,a=t.data,d=e.attrs,v=[],y=null,C=null;for(let b=i;b<r;b++){let T=a[b],M=n?n.get(T):null,O=M?M.inputs:null,L=M?M.outputs:null;y=pg(0,T.inputs,b,y,O),C=pg(1,T.outputs,b,C,L);let P=y!==null&&d!==null&&!Sh(e)?SE(y,b,d):null;v.push(P)}y!==null&&(y.hasOwnProperty("class")&&(e.flags|=8),y.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=v,e.inputs=y,e.outputs=C}function dE(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function fE(t,e,n,i,r,a,d,v){let y=Sn(e,n),C=e.inputs,b;!v&&C!=null&&(b=C[i])?(td(t,n,b,i,r),mc(e)&&pE(n,e.index)):e.type&3?(i=dE(i),r=d!=null?d(r,e.value||"",i):r,a.setProperty(y,i,r)):e.type&12}function pE(t,e){let n=Oi(e,t);n[xe]&16||(n[xe]|=64)}function ev(t,e,n,i){if(am()){let r=i===null?null:{"":-1},a=_E(t,n),d,v;a===null?d=v=null:[d,v]=a,d!==null&&tv(t,e,n,d,r,v),r&&wE(n,i,r)}n.mergedAttrs=Dh(n.mergedAttrs,n.attrs)}function tv(t,e,n,i,r,a){for(let C=0;C<i.length;C++)mC(Cm(n,e),t,i[C].type);EE(n,t.data.length,i.length);for(let C=0;C<i.length;C++){let b=i[C];b.providersResolver&&b.providersResolver(b)}let d=!1,v=!1,y=Xm(t,e,i.length,null);for(let C=0;C<i.length;C++){let b=i[C];n.mergedAttrs=Dh(n.mergedAttrs,b.hostAttrs),IE(t,n,e,y,b),CE(y,b,r),b.contentQueries!==null&&(n.flags|=4),(b.hostBindings!==null||b.hostAttrs!==null||b.hostVars!==0)&&(n.flags|=64);let T=b.type.prototype;!d&&(T.ngOnChanges||T.ngOnInit||T.ngDoCheck)&&((t.preOrderHooks??=[]).push(n.index),d=!0),!v&&(T.ngOnChanges||T.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(n.index),v=!0),y++}hE(t,n,a)}function gE(t,e,n,i,r){let a=r.hostBindings;if(a){let d=t.hostBindingOpCodes;d===null&&(d=t.hostBindingOpCodes=[]);let v=~e.index;mE(d)!=v&&d.push(v),d.push(n,i,a)}}function mE(t){let e=t.length;for(;e>0;){let n=t[--e];if(typeof n=="number"&&n<0)return n}return 0}function vE(t,e,n,i){let r=n.directiveStart,a=n.directiveEnd;mc(n)&&bE(e,n,t.data[r+n.componentOffset]),t.firstCreatePass||Cm(n,e),fr(i,e);let d=n.initialInputs;for(let v=r;v<a;v++){let y=t.data[v],C=io(e,t,v,n);if(fr(C,e),d!==null&&DE(e,v-r,C,y,n,d),us(y)){let b=Oi(n.index,e);b[Vn]=io(e,t,v,n)}}}function nv(t,e,n){let i=n.directiveStart,r=n.directiveEnd,a=n.index,d=iC();try{dr(a);for(let v=i;v<r;v++){let y=t.data[v],C=e[v];Hu(v),(y.hostBindings!==null||y.hostVars!==0||y.hostAttrs!==null)&&yE(y,C)}}finally{dr(-1),Hu(d)}}function yE(t,e){t.hostBindings!==null&&t.hostBindings(1,e)}function _E(t,e){let n=t.directiveRegistry,i=null,r=null;if(n)for(let a=0;a<n.length;a++){let d=n[a];if(u0(e,d.selectors,!1))if(i||(i=[]),us(d))if(d.findHostDirectiveDefs!==null){let v=[];r=r||new Map,d.findHostDirectiveDefs(d,v,r),i.unshift(...v,d);let y=v.length;Zu(t,e,y)}else i.unshift(d),Zu(t,e,0);else r=r||new Map,d.findHostDirectiveDefs?.(d,i,r),i.push(d)}return i===null?null:[i,r]}function Zu(t,e,n){e.componentOffset=n,(t.components??=[]).push(e.index)}function wE(t,e,n){if(e){let i=t.localNames=[];for(let r=0;r<e.length;r+=2){let a=n[e[r+1]];if(a==null)throw new Ae(-301,!1);i.push(e[r],a)}}}function CE(t,e,n){if(n){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)n[e.exportAs[i]]=t;us(e)&&(n[""]=t)}}function EE(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function IE(t,e,n,i,r){t.data[i]=r;let a=r.factory||(r.factory=Qr(r.type,!0)),d=new is(a,us(r),Ni);t.blueprint[i]=d,n[i]=d,gE(t,e,i,Xm(t,n,r.hostVars,ds),r)}function bE(t,e,n){let i=Sn(e,t),r=Jm(n),a=t[Un].rendererFactory,d=16;n.signals?d=4096:n.onPush&&(d=64);let v=Ec(t,wc(t,r,null,d,i,e,null,a.createRenderer(i,n),null,null,null));t[e.index]=v}function DE(t,e,n,i,r,a){let d=a[e];if(d!==null)for(let v=0;v<d.length;){let y=d[v++],C=d[v++],b=d[v++],T=d[v++];Ym(i,n,y,C,b,T)}}function SE(t,e,n){let i=null,r=0;for(;r<n.length;){let a=n[r];if(a===0){r+=4;continue}else if(a===5){r+=2;continue}if(typeof a=="number")break;if(t.hasOwnProperty(a)){i===null&&(i=[]);let d=t[a];for(let v=0;v<d.length;v+=3)if(d[v]===e){i.push(a,d[v+1],d[v+2],n[r+1]);break}}r+=2}return i}function iv(t,e,n,i){return[t,!0,0,e,null,i,null,n,null,null]}function rv(t,e){let n=t.contentQueries;if(n!==null){let i=Ke(null);try{for(let r=0;r<n.length;r+=2){let a=n[r],d=n[r+1];if(d!==-1){let v=t.data[d];Fh(a),v.contentQueries(2,e[d],d)}}}finally{Ke(i)}}}function Ec(t,e){return t[es]?t[rg][bn]=e:t[es]=e,t[rg]=e,e}function Ku(t,e,n){Fh(0);let i=Ke(null);try{e(t,n)}finally{Ke(i)}}function ov(t){return t[Jo]||(t[Jo]=[])}function sv(t){return t.cleanup||(t.cleanup=[])}function av(t,e){let n=t[to],i=n?n.get(ri,null):null;i&&i.handleError(e)}function td(t,e,n,i,r){for(let a=0;a<n.length;){let d=n[a++],v=n[a++],y=n[a++],C=e[d],b=t.data[d];Ym(b,C,i,v,y,r)}}function TE(t,e,n){let i=V0(e,t);BC(t[Ft],i,n)}function xE(t,e){let n=Oi(e,t),i=n[Fe];AE(i,n);let r=n[oi];r!==null&&n[Qa]===null&&(n[Qa]=Xh(r,n[to])),nd(i,n,n[Vn])}function AE(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])}function nd(t,e,n){kh(e);try{let i=t.viewQuery;i!==null&&Ku(1,i,n);let r=t.template;r!==null&&qm(t,e,r,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),e[ii]?.finishViewCreation(t),t.staticContentQueries&&rv(t,e),t.staticViewQueries&&Ku(2,t.viewQuery,n);let a=t.components;a!==null&&ME(e,a)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{e[xe]&=-5,Bh()}}function ME(t,e){for(let n=0;n<e.length;n++)xE(t,e[n])}function cv(t,e,n,i){let r=Ke(null);try{let a=e.tView,v=t[xe]&4096?4096:16,y=wc(t,a,n,v,null,e,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),C=t[e.index];y[ls]=C;let b=t[ii];return b!==null&&(y[ii]=b.createEmbeddedView(a)),nd(a,y,n),y}finally{Ke(r)}}function OE(t,e){let n=Vt+e;if(n<t.length)return t[n]}function Qu(t,e){return!e||e.firstChild===null||Om(t)}function lv(t,e,n,i=!0){let r=e[Fe];if(HC(r,e,t,n),i){let d=qu(n,t),v=e[Ft],y=Kh(v,t[hr]);y!==null&&VC(r,t[Dn],v,e,y,d)}let a=e[Qa];a!==null&&a.firstChild!==null&&(a.firstChild=null)}function RE(t,e){let n=ic(t,e);return n!==void 0&&Zh(n[Fe],n),n}function oc(t,e,n,i,r=!1){for(;n!==null;){let a=e[n.index];a!==null&&i.push(Wn(a)),si(a)&&LE(a,i);let d=n.type;if(d&8)oc(t,e,n.child,i);else if(d&32){let v=qh(n,e),y;for(;y=v();)i.push(y)}else if(d&16){let v=Gm(e,n);if(Array.isArray(v))i.push(...v);else{let y=ns(e[Hn]);oc(y[Fe],y,v,i,!0)}}n=r?n.projectionNext:n.next}return i}function LE(t,e){for(let n=Vt;n<t.length;n++){let i=t[n],r=i[Fe].firstChild;r!==null&&oc(i[Fe],i,r,e)}t[hr]!==t[oi]&&e.push(t[hr])}var uv=[];function NE(t){return t[ur]??PE(t)}function PE(t){let e=uv.pop()??Object.create(kE);return e.lView=t,e}function FE(t){t.lView[ur]!==t&&(t.lView=null,uv.push(t))}var kE=mt(Te({},gp),{consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{ts(t.lView)},consumerOnSignalRead(){this.lView[ur]=this}}),hv=100;function dv(t,e=!0,n=0){let i=t[Un],r=i.rendererFactory,a=!1;a||r.begin?.();try{BE(t,n)}catch(d){throw e&&av(t,d),d}finally{a||(r.end?.(),i.inlineEffectRunner?.flush())}}function BE(t,e){Ju(t,e);let n=0;for(;Nh(t);){if(n===hv)throw new Ae(103,!1);n++,Ju(t,1)}}function jE(t,e,n,i){let r=e[xe];if((r&256)===256)return;let a=!1;!a&&e[Un].inlineEffectRunner?.flush(),kh(e);let d=null,v=null;!a&&VE(t)&&(v=NE(e),d=mp(v));try{om(e),eC(t.bindingStartIndex),n!==null&&qm(t,e,n,2,i);let y=(r&3)===3;if(!a)if(y){let T=t.preOrderCheckHooks;T!==null&&Ga(e,T,null)}else{let T=t.preOrderHooks;T!==null&&Wa(e,T,0,null),bu(e,0)}if(UE(e),fv(e,0),t.contentQueries!==null&&rv(t,e),!a)if(y){let T=t.contentCheckHooks;T!==null&&Ga(e,T)}else{let T=t.contentHooks;T!==null&&Wa(e,T,1),bu(e,1)}iE(t,e);let C=t.components;C!==null&&gv(e,C,0);let b=t.viewQuery;if(b!==null&&Ku(2,b,i),!a)if(y){let T=t.viewCheckHooks;T!==null&&Ga(e,T)}else{let T=t.viewHooks;T!==null&&Wa(e,T,2),bu(e,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),e[Iu]){for(let T of e[Iu])T();e[Iu]=null}a||(e[xe]&=-73)}catch(y){throw ts(e),y}finally{v!==null&&(vp(v,d),FE(v)),Bh()}}function VE(t){return t.type!==2}function fv(t,e){for(let n=Lm(t);n!==null;n=Nm(n))for(let i=Vt;i<n.length;i++){let r=n[i];pv(r,e)}}function UE(t){for(let e=Lm(t);e!==null;e=Nm(e)){if(!(e[xe]&Mh.HasTransplantedViews))continue;let n=e[no];for(let i=0;i<n.length;i++){let r=n[i],a=r[Mt];G0(r)}}}function HE(t,e,n){let i=Oi(e,t);pv(i,n)}function pv(t,e){Lh(t)&&Ju(t,e)}function Ju(t,e){let i=t[Fe],r=t[xe],a=t[ur],d=!!(e===0&&r&16);if(d||=!!(r&64&&e===0),d||=!!(r&1024),d||=!!(a?.dirty&&iu(a)),a&&(a.dirty=!1),t[xe]&=-9217,d)jE(i,t,i.template,t[Vn]);else if(r&8192){fv(t,1);let v=i.components;v!==null&&gv(t,v,1)}}function gv(t,e,n){for(let i=0;i<e.length;i++)HE(t,e[i],n)}function id(t){for(t[Un].changeDetectionScheduler?.notify();t;){t[xe]|=64;let e=ns(t);if(R0(t)&&!e)return t;t=e}return null}var pr=class{get rootNodes(){let e=this._lView,n=e[Fe];return oc(n,e,n.firstChild,[])}constructor(e,n,i=!0){this._lView=e,this._cdRefInjectingView=n,this.notifyErrorHandler=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Vn]}set context(e){this._lView[Vn]=e}get destroyed(){return(this._lView[xe]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[Mt];if(si(e)){let n=e[Ja],i=n?n.indexOf(this):-1;i>-1&&(ic(e,i),Za(n,i))}this._attachedToViewContainer=!1}Zh(this._lView[Fe],this._lView)}onDestroy(e){sm(this._lView,e)}markForCheck(){id(this._cdRefInjectingView||this._lView)}detach(){this._lView[xe]&=-129}reattach(){Uu(this._lView),this._lView[xe]|=128}detectChanges(){this._lView[xe]|=1024,dv(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ae(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,Vm(this._lView[Fe],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Ae(902,!1);this._appRef=e,Uu(this._lView)}},rs=(()=>{class t{static{this.__NG_ELEMENT_ID__=$E}}return t})(),GE=rs,WE=class extends GE{constructor(e,n,i){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,n){return this.createEmbeddedViewImpl(e,n)}createEmbeddedViewImpl(e,n,i){let r=cv(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:n,dehydratedView:i});return new pr(r)}};function $E(){return rd(Tn(),ut())}function rd(t,e){return t.type&4?new WE(e,t,ro(t,e)):null}var t1=new RegExp(`^(\\d+)*(${LC}|${RC})*(.*)`);var zE=()=>null;function eh(t,e){return zE(t,e)}var th=class{},nh=class{},sc=class{};function YE(t){let e=Error(`No component factory found for ${$t(t)}.`);return e[XE]=t,e}var XE="ngComponent";var ih=class{resolveComponentFactory(e){throw YE(e)}},Ic=(()=>{class t{static{this.NULL=new ih}}return t})(),os=class{},bc=(()=>{class t{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>qE()}}return t})();function qE(){let t=ut(),e=Tn(),n=Oi(e.index,t);return(ar(n)?n:t)[Ft]}var ZE=(()=>{class t{static{this.\u0275prov=Re({token:t,providedIn:"root",factory:()=>null})}}return t})(),Au={};var mg=new Set;function od(t){mg.has(t)||(mg.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function vg(...t){}function KE(){let t=typeof Xo.requestAnimationFrame=="function",e=Xo[t?"requestAnimationFrame":"setTimeout"],n=Xo[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&n){let i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i);let r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:n}}var vt=class t{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ln(!1),this.onMicrotaskEmpty=new ln(!1),this.onStable=new ln(!1),this.onError=new ln(!1),typeof Zone>"u")throw new Ae(908,!1);Zone.assertZonePatched();let r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&n,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=KE().nativeRequestAnimationFrame,eI(r)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new Ae(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new Ae(909,!1)}run(e,n,i){return this._inner.run(e,n,i)}runTask(e,n,i,r){let a=this._inner,d=a.scheduleEventTask("NgZoneEvent: "+r,e,QE,vg,vg);try{return a.runTask(d,n,i)}finally{a.cancelTask(d)}}runGuarded(e,n,i){return this._inner.runGuarded(e,n,i)}runOutsideAngular(e){return this._outer.run(e)}},QE={};function sd(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function JE(t){t.isCheckStableRunning||t.lastRequestAnimationFrameId!==-1||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Xo,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,rh(t),t.isCheckStableRunning=!0,sd(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),rh(t))}function eI(t){let e=()=>{JE(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,r,a,d,v)=>{if(tI(v))return n.invokeTask(r,a,d,v);try{return yg(t),n.invokeTask(r,a,d,v)}finally{(t.shouldCoalesceEventChangeDetection&&a.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&e(),_g(t)}},onInvoke:(n,i,r,a,d,v,y)=>{try{return yg(t),n.invoke(r,a,d,v,y)}finally{t.shouldCoalesceRunChangeDetection&&e(),_g(t)}},onHasTask:(n,i,r,a)=>{n.hasTask(r,a),i===r&&(a.change=="microTask"?(t._hasPendingMicrotasks=a.microTask,rh(t),sd(t)):a.change=="macroTask"&&(t.hasPendingMacrotasks=a.macroTask))},onHandleError:(n,i,r,a)=>(n.handleError(r,a),t.runOutsideAngular(()=>t.onError.emit(a)),!1)})}function rh(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.lastRequestAnimationFrameId!==-1?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function yg(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function _g(t){t._nesting--,sd(t)}function tI(t){return!Array.isArray(t)||t.length!==1?!1:t[0].data?.__ignore_ng_zone__===!0}var mv=(()=>{class t{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let n=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let i of n)i()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static{this.\u0275prov=Re({token:t,providedIn:"root",factory:()=>new t})}}return t})();function oh(t,e,n){let i=n?t.styles:null,r=n?t.classes:null,a=0;if(e!==null)for(let d=0;d<e.length;d++){let v=e[d];if(typeof v=="number")a=v;else if(a==1)r=Xp(r,v);else if(a==2){let y=v,C=e[++d];i=Xp(i,y+": "+C+";")}}n?t.styles=i:t.stylesWithoutHost=i,n?t.classes=r:t.classesWithoutHost=r}var ac=class extends Ic{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let n=lr(e);return new ss(n,this.ngModule)}};function wg(t){let e=[];for(let n in t){if(!t.hasOwnProperty(n))continue;let i=t[n];i!==void 0&&e.push({propName:Array.isArray(i)?i[0]:i,templateName:n})}return e}function nI(t){let e=t.toLowerCase();return e==="svg"?F0:e==="math"?k0:null}var sh=class{constructor(e,n){this.injector=e,this.parentInjector=n}get(e,n,i){i=dc(i);let r=this.injector.get(e,Au,i);return r!==Au||n===Au?r:this.parentInjector.get(e,n,i)}},ss=class extends sc{get inputs(){let e=this.componentDef,n=e.inputTransforms,i=wg(e.inputs);if(n!==null)for(let r of i)n.hasOwnProperty(r.propName)&&(r.transform=n[r.propName]);return i}get outputs(){return wg(this.componentDef.outputs)}constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=p0(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}create(e,n,i,r){let a=Ke(null);try{r=r||this.ngModule;let d=r instanceof un?r:r?.injector;d&&this.componentDef.getStandaloneInjector!==null&&(d=this.componentDef.getStandaloneInjector(d)||d);let v=d?new sh(e,d):e,y=v.get(os,null);if(y===null)throw new Ae(407,!1);let C=v.get(ZE,null),b=v.get(mv,null),T=v.get(th,null),M={rendererFactory:y,sanitizer:C,inlineEffectRunner:null,afterRenderEventManager:b,changeDetectionScheduler:T},O=y.createRenderer(null,this.componentDef),L=this.componentDef.selectors[0][0]||"div",P=i?sE(O,i,this.componentDef.encapsulation,v):jm(O,L,nI(L)),Y=512;this.componentDef.signals?Y|=4096:this.componentDef.onPush||(Y|=16);let H=null;P!==null&&(H=Xh(P,v,!0));let G=ed(0,null,null,1,0,null,null,null,null,null,null),W=wc(null,G,null,Y,null,null,M,O,v,null,H);kh(W);let oe,te;try{let ie=this.componentDef,ae,w=null;ie.findHostDirectiveDefs?(ae=[],w=new Map,ie.findHostDirectiveDefs(ie,ae,w),ae.push(ie)):ae=[ie];let re=iI(W,P),pe=rI(re,P,ie,ae,W,M,O);te=Rh(G,Gn),P&&aI(O,ie,P,i),n!==void 0&&cI(te,this.ngContentSelectors,n),oe=sI(pe,ie,ae,w,W,[lI]),nd(G,W,null)}finally{Bh()}return new ah(this.componentType,oe,ro(te,W),W,te)}finally{Ke(a)}}},ah=class extends nh{constructor(e,n,i,r,a){super(),this.location=i,this._rootLView=r,this._tNode=a,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new pr(r,void 0,!1),this.componentType=e}setInput(e,n){let i=this._tNode.inputs,r;if(i!==null&&(r=i[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),n))return;let a=this._rootLView;td(a[Fe],a,r,e,n),this.previousInputValues.set(e,n);let d=Oi(this._tNode.index,a);id(d)}}get injector(){return new cr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function iI(t,e){let n=t[Fe],i=Gn;return t[i]=e,Cc(n,i,2,"#host",null)}function rI(t,e,n,i,r,a,d){let v=r[Fe];oI(i,t,e,d);let y=null;e!==null&&(y=Xh(e,r[to]));let C=a.rendererFactory.createRenderer(e,n),b=16;n.signals?b=4096:n.onPush&&(b=64);let T=wc(r,Jm(n),null,b,r[t.index],t,a,C,null,null,y);return v.firstCreatePass&&Zu(v,t,i.length-1),Ec(r,T),r[t.index]=T}function oI(t,e,n,i){for(let r of t)e.mergedAttrs=Dh(e.mergedAttrs,r.hostAttrs);e.mergedAttrs!==null&&(oh(e,e.mergedAttrs,!0),n!==null&&$m(i,n,e))}function sI(t,e,n,i,r,a){let d=Tn(),v=r[Fe],y=Sn(d,r);tv(v,r,d,n,null,i);for(let b=0;b<n.length;b++){let T=d.directiveStart+b,M=io(r,v,T,d);fr(M,r)}nv(v,r,d),y&&fr(y,r);let C=io(r,v,d.directiveStart+d.componentOffset,d);if(t[Vn]=r[Vn]=C,a!==null)for(let b of a)b(C,e);return Zm(v,d,r),C}function aI(t,e,n,i){if(i)Pu(t,n,["ng-version","17.3.12"]);else{let{attrs:r,classes:a}=g0(e.selectors[0]);r&&Pu(t,n,r),a&&a.length>0&&Wm(t,n,a.join(" "))}}function cI(t,e,n){let i=t.projection=[];for(let r=0;r<e.length;r++){let a=n[r];i.push(a!=null?Array.from(a):null)}}function lI(){let t=Tn();Hh(ut()[Fe],t)}var ao=(()=>{class t{static{this.__NG_ELEMENT_ID__=uI}}return t})();function uI(){let t=Tn();return yv(t,ut())}var hI=ao,vv=class extends hI{constructor(e,n,i){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=i}get element(){return ro(this._hostTNode,this._hostLView)}get injector(){return new cr(this._hostTNode,this._hostLView)}get parentInjector(){let e=Gh(this._hostTNode,this._hostLView);if(ym(e)){let n=nc(e,this._hostLView),i=tc(e),r=n[Fe].data[i+8];return new cr(r,n)}else return new cr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let n=Cg(this._lContainer);return n!==null&&n[e]||null}get length(){return this._lContainer.length-Vt}createEmbeddedView(e,n,i){let r,a;typeof i=="number"?r=i:i!=null&&(r=i.index,a=i.injector);let d=eh(this._lContainer,e.ssrId),v=e.createEmbeddedViewImpl(n||{},a,d);return this.insertImpl(v,r,Qu(this._hostTNode,d)),v}createComponent(e,n,i,r,a){let d=e&&!O0(e),v;if(d)v=n;else{let L=n||{};v=L.index,i=L.injector,r=L.projectableNodes,a=L.environmentInjector||L.ngModuleRef}let y=d?e:new ss(lr(e)),C=i||this.parentInjector;if(!a&&y.ngModule==null){let P=(d?C:this.parentInjector).get(un,null);P&&(a=P)}let b=lr(y.componentType??{}),T=eh(this._lContainer,b?.id??null),M=T?.firstChild??null,O=y.create(C,r,M,a);return this.insertImpl(O.hostView,v,Qu(this._hostTNode,T)),O}insert(e,n){return this.insertImpl(e,n,!0)}insertImpl(e,n,i){let r=e._lView;if(H0(r)){let v=this.indexOf(e);if(v!==-1)this.detach(v);else{let y=r[Mt],C=new vv(y,y[Dn],y[Mt]);C.detach(C.indexOf(e))}}let a=this._adjustIndex(n),d=this._lContainer;return lv(d,r,a,i),e.attachToViewContainerRef(),Bg(Mu(d),a,e),e}move(e,n){return this.insert(e,n)}indexOf(e){let n=Cg(this._lContainer);return n!==null?n.indexOf(e):-1}remove(e){let n=this._adjustIndex(e,-1),i=ic(this._lContainer,n);i&&(Za(Mu(this._lContainer),n),Zh(i[Fe],i))}detach(e){let n=this._adjustIndex(e,-1),i=ic(this._lContainer,n);return i&&Za(Mu(this._lContainer),n)!=null?new pr(i):null}_adjustIndex(e,n=0){return e??this.length+n}};function Cg(t){return t[Ja]}function Mu(t){return t[Ja]||(t[Ja]=[])}function yv(t,e){let n,i=e[t.index];return si(i)?n=i:(n=iv(i,e,null,t),e[t.index]=n,Ec(e,n)),fI(n,e,t,i),new vv(n,t,e)}function dI(t,e){let n=t[Ft],i=n.createComment(""),r=Sn(e,t),a=Kh(n,r);return rc(n,a,i,qC(n,r),!1),i}var fI=mI,pI=()=>!1;function gI(t,e,n){return pI(t,e,n)}function mI(t,e,n,i){if(t[hr])return;let r;n.type&8?r=Wn(i):r=dI(e,n),t[hr]=r}var ch=class t{constructor(e){this.queryList=e,this.matches=null}clone(){return new t(this.queryList)}setDirty(){this.queryList.setDirty()}},lh=class t{constructor(e=[]){this.queries=e}createEmbeddedView(e){let n=e.queries;if(n!==null){let i=e.contentQueries!==null?e.contentQueries[0]:n.length,r=[];for(let a=0;a<i;a++){let d=n.getByIndex(a),v=this.queries[d.indexInDeclarationView];r.push(v.clone())}return new t(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let n=0;n<this.queries.length;n++)ad(e,n).matches!==null&&this.queries[n].setDirty()}},uh=class{constructor(e,n,i=null){this.flags=n,this.read=i,typeof e=="string"?this.predicate=bI(e):this.predicate=e}},hh=class t{constructor(e=[]){this.queries=e}elementStart(e,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,n)}elementEnd(e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(e)}embeddedTView(e){let n=null;for(let i=0;i<this.length;i++){let r=n!==null?n.length:0,a=this.getByIndex(i).embeddedTView(e,r);a&&(a.indexInDeclarationView=i,n!==null?n.push(a):n=[a])}return n!==null?new t(n):null}template(e,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,n)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},dh=class t{constructor(e,n=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(e,n){this.isApplyingToNode(n)&&this.matchTNode(e,n)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,n){this.elementStart(e,n)}embeddedTView(e,n){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,n),new t(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let n=this._declarationNodeIndex,i=e.parent;for(;i!==null&&i.type&8&&i.index!==n;)i=i.parent;return n===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(e,n){let i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){let a=i[r];this.matchTNodeWithReadOption(e,n,vI(n,a)),this.matchTNodeWithReadOption(e,n,$a(n,e,a,!1,!1))}else i===rs?n.type&4&&this.matchTNodeWithReadOption(e,n,-1):this.matchTNodeWithReadOption(e,n,$a(n,e,i,!1,!1))}matchTNodeWithReadOption(e,n,i){if(i!==null){let r=this.metadata.read;if(r!==null)if(r===Ri||r===ao||r===rs&&n.type&4)this.addMatch(n.index,-2);else{let a=$a(n,e,r,!1,!1);a!==null&&this.addMatch(n.index,a)}else this.addMatch(n.index,i)}}addMatch(e,n){this.matches===null?this.matches=[e,n]:this.matches.push(e,n)}};function vI(t,e){let n=t.localNames;if(n!==null){for(let i=0;i<n.length;i+=2)if(n[i]===e)return n[i+1]}return null}function yI(t,e){return t.type&11?ro(t,e):t.type&4?rd(t,e):null}function _I(t,e,n,i){return n===-1?yI(e,t):n===-2?wI(t,e,i):io(t,t[Fe],n,e)}function wI(t,e,n){if(n===Ri)return ro(e,t);if(n===rs)return rd(e,t);if(n===ao)return yv(e,t)}function _v(t,e,n,i){let r=e[ii].queries[i];if(r.matches===null){let a=t.data,d=n.matches,v=[];for(let y=0;d!==null&&y<d.length;y+=2){let C=d[y];if(C<0)v.push(null);else{let b=a[C];v.push(_I(e,b,d[y+1],n.metadata.read))}}r.matches=v}return r.matches}function fh(t,e,n,i){let r=t.queries.getByIndex(n),a=r.matches;if(a!==null){let d=_v(t,e,r,n);for(let v=0;v<a.length;v+=2){let y=a[v];if(y>0)i.push(d[v/2]);else{let C=a[v+1],b=e[-y];for(let T=Vt;T<b.length;T++){let M=b[T];M[ls]===M[Mt]&&fh(M[Fe],M,C,i)}if(b[no]!==null){let T=b[no];for(let M=0;M<T.length;M++){let O=T[M];fh(O[Fe],O,C,i)}}}}}return i}function CI(t,e){return t[ii].queries[e].queryList}function EI(t,e,n){let i=new Yu((n&4)===4);return lE(t,e,i,i.destroy),(e[ii]??=new lh).queries.push(new ch(i))-1}function II(t,e,n){let i=ai();return i.firstCreatePass&&(DI(i,new uh(t,e,n),-1),(e&2)===2&&(i.staticViewQueries=!0)),EI(i,ut(),e)}function bI(t){return t.split(",").map(e=>e.trim())}function DI(t,e,n){t.queries===null&&(t.queries=new hh),t.queries.track(new dh(e,n))}function ad(t,e){return t.queries.getByIndex(e)}function SI(t,e){let n=t[Fe],i=ad(n,e);return i.crossesNgTemplate?fh(n,t,e,[]):_v(n,t,i,e)}var Ai=class{},as=class{};var ph=class extends Ai{constructor(e,n,i){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ac(this);let r=zg(e);this._bootstrapComponents=Bm(r.bootstrap),this._r3Injector=xm(e,n,[{provide:Ai,useValue:this},{provide:Ic,useValue:this.componentFactoryResolver},...i],$t(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},gh=class extends as{constructor(e){super(),this.moduleType=e}create(e){return new ph(this.moduleType,e,[])}};var cc=class extends Ai{constructor(e){super(),this.componentFactoryResolver=new ac(this),this.instance=null;let n=new Qo([...e.providers,{provide:Ai,useValue:this},{provide:Ic,useValue:this.componentFactoryResolver}],e.parent||Ah(),e.debugName,new Set(["environment"]));this.injector=n,e.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function cd(t,e,n=null){return new cc({providers:t,parent:e,debugName:n,runEnvironmentInitializers:!0}).injector}var Dc=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new xt(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function wv(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function TI(t,e,n){return t[e]=n}function Sc(t,e,n){let i=t[e];return Object.is(i,n)?!1:(t[e]=n,!0)}function xI(t){return(t.flags&32)===32}function AI(t,e,n,i,r,a,d,v,y){let C=e.consts,b=Cc(e,t,4,d||null,ec(C,v));ev(e,n,b,ec(C,y)),Hh(e,b);let T=b.tView=ed(2,b,i,r,a,e.directiveRegistry,e.pipeRegistry,null,e.schemas,C,null);return e.queries!==null&&(e.queries.template(e,b),T.queries=e.queries.embeddedTView(b)),b}function ld(t,e,n,i,r,a,d,v){let y=ut(),C=ai(),b=t+Gn,T=C.firstCreatePass?AI(b,C,y,e,n,i,r,a,d):C.data[b];hs(T,!1);let M=MI(C,y,T,t);Vh()&&Qh(C,y,M,T),fr(M,y);let O=iv(M,y,M,T);return y[b]=O,Ec(y,O),gI(O,T,y),Oh(T)&&Km(C,y,T),d!=null&&Qm(y,T,v),ld}var MI=OI;function OI(t,e,n,i){return Uh(!0),e[Ft].createComment("")}function RI(t,e,n,i){return Sc(t,Ph(),n)?e+Lg(n)+i:ds}function Tc(t,e,n){let i=ut(),r=Ph();if(Sc(i,r,e)){let a=ai(),d=oC();fE(a,d,i,t,e,i[Ft],n,!1)}return Tc}function Eg(t,e,n,i,r){let a=e.inputs,d=r?"class":"style";td(t,n,a[d],d,i)}function Cv(t,e,n){od("NgControlFlow");let i=ut(),r=Ph(),a=LI(i,Gn+t),d=0;if(Sc(i,r,e)){let v=Ke(null);try{if(RE(a,d),e!==-1){let y=NI(i[Fe],Gn+e),C=eh(a,y.tView.ssrId),b=cv(i,y,n,{dehydratedView:C});lv(a,b,d,Qu(y,C))}}finally{Ke(v)}}else{let v=OE(a,d);v!==void 0&&(v[Vn]=n)}}function LI(t,e){return t[e]}function NI(t,e){return Rh(t,e)}function PI(t,e,n,i,r,a){let d=e.consts,v=ec(d,r),y=Cc(e,t,2,i,v);return ev(e,n,y,ec(d,a)),y.attrs!==null&&oh(y,y.attrs,!1),y.mergedAttrs!==null&&oh(y,y.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,y),y}function xn(t,e,n,i){let r=ut(),a=ai(),d=Gn+t,v=r[Ft],y=a.firstCreatePass?PI(d,a,r,e,n,i):a.data[d],C=FI(a,r,y,v,e,t);r[d]=C;let b=Oh(y);return hs(y,!0),$m(v,C,y),!xI(y)&&Vh()&&Qh(a,r,C,y),$0()===0&&fr(C,r),z0(),b&&(Km(a,r,y),Zm(a,y,r)),i!==null&&Qm(r,y),xn}function hn(){let t=Tn();lm()?Q0():(t=t.parent,hs(t,!1));let e=t;q0(e)&&Z0(),Y0();let n=ai();return n.firstCreatePass&&(Hh(n,t),em(t)&&n.queries.elementEnd(t)),e.classesWithoutHost!=null&&uC(e)&&Eg(n,e,ut(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&hC(e)&&Eg(n,e,ut(),e.stylesWithoutHost,!1),hn}function ci(t,e,n,i){return xn(t,e,n,i),hn(),ci}var FI=(t,e,n,i,r,a)=>(Uh(!0),jm(i,r,sC()));var lc="en-US";var kI=lc;function BI(t){typeof t=="string"&&(kI=t.toLowerCase().replace(/_/g,"-"))}function mr(t,e,n,i){let r=ut(),a=ai(),d=Tn();return VI(a,r,r[Ft],d,t,e,i),mr}function jI(t,e,n,i){let r=t.cleanup;if(r!=null)for(let a=0;a<r.length-1;a+=2){let d=r[a];if(d===n&&r[a+1]===i){let v=e[Jo],y=r[a+2];return v.length>y?v[y]:null}typeof d=="string"&&(a+=2)}return null}function VI(t,e,n,i,r,a,d){let v=Oh(i),C=t.firstCreatePass&&sv(t),b=e[Vn],T=ov(e),M=!0;if(i.type&3||d){let P=Sn(i,e),Y=d?d(P):P,H=T.length,G=d?oe=>d(Wn(oe[i.index])):i.index,W=null;if(!d&&v&&(W=jI(t,e,r,i.index)),W!==null){let oe=W.__ngLastListenerFn__||W;oe.__ngNextListenerFn__=a,W.__ngLastListenerFn__=a,M=!1}else{a=bg(i,e,b,a,!1);let oe=n.listen(Y,r,a);T.push(a,oe),C&&C.push(r,G,H,H+1)}}else a=bg(i,e,b,a,!1);let O=i.outputs,L;if(M&&O!==null&&(L=O[r])){let P=L.length;if(P)for(let Y=0;Y<P;Y+=2){let H=L[Y],G=L[Y+1],te=e[H][G].subscribe(a),ie=T.length;T.push(a,te),C&&C.push(r,i.index,ie,-(ie+1))}}}function Ig(t,e,n,i){let r=Ke(null);try{return kn(6,e,n),n(i)!==!1}catch(a){return av(t,a),!1}finally{kn(7,e,n),Ke(r)}}function bg(t,e,n,i,r){return function a(d){if(d===Function)return i;let v=t.componentOffset>-1?Oi(t.index,e):e;id(v);let y=Ig(e,n,i,d),C=a.__ngNextListenerFn__;for(;C;)y=Ig(e,n,C,d)&&y,C=C.__ngNextListenerFn__;return r&&y===!1&&d.preventDefault(),y}}function Ev(t,e,n){II(t,e,n)}function ud(t){let e=ut(),n=ai(),i=um();Fh(i+1);let r=ad(n,i);if(t.dirty&&U0(e)===((r.metadata.flags&2)===2)){if(r.matches===null)t.reset([]);else{let a=SI(e,i);t.reset(a,bC),t.notifyOnChanges()}return!0}return!1}function hd(){return CI(ut(),um())}function co(t,e=""){let n=ut(),i=ai(),r=t+Gn,a=i.firstCreatePass?Cc(i,r,1,e,null):i.data[r],d=UI(i,n,a,e,t);n[r]=d,Vh()&&Qh(i,n,d,a),hs(a,!1)}var UI=(t,e,n,i,r)=>(Uh(!0),kC(e[Ft],i));function dd(t){return Iv("",t,""),dd}function Iv(t,e,n){let i=ut(),r=RI(i,t,e,n);return r!==ds&&TE(i,jh(),r),Iv}var HI=(()=>{class t{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){let i=qg(!1,n.type),r=i.length>0?cd([i],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,r)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(let n of this.cachedInjectors.values())n!==null&&n.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Re({token:t,providedIn:"environment",factory:()=>new t(Ze(un))})}}return t})();function Pi(t){od("NgStandalone"),t.getStandaloneInjector=e=>e.get(HI).getOrCreateStandaloneInjector(t)}function fd(t,e,n,i){return WI(ut(),J0(),t,e,n,i)}function GI(t,e){let n=t[e];return n===ds?void 0:n}function WI(t,e,n,i,r,a){let d=e+n;return Sc(t,d,r)?TI(t,d+1,a?i.call(a,r):i(r)):GI(t,d+1)}var xc=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})();var bv=new nt("");function fs(t){return!!t&&typeof t.then=="function"}function Dv(t){return!!t&&typeof t.subscribe=="function"}var Sv=new nt(""),Tv=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,i)=>{this.resolve=n,this.reject=i}),this.appInits=Ie(Sv,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let n=[];for(let r of this.appInits){let a=r();if(fs(a))n.push(a);else if(Dv(a)){let d=new Promise((v,y)=>{a.subscribe({complete:v,error:y})});n.push(d)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{i()}).catch(r=>{this.reject(r)}),n.length===0&&i(),this.initialized=!0}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),xv=new nt("");function $I(){_p(()=>{throw new Ae(600,!1)})}function zI(t){return t.isBoundToModule}function YI(t,e,n){try{let i=n();return fs(i)?i.catch(r=>{throw e.runOutsideAngular(()=>t.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>t.handleError(i)),i}}var Ac=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ie(Am),this.afterRenderEffectManager=Ie(mv),this.externalTestViews=new Set,this.beforeRender=new Bt,this.afterTick=new Bt,this.componentTypes=[],this.components=[],this.isStable=Ie(Dc).hasPendingTasks.pipe(qe(n=>!n)),this._injector=Ie(un)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,i){let r=n instanceof sc;if(!this._injector.get(Tv).done){let M=!r&&$g(n),O=!1;throw new Ae(405,O)}let d;r?d=n:d=this._injector.get(Ic).resolveComponentFactory(n),this.componentTypes.push(d.componentType);let v=zI(d)?void 0:this._injector.get(Ai),y=i||d.selector,C=d.create(yc.NULL,[],y,v),b=C.location.nativeElement,T=C.injector.get(bv,null);return T?.registerApplication(b),C.onDestroy(()=>{this.detachView(C.hostView),Ou(this.components,C),T?.unregisterApplication(b)}),this._loadComponent(C),C}tick(){this._tick(!0)}_tick(n){if(this._runningTick)throw new Ae(101,!1);let i=Ke(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(n)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,Ke(i)}}detectChangesInAttachedViews(n){let i=0,r=this.afterRenderEffectManager;for(;;){if(i===hv)throw new Ae(103,!1);if(n){let a=i===0;this.beforeRender.next(a);for(let{_lView:d,notifyErrorHandler:v}of this._views)XI(d,a,v)}if(i++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:a})=>mh(a))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:a})=>mh(a))))break}}attachView(n){let i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){let i=n;Ou(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);let i=this._injector.get(xv,[]);[...this._bootstrapListeners,...i].forEach(r=>r(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>Ou(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Ae(406,!1);let n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Ou(t,e){let n=t.indexOf(e);n>-1&&t.splice(n,1)}function XI(t,e,n){!e&&!mh(t)||qI(t,n,e)}function mh(t){return Nh(t)}function qI(t,e,n){let i;n?(i=0,t[xe]|=1024):t[xe]&64?i=0:i=1,dv(t,e,i)}var vh=class{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}},pd=(()=>{class t{compileModuleSync(n){return new gh(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){let i=this.compileModuleSync(n),r=zg(n),a=Bm(r.declarations).reduce((d,v)=>{let y=lr(v);return y&&d.push(new ss(y)),d},[]);return new vh(i,a)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ZI=(()=>{class t{constructor(){this.zone=Ie(vt),this.applicationRef=Ie(Ac)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function KI(t){return[{provide:vt,useFactory:t},{provide:eo,multi:!0,useFactory:()=>{let e=Ie(ZI,{optional:!0});return()=>e.initialize()}},{provide:eo,multi:!0,useFactory:()=>{let e=Ie(tb);return()=>{e.initialize()}}},{provide:Am,useFactory:QI}]}function QI(){let t=Ie(vt),e=Ie(ri);return n=>t.runOutsideAngular(()=>e.handleError(n))}function JI(t){let e=KI(()=>new vt(eb(t)));return Th([[],e])}function eb(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var tb=(()=>{class t{constructor(){this.subscription=new wt,this.initialized=!1,this.zone=Ie(vt),this.pendingTasks=Ie(Dc)}initialize(){if(this.initialized)return;this.initialized=!0;let n=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(n=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{vt.assertNotInAngularZone(),queueMicrotask(()=>{n!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(n),n=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{vt.assertInAngularZone(),n??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function nb(){return typeof $localize<"u"&&$localize.locale||lc}var gd=new nt("",{providedIn:"root",factory:()=>Ie(gd,Ge.Optional|Ge.SkipSelf)||nb()});var Av=new nt("");var Ya=null;function ib(t=[],e){return yc.create({name:e,providers:[{provide:pc,useValue:"platform"},{provide:Av,useValue:new Set([()=>Ya=null])},...t]})}function rb(t=[]){if(Ya)return Ya;let e=ib(t);return Ya=e,$I(),ob(e),e}function ob(t){t.get(zh,null)?.forEach(n=>n())}var ps=(()=>{class t{static{this.__NG_ELEMENT_ID__=sb}}return t})();function sb(t){return ab(Tn(),ut(),(t&16)===16)}function ab(t,e,n){if(mc(t)&&!n){let i=Oi(t.index,e);return new pr(i,i)}else if(t.type&47){let i=e[Hn];return new pr(i,e)}return null}var yh=class{constructor(){}supports(e){return e instanceof Map||wv(e)}create(){return new _h}},_h=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(e){let n;for(n=this._mapHead;n!==null;n=n._next)e(n)}forEachPreviousItem(e){let n;for(n=this._previousMapHead;n!==null;n=n._nextPrevious)e(n)}forEachChangedItem(e){let n;for(n=this._changesHead;n!==null;n=n._nextChanged)e(n)}forEachAddedItem(e){let n;for(n=this._additionsHead;n!==null;n=n._nextAdded)e(n)}forEachRemovedItem(e){let n;for(n=this._removalsHead;n!==null;n=n._nextRemoved)e(n)}diff(e){if(!e)e=new Map;else if(!(e instanceof Map||wv(e)))throw new Ae(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(i,r)=>{if(n&&n.key===r)this._maybeAddToChanges(n,i),this._appendAfter=n,n=n._next;else{let a=this._getOrCreateRecordForKey(r,i);n=this._insertBeforeOrAppend(n,a)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let i=n;i!==null;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,n){if(e){let i=e._prev;return n._next=e,n._prev=i,e._prev=n,i&&(i._next=n),e===this._mapHead&&(this._mapHead=n),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(e,n){if(this._records.has(e)){let r=this._records.get(e);this._maybeAddToChanges(r,n);let a=r._prev,d=r._next;return a&&(a._next=d),d&&(d._prev=a),r._next=null,r._prev=null,r}let i=new wh(e);return this._records.set(e,i),i.currentValue=n,this._addToAdditions(i),i}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;e!==null;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;e!=null;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,n){Object.is(n,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=n,this._addToChanges(e))}_addToAdditions(e){this._additionsHead===null?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){this._changesHead===null?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,n){e instanceof Map?e.forEach(n):Object.keys(e).forEach(i=>n(e[i],i))}},wh=class{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function Dg(){return new md([new yh])}var md=(()=>{class t{static{this.\u0275prov=Re({token:t,providedIn:"root",factory:Dg})}constructor(n){this.factories=n}static create(n,i){if(i){let r=i.factories.slice();n=n.concat(r)}return new t(n)}static extend(n){return{provide:t,useFactory:i=>t.create(n,i||Dg()),deps:[[t,new kg,new Ih]]}}find(n){let i=this.factories.find(r=>r.supports(n));if(i)return i;throw new Ae(901,!1)}}return t})();function Mv(t){try{let{rootComponent:e,appProviders:n,platformProviders:i}=t,r=rb(i),a=[JI(),...n||[]],v=new cc({providers:a,parent:r,debugName:"",runEnvironmentInitializers:!1}).injector,y=v.get(vt);return y.run(()=>{v.resolveInjectorInitializers();let C=v.get(ri,null),b;y.runOutsideAngular(()=>{b=y.onError.subscribe({next:O=>{C.handleError(O)}})});let T=()=>v.destroy(),M=r.get(Av);return M.add(T),v.onDestroy(()=>{b.unsubscribe(),M.delete(T)}),YI(C,y,()=>{let O=v.get(Tv);return O.runInitializers(),O.donePromise.then(()=>{let L=v.get(gd,lc);BI(L||lc);let P=v.get(Ac);return e!==void 0&&P.bootstrap(e),P})})})}catch(e){return Promise.reject(e)}}var Fv=null;function uo(){return Fv}function kv(t){Fv??=t}var Mc=class{};var dn=new nt(""),Bv=(()=>{class t{historyGo(n){throw new Error("")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:()=>Ie(db),providedIn:"platform"})}}return t})();var db=(()=>{class t extends Bv{constructor(){super(),this._doc=Ie(dn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return uo().getBaseHref(this._doc)}onPopState(n){let i=uo().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){let i=uo().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,i,r){this._history.pushState(n,i,r)}replaceState(n,i,r){this._history.replaceState(n,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:()=>new t,providedIn:"platform"})}}return t})();function jv(t,e){if(t.length==0)return e;if(e.length==0)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,n==2?t+e.substring(1):n==1?t+e:t+"/"+e}function Ov(t){let e=t.match(/#|\?|$/),n=e&&e.index||t.length,i=n-(t[n-1]==="/"?1:0);return t.slice(0,i)+t.slice(n)}function vr(t){return t&&t[0]!=="?"?"?"+t:t}var Rc=(()=>{class t{historyGo(n){throw new Error("")}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:()=>Ie(Vv),providedIn:"root"})}}return t})(),fb=new nt(""),Vv=(()=>{class t extends Rc{constructor(n,i){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??Ie(dn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return jv(this._baseHref,n)}path(n=!1){let i=this._platformLocation.pathname+vr(this._platformLocation.search),r=this._platformLocation.hash;return r&&n?`${i}${r}`:i}pushState(n,i,r,a){let d=this.prepareExternalUrl(r+vr(a));this._platformLocation.pushState(n,i,d)}replaceState(n,i,r,a){let d=this.prepareExternalUrl(r+vr(a));this._platformLocation.replaceState(n,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static{this.\u0275fac=function(i){return new(i||t)(Ze(Bv),Ze(fb,8))}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var gs=(()=>{class t{constructor(n){this._subject=new ln,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;let i=this._locationStrategy.getBaseHref();this._basePath=mb(Ov(Rv(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+vr(i))}normalize(n){return t.stripTrailingSlash(gb(this._basePath,Rv(n)))}prepareExternalUrl(n){return n&&n[0]!=="/"&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,i="",r=null){this._locationStrategy.pushState(r,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+vr(i)),r)}replaceState(n,i="",r=null){this._locationStrategy.replaceState(r,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+vr(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(r=>r(n,i))}subscribe(n,i,r){return this._subject.subscribe({next:n,error:i,complete:r})}static{this.normalizeQueryParams=vr}static{this.joinWithSlash=jv}static{this.stripTrailingSlash=Ov}static{this.\u0275fac=function(i){return new(i||t)(Ze(Rc))}}static{this.\u0275prov=Re({token:t,factory:()=>pb(),providedIn:"root"})}}return t})();function pb(){return new gs(Ze(Rc))}function gb(t,e){if(!t||!e.startsWith(t))return e;let n=e.substring(t.length);return n===""||["/",";","?","#"].includes(n[0])?n:e}function Rv(t){return t.replace(/\/index.html$/,"")}function mb(t){if(new RegExp("^(https?:)?//").test(t)){let[,n]=t.split(/\/\/[^\/]+/);return n}return t}function Uv(t,e){e=encodeURIComponent(e);for(let n of t.split(";")){let i=n.indexOf("="),[r,a]=i==-1?[n,""]:[n.slice(0,i),n.slice(i+1)];if(r.trim()===e)return decodeURIComponent(a)}return null}var Hv=(()=>{class t{constructor(n,i,r){this._ngEl=n,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(n){this._ngStyle=n,!this._differ&&n&&(this._differ=this._differs.find(n).create())}ngDoCheck(){if(this._differ){let n=this._differ.diff(this._ngStyle);n&&this._applyChanges(n)}}_setStyle(n,i){let[r,a]=n.split("."),d=r.indexOf("-")===-1?void 0:Li.DashCase;i!=null?this._renderer.setStyle(this._ngEl.nativeElement,r,a?`${i}${a}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(n){n.forEachRemovedItem(i=>this._setStyle(i.key,null)),n.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),n.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}static{this.\u0275fac=function(i){return new(i||t)(Ni(Ri),Ni(md),Ni(bc))}}static{this.\u0275dir=fc({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0})}}return t})();var Gv="browser",vb="server";function vd(t){return t===vb}var Oc=class{};var wd=class extends Mc{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Cd=class t extends wd{static makeCurrent(){kv(new t)}onAndCancel(e,n,i){return e.addEventListener(n,i),()=>{e.removeEventListener(n,i)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return n=n||this.getDefaultDocument(),n.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return n==="window"?window:n==="document"?e:n==="body"?e.body:null}getBaseHref(e){let n=yb();return n==null?null:_b(n)}resetBaseElement(){ms=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Uv(document.cookie,e)}},ms=null;function yb(){return ms=ms||document.querySelector("base"),ms?ms.getAttribute("href"):null}function _b(t){return new URL(t,document.baseURI).pathname}var wb=(()=>{class t{build(){return new XMLHttpRequest}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac})}}return t})(),Ed=new nt(""),Yv=(()=>{class t{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(r=>{r.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,r){return this._findPluginFor(i).addEventListener(n,i,r)}getZone(){return this._zone}_findPluginFor(n){let i=this._eventNameToPlugin.get(n);if(i)return i;if(i=this._plugins.find(a=>a.supports(n)),!i)throw new Ae(5101,!1);return this._eventNameToPlugin.set(n,i),i}static{this.\u0275fac=function(i){return new(i||t)(Ze(Ed),Ze(vt))}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac})}}return t})(),Lc=class{constructor(e){this._doc=e}},yd="ng-app-id",Xv=(()=>{class t{constructor(n,i,r,a={}){this.doc=n,this.appId=i,this.nonce=r,this.platformId=a,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=vd(a),this.resetHostNodes()}addStyles(n){for(let i of n)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(n){for(let i of n)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let n=this.styleNodesInDOM;n&&(n.forEach(i=>i.remove()),n.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(let i of this.getAllStyles())this.addStyleToHost(n,i)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(let i of this.hostNodes)this.addStyleToHost(i,n)}onStyleRemoved(n){let i=this.styleRef;i.get(n)?.elements?.forEach(r=>r.remove()),i.delete(n)}collectServerRenderedStyles(){let n=this.doc.head?.querySelectorAll(`style[${yd}="${this.appId}"]`);if(n?.length){let i=new Map;return n.forEach(r=>{r.textContent!=null&&i.set(r.textContent,r)}),i}return null}changeUsageCount(n,i){let r=this.styleRef;if(r.has(n)){let a=r.get(n);return a.usage+=i,a.usage}return r.set(n,{usage:i,elements:[]}),i}getStyleElement(n,i){let r=this.styleNodesInDOM,a=r?.get(i);if(a?.parentNode===n)return r.delete(i),a.removeAttribute(yd),a;{let d=this.doc.createElement("style");return this.nonce&&d.setAttribute("nonce",this.nonce),d.textContent=i,this.platformIsServer&&d.setAttribute(yd,this.appId),n.appendChild(d),d}}addStyleToHost(n,i){let r=this.getStyleElement(n,i),a=this.styleRef,d=a.get(i)?.elements;d?d.push(r):a.set(i,{elements:[r],usage:1})}resetHostNodes(){let n=this.hostNodes;n.clear(),n.add(this.doc.head)}static{this.\u0275fac=function(i){return new(i||t)(Ze(dn),Ze($h),Ze(Yh,8),Ze(oo))}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac})}}return t})(),_d={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},bd=/%COMP%/g,qv="%COMP%",Cb=`_nghost-${qv}`,Eb=`_ngcontent-${qv}`,Ib=!0,bb=new nt("",{providedIn:"root",factory:()=>Ib});function Db(t){return Eb.replace(bd,t)}function Sb(t){return Cb.replace(bd,t)}function Zv(t,e){return e.map(n=>n.replace(bd,t))}var Wv=(()=>{class t{constructor(n,i,r,a,d,v,y,C=null){this.eventManager=n,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=a,this.doc=d,this.platformId=v,this.ngZone=y,this.nonce=C,this.rendererByCompId=new Map,this.platformIsServer=vd(v),this.defaultRenderer=new vs(n,d,y,this.platformIsServer)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===jn.ShadowDom&&(i=mt(Te({},i),{encapsulation:jn.Emulated}));let r=this.getOrCreateRenderer(n,i);return r instanceof Nc?r.applyToHost(n):r instanceof ys&&r.applyStyles(),r}getOrCreateRenderer(n,i){let r=this.rendererByCompId,a=r.get(i.id);if(!a){let d=this.doc,v=this.ngZone,y=this.eventManager,C=this.sharedStylesHost,b=this.removeStylesOnCompDestroy,T=this.platformIsServer;switch(i.encapsulation){case jn.Emulated:a=new Nc(y,C,i,this.appId,b,d,v,T);break;case jn.ShadowDom:return new Id(y,C,n,i,d,v,this.nonce,T);default:a=new ys(y,C,i,b,d,v,T);break}r.set(i.id,a)}return a}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(i){return new(i||t)(Ze(Yv),Ze(Xv),Ze($h),Ze(bb),Ze(dn),Ze(oo),Ze(vt),Ze(Yh))}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac})}}return t})(),vs=class{constructor(e,n,i,r){this.eventManager=e,this.doc=n,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,n){return n?this.doc.createElementNS(_d[n]||n,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,n){($v(e)?e.content:e).appendChild(n)}insertBefore(e,n,i){e&&($v(e)?e.content:e).insertBefore(n,i)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let i=typeof e=="string"?this.doc.querySelector(e):e;if(!i)throw new Ae(-5104,!1);return n||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,i,r){if(r){n=r+":"+n;let a=_d[r];a?e.setAttributeNS(a,n,i):e.setAttribute(n,i)}else e.setAttribute(n,i)}removeAttribute(e,n,i){if(i){let r=_d[i];r?e.removeAttributeNS(r,n):e.removeAttribute(`${i}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,i,r){r&(Li.DashCase|Li.Important)?e.style.setProperty(n,i,r&Li.Important?"important":""):e.style[n]=i}removeStyle(e,n,i){i&Li.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,i){e!=null&&(e[n]=i)}setValue(e,n){e.nodeValue=n}listen(e,n,i){if(typeof e=="string"&&(e=uo().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${n}`);return this.eventManager.addEventListener(e,n,this.decoratePreventDefault(i))}decoratePreventDefault(e){return n=>{if(n==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(n)):e(n))===!1&&n.preventDefault()}}};function $v(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var Id=class extends vs{constructor(e,n,i,r,a,d,v,y){super(e,a,d,y),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let C=Zv(r.id,r.styles);for(let b of C){let T=document.createElement("style");v&&T.setAttribute("nonce",v),T.textContent=b,this.shadowRoot.appendChild(T)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,i){return super.insertBefore(this.nodeOrShadowRoot(e),n,i)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},ys=class extends vs{constructor(e,n,i,r,a,d,v,y){super(e,a,d,v),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=r,this.styles=y?Zv(y,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Nc=class extends ys{constructor(e,n,i,r,a,d,v,y){let C=r+"-"+i.id;super(e,n,i,a,d,v,y,C),this.contentAttr=Db(C),this.hostAttr=Sb(C)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,n){let i=super.createElement(e,n);return super.setAttribute(i,this.contentAttr,""),i}},Tb=(()=>{class t extends Lc{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,r){return n.addEventListener(i,r,!1),()=>this.removeEventListener(n,i,r)}removeEventListener(n,i,r){return n.removeEventListener(i,r)}static{this.\u0275fac=function(i){return new(i||t)(Ze(dn))}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac})}}return t})(),zv=["alt","control","meta","shift"],xb={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ab={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},Mb=(()=>{class t extends Lc{constructor(n){super(n)}supports(n){return t.parseEventName(n)!=null}addEventListener(n,i,r){let a=t.parseEventName(i),d=t.eventCallback(a.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>uo().onAndCancel(n,a.domEventName,d))}static parseEventName(n){let i=n.toLowerCase().split("."),r=i.shift();if(i.length===0||!(r==="keydown"||r==="keyup"))return null;let a=t._normalizeKey(i.pop()),d="",v=i.indexOf("code");if(v>-1&&(i.splice(v,1),d="code."),zv.forEach(C=>{let b=i.indexOf(C);b>-1&&(i.splice(b,1),d+=C+".")}),d+=a,i.length!=0||a.length===0)return null;let y={};return y.domEventName=r,y.fullKey=d,y}static matchEventFullKeyCode(n,i){let r=xb[n.key]||n.key,a="";return i.indexOf("code.")>-1&&(r=n.code,a="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),zv.forEach(d=>{if(d!==r){let v=Ab[d];v(n)&&(a+=d+".")}}),a+=r,a===i)}static eventCallback(n,i,r){return a=>{t.matchEventFullKeyCode(a,n)&&r.runGuarded(()=>i(a))}}static _normalizeKey(n){return n==="esc"?"escape":n}static{this.\u0275fac=function(i){return new(i||t)(Ze(dn))}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac})}}return t})();function Kv(t,e){return Mv(Te({rootComponent:t},Ob(e)))}function Ob(t){return{appProviders:[...Fb,...t?.providers??[]],platformProviders:Pb}}function Rb(){Cd.makeCurrent()}function Lb(){return new ri}function Nb(){return Fm(document),document}var Pb=[{provide:oo,useValue:Gv},{provide:zh,useValue:Rb,multi:!0},{provide:dn,useFactory:Nb,deps:[]}];var Fb=[{provide:pc,useValue:"root"},{provide:ri,useFactory:Lb,deps:[]},{provide:Ed,useClass:Tb,multi:!0,deps:[dn,vt,oo]},{provide:Ed,useClass:Mb,multi:!0,deps:[dn]},Wv,Xv,Yv,{provide:os,useExisting:Wv},{provide:Oc,useClass:wb,deps:[]},[]];var Qv=(()=>{class t{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}static{this.\u0275fac=function(i){return new(i||t)(Ze(dn))}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Jv=t=>t&&typeof t=="object"&&typeof t.then=="function",ey=$(void 0,null,function*(){}).constructor,Es=class extends ey{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let n;this._task=e,Jv(e)?n=e:typeof e=="function"&&(n=new ey(e)),n&&$(this,null,function*(){try{let i=yield n;e===this._task&&this.resolve(i)}catch(i){e===this._task&&this.reject(i)}})}get isEmpty(){return this._task==null}constructor(e){let n,i;super((r,a)=>{n=r,i=a}),this._s="pending",this.resolve=r=>{this.isPending&&(Jv(r)?this.task=r:(this._s="fulfilled",n(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",i(r))},this.task=e}};function je(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function yr(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n}var Fi,An,De;typeof SuppressedError=="function"&&SuppressedError,function(t){t[t.BOPM_BLOCK=0]="BOPM_BLOCK",t[t.BOPM_UPDATE=1]="BOPM_UPDATE"}(Fi||(Fi={})),function(t){t[t.CCUT_AUTO=0]="CCUT_AUTO",t[t.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",t[t.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",t[t.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",t[t.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",t[t.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(An||(An={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12",t[t.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(De||(De={}));var kc=typeof self>"u",ly=typeof importScripts=="function",ty=(()=>{if(!ly){if(!kc&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),uy=t=>{if(t==null&&(t="./"),!(kc||ly)){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},hy=t=>Object.prototype.toString.call(t),dy=t=>Array.isArray?Array.isArray(t):hy(t)==="[object Array]",Td=t=>hy(t)==="[object Boolean]",Ot=t=>typeof t=="number"&&!Number.isNaN(t),ki=t=>t!==null&&typeof t=="object"&&!Array.isArray(t);var Bb=t=>!!ki(t)&&!!Ot(t.width)&&!(t.width<=0)&&!!Ot(t.height)&&!(t.height<=0)&&!!Ot(t.stride)&&!(t.stride<=0)&&"format"in t&&!("tag"in t&&!jb(t.tag));var Uc=t=>!!Bb(t)&&t.bytes instanceof Uint8Array,Hc=t=>!!ki(t)&&!!Ot(t.left)&&!(t.left<0)&&!!Ot(t.top)&&!(t.top<0)&&!!Ot(t.right)&&!(t.right<0)&&!!Ot(t.bottom)&&!(t.bottom<0)&&!(t.left>=t.right)&&!(t.top>=t.bottom)&&!!Td(t.isMeasuredInPercentage),jb=t=>t===null||!!ki(t)&&!!Ot(t.imageId)&&"type"in t;var Gc=t=>!!ki(t)&&!!Ot(t.x)&&!!Ot(t.y),xd=t=>!!ki(t)&&!!dy(t.points)&&t.points.length!=0&&!t.points.some(e=>!Gc(e)),Ad=t=>!!ki(t)&&!!dy(t.points)&&t.points.length!=0&&t.points.length==4&&!t.points.some(e=>!Gc(e)),Bi=t=>!!ki(t)&&!!Ot(t.x)&&!!Ot(t.y)&&!!Ot(t.width)&&!(t.width<0)&&!!Ot(t.height)&&!(t.height<0)&&!("isMeasuredInPercentage"in t&&!Td(t.isMeasuredInPercentage)),Wc=(t,e)=>$(void 0,null,function*(){return yield new Promise((n,i)=>{let r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType=e,r.send(),r.onloadend=()=>$(void 0,null,function*(){r.status<200||r.status>=300?i(new Error(t+" "+r.status)):n(r.response)}),r.onerror=()=>{i(new Error("Network Error: "+r.statusText))}})});var On=(t,e)=>{let n=t.split("."),i=e.split(".");for(let r=0;r<n.length&&r<i.length;++r){let a=n[r],d=i[r];if(a===d)continue;let v=parseInt(n[r]),y=parseInt(i[r]);return v===y||Number.isNaN(v)&&Number.isNaN(y)?a<d?-1:1:v<y||Number.isNaN(v)&&Number.isInteger(y)?-1:1}return n.length===i.length?0:n.length<i.length?-1:1},ji=t=>{let e={},n={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcpd:"dynamsoft-code-parser",dlrData:"dynamsoft-label-recognizer-data",dce:"dynamsoft-camera-enhancer",ddv:"dynamsoft-document-viewer"};for(let i in t){if(i==="rootDirectory")continue;let r=i,a=t[r],d=a&&typeof a=="object"&&a.path?a.path:a,v=t.rootDirectory;if(v&&!v.endsWith("/")&&(v+="/"),typeof a=="object"&&a.isInternal)v&&(d=t[r].version?`${v}${n[r]}@${t[r].version}/dist/${r==="ddv"?"engine":""}`:`${v}${n[r]}/dist/${r==="ddv"?"engine":""}`);else{let y=/^@engineRootDirectory(\/?)/;if(typeof d=="string"&&(d=d.replace(y,v||"")),typeof d=="object"&&r==="dwt"){let C=t[r].resourcesPath,b=t[r].serviceInstallerLocation;e[r]={resourcesPath:C.replace(y,v||""),serviceInstallerLocation:b.replace(y,v||"")};continue}}e[r]=uy(d)}return e};var Fc,yt,_r,ws,Cs,fn,wr,Dd,ho=class t{get _isFetchingStarted(){return je(this,Cs,"f")}constructor(){Fc.add(this),yt.set(this,[]),_r.set(this,1),ws.set(this,Fi.BOPM_BLOCK),Cs.set(this,!1),fn.set(this,void 0),wr.set(this,An.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var n;if(!Uc(e))throw new TypeError("Invalid 'image'.");if(!((n=e.tag)===null||n===void 0)&&n.hasOwnProperty("imageId")&&typeof e.tag.imageId=="number"&&this.hasImage(e.tag.imageId))throw new Error("Existed imageId.");if(je(this,yt,"f").length>=je(this,_r,"f"))switch(je(this,ws,"f")){case Fi.BOPM_BLOCK:break;case Fi.BOPM_UPDATE:if(je(this,yt,"f").push(e),ki(je(this,fn,"f"))&&Ot(je(this,fn,"f").imageId)&&je(this,fn,"f").keepInBuffer==1)for(;je(this,yt,"f").length>je(this,_r,"f");){let i=je(this,yt,"f").findIndex(r=>{var a;return((a=r.tag)===null||a===void 0?void 0:a.imageId)!==je(this,fn,"f").imageId});je(this,yt,"f").splice(i,1)}else je(this,yt,"f").splice(0,je(this,yt,"f").length-je(this,_r,"f"))}else je(this,yt,"f").push(e)}getImage(){if(je(this,yt,"f").length===0)return null;let e;if(je(this,fn,"f")&&Ot(je(this,fn,"f").imageId)){let n=je(this,Fc,"m",Dd).call(this,je(this,fn,"f").imageId);if(n<0)throw new Error(`Image with id ${je(this,fn,"f").imageId} doesn't exist.`);e=je(this,yt,"f").slice(n,n+1)[0]}else e=je(this,yt,"f").pop();if([De.IPF_RGB_565,De.IPF_RGB_555,De.IPF_RGB_888,De.IPF_ARGB_8888,De.IPF_RGB_161616,De.IPF_ARGB_16161616,De.IPF_ABGR_8888,De.IPF_ABGR_16161616,De.IPF_BGR_888].includes(e.format)){if(je(this,wr,"f")===An.CCUT_RGB_R_CHANNEL_ONLY){t._onLog&&t._onLog("only get R channel data.");let n=new Uint8Array(e.width*e.height);for(let i=0;i<n.length;i++)switch(e.format){case De.IPF_RGB_565:case De.IPF_RGB_555:case De.IPF_RGB_888:case De.IPF_RGB_161616:n[i]=e.bytes[3*i+2];break;case De.IPF_ARGB_8888:case De.IPF_ARGB_16161616:n[i]=e.bytes[4*i+2];break;case De.IPF_BGR_888:n[i]=e.bytes[3*i];break;case De.IPF_ABGR_8888:case De.IPF_ABGR_16161616:n[i]=e.bytes[4*i]}e.bytes=n,e.stride=e.width,e.format=De.IPF_GRAYSCALED}else if(je(this,wr,"f")===An.CCUT_RGB_G_CHANNEL_ONLY){t._onLog&&t._onLog("only get G channel data.");let n=new Uint8Array(e.width*e.height);for(let i=0;i<n.length;i++)switch(e.format){case De.IPF_RGB_565:case De.IPF_RGB_555:case De.IPF_RGB_888:case De.IPF_RGB_161616:case De.IPF_BGR_888:n[i]=e.bytes[3*i+1];break;case De.IPF_ARGB_8888:case De.IPF_ARGB_16161616:case De.IPF_ABGR_8888:case De.IPF_ABGR_16161616:n[i]=e.bytes[4*i+1]}e.bytes=n,e.stride=e.width,e.format=De.IPF_GRAYSCALED}else if(je(this,wr,"f")===An.CCUT_RGB_B_CHANNEL_ONLY){t._onLog&&t._onLog("only get B channel data.");let n=new Uint8Array(e.width*e.height);for(let i=0;i<n.length;i++)switch(e.format){case De.IPF_RGB_565:case De.IPF_RGB_555:case De.IPF_RGB_888:case De.IPF_RGB_161616:n[i]=e.bytes[3*i];break;case De.IPF_ARGB_8888:case De.IPF_ARGB_16161616:n[i]=e.bytes[4*i];break;case De.IPF_BGR_888:n[i]=e.bytes[3*i+2];break;case De.IPF_ABGR_8888:case De.IPF_ABGR_16161616:n[i]=e.bytes[4*i+2]}e.bytes=n,e.stride=e.width,e.format=De.IPF_GRAYSCALED}}else[De.IPF_NV21,De.IPF_NV12].includes(e.format)&&t._onLog&&t._onLog("NV21 or NV12 is not supported.");return e}setNextImageToReturn(e,n){if(!((...i)=>i.length!==0&&i.every(r=>Ot(r)))(e))throw new TypeError("Invalid 'imageId'.");if(n!==void 0&&!Td(n))throw new TypeError("Invalid 'keepInBuffer'.");yr(this,fn,{imageId:e,keepInBuffer:n},"f")}_resetNextReturnedImage(){yr(this,fn,null,"f")}hasImage(e){return je(this,Fc,"m",Dd).call(this,e)>=0}startFetching(){yr(this,Cs,!0,"f")}stopFetching(){yr(this,Cs,!1,"f")}setMaxImageCount(e){if(typeof e!="number")throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(yr(this,_r,e,"f");je(this,yt,"f")&&je(this,yt,"f").length>e;)je(this,yt,"f").shift()}getMaxImageCount(){return je(this,_r,"f")}getImageCount(){return je(this,yt,"f").length}clearBuffer(){je(this,yt,"f").length=0}isBufferEmpty(){return je(this,yt,"f").length===0}setBufferOverflowProtectionMode(e){yr(this,ws,e,"f")}getBufferOverflowProtectionMode(){return je(this,ws,"f")}setColourChannelUsageType(e){yr(this,wr,e,"f")}getColourChannelUsageType(){return je(this,wr,"f")}},_s,li,Pc,Bc,Ut;yt=new WeakMap,_r=new WeakMap,ws=new WeakMap,Cs=new WeakMap,fn=new WeakMap,wr=new WeakMap,Fc=new WeakSet,Dd=function(t){if(typeof t!="number")throw new TypeError("Invalid 'imageId'.");return je(this,yt,"f").findIndex(e=>{var n;return((n=e.tag)===null||n===void 0?void 0:n.imageId)===t})},typeof navigator<"u"&&(_s=navigator,li=_s.userAgent,Pc=_s.platform,Bc=_s.mediaDevices),function(){if(!kc){let t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:_s.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Pc,search:"Win"},Mac:{str:Pc},Linux:{str:Pc}},n="unknownBrowser",i=0,r="unknownOS";for(let a in t){let d=t[a]||{},v=d.str||li,y=d.search||a,C=d.verStr||li,b=d.verSearch||a;if(b instanceof Array||(b=[b]),v.indexOf(y)!=-1){n=a;for(let T of b){let M=C.indexOf(T);if(M!=-1){i=parseFloat(C.substring(M+T.length+1));break}}break}}for(let a in e){let d=e[a]||{},v=d.str||li,y=d.search||a;if(v.indexOf(y)!=-1){r=a;break}}r=="Linux"&&li.indexOf("Windows NT")!=-1&&(r="HarmonyOS"),Ut={browser:n,version:i,OS:r}}kc&&(Ut={browser:"ssr",version:0,OS:"ssr"})}();var Vb=typeof WebAssembly<"u"&&li&&!(/Safari/.test(li)&&!/Chrome/.test(li)&&/\(.+\s11_2_([2-6]).*\)/.test(li)),Ub=!(typeof Worker>"u"),fy=!(!Bc||!Bc.getUserMedia),Hb=()=>$(void 0,null,function*(){let t=!1;if(fy)try{(yield Bc.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t});Ut.browser==="Chrome"&&Ut.version>66||Ut.browser==="Safari"&&Ut.version>13||Ut.browser==="OPR"&&Ut.version>43||Ut.browser==="Edge"&&Ut.version;var $n={},jc=t=>$(void 0,null,function*(){let e=typeof t=="string"?[t]:t,n=[];for(let i of e)n.push($n[i]=$n[i]||new Es);yield Promise.all(n)}),$c=(t,e)=>$(void 0,null,function*(){let n,i=typeof t=="string"?[t]:t,r=[];for(let a of i){let d;r.push(d=$n[a]=$n[a]||new Es(n=n||e())),d.isEmpty&&(d.task=n=n||e())}yield Promise.all(r)}),ke,py=0,Je=()=>py++,We={},ui,Gb=t=>{ui=t,ke&&ke.postMessage({type:"setBLog",body:{value:!!t}})},Md=!1,Wb=t=>{Md=t,ke&&ke.postMessage({type:"setBDebug",body:{value:!!t}})},Mn={},ht={},zt={dip:{wasm:!0}},Sd={std:{version:"1.4.21",path:uy(ty+"../../dynamsoft-capture-vision-std@1.4.21/dist/"),isInternal:!0},core:{version:"3.4.31",path:ty,isInternal:!0}},Rn=t=>$(void 0,null,function*(){let e;t instanceof Array||(t=t?[t]:[]);let n=$n.core;e=!n||n.isEmpty;let i=new Map,r=v=>{if((v=v.toLowerCase())=="std"||v=="core")return;if(!zt[v])throw Error("The '"+v+"' module cannot be found.");let y=zt[v].deps;if(y?.length)for(let b of y)r(b);let C=$n[v];i.has(v)||i.set(v,!C||C.isEmpty)};for(let v of t)r(v);let a=[];e&&a.push("core"),a.push(...i.keys());let d=[...i.entries()].filter(v=>!v[1]).map(v=>v[0]);yield $c(a,()=>$(void 0,null,function*(){let v=[...i.entries()].filter(O=>O[1]).map(O=>O[0]);yield jc(d);let y=ji(Sd),C={};for(let O of v)C[O]=zt[O];let b={engineResourcePaths:y,autoResources:C,names:v},T=new Es;if(e){b.needLoadCore=!0;let O=y.core+be._workerName;O.startsWith(location.origin)||(O=yield fetch(O).then(L=>L.blob()).then(L=>URL.createObjectURL(L))),ke=new Worker(O),ke.onerror=L=>{let P=new Error(L.message);T.reject(P)},ke.addEventListener("message",L=>{let P=L.data?L.data:L,Y=P.type,H=P.id,G=P.body;switch(Y){case"log":ui&&ui(P.message);break;case"task":try{We[H](G),delete We[H]}catch(W){throw delete We[H],W}break;case"event":try{We[H](G)}catch(W){throw W}break;default:console.log(L)}}),b.bLog=!!ui,b.bd=Md,b.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield jc("core");let M=py++;We[M]=O=>{if(O.success)Object.assign(Mn,O.versions),JSON.stringify(O.versions)!=="{}"&&(be._versions=O.versions),T.resolve(void 0);else{let L=Error(O.message);O.stack&&(L.stack=O.stack),T.reject(L)}},ke.postMessage({type:"loadWasm",body:b,id:M}),yield T}))}),be=class t{static get engineResourcePaths(){return Sd}static set engineResourcePaths(e){Object.assign(Sd,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return ui}static set _onLog(e){Gb(e)}static get _bDebug(){return Md}static set _bDebug(e){Wb(e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!$n[e]&&$n[e].isFulfilled}static loadWasm(e){return $(this,null,function*(){return yield Rn(e)})}static detectEnvironment(){return $(this,null,function*(){return yield $(this,null,function*(){return{wasm:Vb,worker:Ub,getUserMedia:fy,camera:yield Hb(),browser:Ut.browser,version:Ut.version,OS:Ut.OS}})})}static getModuleVersion(){return $(this,null,function*(){return yield new Promise((e,n)=>{let i=Je();We[i]=r=>$(this,null,function*(){if(r.success)return e(r.versions);{let a=new Error(r.message);return a.stack=r.stack+`
`+a.stack,n(a)}}),ke.postMessage({type:"getModuleVersion",id:i})})})}static getVersion(){let e=Mn.core&&Mn.core.worker,n=Mn.core&&Mn.core.wasm;return`3.4.31(Worker: ${e||"Not Loaded"}, Wasm: ${n||"Not Loaded"})`}static enableLogging(){ho._onLog=console.log,t._onLog=console.log}static disableLogging(){ho._onLog=null,t._onLog=null}static cfd(e){return $(this,null,function*(){return yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success)return n();{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cfd",id:r,body:{count:e}})})})}},_e,ny,Vc,iy,ry,Is,oy,sy,bs;be._bSupportDce4Module=-1,be._bSupportIRTModule=-1,be._versions=null,be._workerName="core.worker.js",be.browserInfo=Ut,function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(_e||(_e={})),function(t){t[t.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",t[t.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",t[t.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",t[t.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(ny||(ny={})),function(t){t[t.EC_OK=0]="EC_OK",t[t.EC_UNKNOWN=-1e4]="EC_UNKNOWN",t[t.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",t[t.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",t[t.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",t[t.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",t[t.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",t[t.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",t[t.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",t[t.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",t[t.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",t[t.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",t[t.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",t[t.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",t[t.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",t[t.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",t[t.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",t[t.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",t[t.EC_TIMEOUT=-10026]="EC_TIMEOUT",t[t.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",t[t.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",t[t.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",t[t.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",t[t.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",t[t.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",t[t.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",t[t.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",t[t.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",t[t.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",t[t.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",t[t.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",t[t.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",t[t.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",t[t.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",t[t.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",t[t.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",t[t.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",t[t.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",t[t.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",t[t.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",t[t.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",t[t.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",t[t.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",t[t.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",t[t.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",t[t.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",t[t.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",t[t.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",t[t.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",t[t.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",t[t.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",t[t.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",t[t.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",t[t.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",t[t.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",t[t.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",t[t.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",t[t.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",t[t.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",t[t.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",t[t.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",t[t.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",t[t.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",t[t.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",t[t.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",t[t.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",t[t.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",t[t.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",t[t.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",t[t.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",t[t.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",t[t.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",t[t.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",t[t.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",t[t.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",t[t.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",t[t.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",t[t.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",t[t.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",t[t.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",t[t.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",t[t.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",t[t.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",t[t.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",t[t.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",t[t.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",t[t.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",t[t.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",t[t.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",t[t.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",t[t.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",t[t.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",t[t.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",t[t.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",t[t.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",t[t.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",t[t.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",t[t.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",t[t.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",t[t.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",t[t.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID",t[t.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",t[t.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",t[t.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",t[t.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",t[t.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(Vc||(Vc={})),function(t){t[t.GEM_SKIP=0]="GEM_SKIP",t[t.GEM_AUTO=1]="GEM_AUTO",t[t.GEM_GENERAL=2]="GEM_GENERAL",t[t.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",t[t.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",t[t.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",t[t.GEM_REV=-2147483648]="GEM_REV"}(iy||(iy={})),function(t){t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_AUTO=4]="GTM_AUTO",t[t.GTM_REV=-2147483648]="GTM_REV"}(ry||(ry={})),function(t){t[t.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",t[t.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(Is||(Is={})),function(t){t[t.PDFRM_VECTOR=1]="PDFRM_VECTOR",t[t.PDFRM_RASTER=2]="PDFRM_RASTER",t[t.PDFRM_REV=-2147483648]="PDFRM_REV"}(oy||(oy={})),function(t){t[t.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",t[t.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(sy||(sy={})),function(t){t[t.CVS_NOT_VERIFIED=0]="CVS_NOT_VERIFIED",t[t.CVS_PASSED=1]="CVS_PASSED",t[t.CVS_FAILED=2]="CVS_FAILED"}(bs||(bs={}));var fo={IRUT_NULL:BigInt(0),IRUT_COLOUR_IMAGE:BigInt(1),IRUT_SCALED_DOWN_COLOUR_IMAGE:BigInt(2),IRUT_GRAYSCALE_IMAGE:BigInt(4),IRUT_TRANSOFORMED_GRAYSCALE_IMAGE:BigInt(8),IRUT_ENHANCED_GRAYSCALE_IMAGE:BigInt(16),IRUT_PREDETECTED_REGIONS:BigInt(32),IRUT_BINARY_IMAGE:BigInt(64),IRUT_TEXTURE_DETECTION_RESULT:BigInt(128),IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE:BigInt(256),IRUT_TEXTURE_REMOVED_BINARY_IMAGE:BigInt(512),IRUT_CONTOURS:BigInt(1024),IRUT_LINE_SEGMENTS:BigInt(2048),IRUT_TEXT_ZONES:BigInt(4096),IRUT_TEXT_REMOVED_BINARY_IMAGE:BigInt(8192),IRUT_CANDIDATE_BARCODE_ZONES:BigInt(16384),IRUT_LOCALIZED_BARCODES:BigInt(32768),IRUT_SCALED_UP_BARCODE_IMAGE:BigInt(65536),IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE:BigInt(1<<17),IRUT_COMPLEMENTED_BARCODE_IMAGE:BigInt(1<<18),IRUT_DECODED_BARCODES:BigInt(1<<19),IRUT_LONG_LINES:BigInt(1<<20),IRUT_CORNERS:BigInt(1<<21),IRUT_CANDIDATE_QUAD_EDGES:BigInt(1<<22),IRUT_DETECTED_QUADS:BigInt(1<<23),IRUT_LOCALIZED_TEXT_LINES:BigInt(1<<24),IRUT_RECOGNIZED_TEXT_LINES:BigInt(1<<25),IRUT_NORMALIZED_IMAGES:BigInt(1<<26),IRUT_SHORT_LINES:BigInt(1<<27),IRUT_RAW_TEXT_LINES:BigInt(1<<28),IRUT_LOGIC_LINES:BigInt(1<<29),IRUT_ALL:BigInt("0xFFFFFFFFFFFFFFFF")},ay,cy;(function(t){t[t.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",t[t.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",t[t.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",t[t.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",t[t.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",t[t.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",t[t.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",t[t.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",t[t.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"})(ay||(ay={})),function(t){t[t.ST_NULL=0]="ST_NULL",t[t.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",t[t.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",t[t.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",t[t.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",t[t.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",t[t.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",t[t.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(cy||(cy={}));var Vi=typeof self>"u",gy=Vi?{}:self,Ey=typeof importScripts=="function",Iy=(()=>{if(!Ey){if(!Vi&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),$b=t=>{if(t==null&&(t="./"),!(Vi||Ey)){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},my=t=>t&&typeof t=="object"&&typeof t.then=="function",vy=$(void 0,null,function*(){}).constructor,Ts=class extends vy{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let n;this._task=e,my(e)?n=e:typeof e=="function"&&(n=new vy(e)),n&&$(this,null,function*(){try{let i=yield n;e===this._task&&this.resolve(i)}catch(i){e===this._task&&this.reject(i)}})}get isEmpty(){return this._task==null}constructor(e){let n,i;super((r,a)=>{n=r,i=a}),this._s="pending",this.resolve=r=>{this.isPending&&(my(r)?this.task=r:(this._s="fulfilled",n(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",i(r))},this.task=e}},Yc=" is not allowed to change after `createInstance` or `loadWasm` is called.",zb=!Vi&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",yy=(t,e)=>{let n=t;if(n._license!==e){if(!n._pLoad.isEmpty)throw new Error("`license`"+Yc);n._license=e}};!Vi&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");var by=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!Vi){let n=document.createElement("a");n.href=t[e],t[e]=n.href}t[e].endsWith("/")||(t[e]+="/")}}return t},_y=(t,e)=>{e=by(e);let n=t;if(n._licenseServer!==e){if(!n._pLoad.isEmpty)throw new Error("`licenseServer`"+Yc);n._licenseServer=e}},wy=(t,e)=>{e=e||"";let n=t;if(n._deviceFriendlyName!==e){if(!n._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Yc);n._deviceFriendlyName=e}},Ds,Ss,zc,Od,Ln;typeof navigator<"u"&&(Ds=navigator,Ss=Ds.userAgent,zc=Ds.platform,Od=Ds.mediaDevices),function(){if(!Vi){let t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ds.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:zc,search:"Win"},Mac:{str:zc},Linux:{str:zc}},n="unknownBrowser",i=0,r="unknownOS";for(let a in t){let d=t[a]||{},v=d.str||Ss,y=d.search||a,C=d.verStr||Ss,b=d.verSearch||a;if(b instanceof Array||(b=[b]),v.indexOf(y)!=-1){n=a;for(let T of b){let M=C.indexOf(T);if(M!=-1){i=parseFloat(C.substring(M+T.length+1));break}}break}}for(let a in e){let d=e[a]||{},v=d.str||Ss,y=d.search||a;if(v.indexOf(y)!=-1){r=a;break}}r=="Linux"&&Ss.indexOf("Windows NT")!=-1&&(r="HarmonyOS"),Ln={browser:n,version:i,OS:r}}Vi&&(Ln={browser:"ssr",version:0,OS:"ssr"})}(),Od&&Od.getUserMedia,Ln.browser==="Chrome"&&Ln.version>66||Ln.browser==="Safari"&&Ln.version>13||Ln.browser==="OPR"&&Ln.version>43||Ln.browser==="Edge"&&Ln.version;var Dy=()=>(Rn("license"),$c("dynamsoft_inited",()=>$(void 0,null,function*(){let{lt:t,l:e,ls:n,sp:i,rmk:r,cv:a}=((y,C=!1)=>{let b=y;if(b._pLoad.isEmpty){let T,M,O,L=b._license||"",P=JSON.parse(JSON.stringify(b._licenseServer)),Y=b._sessionPassword,H=0;if(L.startsWith("t")||L.startsWith("f"))H=0;else if(L.length===0||L.startsWith("P")||L.startsWith("L")||L.startsWith("Y")||L.startsWith("A"))H=1;else{H=2;let G=L.indexOf(":");G!=-1&&(L=L.substring(G+1));let W=L.indexOf("?");if(W!=-1&&(M=L.substring(W+1),L=L.substring(0,W)),L.startsWith("DLC2"))H=0;else{if(L.startsWith("DLS2")){let oe;try{let te=L.substring(4);te=atob(te),oe=JSON.parse(te)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(L=oe.handshakeCode?oe.handshakeCode:oe.organizationID?oe.organizationID:"",typeof L=="number"&&(L=JSON.stringify(L)),P.length===0){let te=[];oe.mainServerURL&&(te[0]=oe.mainServerURL),oe.standbyServerURL&&(te[1]=oe.standbyServerURL),P=by(te)}!Y&&oe.sessionPassword&&(Y=oe.sessionPassword),T=oe.remark}L&&L!=="200001"&&!L.startsWith("200001-")||(H=1)}}if(H&&(C||(gy.crypto||(O="Please upgrade your browser to support online key."),gy.crypto.subtle||(O="Require https to use online key in this browser."))),O)throw new Error(O);return H===1&&(L="",console.warn("Applying for a public trial license ...")),{lt:H,l:L,ls:P,sp:Y,rmk:T,cv:M}}throw new Error("Can't preprocess license again"+Yc)})(pt),d=new Ts;pt._pLoad.task=d,$(void 0,null,function*(){try{yield pt._pLoad}catch{}});let v=Je();We[v]=y=>{if(y.message&&pt._onAuthMessage){let T=pt._onAuthMessage(y.message);T!=null&&(y.message=T)}let C,b=!1;if(t===1&&(b=!0),y.success?(ui&&ui("init license success"),y.message&&console.warn(y.message),be._bSupportIRTModule=y.bSupportIRTModule,be._bSupportDce4Module=y.bSupportDce4Module,pt.bPassValidation=!0,[0,-10076].includes(y.initLicenseInfo.errorCode)?[-10076].includes(y.initLicenseInfo.errorCode)&&console.warn(y.initLicenseInfo.errorString):d.reject(new Error(y.initLicenseInfo.errorString))):(C=Error(y.message),y.stack&&(C.stack=y.stack),y.ltsErrorCode&&(C.ltsErrorCode=y.ltsErrorCode),b||y.ltsErrorCode==111&&y.message.toLowerCase().indexOf("trial license")!=-1&&(b=!0)),b){let T=ji(be.engineResourcePaths);((M,O,L)=>$(void 0,null,function*(){if(!M._bNeverShowDialog)try{let P=yield fetch(M.engineResourcePath+"dls.license.dialog.html");if(!P.ok)throw Error("Get license dialog fail. Network Error: "+P.statusText);let Y=yield P.text();if(!Y.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let H=document.createElement("div");H.innerHTML=Y;let G=[];for(let de=0;de<H.childElementCount;++de){let l=H.children[de];l instanceof HTMLStyleElement&&(G.push(l),document.head.append(l))}let W=H.childElementCount==1?H.children[0]:H;W.remove();let oe,te,ie,ae,w,re=[W],pe=W.children;for(let de of pe)re.push(de);for(let de=0;de<re.length;++de)for(let l of re[de].children)re.push(l);for(let de of re)if(!oe&&de.classList.contains("dls-license-mask"))oe=de,de.addEventListener("click",l=>{if(de==l.target){W.remove();for(let c of G)c.remove()}});else if(!te&&de.classList.contains("dls-license-icon-close"))te=de,de.addEventListener("click",()=>{W.remove();for(let l of G)l.remove()});else if(!ie&&de.classList.contains("dls-license-icon-error"))ie=de,O!="error"&&de.remove();else if(!ae&&de.classList.contains("dls-license-icon-warn"))ae=de,O!="warn"&&de.remove();else if(!w&&de.classList.contains("dls-license-msg-content")){w=de;let l=L;for(;l;){let c=l.indexOf("["),u=l.indexOf("]",c),f=l.indexOf("(",u),o=l.indexOf(")",f);if(c==-1||u==-1||f==-1||o==-1){de.appendChild(new Text(l));break}c>0&&de.appendChild(new Text(l.substring(0,c)));let s=document.createElement("a"),h=l.substring(c+1,u);s.innerText=h;let m=l.substring(f+1,o);s.setAttribute("href",m),s.setAttribute("target","_blank"),de.appendChild(s),l=l.substring(o+1)}}document.body.appendChild(W)}catch(P){M._onLog&&M._onLog(P.message||P)}}))({_bNeverShowDialog:pt._bNeverShowDialog,engineResourcePath:T.license,_onLog:ui},y.success?"warn":"error",y.message)}y.success?d.resolve(void 0):d.reject(C)},yield jc("core"),ke.postMessage({type:"license_dynamsoft",body:{v:"3.4.31",brtk:!!t,bptk:t===1,l:e,os:Ln,fn:pt.deviceFriendlyName,ls:n,sp:i,rmk:r,cv:a},id:v}),pt.bCallInitLicense=!0,yield d}))),Cy;ht.license={},ht.license.dynamsoft=Dy,ht.license.getAR=()=>$(void 0,null,function*(){{let t=$n.dynamsoft_inited;t&&t.isRejected&&(yield t)}return ke?new Promise((t,e)=>{let n=Je();We[n]=i=>$(void 0,null,function*(){if(i.success){delete i.success;{let r=pt.license;r&&(r.startsWith("t")||r.startsWith("f"))&&(i.pk=r)}if(Object.keys(i).length){if(i.lem){let r=Error(i.lem);r.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=r}t(i)}else t(null)}else{let r=Error(i.message);i.stack&&(r.stack=i.stack),e(r)}}),ke.postMessage({type:"license_getAR",id:n})}):null});var pt=class t{static setLicenseServer(e){_y(t,e)}static get license(){return this._license}static set license(e){yy(t,e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){_y(t,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){wy(t,e)}static initLicense(e,n){if(yy(t,e),t.bCallInitLicense=!0,typeof n=="boolean"&&n||typeof n=="object"&&n.executeNow)return Dy()}static setDeviceFriendlyName(e){wy(t,e)}static getDeviceFriendlyName(){return t._deviceFriendlyName}static getDeviceUUID(){return $(this,null,function*(){return yield $c("dynamsoft_uuid",()=>$(this,null,function*(){yield Rn();let e=new Ts,n=Je();We[n]=i=>{if(i.success)e.resolve(i.uuid);else{let r=Error(i.message);i.stack&&(r.stack=i.stack),e.reject(r)}},ke.postMessage({type:"license_getDeviceUUID",id:n}),Cy=yield e})),Cy})}};pt._pLoad=new Ts,pt.bPassValidation=!1,pt.bCallInitLicense=!1,pt._license=zb,pt._licenseServer=[],pt._deviceFriendlyName="",be.engineResourcePaths.license={version:"3.4.31",path:Iy,isInternal:!0},zt.license={wasm:!0,js:!0},ht.license.LicenseManager=pt;var Rd="1.4.21";typeof be.engineResourcePaths.std!="string"&&On(be.engineResourcePaths.std.version,Rd)<0&&(be.engineResourcePaths.std={version:Rd,path:$b(Iy+`../../dynamsoft-capture-vision-std@${Rd}/dist/`),isInternal:!0});var My=typeof self>"u",Oy=typeof importScripts=="function",Pd=(()=>{if(!Oy){if(!My&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),Ry=t=>{if(t==null&&(t="./"),!(My||Oy)){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};be.engineResourcePaths.dbr={version:"10.4.31",path:Pd,isInternal:!0},zt.dbr={js:!1,wasm:!0,deps:["license","dip"]},ht.dbr={};var Ld="1.4.21";typeof be.engineResourcePaths.std!="string"&&On(be.engineResourcePaths.std.version,Ld)<0&&(be.engineResourcePaths.std={version:Ld,path:Ry(Pd+`../../dynamsoft-capture-vision-std@${Ld}/dist/`),isInternal:!0});var Nd="2.4.31";(!be.engineResourcePaths.dip||typeof be.engineResourcePaths.dip!="string"&&On(be.engineResourcePaths.dip.version,Nd)<0)&&(be.engineResourcePaths.dip={version:Nd,path:Ry(Pd+`../../dynamsoft-image-processing@${Nd}/dist/`),isInternal:!0});var uL={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)},Sy,Ty,xy,Ay;(function(t){t[t.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",t[t.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",t[t.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(Sy||(Sy={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Ty||(Ty={})),function(t){t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=-2147483648]="LM_REV",t[t.LM_SKIP=0]="LM_SKIP"}(xy||(xy={})),function(t){t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",t[t.DM_REV=-2147483648]="DM_REV",t[t.DM_SKIP=0]="DM_SKIP"}(Ay||(Ay={}));be.engineResourcePaths.rootDirectory="assets/distributables";pt.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMTAzNzEyNDYzLVRYbFhaV0pRY205cSIsIm1haW5TZXJ2ZXJVUkwiOiJodHRwczovL21kbHMuZHluYW1zb2Z0b25saW5lLmNvbSIsIm9yZ2FuaXphdGlvbklEIjoiMTAzNzEyNDYzIiwic3RhbmRieVNlcnZlclVSTCI6Imh0dHBzOi8vc2Rscy5keW5hbXNvZnRvbmxpbmUuY29tIiwiY2hlY2tDb2RlIjotMTUyNzMzMDB9",{executeNow:!0});be.loadWasm(["DBR"]);function ce(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function Tt(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n}var Ly=t=>t&&typeof t=="object"&&typeof t.then=="function",Ny=$(void 0,null,function*(){}).constructor,Cr=class extends Ny{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){this._task=e;let n;Ly(e)?n=e:typeof e=="function"&&(n=new Ny(e)),n&&$(this,null,function*(){try{let i=yield n;e===this._task&&this.resolve(i)}catch(i){e===this._task&&this.reject(i)}})}get isEmpty(){return this._task==null}constructor(e){let n,i,r=(a,d)=>{n=a,i=d};super(r),this._s="pending",this.resolve=a=>{this.isPending&&(Ly(a)?this.task=a:(this._s="fulfilled",n(a)))},this.reject=a=>{this.isPending&&(this._s="rejected",i(a))},this.task=e}},jd=class{constructor(e){this._cvr=e}getMaxBufferedItems(){return $(this,null,function*(){return yield new Promise((e,n)=>{let i=Je();We[i]=r=>$(this,null,function*(){if(r.success)return e(r.count);{let a=new Error(r.message);return a.stack=r.stack+`
`+a.stack,n(a)}}),ke.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})})})}setMaxBufferedItems(e){return $(this,null,function*(){return yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success)return n();{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_setMaxBufferedItems",id:r,instanceID:this._cvr._instanceID,body:{count:e}})})})}getBufferedCharacterItemSet(){return $(this,null,function*(){return yield new Promise((e,n)=>{let i=Je();We[i]=r=>$(this,null,function*(){if(r.success)return e(r.itemSet);{let a=new Error(r.message);return a.stack=r.stack+`
`+a.stack,n(a)}}),ke.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})})})}},Yb={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1,onLogicLinesReceived:!1},Py=t=>{for(let e in t._irrRegistryState)t._irrRegistryState[e]=!1;for(let e of t._intermediateResultReceiverSet){if(e.isDce||e.isFilter){t._irrRegistryState.onTaskResultsReceivedForDce=!0;continue}for(let n in e)t._irrRegistryState[n]||(t._irrRegistryState[n]=!!e[n])}},Vd=class{constructor(e){this._irrRegistryState=Yb,this._intermediateResultReceiverSet=new Set,this._cvr=e}addResultReceiver(e){return $(this,null,function*(){if(typeof e!="object")throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(e),Py(this);let n=-1,i={};if(!e.isDce&&!e.isFilter){if(!e._observedResultUnitTypes||!e._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");n=e._observedResultUnitTypes,e._observedTaskMap.forEach((r,a)=>{i[a]=r}),e._observedTaskMap.clear()}return yield new Promise((r,a)=>{let d=Je();We[d]=v=>$(this,null,function*(){if(v.success)return r();{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,a(y)}}),ke.postMessage({type:"cvr_setIrrRegistry",id:d,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:n.toString(),observedTaskMap:i}})})})}removeResultReceiver(e){return $(this,null,function*(){return this._intermediateResultReceiverSet.delete(e),Py(this),yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success)return n();{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_setIrrRegistry",id:r,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})})}getOriginalImage(){return this._cvr._dsImage}},jy=typeof self>"u",Vy=typeof importScripts=="function",Hd=(()=>{if(!Vy){if(!jy&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),Uy=t=>{if(t==null&&(t="./"),!(jy||Vy)){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},Fd;be.engineResourcePaths.cvr={version:"2.4.33",path:Hd,isInternal:!0};zt.cvr={js:!0,wasm:!0,deps:["license","dip"]};ht.cvr={};var kd="1.4.21";typeof be.engineResourcePaths.std!="string"&&On(be.engineResourcePaths.std.version,kd)<0&&(be.engineResourcePaths.std={version:kd,path:Uy(Hd+`../../dynamsoft-capture-vision-std@${kd}/dist/`),isInternal:!0});var Bd="2.4.31";(!be.engineResourcePaths.dip||typeof be.engineResourcePaths.dip!="string"&&On(be.engineResourcePaths.dip.version,Bd)<0)&&(be.engineResourcePaths.dip={version:Bd,path:Uy(Hd+`../../dynamsoft-image-processing@${Bd}/dist/`),isInternal:!0});var Xc=class{static getVersion(){return this._version}};Xc._version=`2.4.33(Worker: ${(Fd=Mn.cvr)===null||Fd===void 0?void 0:Fd.worker}, Wasm: loading...`;var po={barcodeResultItems:{type:_e.CRIT_BARCODE,reveiver:"onDecodedBarcodesReceived",isNeedFilter:!0},textLineResultItems:{type:_e.CRIT_TEXT_LINE,reveiver:"onRecognizedTextLinesReceived",isNeedFilter:!0},detectedQuadResultItems:{type:_e.CRIT_DETECTED_QUAD,reveiver:"onDetectedQuadsReceived",isNeedFilter:!1},normalizedImageResultItems:{type:_e.CRIT_NORMALIZED_IMAGE,reveiver:"onNormalizedImagesReceived",isNeedFilter:!1},parsedResultItems:{type:_e.CRIT_PARSED_RESULT,reveiver:"onParsedResultsReceived",isNeedFilter:!1}},Ud=function(t){return t[t.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",t[t.ISS_EXHAUSTED=1]="ISS_EXHAUSTED",t}(Ud||{});function Hy(t,e){if(t&&t.location){let n=t.location.points;for(let i of n)i.x=i.x/e,i.y=i.y/e;Hy(t.referencedItem,e)}}function dt(t){if(t.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}var Ue,hi,pn,kt,go,gn,Ui,zn,mn,Hi,mo,xs,Fy={onTaskResultsReceived:()=>{},isFilter:!0},Er=class t{constructor(){this.maxImageSideLength=["iPhone","Android","HarmonyOS"].includes(be.browserInfo.OS)?2048:4096,this._instanceID=void 0,this._dsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,Ue.set(this,null),hi.set(this,null),pn.set(this,null),kt.set(this,null),go.set(this,null),gn.set(this,new Set),Ui.set(this,new Set),zn.set(this,new Set),mn.set(this,0),Hi.set(this,!1),mo.set(this,!1),xs.set(this,!1),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return ce(this,xs,"f")}static createInstance(){return $(this,null,function*(){if(!ht.license)throw Error("Module `license` is not existed.");yield ht.license.dynamsoft(),yield Rn(["cvr"]);let e=new t,n=new Cr,i=Je();return We[i]=r=>$(this,null,function*(){var a;if(r.success)e._instanceID=r.instanceID,e._currentSettings=JSON.parse(JSON.parse(r.outputSettings).data),Xc._version=`2.4.33(Worker: ${(a=Mn.cvr)===null||a===void 0?void 0:a.worker}, Wasm: ${r.version})`,Tt(e,mo,!0,"f"),Tt(e,kt,e.getIntermediateResultManager(),"f"),Tt(e,mo,!1,"f"),n.resolve(e);else{let d=Error(r.message);r.stack&&(d.stack=r.stack),n.reject(d)}}),ke.postMessage({type:"cvr_createInstance",id:i}),n})}_singleFrameModeCallback(e){return $(this,null,function*(){for(let a of ce(this,gn,"f"))this._isOutputOriginalImage&&a.onOriginalImageResultReceived&&a.onOriginalImageResultReceived({imageData:e});let n={bytes:new Uint8Array(e.bytes),width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.tag};this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);let i=yield this.capture(n,this._templateName);i.originalImageTag=e.tag;let r={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let a of ce(this,gn,"f")){if(a.isDce){a.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});continue}for(let d in po){let v=d,y=po[v];a[y.reveiver]&&i[v]&&a[y.reveiver](Object.assign(Object.assign({},r),{[v]:i[v]}))}a.onCapturedResultReceived&&a.onCapturedResultReceived(i)}})}setInput(e){if(dt(this),!e){Tt(this,Ue,null,"f");return}if(Tt(this,Ue,e,"f"),e.isCameraEnhancer){ce(this,kt,"f")&&(ce(this,Ue,"f")._intermediateResultReceiver.isDce=!0,ce(this,kt,"f").addResultReceiver(ce(this,Ue,"f")._intermediateResultReceiver));let n=ce(this,Ue,"f").getCameraView();if(n){let i=n._capturedResultReceiver;i.isDce=!0,ce(this,gn,"f").add(i)}}}getInput(){return ce(this,Ue,"f")}addImageSourceStateListener(e){if(dt(this),typeof e!="object")return console.warn("Invalid ISA state listener.");!e||!Object.keys(e)||ce(this,Ui,"f").add(e)}removeImageSourceStateListener(e){return dt(this),ce(this,Ui,"f").delete(e)}addResultReceiver(e){if(dt(this),typeof e!="object")throw new Error("Invalid receiver.");!e||!Object.keys(e).length||(ce(this,gn,"f").add(e),this._setCrrRegistry())}removeResultReceiver(e){dt(this),ce(this,gn,"f").delete(e),this._setCrrRegistry()}_setCrrRegistry(){return $(this,null,function*(){let e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let r of ce(this,gn,"f"))r.isDce||(e.onCapturedResultReceived=!!r.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!r.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!r.onRecognizedTextLinesReceived,e.onDetectedQuadsReceived=!!r.onDetectedQuadsReceived,e.onNormalizedImagesReceived=!!r.onNormalizedImagesReceived,e.onParsedResultsReceived=!!r.onParsedResultsReceived);let n=new Cr,i=Je();return We[i]=r=>$(this,null,function*(){if(r.success)n.resolve();else{let a=new Error(r.message);a.stack=r.stack+`
`+a.stack,n.reject()}}),ke.postMessage({type:"cvr_setCrrRegistry",id:i,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}}),n})}addResultFilter(e){return $(this,null,function*(){if(dt(this),!e||typeof e!="object"||!Object.keys(e).length)return console.warn("Invalid filter.");ce(this,zn,"f").add(e),e._dynamsoft(),yield this._handleFilterUpdate()})}removeResultFilter(e){return $(this,null,function*(){dt(this),ce(this,zn,"f").delete(e),yield this._handleFilterUpdate()})}_handleFilterUpdate(){return $(this,null,function*(){if(ce(this,kt,"f").removeResultReceiver(Fy),ce(this,zn,"f").size===0){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;let e={[_e.CRIT_BARCODE]:!1,[_e.CRIT_TEXT_LINE]:!1,[_e.CRIT_DETECTED_QUAD]:!1,[_e.CRIT_NORMALIZED_IMAGE]:!1},n={[_e.CRIT_BARCODE]:!1,[_e.CRIT_TEXT_LINE]:!1,[_e.CRIT_DETECTED_QUAD]:!1,[_e.CRIT_NORMALIZED_IMAGE]:!1};yield ky(this,e),yield By(this,n);return}for(let e of ce(this,zn,"f"))this._isOpenBarcodeVerify=e.isResultCrossVerificationEnabled(_e.CRIT_BARCODE),this._isOpenLabelVerify=e.isResultCrossVerificationEnabled(_e.CRIT_TEXT_LINE),this._isOpenDetectVerify=e.isResultCrossVerificationEnabled(_e.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=e.isResultCrossVerificationEnabled(_e.CRIT_NORMALIZED_IMAGE),e.isLatestOverlappingEnabled(_e.CRIT_BARCODE)&&([...ce(this,kt,"f")._intermediateResultReceiverSet.values()].find(i=>i.isFilter)||ce(this,kt,"f").addResultReceiver(Fy)),yield ky(this,e.verificationEnabled),yield By(this,e.duplicateFilterEnabled),yield Xb(this,e.duplicateForgetTime)})}startCapturing(e){return $(this,null,function*(){var n,i;if(dt(this),!this._isPauseScan)return;if(!ce(this,Ue,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");e||(e=t._defaultTemplate);let r=yield this.containsTask(e);yield Rn(r);for(let d of ce(this,zn,"f"))yield this.addResultFilter(d);if(r.includes("dlr")&&!(!((n=ht.dlr)===null||n===void 0)&&n.bLoadConfusableCharsData)){let d=ji(be.engineResourcePaths);yield(i=ht.dlr)===null||i===void 0?void 0:i.loadRecognitionData("ConfusableChars",d.dlr)}if(ce(this,Ue,"f").isCameraEnhancer&&(r.includes("ddn")?ce(this,Ue,"f").setPixelFormat(De.IPF_ABGR_8888):ce(this,Ue,"f").setPixelFormat(De.IPF_GRAYSCALED)),ce(this,Ue,"f").singleFrameMode!==void 0&&ce(this,Ue,"f").singleFrameMode!=="disabled"){this._templateName=e,ce(this,Ue,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind);return}return ce(this,Ue,"f").getColourChannelUsageType()===An.CCUT_AUTO&&ce(this,Ue,"f").setColourChannelUsageType(r.includes("ddn")?An.CCUT_FULL_CHANNEL:An.CCUT_Y_CHANNEL_ONLY),ce(this,pn,"f")&&ce(this,pn,"f").isPending?ce(this,pn,"f"):(Tt(this,pn,new Cr((d,v)=>{if(this.disposed)return;let y=Je();We[y]=C=>$(this,null,function*(){if(!(!ce(this,pn,"f")||ce(this,pn,"f").isFulfilled))if(C.success)this._isPauseScan=!1,this._isOutputOriginalImage=C.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>$(this,null,function*(){this._minImageCaptureInterval!==-1&&ce(this,Ue,"f").startFetching(),this._loopReadVideo(e),d()}),0);else{let b=new Error(C.message);return b.stack=C.stack+`
`+b.stack,v(b)}}),ke.postMessage({type:"cvr_startCapturing",id:y,instanceID:this._instanceID,body:{templateName:e}})}),"f"),yield ce(this,pn,"f"))})}stopCapturing(){if(dt(this),!!ce(this,Ue,"f")){if(ce(this,Ue,"f").isCameraEnhancer&&ce(this,Ue,"f").singleFrameMode!==void 0&&ce(this,Ue,"f").singleFrameMode!=="disabled"){ce(this,Ue,"f").off("singleFrameAcquired",this._singleFrameModeCallbackBind);return}qb(this),ce(this,Ue,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,Tt(this,pn,null,"f"),ce(this,Ue,"f").setColourChannelUsageType(An.CCUT_AUTO)}}containsTask(e){return $(this,null,function*(){return dt(this),yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success)return n(JSON.parse(a.tasks));{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_containsTask",id:r,instanceID:this._instanceID,body:{templateName:e}})})})}_loopReadVideo(e){return $(this,null,function*(){if(this.disposed||this._isPauseScan)return;if(Tt(this,Hi,!0,"f"),ce(this,Ue,"f").isBufferEmpty()){if(ce(this,Ue,"f").hasNextImageToFetch())for(let i of ce(this,Ui,"f"))i.onImageSourceStateReceived&&i.onImageSourceStateReceived(Ud.ISS_BUFFER_EMPTY);else if(!ce(this,Ue,"f").hasNextImageToFetch())for(let i of ce(this,Ui,"f"))i.onImageSourceStateReceived&&i.onImageSourceStateReceived(Ud.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||ce(this,Ue,"f").isBufferEmpty())try{ce(this,Ue,"f").isBufferEmpty()&&t._onLog&&t._onLog("buffer is empty so fetch image"),t._onLog&&t._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=ce(this,Ue,"f").fetchImage(),t._onLog&&t._onLog(`DCE: finish fetching a frame: ${Date.now()}`),ce(this,Ue,"f").setImageFetchInterval(this._averageTime)}catch{this._reRunCurrnetFunc(e);return}else if(ce(this,Ue,"f").setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=ce(this,Ue,"f").getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200){this._reRunCurrnetFunc(e);return}if(!this._dsImage){this._reRunCurrnetFunc(e);return}for(let i of ce(this,gn,"f"))this._isOutputOriginalImage&&i.onOriginalImageResultReceived&&i.onOriginalImageResultReceived({imageData:this._dsImage});let n=Date.now();this._captureDsimage(this._dsImage,e).then(i=>$(this,null,function*(){if(t._onLog&&t._onLog(`no js handle time: ${Date.now()-n}`),this._isPauseScan){this._reRunCurrnetFunc(e);return}i.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;let r={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let d of ce(this,gn,"f")){if(d.isDce){let v=Date.now();if(d.onCapturedResultReceived(i,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify}),t._onLog){let y=Date.now()-v;y>10&&t._onLog(`draw result time: ${y}`)}continue}for(let v in po){let y=v,C=po[y];d[C.reveiver],d[C.reveiver]&&i[y]&&d[C.reveiver](Object.assign(Object.assign({},r),{[y]:i[y].filter(b=>!C.isNeedFilter||!b.isFilter)})),i[y]&&(i[y]=i[y].filter(b=>!C.isNeedFilter||!b.isFilter))}d.onCapturedResultReceived&&(i.items=i.items.filter(v=>[_e.CRIT_DETECTED_QUAD,_e.CRIT_NORMALIZED_IMAGE].includes(v.type)||!v.isFilter),d.onCapturedResultReceived(i))}let a=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-n),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,t._onLog&&(t._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),t._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),t._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),t._onLog(`averageTime: ${this._averageTime}`))),t._onLog){let d=Date.now()-a;d>10&&t._onLog(`fetch image calculate time: ${d}`)}t._onLog&&t._onLog(`time finish decode: ${Date.now()}`),t._onLog&&t._onLog(`main time: ${Date.now()-n}`),t._onLog&&t._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))})).catch(i=>{ce(this,Ue,"f").stopFetching(),i.errorCode&&i.errorCode===0&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{ce(this,Ue,"f").startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3))),i.message!=="platform error"&&setTimeout(()=>{throw i},0)})})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}capture(e,n){return $(this,null,function*(){var i,r;dt(this),n||(n=t._defaultTemplate);let a=yield this.containsTask(n);if(yield Rn(a),a.includes("dlr")&&!(!((i=ht.dlr)===null||i===void 0)&&i.bLoadConfusableCharsData)){let v=ji(be.engineResourcePaths);yield(r=ht.dlr)===null||r===void 0?void 0:r.loadRecognitionData("ConfusableChars",v.dlr)}let d;if(Tt(this,Hi,!1,"f"),Uc(e))d=yield this._captureDsimage(e,n);else if(typeof e=="string")e.substring(0,11)=="data:image/"?d=yield this._captureBase64(e,n):d=yield this._captureUrl(e,n);else if(e instanceof Blob)d=yield this._captureBlob(e,n);else if(e instanceof HTMLImageElement)d=yield this._captureImage(e,n);else if(e instanceof HTMLCanvasElement)d=yield this._captureCanvas(e,n);else if(e instanceof HTMLVideoElement)d=yield this._captureVideo(e,n);else throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");return d})}_captureDsimage(e,n){return $(this,null,function*(){return yield this._captureInWorker(e,n)})}_captureUrl(e,n){return $(this,null,function*(){let i=yield Wc(e,"blob");return yield this._captureBlob(i,n)})}_captureBase64(e,n){return $(this,null,function*(){e=e.substring(e.indexOf(",")+1);let i=atob(e),r=i.length,a=new Uint8Array(r);for(;r--;)a[r]=i.charCodeAt(r);return yield this._captureBlob(new Blob([a]),n)})}_captureBlob(e,n){return $(this,null,function*(){let i=function(v){return $(this,null,function*(){return yield new Promise((y,C)=>{let b=URL.createObjectURL(v),T=new Image;T.src=b,T.onload=()=>{URL.revokeObjectURL(T.dbrObjUrl),y(T)},T.onerror=M=>{C(new Error("Can't convert blob to image : "+(M instanceof Event?M.type:M)))}})})},r=null,a=null;if(typeof createImageBitmap<"u")try{r=yield createImageBitmap(e)}catch{}r||(a=yield i(e));let d=yield this._captureImage(r||a,n);return r&&r.close(),d})}_captureImage(e,n){return $(this,null,function*(){let i=e instanceof HTMLImageElement?e.naturalWidth:e.width,r=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(i,r),d,v;a>this.maxImageSideLength?(Tt(this,mn,this.maxImageSideLength/a,"f"),d=Math.round(i*ce(this,mn,"f")),v=Math.round(r*ce(this,mn,"f"))):(d=i,v=r),ce(this,hi,"f")||Tt(this,hi,document.createElement("canvas"),"f");let y=ce(this,hi,"f");return(y.width!==d||y.height!==v)&&(y.width=d,y.height=v),y.ctx2d||(y.ctx2d=y.getContext("2d",{willReadFrequently:!0})),y.ctx2d.drawImage(e,0,0,i,r,0,0,d,v),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),yield this._captureCanvas(y,n)})}_captureCanvas(e,n){return $(this,null,function*(){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");let i=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),a={bytes:Uint8Array.from(i.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:e.width*4,format:10};return yield this._captureInWorker(a,n)})}_captureVideo(e,n){return $(this,null,function*(){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";let i=e.videoWidth,r=e.videoHeight,a=Math.max(i,r),d,v;a>this.maxImageSideLength?(Tt(this,mn,this.maxImageSideLength/a,"f"),d=Math.round(i*ce(this,mn,"f")),v=Math.round(r*ce(this,mn,"f"))):(d=i,v=r),ce(this,hi,"f")||Tt(this,hi,document.createElement("canvas"),"f");let y=ce(this,hi,"f");return(y.width!==d||y.height!==v)&&(y.width=d,y.height=v),y.ctx2d||(y.ctx2d=y.getContext("2d",{willReadFrequently:!0})),y.ctx2d.drawImage(e,0,0,i,r,0,0,d,v),yield this._captureCanvas(y,n)})}_captureInWorker(e,n){return $(this,null,function*(){let{bytes:i,width:r,height:a,stride:d,format:v}=e,y=Je(),C=new Cr;return We[y]=b=>$(this,null,function*(){var T,M;if(b.success){let O=Date.now();t._onLog&&(t._onLog(`get result time from worker: ${O}`),t._onLog(`worker to main time consume: ${O-b.workerReturnMsgTime}`));try{let L=b.captureResult;if(L.errorCode!==0){let P=new Error(L.errorString);return P.errorCode=L.errorCode,C.reject(P)}e.bytes=b.bytes;for(let P of L.items)ce(this,mn,"f")!==0&&Hy(P,ce(this,mn,"f")),P.type===_e.CRIT_ORIGINAL_IMAGE?P.imageData=e:P.type===_e.CRIT_NORMALIZED_IMAGE?(T=ht.ddn)===null||T===void 0||T.handleNormalizedImageResultItem(P):P.type===_e.CRIT_PARSED_RESULT&&((M=ht.dcp)===null||M===void 0||M.handleParsedResultItem(P));if(ce(this,Hi,"f"))for(let P of ce(this,zn,"f"))P.onDecodedBarcodesReceived(L),P.onRecognizedTextLinesReceived(L),P.onDetectedQuadsReceived(L),P.onNormalizedImagesReceived(L);for(let P in po){let Y=P,H=L.items.filter(G=>G.type===po[Y].type);H.length&&(L[P]=H)}if(!this._isPauseScan||!ce(this,Hi,"f")){let P=L.intermediateResult;if(P){let Y=0;for(let H of ce(this,kt,"f")._intermediateResultReceiverSet){Y++;for(let G of P){if(G.info.callbackName==="onTaskResultsReceived"){for(let W of G.intermediateResultUnits)W.originalImageTag=e.tag?e.tag:null;H[G.info.callbackName]&&H[G.info.callbackName]({intermediateResultUnits:G.intermediateResultUnits},G.info)}else H[G.info.callbackName]&&H[G.info.callbackName](G.result,G.info);Y===ce(this,kt,"f")._intermediateResultReceiverSet.size&&delete G.info.callbackName}}}}return L&&L.hasOwnProperty("intermediateResult")&&delete L.intermediateResult,Tt(this,mn,0,"f"),C.resolve(L)}catch(L){return C.reject(L)}}else{let O=new Error(b.message);return O.stack=b.stack+`
`+O.stack,C.reject(O)}}),t._onLog&&t._onLog(`send buffer to worker: ${Date.now()}`),ke.postMessage({type:"cvr_capture",id:y,instanceID:this._instanceID,body:{bytes:i,width:r,height:a,stride:d,format:v,templateName:n||"",isScanner:ce(this,Hi,"f")}},[i.buffer]),C})}initSettings(e){return $(this,null,function*(){return dt(this),!e||!["string","object"].includes(typeof e)?console.error("Invalid template."):(typeof e=="string"?e.trimStart().startsWith("{")||(e=yield Wc(e,"text")):typeof e=="object"&&(e=JSON.stringify(e)),yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success){let d=JSON.parse(a.response);if(d.errorCode!==0){let b=new Error(d.errorString?d.errorString:"Init Settings Failed.");return b.errorCode=d.errorCode,i(b)}let v=JSON.parse(e);this._currentSettings=v;let y=[],C=v.CaptureVisionTemplates;for(let b=0;b<C.length;b++){let T=yield this.containsTask(C[b].Name);y=y.concat(T)}return yield Rn([...new Set(y)]),this._isOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,t._defaultTemplate=this._currentSettings.CaptureVisionTemplates[0].Name,n(d)}else{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_initSettings",id:r,instanceID:this._instanceID,body:{settings:e}})}))})}outputSettings(e){return $(this,null,function*(){return dt(this),yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success){let d=JSON.parse(a.response);if(d.errorCode!==0){let v=new Error(d.errorString);return v.errorCode=d.errorCode,i(v)}return n(JSON.parse(d.data))}else{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_outputSettings",id:r,instanceID:this._instanceID,body:{templateName:e||"*"}})})})}outputSettingsToFile(e,n,i){return $(this,null,function*(){let r=yield this.outputSettings(e),a=new Blob([JSON.stringify(r,null,2,function(d,v){return v instanceof Array?JSON.stringify(v):v},2)],{type:"application/json"});if(i){let d=document.createElement("a");d.href=URL.createObjectURL(a),n.endsWith(".json")&&(n=n.replace(".json","")),d.download=`${n}.json`,d.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(d.href)},500)},d.click()}return a})}getTemplateNames(){return $(this,null,function*(){return dt(this),yield new Promise((e,n)=>{let i=Je();We[i]=r=>$(this,null,function*(){if(r.success){let a=JSON.parse(r.response);if(a.errorCode!==0){let d=new Error(a.errorString);return d.errorCode=a.errorCode,n(d)}return e(JSON.parse(a.data))}else{let a=new Error(r.message);return a.stack=r.stack+`
`+a.stack,n(a)}}),ke.postMessage({type:"cvr_getTemplateNames",id:i,instanceID:this._instanceID})})})}getSimplifiedSettings(e){return $(this,null,function*(){dt(this),e||(e=this._currentSettings.CaptureVisionTemplates[0].Name);let n=yield this.containsTask(e);return yield Rn(n),yield new Promise((i,r)=>{let a=Je();We[a]=d=>$(this,null,function*(){if(d.success){let v=JSON.parse(d.response);if(v.errorCode!==0){let C=new Error(v.errorString);return C.errorCode=v.errorCode,r(C)}let y=JSON.parse(v.data,(C,b)=>C==="barcodeFormatIds"?BigInt(b):b);return y.minImageCaptureInterval=this._minImageCaptureInterval,i(y)}else{let v=new Error(d.message);return v.stack=d.stack+`
`+v.stack,r(v)}}),ke.postMessage({type:"cvr_getSimplifiedSettings",id:a,instanceID:this._instanceID,body:{templateName:e}})})})}updateSettings(e,n){return $(this,null,function*(){dt(this);let i=yield this.containsTask(e);return yield Rn(i),yield new Promise((r,a)=>{let d=Je();We[d]=v=>$(this,null,function*(){if(v.success){let y=JSON.parse(v.response);if(n.minImageCaptureInterval&&n.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=n.minImageCaptureInterval),this._isOutputOriginalImage=v.isOutputOriginalImage,y.errorCode!==0){let C=new Error(y.errorString?y.errorString:"Update Settings Failed.");return C.errorCode=y.errorCode,a(C)}return this._currentSettings=yield this.outputSettings("*"),r(y)}else{let y=new Error(v.message);return y.stack=v.stack+`
`+y.stack,a(y)}}),ke.postMessage({type:"cvr_updateSettings",id:d,instanceID:this._instanceID,body:{settings:n,templateName:e}})})})}resetSettings(){return $(this,null,function*(){return dt(this),yield new Promise((e,n)=>{let i=Je();We[i]=r=>$(this,null,function*(){if(r.success){let a=JSON.parse(r.response);if(a.errorCode!==0){let d=new Error(a.errorString?a.errorString:"Reset Settings Failed.");return d.errorCode=a.errorCode,n(d)}return this._currentSettings=yield this.outputSettings("*"),e(a)}else{let a=new Error(r.message);return a.stack=r.stack+`
`+a.stack,n(a)}}),ke.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})})})}getBufferedItemsManager(){return ce(this,go,"f")||Tt(this,go,new jd(this),"f"),ce(this,go,"f")}getIntermediateResultManager(){if(dt(this),!ce(this,mo,"f")&&be.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return ce(this,kt,"f")||Tt(this,kt,new Vd(this),"f"),ce(this,kt,"f")}parseRequiredResources(e){return $(this,null,function*(){return dt(this),yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success)return n(JSON.parse(a.resources));{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_parseRequiredResources",id:r,instanceID:this._instanceID,body:{templateName:e}})})})}dispose(){return $(this,null,function*(){dt(this),ce(this,pn,"f")&&this.stopCapturing(),Tt(this,Ue,null,"f"),ce(this,gn,"f").clear(),ce(this,Ui,"f").clear(),ce(this,zn,"f").clear(),ce(this,kt,"f")._intermediateResultReceiverSet.clear(),Tt(this,xs,!0,"f");let e=Je();We[e]=n=>{if(!n.success){let i=new Error(n.message);throw i.stack=n.stack+`
`+i.stack,i}},ke.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})})}_getInternalData(){return{isa:ce(this,Ue,"f"),promiseStartScan:ce(this,pn,"f"),intermediateResultManager:ce(this,kt,"f"),bufferdItemsManager:ce(this,go,"f"),resultReceiverSet:ce(this,gn,"f"),isaStateListenerSet:ce(this,Ui,"f"),resultFilterSet:ce(this,zn,"f"),compressRate:ce(this,mn,"f"),canvas:ce(this,hi,"f"),isScanner:ce(this,Hi,"f"),innerUseTag:ce(this,mo,"f"),isDestroyed:ce(this,xs,"f")}}_getWasmFilterState(){return $(this,null,function*(){return yield new Promise((e,n)=>{let i=Je();We[i]=r=>$(this,null,function*(){if(r.success){let a=JSON.parse(r.response);return e(a)}else{let a=new Error(r.message);return a.stack=r.stack+`
`+a.stack,n(a)}}),ke.postMessage({type:"cvr_getWasmFilterState",id:i,instanceID:this._instanceID})})})}};Ue=new WeakMap,hi=new WeakMap,pn=new WeakMap,kt=new WeakMap,go=new WeakMap,gn=new WeakMap,Ui=new WeakMap,zn=new WeakMap,mn=new WeakMap,Hi=new WeakMap,mo=new WeakMap,xs=new WeakMap;Er._defaultTemplate="Default";function ky(t,e){return $(this,null,function*(){return dt(t),yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success)return n(a.result);{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_enableResultCrossVerification",id:r,instanceID:t._instanceID,body:{verificationEnabled:e}})})})}function By(t,e){return $(this,null,function*(){return dt(t),yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success)return n(a.result);{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_enableResultDeduplication",id:r,instanceID:t._instanceID,body:{duplicateFilterEnabled:e}})})})}function Xb(t,e){return $(this,null,function*(){return dt(t),yield new Promise((n,i)=>{let r=Je();We[r]=a=>$(this,null,function*(){if(a.success)return n(a.result);{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,i(d)}}),ke.postMessage({type:"cvr_setDuplicateForgetTime",id:r,instanceID:t._instanceID,body:{duplicateForgetTime:e}})})})}function qb(t){return $(this,null,function*(){let e=Je(),n=new Cr;return We[e]=i=>$(this,null,function*(){if(i.success)return n.resolve();{let r=new Error(i.message);return r.stack=i.stack+`
`+r.stack,n.reject(r)}}),ke.postMessage({type:"cvr_clearVerifyList",id:e,instanceID:t._instanceID}),n})}var Gy=(()=>{class t{constructor(){this.resultText="",this.isDestroyed=!1,this.captureImage=n=>$(this,null,function*(){let i=[...n.target.files];n.target.value="",this.resultText="";try{let r=yield this.pCvRouter=this.pCvRouter||Er.createInstance();if(this.isDestroyed)return;for(let a of i){let d=yield r.capture(a,"ReadBarcodes_ReadRateFirst");if(console.log(d),this.isDestroyed)return;i.length>1&&(this.resultText+=`
${a.name}:
`);for(let v of d.items){if(v.type!==_e.CRIT_BARCODE)continue;let y=v;this.resultText+=y.text+`
`}d.items.length||(this.resultText+=`No barcode found
`)}}catch(r){let a=r.message||r;console.error(a),alert(a)}})}ngOnDestroy(){return $(this,null,function*(){if(this.isDestroyed=!0,this.pCvRouter)try{(yield this.pCvRouter).dispose()}catch{}})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Mi({type:t,selectors:[["app-image-capture"]],standalone:!0,features:[Pi],decls:5,vars:1,consts:[[1,"image-capture-container"],[1,"input-container"],["type","file","multiple","","accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp",3,"change"],[1,"results"]],template:function(i,r){i&1&&(xn(0,"div",0)(1,"div",1)(2,"input",2),mr("change",function(d){return r.captureImage(d)}),hn()(),xn(3,"div",3),co(4),hn()()),i&2&&(so(4),dd(r.resultText))},styles:[".image-capture-container[_ngcontent-%COMP%]{width:100%;height:100%;font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace}.image-capture-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{width:80%;height:100%;display:flex;justify-content:center;border:1px solid black;margin:0 auto}.image-capture-container[_ngcontent-%COMP%]   .results[_ngcontent-%COMP%]{margin-top:20px;white-space:pre-wrap}"]})}}return t})();var Zd=typeof self>"u",Zb=typeof importScripts=="function",Kb=(()=>{if(!Zb){if(!Zd&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})();be.engineResourcePaths.dce={version:"4.1.1",path:Kb,isInternal:!0},zt.dce={wasm:!1,js:!1},ht.dce={};function A(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function Se(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n}var As,_i,qc,Cl,Dt;typeof SuppressedError=="function"&&SuppressedError,typeof navigator<"u"&&(As=navigator,_i=As.userAgent,qc=As.platform,Cl=As.mediaDevices),function(){if(!Zd){let t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:As.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:qc,search:"Win"},Mac:{str:qc},Linux:{str:qc}},n="unknownBrowser",i=0,r="unknownOS";for(let a in t){let d=t[a]||{},v=d.str||_i,y=d.search||a,C=d.verStr||_i,b=d.verSearch||a;if(b instanceof Array||(b=[b]),v.indexOf(y)!=-1){n=a;for(let T of b){let M=C.indexOf(T);if(M!=-1){i=parseFloat(C.substring(M+T.length+1));break}}break}}for(let a in e){let d=e[a]||{},v=d.str||_i,y=d.search||a;if(v.indexOf(y)!=-1){r=a;break}}r=="Linux"&&_i.indexOf("Windows NT")!=-1&&(r="HarmonyOS"),Dt={browser:n,version:i,OS:r}}Zd&&(Dt={browser:"ssr",version:0,OS:"ssr"})}();var Qb=typeof WebAssembly<"u"&&_i&&!(/Safari/.test(_i)&&!/Chrome/.test(_i)&&/\(.+\s11_2_([2-6]).*\)/.test(_i)),Jb=!(typeof Worker>"u"),t_=!(!Cl||!Cl.getUserMedia),eD=()=>$(void 0,null,function*(){let t=!1;if(t_)try{(yield Cl.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t});Dt.browser==="Chrome"&&Dt.version>66||Dt.browser==="Safari"&&Dt.version>13||Dt.browser==="OPR"&&Dt.version>43||Dt.browser==="Edge"&&Dt.version;var tD={653:(t,e,n)=>{var i,r,a,d,v,y,C,b,T,M,O,L,P,Y,H,G,W,oe,te,ie,ae,w=w||{version:"5.2.1"};if(e.fabric=w,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?w.document=document:w.document=document.implementation.createHTMLDocument(""),w.window=window;else{var re=new(n(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;w.document=re.document,w.jsdomImplForWrapper=n(898).implForWrapper,w.nodeCanvas=n(245).Canvas,w.window=re,DOMParser=w.window.DOMParser}function pe(l,c){var u=l.canvas,f=c.targetCanvas,o=f.getContext("2d");o.translate(0,f.height),o.scale(1,-1);var s=u.height-f.height;o.drawImage(u,0,s,f.width,f.height,0,0,f.width,f.height)}function de(l,c){var u=c.targetCanvas.getContext("2d"),f=c.destinationWidth,o=c.destinationHeight,s=f*o*4,h=new Uint8Array(this.imageBuffer,0,s),m=new Uint8ClampedArray(this.imageBuffer,0,s);l.readPixels(0,0,f,o,l.RGBA,l.UNSIGNED_BYTE,h);var p=new ImageData(m,f,o);u.putImageData(p,0,0)}w.isTouchSupported="ontouchstart"in w.window||"ontouchstart"in w.document||w.window&&w.window.navigator&&w.window.navigator.maxTouchPoints>0,w.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",w.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],w.DPI=96,w.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",w.commaWsp="(?:\\s+,?\\s*|,\\s*)",w.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,w.reNonWord=/[ \n\.,;!\?\-]/,w.fontPaths={},w.iMatrix=[1,0,0,1,0,0],w.svgNS="http://www.w3.org/2000/svg",w.perfLimitSizeTotal=2097152,w.maxCacheSideLimit=4096,w.minCacheSideLimit=256,w.charWidthsCache={},w.textureSize=2048,w.disableStyleCopyPaste=!1,w.enableGLFiltering=!0,w.devicePixelRatio=w.window.devicePixelRatio||w.window.webkitDevicePixelRatio||w.window.mozDevicePixelRatio||1,w.browserShadowBlurConstant=1,w.arcToSegmentsCache={},w.boundsOfCurveCache={},w.cachesBoundsOfCurve=!0,w.forceGLPutImageData=!1,w.initFilterBackend=function(){return w.enableGLFiltering&&w.isWebglSupported&&w.isWebglSupported(w.textureSize)?(console.log("max texture size: "+w.maxTextureSize),new w.WebglFilterBackend({tileSize:w.textureSize})):w.Canvas2dFilterBackend?new w.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=w),function(){function l(u,f){if(this.__eventListeners[u]){var o=this.__eventListeners[u];f?o[o.indexOf(f)]=!1:w.util.array.fill(o,!1)}}function c(u,f){var o=function(){f.apply(this,arguments),this.off(u,o)}.bind(this);this.on(u,o)}w.Observable={fire:function(u,f){if(!this.__eventListeners)return this;var o=this.__eventListeners[u];if(!o)return this;for(var s=0,h=o.length;s<h;s++)o[s]&&o[s].call(this,f||{});return this.__eventListeners[u]=o.filter(function(m){return m!==!1}),this},on:function(u,f){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var o in u)this.on(o,u[o]);else this.__eventListeners[u]||(this.__eventListeners[u]=[]),this.__eventListeners[u].push(f);return this},once:function(u,f){if(arguments.length===1)for(var o in u)c.call(this,o,u[o]);else c.call(this,u,f);return this},off:function(u,f){if(!this.__eventListeners)return this;if(arguments.length===0)for(u in this.__eventListeners)l.call(this,u);else if(arguments.length===1&&typeof arguments[0]=="object")for(var o in u)l.call(this,o,u[o]);else l.call(this,u,f);return this}}}(),w.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var l=0,c=arguments.length;l<c;l++)this._onObjectAdded(arguments[l]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(l,c,u){var f=this._objects;return u?f[c]=l:f.splice(c,0,l),this._onObjectAdded&&this._onObjectAdded(l),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var l,c=this._objects,u=!1,f=0,o=arguments.length;f<o;f++)(l=c.indexOf(arguments[f]))!==-1&&(u=!0,c.splice(l,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[f]));return this.renderOnAddRemove&&u&&this.requestRenderAll(),this},forEachObject:function(l,c){for(var u=this.getObjects(),f=0,o=u.length;f<o;f++)l.call(c,u[f],f,u);return this},getObjects:function(l){return l===void 0?this._objects.concat():this._objects.filter(function(c){return c.type===l})},item:function(l){return this._objects[l]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(l,c){return this._objects.indexOf(l)>-1||!!c&&this._objects.some(function(u){return typeof u.contains=="function"&&u.contains(l,!0)})},complexity:function(){return this._objects.reduce(function(l,c){return l+(c.complexity?c.complexity():0)},0)}},w.CommonMethods={_setOptions:function(l){for(var c in l)this.set(c,l[c])},_initGradient:function(l,c){!l||!l.colorStops||l instanceof w.Gradient||this.set(c,new w.Gradient(l))},_initPattern:function(l,c,u){!l||!l.source||l instanceof w.Pattern?u&&u():this.set(c,new w.Pattern(l,u))},_setObject:function(l){for(var c in l)this._set(c,l[c])},set:function(l,c){return typeof l=="object"?this._setObject(l):this._set(l,c),this},_set:function(l,c){this[l]=c},toggle:function(l){var c=this.get(l);return typeof c=="boolean"&&this.set(l,!c),this},get:function(l){return this[l]}},i=e,r=Math.sqrt,a=Math.atan2,d=Math.pow,v=Math.PI/180,y=Math.PI/2,w.util={cos:function(l){if(l===0)return 1;switch(l<0&&(l=-l),l/y){case 1:case 3:return 0;case 2:return-1}return Math.cos(l)},sin:function(l){if(l===0)return 0;var c=1;switch(l<0&&(c=-1),l/y){case 1:return c;case 2:return 0;case 3:return-c}return Math.sin(l)},removeFromArray:function(l,c){var u=l.indexOf(c);return u!==-1&&l.splice(u,1),l},getRandomInt:function(l,c){return Math.floor(Math.random()*(c-l+1))+l},degreesToRadians:function(l){return l*v},radiansToDegrees:function(l){return l/v},rotatePoint:function(l,c,u){var f=new w.Point(l.x-c.x,l.y-c.y),o=w.util.rotateVector(f,u);return new w.Point(o.x,o.y).addEquals(c)},rotateVector:function(l,c){var u=w.util.sin(c),f=w.util.cos(c);return{x:l.x*f-l.y*u,y:l.x*u+l.y*f}},createVector:function(l,c){return new w.Point(c.x-l.x,c.y-l.y)},calcAngleBetweenVectors:function(l,c){return Math.acos((l.x*c.x+l.y*c.y)/(Math.hypot(l.x,l.y)*Math.hypot(c.x,c.y)))},getHatVector:function(l){return new w.Point(l.x,l.y).multiply(1/Math.hypot(l.x,l.y))},getBisector:function(l,c,u){var f=w.util.createVector(l,c),o=w.util.createVector(l,u),s=w.util.calcAngleBetweenVectors(f,o),h=s*(w.util.calcAngleBetweenVectors(w.util.rotateVector(f,s),o)===0?1:-1)/2;return{vector:w.util.getHatVector(w.util.rotateVector(f,h)),angle:s}},projectStrokeOnPoints:function(l,c,u){var f=[],o=c.strokeWidth/2,s=c.strokeUniform?new w.Point(1/c.scaleX,1/c.scaleY):new w.Point(1,1),h=function(m){var p=o/Math.hypot(m.x,m.y);return new w.Point(m.x*p*s.x,m.y*p*s.y)};return l.length<=1||l.forEach(function(m,p){var g,_,E=new w.Point(m.x,m.y);p===0?(_=l[p+1],g=u?h(w.util.createVector(_,E)).addEquals(E):l[l.length-1]):p===l.length-1?(g=l[p-1],_=u?h(w.util.createVector(g,E)).addEquals(E):l[0]):(g=l[p-1],_=l[p+1]);var I,S,D=w.util.getBisector(E,g,_),x=D.vector,R=D.angle;if(c.strokeLineJoin==="miter"&&(I=-o/Math.sin(R/2),S=new w.Point(x.x*I*s.x,x.y*I*s.y),Math.hypot(S.x,S.y)/o<=c.strokeMiterLimit))return f.push(E.add(S)),void f.push(E.subtract(S));I=-o*Math.SQRT2,S=new w.Point(x.x*I*s.x,x.y*I*s.y),f.push(E.add(S)),f.push(E.subtract(S))}),f},transformPoint:function(l,c,u){return u?new w.Point(c[0]*l.x+c[2]*l.y,c[1]*l.x+c[3]*l.y):new w.Point(c[0]*l.x+c[2]*l.y+c[4],c[1]*l.x+c[3]*l.y+c[5])},makeBoundingBoxFromPoints:function(l,c){if(c)for(var u=0;u<l.length;u++)l[u]=w.util.transformPoint(l[u],c);var f=[l[0].x,l[1].x,l[2].x,l[3].x],o=w.util.array.min(f),s=w.util.array.max(f)-o,h=[l[0].y,l[1].y,l[2].y,l[3].y],m=w.util.array.min(h);return{left:o,top:m,width:s,height:w.util.array.max(h)-m}},invertTransform:function(l){var c=1/(l[0]*l[3]-l[1]*l[2]),u=[c*l[3],-c*l[1],-c*l[2],c*l[0]],f=w.util.transformPoint({x:l[4],y:l[5]},u,!0);return u[4]=-f.x,u[5]=-f.y,u},toFixed:function(l,c){return parseFloat(Number(l).toFixed(c))},parseUnit:function(l,c){var u=/\D{0,2}$/.exec(l),f=parseFloat(l);switch(c||(c=w.Text.DEFAULT_SVG_FONT_SIZE),u[0]){case"mm":return f*w.DPI/25.4;case"cm":return f*w.DPI/2.54;case"in":return f*w.DPI;case"pt":return f*w.DPI/72;case"pc":return f*w.DPI/72*12;case"em":return f*c;default:return f}},falseFunction:function(){return!1},getKlass:function(l,c){return l=w.util.string.camelize(l.charAt(0).toUpperCase()+l.slice(1)),w.util.resolveNamespace(c)[l]},getSvgAttributes:function(l){var c=["instantiated_by_use","style","id","class"];switch(l){case"linearGradient":c=c.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":c=c.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":c=c.concat(["offset","stop-color","stop-opacity"])}return c},resolveNamespace:function(l){if(!l)return w;var c,u=l.split("."),f=u.length,o=i||w.window;for(c=0;c<f;++c)o=o[u[c]];return o},loadImage:function(l,c,u,f){if(l){var o=w.util.createImage(),s=function(){c&&c.call(u,o,!1),o=o.onload=o.onerror=null};o.onload=s,o.onerror=function(){w.log("Error loading "+o.src),c&&c.call(u,null,!0),o=o.onload=o.onerror=null},l.indexOf("data")!==0&&f!=null&&(o.crossOrigin=f),l.substring(0,14)==="data:image/svg"&&(o.onload=null,w.util.loadImageInDom(o,s)),o.src=l}else c&&c.call(u,l)},loadImageInDom:function(l,c){var u=w.document.createElement("div");u.style.width=u.style.height="1px",u.style.left=u.style.top="-100%",u.style.position="absolute",u.appendChild(l),w.document.querySelector("body").appendChild(u),l.onload=function(){c(),u.parentNode.removeChild(u),u=null}},enlivenObjects:function(l,c,u,f){var o=[],s=0,h=(l=l||[]).length;function m(){++s===h&&c&&c(o.filter(function(p){return p}))}h?l.forEach(function(p,g){p&&p.type?w.util.getKlass(p.type,u).fromObject(p,function(_,E){E||(o[g]=_),f&&f(p,_,E),m()}):m()}):c&&c(o)},enlivenObjectEnlivables:function(l,c,u){var f=w.Object.ENLIVEN_PROPS.filter(function(o){return!!l[o]});w.util.enlivenObjects(f.map(function(o){return l[o]}),function(o){var s={};f.forEach(function(h,m){s[h]=o[m],c&&(c[h]=o[m])}),u&&u(s)})},enlivenPatterns:function(l,c){function u(){++o===s&&c&&c(f)}var f=[],o=0,s=(l=l||[]).length;s?l.forEach(function(h,m){h&&h.source?new w.Pattern(h,function(p){f[m]=p,u()}):(f[m]=h,u())}):c&&c(f)},groupSVGElements:function(l,c,u){var f;return l&&l.length===1?l[0]:(c&&(c.width&&c.height?c.centerPoint={x:c.width/2,y:c.height/2}:(delete c.width,delete c.height)),f=new w.Group(l,c),u!==void 0&&(f.sourcePath=u),f)},populateWithProperties:function(l,c,u){if(u&&Array.isArray(u))for(var f=0,o=u.length;f<o;f++)u[f]in l&&(c[u[f]]=l[u[f]])},createCanvasElement:function(){return w.document.createElement("canvas")},copyCanvasElement:function(l){var c=w.util.createCanvasElement();return c.width=l.width,c.height=l.height,c.getContext("2d").drawImage(l,0,0),c},toDataURL:function(l,c,u){return l.toDataURL("image/"+c,u)},createImage:function(){return w.document.createElement("img")},multiplyTransformMatrices:function(l,c,u){return[l[0]*c[0]+l[2]*c[1],l[1]*c[0]+l[3]*c[1],l[0]*c[2]+l[2]*c[3],l[1]*c[2]+l[3]*c[3],u?0:l[0]*c[4]+l[2]*c[5]+l[4],u?0:l[1]*c[4]+l[3]*c[5]+l[5]]},qrDecompose:function(l){var c=a(l[1],l[0]),u=d(l[0],2)+d(l[1],2),f=r(u),o=(l[0]*l[3]-l[2]*l[1])/f,s=a(l[0]*l[2]+l[1]*l[3],u);return{angle:c/v,scaleX:f,scaleY:o,skewX:s/v,skewY:0,translateX:l[4],translateY:l[5]}},calcRotateMatrix:function(l){if(!l.angle)return w.iMatrix.concat();var c=w.util.degreesToRadians(l.angle),u=w.util.cos(c),f=w.util.sin(c);return[u,f,-f,u,0,0]},calcDimensionsMatrix:function(l){var c=l.scaleX===void 0?1:l.scaleX,u=l.scaleY===void 0?1:l.scaleY,f=[l.flipX?-c:c,0,0,l.flipY?-u:u,0,0],o=w.util.multiplyTransformMatrices,s=w.util.degreesToRadians;return l.skewX&&(f=o(f,[1,0,Math.tan(s(l.skewX)),1],!0)),l.skewY&&(f=o(f,[1,Math.tan(s(l.skewY)),0,1],!0)),f},composeMatrix:function(l){var c=[1,0,0,1,l.translateX||0,l.translateY||0],u=w.util.multiplyTransformMatrices;return l.angle&&(c=u(c,w.util.calcRotateMatrix(l))),(l.scaleX!==1||l.scaleY!==1||l.skewX||l.skewY||l.flipX||l.flipY)&&(c=u(c,w.util.calcDimensionsMatrix(l))),c},resetObjectTransform:function(l){l.scaleX=1,l.scaleY=1,l.skewX=0,l.skewY=0,l.flipX=!1,l.flipY=!1,l.rotate(0)},saveObjectTransform:function(l){return{scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,angle:l.angle,left:l.left,flipX:l.flipX,flipY:l.flipY,top:l.top}},isTransparent:function(l,c,u,f){f>0&&(c>f?c-=f:c=0,u>f?u-=f:u=0);var o,s=!0,h=l.getImageData(c,u,2*f||1,2*f||1),m=h.data.length;for(o=3;o<m&&(s=h.data[o]<=0)!=0;o+=4);return h=null,s},parsePreserveAspectRatioAttribute:function(l){var c,u="meet",f=l.split(" ");return f&&f.length&&((u=f.pop())!=="meet"&&u!=="slice"?(c=u,u="meet"):f.length&&(c=f.pop())),{meetOrSlice:u,alignX:c!=="none"?c.slice(1,4):"none",alignY:c!=="none"?c.slice(5,8):"none"}},clearFabricFontCache:function(l){(l=(l||"").toLowerCase())?w.charWidthsCache[l]&&delete w.charWidthsCache[l]:w.charWidthsCache={}},limitDimsByArea:function(l,c){var u=Math.sqrt(c*l),f=Math.floor(c/u);return{x:Math.floor(u),y:f}},capValue:function(l,c,u){return Math.max(l,Math.min(c,u))},findScaleToFit:function(l,c){return Math.min(c.width/l.width,c.height/l.height)},findScaleToCover:function(l,c){return Math.max(c.width/l.width,c.height/l.height)},matrixToSVG:function(l){return"matrix("+l.map(function(c){return w.util.toFixed(c,w.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(l,c){var u=w.util.invertTransform(c),f=w.util.multiplyTransformMatrices(u,l.calcOwnMatrix());w.util.applyTransformToObject(l,f)},addTransformToObject:function(l,c){w.util.applyTransformToObject(l,w.util.multiplyTransformMatrices(c,l.calcOwnMatrix()))},applyTransformToObject:function(l,c){var u=w.util.qrDecompose(c),f=new w.Point(u.translateX,u.translateY);l.flipX=!1,l.flipY=!1,l.set("scaleX",u.scaleX),l.set("scaleY",u.scaleY),l.skewX=u.skewX,l.skewY=u.skewY,l.angle=u.angle,l.setPositionByOrigin(f,"center","center")},sizeAfterTransform:function(l,c,u){var f=l/2,o=c/2,s=[{x:-f,y:-o},{x:f,y:-o},{x:-f,y:o},{x:f,y:o}],h=w.util.calcDimensionsMatrix(u),m=w.util.makeBoundingBoxFromPoints(s,h);return{x:m.width,y:m.height}},mergeClipPaths:function(l,c){var u=l,f=c;u.inverted&&!f.inverted&&(u=c,f=l),w.util.applyTransformToObject(f,w.util.multiplyTransformMatrices(w.util.invertTransform(u.calcTransformMatrix()),f.calcTransformMatrix()));var o=u.inverted&&f.inverted;return o&&(u.inverted=f.inverted=!1),new w.Group([u],{clipPath:f,inverted:o})}},function(){var l=Array.prototype.join,c={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},u={m:"l",M:"L"};function f(S,D,x,R,j,U,Q,Z,q,k,F){var z=w.util.cos(S),J=w.util.sin(S),ee=w.util.cos(D),V=w.util.sin(D),B=x*j*ee-R*U*V+Q,X=R*j*ee+x*U*V+Z;return["C",k+q*(-x*j*J-R*U*z),F+q*(-R*j*J+x*U*z),B+q*(x*j*V+R*U*ee),X+q*(R*j*V-x*U*ee),B,X]}function o(S,D,x,R){var j=Math.atan2(D,S),U=Math.atan2(R,x);return U>=j?U-j:2*Math.PI-(j-U)}function s(S,D,x){for(var R=x[1],j=x[2],U=x[3],Q=x[4],Z=x[5],q=function(z,J,ee,V,B,X,ne){var K=Math.PI,se=ne*K/180,ge=w.util.sin(se),ue=w.util.cos(se),le=0,fe=0,he=-ue*z*.5-ge*J*.5,ve=-ue*J*.5+ge*z*.5,Ee=(ee=Math.abs(ee))*ee,ye=(V=Math.abs(V))*V,Ne=ve*ve,tt=he*he,on=Ee*ye-Ee*Ne-ye*tt,ei=0;if(on<0){var Lr=Math.sqrt(1-on/(Ee*ye));ee*=Lr,V*=Lr}else ei=(B===X?-1:1)*Math.sqrt(on/(Ee*Ne+ye*tt));var ct=ei*ee*ve/V,sn=-ei*V*he/ee,Ho=ue*ct-ge*sn+.5*z,Nr=ge*ct+ue*sn+.5*J,ir=o(1,0,(he-ct)/ee,(ve-sn)/V),Pr=o((he-ct)/ee,(ve-sn)/V,(-he-ct)/ee,(-ve-sn)/V);X===0&&Pr>0?Pr-=2*K:X===1&&Pr<0&&(Pr+=2*K);for(var up=Math.ceil(Math.abs(Pr/K*2)),_a=[],Go=Pr/up,ow=8/3*Math.sin(Go/4)*Math.sin(Go/4)/Math.sin(Go/2),tu=ir+Go,Wo=0;Wo<up;Wo++)_a[Wo]=f(ir,tu,ue,ge,ee,V,Ho,Nr,ow,le,fe),le=_a[Wo][5],fe=_a[Wo][6],ir=tu,tu+=Go;return _a}(x[6]-S,x[7]-D,R,j,Q,Z,U),k=0,F=q.length;k<F;k++)q[k][1]+=S,q[k][2]+=D,q[k][3]+=S,q[k][4]+=D,q[k][5]+=S,q[k][6]+=D;return q}function h(S,D,x,R){return Math.sqrt((x-S)*(x-S)+(R-D)*(R-D))}function m(S,D,x,R,j,U,Q,Z){return function(q){var k,F=(k=q)*k*k,z=function(V){return 3*V*V*(1-V)}(q),J=function(V){return 3*V*(1-V)*(1-V)}(q),ee=function(V){return(1-V)*(1-V)*(1-V)}(q);return{x:Q*F+j*z+x*J+S*ee,y:Z*F+U*z+R*J+D*ee}}}function p(S,D,x,R,j,U,Q,Z){return function(q){var k=1-q,F=3*k*k*(x-S)+6*k*q*(j-x)+3*q*q*(Q-j),z=3*k*k*(R-D)+6*k*q*(U-R)+3*q*q*(Z-U);return Math.atan2(z,F)}}function g(S,D,x,R,j,U){return function(Q){var Z,q=(Z=Q)*Z,k=function(z){return 2*z*(1-z)}(Q),F=function(z){return(1-z)*(1-z)}(Q);return{x:j*q+x*k+S*F,y:U*q+R*k+D*F}}}function _(S,D,x,R,j,U){return function(Q){var Z=1-Q,q=2*Z*(x-S)+2*Q*(j-x),k=2*Z*(R-D)+2*Q*(U-R);return Math.atan2(k,q)}}function E(S,D,x){var R,j,U={x:D,y:x},Q=0;for(j=1;j<=100;j+=1)R=S(j/100),Q+=h(U.x,U.y,R.x,R.y),U=R;return Q}function I(S){for(var D,x,R,j,U=0,Q=S.length,Z=0,q=0,k=0,F=0,z=[],J=0;J<Q;J++){switch(R={x:Z,y:q,command:(D=S[J])[0]},D[0]){case"M":R.length=0,k=Z=D[1],F=q=D[2];break;case"L":R.length=h(Z,q,D[1],D[2]),Z=D[1],q=D[2];break;case"C":x=m(Z,q,D[1],D[2],D[3],D[4],D[5],D[6]),j=p(Z,q,D[1],D[2],D[3],D[4],D[5],D[6]),R.iterator=x,R.angleFinder=j,R.length=E(x,Z,q),Z=D[5],q=D[6];break;case"Q":x=g(Z,q,D[1],D[2],D[3],D[4]),j=_(Z,q,D[1],D[2],D[3],D[4]),R.iterator=x,R.angleFinder=j,R.length=E(x,Z,q),Z=D[3],q=D[4];break;case"Z":case"z":R.destX=k,R.destY=F,R.length=h(Z,q,k,F),Z=k,q=F}U+=R.length,z.push(R)}return z.push({length:U,x:Z,y:q}),z}w.util.joinPath=function(S){return S.map(function(D){return D.join(" ")}).join(" ")},w.util.parsePath=function(S){var D,x,R,j,U,Q=[],Z=[],q=w.rePathCommand,k="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",F="("+k+")"+w.commaWsp,z="([01])"+w.commaWsp+"?",J=new RegExp(F+"?"+F+"?"+F+z+z+F+"?("+k+")","g");if(!S||!S.match)return Q;for(var ee,V=0,B=(U=S.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;V<B;V++){j=(D=U[V]).slice(1).trim(),Z.length=0;var X=D.charAt(0);if(ee=[X],X.toLowerCase()==="a")for(var ne;ne=J.exec(j);)for(var K=1;K<ne.length;K++)Z.push(ne[K]);else for(;R=q.exec(j);)Z.push(R[0]);K=0;for(var se=Z.length;K<se;K++)x=parseFloat(Z[K]),isNaN(x)||ee.push(x);var ge=c[X.toLowerCase()],ue=u[X]||X;if(ee.length-1>ge)for(var le=1,fe=ee.length;le<fe;le+=ge)Q.push([X].concat(ee.slice(le,le+ge))),X=ue;else Q.push(ee)}return Q},w.util.makePathSimpler=function(S){var D,x,R,j,U,Q,Z=0,q=0,k=S.length,F=0,z=0,J=[];for(x=0;x<k;++x){switch(R=!1,(D=S[x].slice(0))[0]){case"l":D[0]="L",D[1]+=Z,D[2]+=q;case"L":Z=D[1],q=D[2];break;case"h":D[1]+=Z;case"H":D[0]="L",D[2]=q,Z=D[1];break;case"v":D[1]+=q;case"V":D[0]="L",q=D[1],D[1]=Z,D[2]=q;break;case"m":D[0]="M",D[1]+=Z,D[2]+=q;case"M":Z=D[1],q=D[2],F=D[1],z=D[2];break;case"c":D[0]="C",D[1]+=Z,D[2]+=q,D[3]+=Z,D[4]+=q,D[5]+=Z,D[6]+=q;case"C":U=D[3],Q=D[4],Z=D[5],q=D[6];break;case"s":D[0]="S",D[1]+=Z,D[2]+=q,D[3]+=Z,D[4]+=q;case"S":j==="C"?(U=2*Z-U,Q=2*q-Q):(U=Z,Q=q),Z=D[3],q=D[4],D[0]="C",D[5]=D[3],D[6]=D[4],D[3]=D[1],D[4]=D[2],D[1]=U,D[2]=Q,U=D[3],Q=D[4];break;case"q":D[0]="Q",D[1]+=Z,D[2]+=q,D[3]+=Z,D[4]+=q;case"Q":U=D[1],Q=D[2],Z=D[3],q=D[4];break;case"t":D[0]="T",D[1]+=Z,D[2]+=q;case"T":j==="Q"?(U=2*Z-U,Q=2*q-Q):(U=Z,Q=q),D[0]="Q",Z=D[1],q=D[2],D[1]=U,D[2]=Q,D[3]=Z,D[4]=q;break;case"a":D[0]="A",D[6]+=Z,D[7]+=q;case"A":R=!0,J=J.concat(s(Z,q,D)),Z=D[6],q=D[7];break;case"z":case"Z":Z=F,q=z}R||J.push(D),j=D[0]}return J},w.util.getSmoothPathFromPoints=function(S,D){var x,R=[],j=new w.Point(S[0].x,S[0].y),U=new w.Point(S[1].x,S[1].y),Q=S.length,Z=1,q=0,k=Q>2;for(D=D||0,k&&(Z=S[2].x<U.x?-1:S[2].x===U.x?0:1,q=S[2].y<U.y?-1:S[2].y===U.y?0:1),R.push(["M",j.x-Z*D,j.y-q*D]),x=1;x<Q;x++){if(!j.eq(U)){var F=j.midPointFrom(U);R.push(["Q",j.x,j.y,F.x,F.y])}j=S[x],x+1<S.length&&(U=S[x+1])}return k&&(Z=j.x>S[x-2].x?1:j.x===S[x-2].x?0:-1,q=j.y>S[x-2].y?1:j.y===S[x-2].y?0:-1),R.push(["L",j.x+Z*D,j.y+q*D]),R},w.util.getPathSegmentsInfo=I,w.util.getBoundsOfCurve=function(S,D,x,R,j,U,Q,Z){var q;if(w.cachesBoundsOfCurve&&(q=l.call(arguments),w.boundsOfCurveCache[q]))return w.boundsOfCurveCache[q];var k,F,z,J,ee,V,B,X,ne=Math.sqrt,K=Math.min,se=Math.max,ge=Math.abs,ue=[],le=[[],[]];F=6*S-12*x+6*j,k=-3*S+9*x-9*j+3*Q,z=3*x-3*S;for(var fe=0;fe<2;++fe)if(fe>0&&(F=6*D-12*R+6*U,k=-3*D+9*R-9*U+3*Z,z=3*R-3*D),ge(k)<1e-12){if(ge(F)<1e-12)continue;0<(J=-z/F)&&J<1&&ue.push(J)}else(B=F*F-4*z*k)<0||(0<(ee=(-F+(X=ne(B)))/(2*k))&&ee<1&&ue.push(ee),0<(V=(-F-X)/(2*k))&&V<1&&ue.push(V));for(var he,ve,Ee,ye=ue.length,Ne=ye;ye--;)he=(Ee=1-(J=ue[ye]))*Ee*Ee*S+3*Ee*Ee*J*x+3*Ee*J*J*j+J*J*J*Q,le[0][ye]=he,ve=Ee*Ee*Ee*D+3*Ee*Ee*J*R+3*Ee*J*J*U+J*J*J*Z,le[1][ye]=ve;le[0][Ne]=S,le[1][Ne]=D,le[0][Ne+1]=Q,le[1][Ne+1]=Z;var tt=[{x:K.apply(null,le[0]),y:K.apply(null,le[1])},{x:se.apply(null,le[0]),y:se.apply(null,le[1])}];return w.cachesBoundsOfCurve&&(w.boundsOfCurveCache[q]=tt),tt},w.util.getPointOnPath=function(S,D,x){x||(x=I(S));for(var R=0;D-x[R].length>0&&R<x.length-2;)D-=x[R].length,R++;var j,U=x[R],Q=D/U.length,Z=U.command,q=S[R];switch(Z){case"M":return{x:U.x,y:U.y,angle:0};case"Z":case"z":return(j=new w.Point(U.x,U.y).lerp(new w.Point(U.destX,U.destY),Q)).angle=Math.atan2(U.destY-U.y,U.destX-U.x),j;case"L":return(j=new w.Point(U.x,U.y).lerp(new w.Point(q[1],q[2]),Q)).angle=Math.atan2(q[2]-U.y,q[1]-U.x),j;case"C":case"Q":return function(k,F){for(var z,J,ee,V=0,B=0,X=k.iterator,ne={x:k.x,y:k.y},K=.01,se=k.angleFinder;B<F&&K>1e-4;)z=X(V),ee=V,(J=h(ne.x,ne.y,z.x,z.y))+B>F?(V-=K,K/=2):(ne=z,V+=K,B+=J);return z.angle=se(ee),z}(U,D)}},w.util.transformPath=function(S,D,x){return x&&(D=w.util.multiplyTransformMatrices(D,[1,0,0,1,-x.x,-x.y])),S.map(function(R){for(var j=R.slice(0),U={},Q=1;Q<R.length-1;Q+=2)U.x=R[Q],U.y=R[Q+1],U=w.util.transformPoint(U,D),j[Q]=U.x,j[Q+1]=U.y;return j})}}(),function(){var l=Array.prototype.slice;function c(u,f,o){if(u&&u.length!==0){var s=u.length-1,h=f?u[s][f]:u[s];if(f)for(;s--;)o(u[s][f],h)&&(h=u[s][f]);else for(;s--;)o(u[s],h)&&(h=u[s]);return h}}w.util.array={fill:function(u,f){for(var o=u.length;o--;)u[o]=f;return u},invoke:function(u,f){for(var o=l.call(arguments,2),s=[],h=0,m=u.length;h<m;h++)s[h]=o.length?u[h][f].apply(u[h],o):u[h][f].call(u[h]);return s},min:function(u,f){return c(u,f,function(o,s){return o<s})},max:function(u,f){return c(u,f,function(o,s){return o>=s})}}}(),function(){function l(c,u,f){if(f)if(!w.isLikelyNode&&u instanceof Element)c=u;else if(u instanceof Array){c=[];for(var o=0,s=u.length;o<s;o++)c[o]=l({},u[o],f)}else if(u&&typeof u=="object")for(var h in u)h==="canvas"||h==="group"?c[h]=null:u.hasOwnProperty(h)&&(c[h]=l({},u[h],f));else c=u;else for(var h in u)c[h]=u[h];return c}w.util.object={extend:l,clone:function(c,u){return l({},c,u)}},w.util.object.extend(w.util,w.Observable)}(),function(){function l(c,u){var f=c.charCodeAt(u);if(isNaN(f))return"";if(f<55296||f>57343)return c.charAt(u);if(55296<=f&&f<=56319){if(c.length<=u+1)throw"High surrogate without following low surrogate";var o=c.charCodeAt(u+1);if(56320>o||o>57343)throw"High surrogate without following low surrogate";return c.charAt(u)+c.charAt(u+1)}if(u===0)throw"Low surrogate without preceding high surrogate";var s=c.charCodeAt(u-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1}w.util.string={camelize:function(c){return c.replace(/-+(.)?/g,function(u,f){return f?f.toUpperCase():""})},capitalize:function(c,u){return c.charAt(0).toUpperCase()+(u?c.slice(1):c.slice(1).toLowerCase())},escapeXml:function(c){return c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(c){var u,f=0,o=[];for(f=0;f<c.length;f++)(u=l(c,f))!==!1&&o.push(u);return o}}}(),function(){var l=Array.prototype.slice,c=function(){},u=function(){for(var h in{toString:1})if(h==="toString")return!1;return!0}(),f=function(h,m,p){for(var g in m)g in h.prototype&&typeof h.prototype[g]=="function"&&(m[g]+"").indexOf("callSuper")>-1?h.prototype[g]=function(_){return function(){var E=this.constructor.superclass;this.constructor.superclass=p;var I=m[_].apply(this,arguments);if(this.constructor.superclass=E,_!=="initialize")return I}}(g):h.prototype[g]=m[g],u&&(m.toString!==Object.prototype.toString&&(h.prototype.toString=m.toString),m.valueOf!==Object.prototype.valueOf&&(h.prototype.valueOf=m.valueOf))};function o(){}function s(h){for(var m=null,p=this;p.constructor.superclass;){var g=p.constructor.superclass.prototype[h];if(p[h]!==g){m=g;break}p=p.constructor.superclass.prototype}return m?arguments.length>1?m.apply(this,l.call(arguments,1)):m.call(this):console.log("tried to callSuper "+h+", method not found in prototype chain",this)}w.util.createClass=function(){var h=null,m=l.call(arguments,0);function p(){this.initialize.apply(this,arguments)}typeof m[0]=="function"&&(h=m.shift()),p.superclass=h,p.subclasses=[],h&&(o.prototype=h.prototype,p.prototype=new o,h.subclasses.push(p));for(var g=0,_=m.length;g<_;g++)f(p,m[g],h);return p.prototype.initialize||(p.prototype.initialize=c),p.prototype.constructor=p,p.prototype.callSuper=s,p}}(),C=!!w.document.createElement("div").attachEvent,b=["touchstart","touchmove","touchend"],w.util.addListener=function(l,c,u,f){l&&l.addEventListener(c,u,!C&&f)},w.util.removeListener=function(l,c,u,f){l&&l.removeEventListener(c,u,!C&&f)},w.util.getPointer=function(l){var c=l.target,u=w.util.getScrollLeftTop(c),f=function(o){var s=o.changedTouches;return s&&s[0]?s[0]:o}(l);return{x:f.clientX+u.left,y:f.clientY+u.top}},w.util.isTouchEvent=function(l){return b.indexOf(l.type)>-1||l.pointerType==="touch"},M=typeof(T=w.document.createElement("div")).style.opacity=="string",O=typeof T.style.filter=="string",L=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,P=function(l){return l},M?P=function(l,c){return l.style.opacity=c,l}:O&&(P=function(l,c){var u=l.style;return l.currentStyle&&!l.currentStyle.hasLayout&&(u.zoom=1),L.test(u.filter)?(c=c>=.9999?"":"alpha(opacity="+100*c+")",u.filter=u.filter.replace(L,c)):u.filter+=" alpha(opacity="+100*c+")",l}),w.util.setStyle=function(l,c){var u=l.style;if(!u)return l;if(typeof c=="string")return l.style.cssText+=";"+c,c.indexOf("opacity")>-1?P(l,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):l;for(var f in c)f==="opacity"?P(l,c[f]):u[f==="float"||f==="cssFloat"?u.styleFloat===void 0?"cssFloat":"styleFloat":f]=c[f];return l},function(){var l,c,u,f,o=Array.prototype.slice,s=function(p){return o.call(p,0)};try{l=s(w.document.childNodes)instanceof Array}catch{}function h(p,g){var _=w.document.createElement(p);for(var E in g)E==="class"?_.className=g[E]:E==="for"?_.htmlFor=g[E]:_.setAttribute(E,g[E]);return _}function m(p){for(var g=0,_=0,E=w.document.documentElement,I=w.document.body||{scrollLeft:0,scrollTop:0};p&&(p.parentNode||p.host)&&((p=p.parentNode||p.host)===w.document?(g=I.scrollLeft||E.scrollLeft||0,_=I.scrollTop||E.scrollTop||0):(g+=p.scrollLeft||0,_+=p.scrollTop||0),p.nodeType!==1||p.style.position!=="fixed"););return{left:g,top:_}}l||(s=function(p){for(var g=new Array(p.length),_=p.length;_--;)g[_]=p[_];return g}),c=w.document.defaultView&&w.document.defaultView.getComputedStyle?function(p,g){var _=w.document.defaultView.getComputedStyle(p,null);return _?_[g]:void 0}:function(p,g){var _=p.style[g];return!_&&p.currentStyle&&(_=p.currentStyle[g]),_},u=w.document.documentElement.style,f="userSelect"in u?"userSelect":"MozUserSelect"in u?"MozUserSelect":"WebkitUserSelect"in u?"WebkitUserSelect":"KhtmlUserSelect"in u?"KhtmlUserSelect":"",w.util.makeElementUnselectable=function(p){return p.onselectstart!==void 0&&(p.onselectstart=w.util.falseFunction),f?p.style[f]="none":typeof p.unselectable=="string"&&(p.unselectable="on"),p},w.util.makeElementSelectable=function(p){return p.onselectstart!==void 0&&(p.onselectstart=null),f?p.style[f]="":typeof p.unselectable=="string"&&(p.unselectable=""),p},w.util.setImageSmoothing=function(p,g){p.imageSmoothingEnabled=p.imageSmoothingEnabled||p.webkitImageSmoothingEnabled||p.mozImageSmoothingEnabled||p.msImageSmoothingEnabled||p.oImageSmoothingEnabled,p.imageSmoothingEnabled=g},w.util.getById=function(p){return typeof p=="string"?w.document.getElementById(p):p},w.util.toArray=s,w.util.addClass=function(p,g){p&&(" "+p.className+" ").indexOf(" "+g+" ")===-1&&(p.className+=(p.className?" ":"")+g)},w.util.makeElement=h,w.util.wrapElement=function(p,g,_){return typeof g=="string"&&(g=h(g,_)),p.parentNode&&p.parentNode.replaceChild(g,p),g.appendChild(p),g},w.util.getScrollLeftTop=m,w.util.getElementOffset=function(p){var g,_,E=p&&p.ownerDocument,I={left:0,top:0},S={left:0,top:0},D={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!E)return S;for(var x in D)S[D[x]]+=parseInt(c(p,x),10)||0;return g=E.documentElement,p.getBoundingClientRect!==void 0&&(I=p.getBoundingClientRect()),_=m(p),{left:I.left+_.left-(g.clientLeft||0)+S.left,top:I.top+_.top-(g.clientTop||0)+S.top}},w.util.getNodeCanvas=function(p){var g=w.jsdomImplForWrapper(p);return g._canvas||g._image},w.util.cleanUpJsdomNode=function(p){if(w.isLikelyNode){var g=w.jsdomImplForWrapper(p);g&&(g._image=null,g._canvas=null,g._currentSrc=null,g._attributes=null,g._classList=null)}}}(),function(){function l(){}w.util.request=function(c,u){u||(u={});var f=u.method?u.method.toUpperCase():"GET",o=u.onComplete||function(){},s=new w.window.XMLHttpRequest,h=u.body||u.parameters;return s.onreadystatechange=function(){s.readyState===4&&(o(s),s.onreadystatechange=l)},f==="GET"&&(h=null,typeof u.parameters=="string"&&(c=function(m,p){return m+(/\?/.test(m)?"&":"?")+p}(c,u.parameters))),s.open(f,c,!0),f!=="POST"&&f!=="PUT"||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(h),s}}(),w.log=console.log,w.warn=console.warn,function(){var l=w.util.object.extend,c=w.util.object.clone,u=[];function f(){return!1}function o(p,g,_,E){return-_*Math.cos(p/E*(Math.PI/2))+_+g}w.util.object.extend(u,{cancelAll:function(){var p=this.splice(0);return p.forEach(function(g){g.cancel()}),p},cancelByCanvas:function(p){if(!p)return[];var g=this.filter(function(_){return typeof _.target=="object"&&_.target.canvas===p});return g.forEach(function(_){_.cancel()}),g},cancelByTarget:function(p){var g=this.findAnimationsByTarget(p);return g.forEach(function(_){_.cancel()}),g},findAnimationIndex:function(p){return this.indexOf(this.findAnimation(p))},findAnimation:function(p){return this.find(function(g){return g.cancel===p})},findAnimationsByTarget:function(p){return p?this.filter(function(g){return g.target===p}):[]}});var s=w.window.requestAnimationFrame||w.window.webkitRequestAnimationFrame||w.window.mozRequestAnimationFrame||w.window.oRequestAnimationFrame||w.window.msRequestAnimationFrame||function(p){return w.window.setTimeout(p,1e3/60)},h=w.window.cancelAnimationFrame||w.window.clearTimeout;function m(){return s.apply(w.window,arguments)}w.util.animate=function(p){p||(p={});var g,_=!1,E=function(){var I=w.runningAnimations.indexOf(g);return I>-1&&w.runningAnimations.splice(I,1)[0]};return g=l(c(p),{cancel:function(){return _=!0,E()},currentValue:"startValue"in p?p.startValue:0,completionRate:0,durationRate:0}),w.runningAnimations.push(g),m(function(I){var S,D=I||+new Date,x=p.duration||500,R=D+x,j=p.onChange||f,U=p.abort||f,Q=p.onComplete||f,Z=p.easing||o,q="startValue"in p&&p.startValue.length>0,k="startValue"in p?p.startValue:0,F="endValue"in p?p.endValue:100,z=p.byValue||(q?k.map(function(J,ee){return F[ee]-k[ee]}):F-k);p.onStart&&p.onStart(),function J(ee){var V=(S=ee||+new Date)>R?x:S-D,B=V/x,X=q?k.map(function(K,se){return Z(V,k[se],z[se],x)}):Z(V,k,z,x),ne=Math.abs(q?(X[0]-k[0])/z[0]:(X-k)/z);if(g.currentValue=q?X.slice():X,g.completionRate=ne,g.durationRate=B,!_){if(!U(X,ne,B))return S>R?(g.currentValue=q?F.slice():F,g.completionRate=1,g.durationRate=1,j(q?F.slice():F,1,1),Q(F,1,1),void E()):(j(X,ne,B),void m(J));E()}}(D)}),g.cancel},w.util.requestAnimFrame=m,w.util.cancelAnimFrame=function(){return h.apply(w.window,arguments)},w.runningAnimations=u}(),function(){function l(c,u,f){var o="rgba("+parseInt(c[0]+f*(u[0]-c[0]),10)+","+parseInt(c[1]+f*(u[1]-c[1]),10)+","+parseInt(c[2]+f*(u[2]-c[2]),10);return(o+=","+(c&&u?parseFloat(c[3]+f*(u[3]-c[3])):1))+")"}w.util.animateColor=function(c,u,f,o){var s=new w.Color(c).getSource(),h=new w.Color(u).getSource(),m=o.onComplete,p=o.onChange;return o=o||{},w.util.animate(w.util.object.extend(o,{duration:f||500,startValue:s,endValue:h,byValue:h,easing:function(g,_,E,I){return l(_,E,o.colorEasing?o.colorEasing(g,I):1-Math.cos(g/I*(Math.PI/2)))},onComplete:function(g,_,E){if(m)return m(l(h,h,0),_,E)},onChange:function(g,_,E){if(p){if(Array.isArray(g))return p(l(g,g,0),_,E);p(g,_,E)}}}))}}(),function(){function l(o,s,h,m){return o<Math.abs(s)?(o=s,m=h/4):m=s===0&&o===0?h/(2*Math.PI)*Math.asin(1):h/(2*Math.PI)*Math.asin(s/o),{a:o,c:s,p:h,s:m}}function c(o,s,h){return o.a*Math.pow(2,10*(s-=1))*Math.sin((s*h-o.s)*(2*Math.PI)/o.p)}function u(o,s,h,m){return h-f(m-o,0,h,m)+s}function f(o,s,h,m){return(o/=m)<1/2.75?h*(7.5625*o*o)+s:o<2/2.75?h*(7.5625*(o-=1.5/2.75)*o+.75)+s:o<2.5/2.75?h*(7.5625*(o-=2.25/2.75)*o+.9375)+s:h*(7.5625*(o-=2.625/2.75)*o+.984375)+s}w.util.ease={easeInQuad:function(o,s,h,m){return h*(o/=m)*o+s},easeOutQuad:function(o,s,h,m){return-h*(o/=m)*(o-2)+s},easeInOutQuad:function(o,s,h,m){return(o/=m/2)<1?h/2*o*o+s:-h/2*(--o*(o-2)-1)+s},easeInCubic:function(o,s,h,m){return h*(o/=m)*o*o+s},easeOutCubic:function(o,s,h,m){return h*((o=o/m-1)*o*o+1)+s},easeInOutCubic:function(o,s,h,m){return(o/=m/2)<1?h/2*o*o*o+s:h/2*((o-=2)*o*o+2)+s},easeInQuart:function(o,s,h,m){return h*(o/=m)*o*o*o+s},easeOutQuart:function(o,s,h,m){return-h*((o=o/m-1)*o*o*o-1)+s},easeInOutQuart:function(o,s,h,m){return(o/=m/2)<1?h/2*o*o*o*o+s:-h/2*((o-=2)*o*o*o-2)+s},easeInQuint:function(o,s,h,m){return h*(o/=m)*o*o*o*o+s},easeOutQuint:function(o,s,h,m){return h*((o=o/m-1)*o*o*o*o+1)+s},easeInOutQuint:function(o,s,h,m){return(o/=m/2)<1?h/2*o*o*o*o*o+s:h/2*((o-=2)*o*o*o*o+2)+s},easeInSine:function(o,s,h,m){return-h*Math.cos(o/m*(Math.PI/2))+h+s},easeOutSine:function(o,s,h,m){return h*Math.sin(o/m*(Math.PI/2))+s},easeInOutSine:function(o,s,h,m){return-h/2*(Math.cos(Math.PI*o/m)-1)+s},easeInExpo:function(o,s,h,m){return o===0?s:h*Math.pow(2,10*(o/m-1))+s},easeOutExpo:function(o,s,h,m){return o===m?s+h:h*(1-Math.pow(2,-10*o/m))+s},easeInOutExpo:function(o,s,h,m){return o===0?s:o===m?s+h:(o/=m/2)<1?h/2*Math.pow(2,10*(o-1))+s:h/2*(2-Math.pow(2,-10*--o))+s},easeInCirc:function(o,s,h,m){return-h*(Math.sqrt(1-(o/=m)*o)-1)+s},easeOutCirc:function(o,s,h,m){return h*Math.sqrt(1-(o=o/m-1)*o)+s},easeInOutCirc:function(o,s,h,m){return(o/=m/2)<1?-h/2*(Math.sqrt(1-o*o)-1)+s:h/2*(Math.sqrt(1-(o-=2)*o)+1)+s},easeInElastic:function(o,s,h,m){var p=0;return o===0?s:(o/=m)==1?s+h:(p||(p=.3*m),-c(l(h,h,p,1.70158),o,m)+s)},easeOutElastic:function(o,s,h,m){var p=0;if(o===0)return s;if((o/=m)==1)return s+h;p||(p=.3*m);var g=l(h,h,p,1.70158);return g.a*Math.pow(2,-10*o)*Math.sin((o*m-g.s)*(2*Math.PI)/g.p)+g.c+s},easeInOutElastic:function(o,s,h,m){var p=0;if(o===0)return s;if((o/=m/2)==2)return s+h;p||(p=m*(.3*1.5));var g=l(h,h,p,1.70158);return o<1?-.5*c(g,o,m)+s:g.a*Math.pow(2,-10*(o-=1))*Math.sin((o*m-g.s)*(2*Math.PI)/g.p)*.5+g.c+s},easeInBack:function(o,s,h,m,p){return p===void 0&&(p=1.70158),h*(o/=m)*o*((p+1)*o-p)+s},easeOutBack:function(o,s,h,m,p){return p===void 0&&(p=1.70158),h*((o=o/m-1)*o*((p+1)*o+p)+1)+s},easeInOutBack:function(o,s,h,m,p){return p===void 0&&(p=1.70158),(o/=m/2)<1?h/2*(o*o*((1+(p*=1.525))*o-p))+s:h/2*((o-=2)*o*((1+(p*=1.525))*o+p)+2)+s},easeInBounce:u,easeOutBounce:f,easeInOutBounce:function(o,s,h,m){return o<m/2?.5*u(2*o,0,h,m)+s:.5*f(2*o-m,0,h,m)+.5*h+s}}}(),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.extend,f=c.util.object.clone,o=c.util.toFixed,s=c.util.parseUnit,h=c.util.multiplyTransformMatrices,m={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},p={stroke:"strokeOpacity",fill:"fillOpacity"},g="font-size",_="clip-path";function E(k){return k in m?m[k]:k}function I(k,F,z,J){var ee,V=Array.isArray(F);if(k!=="fill"&&k!=="stroke"||F!=="none"){if(k==="strokeUniform")return F==="non-scaling-stroke";if(k==="strokeDashArray")F=F==="none"?null:F.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(k==="transformMatrix")F=z&&z.transformMatrix?h(z.transformMatrix,c.parseTransformAttribute(F)):c.parseTransformAttribute(F);else if(k==="visible")F=F!=="none"&&F!=="hidden",z&&z.visible===!1&&(F=!1);else if(k==="opacity")F=parseFloat(F),z&&z.opacity!==void 0&&(F*=z.opacity);else if(k==="textAnchor")F=F==="start"?"left":F==="end"?"right":"center";else if(k==="charSpacing")ee=s(F,J)/J*1e3;else if(k==="paintFirst"){var B=F.indexOf("fill"),X=F.indexOf("stroke");F="fill",(B>-1&&X>-1&&X<B||B===-1&&X>-1)&&(F="stroke")}else{if(k==="href"||k==="xlink:href"||k==="font")return F;if(k==="imageSmoothing")return F==="optimizeQuality";ee=V?F.map(s):s(F,J)}}else F="";return!V&&isNaN(ee)?F:ee}function S(k){return new RegExp("^("+k.join("|")+")\\b","i")}function D(k,F){var z,J,ee,V,B=[];for(ee=0,V=F.length;ee<V;ee++)z=F[ee],J=k.getElementsByTagName(z),B=B.concat(Array.prototype.slice.call(J));return B}function x(k,F){var z,J=!0;return(z=R(k,F.pop()))&&F.length&&(J=function(ee,V){for(var B,X=!0;ee.parentNode&&ee.parentNode.nodeType===1&&V.length;)X&&(B=V.pop()),X=R(ee=ee.parentNode,B);return V.length===0}(k,F)),z&&J&&F.length===0}function R(k,F){var z,J,ee=k.nodeName,V=k.getAttribute("class"),B=k.getAttribute("id");if(z=new RegExp("^"+ee,"i"),F=F.replace(z,""),B&&F.length&&(z=new RegExp("#"+B+"(?![a-zA-Z\\-]+)","i"),F=F.replace(z,"")),V&&F.length)for(J=(V=V.split(" ")).length;J--;)z=new RegExp("\\."+V[J]+"(?![a-zA-Z\\-]+)","i"),F=F.replace(z,"");return F.length===0}function j(k,F){var z;if(k.getElementById&&(z=k.getElementById(F)),z)return z;var J,ee,V,B=k.getElementsByTagName("*");for(ee=0,V=B.length;ee<V;ee++)if(F===(J=B[ee]).getAttribute("id"))return J}c.svgValidTagNamesRegEx=S(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),c.svgViewBoxElementsRegEx=S(["symbol","image","marker","pattern","view","svg"]),c.svgInvalidAncestorsRegEx=S(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),c.svgValidParentsRegEx=S(["symbol","g","a","svg","clipPath","defs"]),c.cssRules={},c.gradientDefs={},c.clipPaths={},c.parseTransformAttribute=function(){function k(X,ne,K){X[K]=Math.tan(c.util.degreesToRadians(ne[0]))}var F=c.iMatrix,z=c.reNum,J=c.commaWsp,ee="(?:(?:(matrix)\\s*\\(\\s*("+z+")"+J+"("+z+")"+J+"("+z+")"+J+"("+z+")"+J+"("+z+")"+J+"("+z+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+z+")(?:"+J+"("+z+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+z+")(?:"+J+"("+z+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+z+")(?:"+J+"("+z+")"+J+"("+z+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+z+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+z+")\\s*\\)))",V=new RegExp("^\\s*(?:(?:"+ee+"(?:"+J+"*"+ee+")*)?)\\s*$"),B=new RegExp(ee,"g");return function(X){var ne=F.concat(),K=[];if(!X||X&&!V.test(X))return ne;X.replace(B,function(ge){var ue=new RegExp(ee).exec(ge).filter(function(he){return!!he}),le=ue[1],fe=ue.slice(2).map(parseFloat);switch(le){case"translate":(function(he,ve){he[4]=ve[0],ve.length===2&&(he[5]=ve[1])})(ne,fe);break;case"rotate":fe[0]=c.util.degreesToRadians(fe[0]),function(he,ve){var Ee=c.util.cos(ve[0]),ye=c.util.sin(ve[0]),Ne=0,tt=0;ve.length===3&&(Ne=ve[1],tt=ve[2]),he[0]=Ee,he[1]=ye,he[2]=-ye,he[3]=Ee,he[4]=Ne-(Ee*Ne-ye*tt),he[5]=tt-(ye*Ne+Ee*tt)}(ne,fe);break;case"scale":(function(he,ve){var Ee=ve[0],ye=ve.length===2?ve[1]:ve[0];he[0]=Ee,he[3]=ye})(ne,fe);break;case"skewX":k(ne,fe,2);break;case"skewY":k(ne,fe,1);break;case"matrix":ne=fe}K.push(ne.concat()),ne=F.concat()});for(var se=K[0];K.length>1;)K.shift(),se=c.util.multiplyTransformMatrices(se,K[0]);return se}}();var U=new RegExp("^\\s*("+c.reNum+"+)\\s*,?\\s*("+c.reNum+"+)\\s*,?\\s*("+c.reNum+"+)\\s*,?\\s*("+c.reNum+"+)\\s*$");function Q(k){if(!c.svgViewBoxElementsRegEx.test(k.nodeName))return{};var F,z,J,ee,V,B,X=k.getAttribute("viewBox"),ne=1,K=1,se=k.getAttribute("width"),ge=k.getAttribute("height"),ue=k.getAttribute("x")||0,le=k.getAttribute("y")||0,fe=k.getAttribute("preserveAspectRatio")||"",he=!X||!(X=X.match(U)),ve=!se||!ge||se==="100%"||ge==="100%",Ee=he&&ve,ye={},Ne="",tt=0,on=0;if(ye.width=0,ye.height=0,ye.toBeParsed=Ee,he&&(ue||le)&&k.parentNode&&k.parentNode.nodeName!=="#document"&&(Ne=" translate("+s(ue)+" "+s(le)+") ",V=(k.getAttribute("transform")||"")+Ne,k.setAttribute("transform",V),k.removeAttribute("x"),k.removeAttribute("y")),Ee)return ye;if(he)return ye.width=s(se),ye.height=s(ge),ye;if(F=-parseFloat(X[1]),z=-parseFloat(X[2]),J=parseFloat(X[3]),ee=parseFloat(X[4]),ye.minX=F,ye.minY=z,ye.viewBoxWidth=J,ye.viewBoxHeight=ee,ve?(ye.width=J,ye.height=ee):(ye.width=s(se),ye.height=s(ge),ne=ye.width/J,K=ye.height/ee),(fe=c.util.parsePreserveAspectRatioAttribute(fe)).alignX!=="none"&&(fe.meetOrSlice==="meet"&&(K=ne=ne>K?K:ne),fe.meetOrSlice==="slice"&&(K=ne=ne>K?ne:K),tt=ye.width-J*ne,on=ye.height-ee*ne,fe.alignX==="Mid"&&(tt/=2),fe.alignY==="Mid"&&(on/=2),fe.alignX==="Min"&&(tt=0),fe.alignY==="Min"&&(on=0)),ne===1&&K===1&&F===0&&z===0&&ue===0&&le===0)return ye;if((ue||le)&&k.parentNode.nodeName!=="#document"&&(Ne=" translate("+s(ue)+" "+s(le)+") "),V=Ne+" matrix("+ne+" 0 0 "+K+" "+(F*ne+tt)+" "+(z*K+on)+") ",k.nodeName==="svg"){for(B=k.ownerDocument.createElementNS(c.svgNS,"g");k.firstChild;)B.appendChild(k.firstChild);k.appendChild(B)}else(B=k).removeAttribute("x"),B.removeAttribute("y"),V=B.getAttribute("transform")+V;return B.setAttribute("transform",V),ye}function Z(k,F){var z="xlink:href",J=j(k,F.getAttribute(z).slice(1));if(J&&J.getAttribute(z)&&Z(k,J),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(V){J&&!F.hasAttribute(V)&&J.hasAttribute(V)&&F.setAttribute(V,J.getAttribute(V))}),!F.children.length)for(var ee=J.cloneNode(!0);ee.firstChild;)F.appendChild(ee.firstChild);F.removeAttribute(z)}c.parseSVGDocument=function(k,F,z,J){if(k){(function(ue){for(var le=D(ue,["use","svg:use"]),fe=0;le.length&&fe<le.length;){var he=le[fe],ve=he.getAttribute("xlink:href")||he.getAttribute("href");if(ve===null)return;var Ee,ye,Ne,tt,on=ve.slice(1),ei=he.getAttribute("x")||0,Lr=he.getAttribute("y")||0,ct=j(ue,on).cloneNode(!0),sn=(ct.getAttribute("transform")||"")+" translate("+ei+", "+Lr+")",Ho=le.length,Nr=c.svgNS;if(Q(ct),/^svg$/i.test(ct.nodeName)){var ir=ct.ownerDocument.createElementNS(Nr,"g");for(ye=0,tt=(Ne=ct.attributes).length;ye<tt;ye++)Ee=Ne.item(ye),ir.setAttributeNS(Nr,Ee.nodeName,Ee.nodeValue);for(;ct.firstChild;)ir.appendChild(ct.firstChild);ct=ir}for(ye=0,tt=(Ne=he.attributes).length;ye<tt;ye++)(Ee=Ne.item(ye)).nodeName!=="x"&&Ee.nodeName!=="y"&&Ee.nodeName!=="xlink:href"&&Ee.nodeName!=="href"&&(Ee.nodeName==="transform"?sn=Ee.nodeValue+" "+sn:ct.setAttribute(Ee.nodeName,Ee.nodeValue));ct.setAttribute("transform",sn),ct.setAttribute("instantiated_by_use","1"),ct.removeAttribute("id"),he.parentNode.replaceChild(ct,he),le.length===Ho&&fe++}})(k);var ee,V,B=c.Object.__uid++,X=Q(k),ne=c.util.toArray(k.getElementsByTagName("*"));if(X.crossOrigin=J&&J.crossOrigin,X.svgUid=B,ne.length===0&&c.isLikelyNode){var K=[];for(ee=0,V=(ne=k.selectNodes('//*[name(.)!="svg"]')).length;ee<V;ee++)K[ee]=ne[ee];ne=K}var se=ne.filter(function(ue){return Q(ue),c.svgValidTagNamesRegEx.test(ue.nodeName.replace("svg:",""))&&!function(le,fe){for(;le&&(le=le.parentNode);)if(le.nodeName&&fe.test(le.nodeName.replace("svg:",""))&&!le.getAttribute("instantiated_by_use"))return!0;return!1}(ue,c.svgInvalidAncestorsRegEx)});if(!se||se&&!se.length)F&&F([],{});else{var ge={};ne.filter(function(ue){return ue.nodeName.replace("svg:","")==="clipPath"}).forEach(function(ue){var le=ue.getAttribute("id");ge[le]=c.util.toArray(ue.getElementsByTagName("*")).filter(function(fe){return c.svgValidTagNamesRegEx.test(fe.nodeName.replace("svg:",""))})}),c.gradientDefs[B]=c.getGradientDefs(k),c.cssRules[B]=c.getCSSRules(k),c.clipPaths[B]=ge,c.parseElements(se,function(ue,le){F&&(F(ue,X,le,ne),delete c.gradientDefs[B],delete c.cssRules[B],delete c.clipPaths[B])},f(X),z,J)}}};var q=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+c.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+c.reNum+"))?\\s+(.*)");u(c,{parseFontDeclaration:function(k,F){var z=k.match(q);if(z){var J=z[1],ee=z[3],V=z[4],B=z[5],X=z[6];J&&(F.fontStyle=J),ee&&(F.fontWeight=isNaN(parseFloat(ee))?ee:parseFloat(ee)),V&&(F.fontSize=s(V)),X&&(F.fontFamily=X),B&&(F.lineHeight=B==="normal"?1:B)}},getGradientDefs:function(k){var F,z=D(k,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),J=0,ee={};for(J=z.length;J--;)(F=z[J]).getAttribute("xlink:href")&&Z(k,F),ee[F.getAttribute("id")]=F;return ee},parseAttributes:function(k,F,z){if(k){var J,ee,V,B={};z===void 0&&(z=k.getAttribute("svgUid")),k.parentNode&&c.svgValidParentsRegEx.test(k.parentNode.nodeName)&&(B=c.parseAttributes(k.parentNode,F,z));var X=F.reduce(function(fe,he){return(J=k.getAttribute(he))&&(fe[he]=J),fe},{}),ne=u(function(fe,he){var ve={};for(var Ee in c.cssRules[he])if(x(fe,Ee.split(" ")))for(var ye in c.cssRules[he][Ee])ve[ye]=c.cssRules[he][Ee][ye];return ve}(k,z),c.parseStyleAttribute(k));X=u(X,ne),ne[_]&&k.setAttribute(_,ne[_]),ee=V=B.fontSize||c.Text.DEFAULT_SVG_FONT_SIZE,X[g]&&(X[g]=ee=s(X[g],V));var K,se,ge={};for(var ue in X)se=I(K=E(ue),X[ue],B,ee),ge[K]=se;ge&&ge.font&&c.parseFontDeclaration(ge.font,ge);var le=u(B,ge);return c.svgValidParentsRegEx.test(k.nodeName)?le:function(fe){for(var he in p)if(fe[p[he]]!==void 0&&fe[he]!==""){if(fe[he]===void 0){if(!c.Object.prototype[he])continue;fe[he]=c.Object.prototype[he]}if(fe[he].indexOf("url(")!==0){var ve=new c.Color(fe[he]);fe[he]=ve.setAlpha(o(ve.getAlpha()*fe[p[he]],2)).toRgba()}}return fe}(le)}},parseElements:function(k,F,z,J,ee){new c.ElementsParser(k,F,z,J,ee).parse()},parseStyleAttribute:function(k){var F={},z=k.getAttribute("style");return z&&(typeof z=="string"?function(J,ee){var V,B;J.replace(/;\s*$/,"").split(";").forEach(function(X){var ne=X.split(":");V=ne[0].trim().toLowerCase(),B=ne[1].trim(),ee[V]=B})}(z,F):function(J,ee){var V,B;for(var X in J)J[X]!==void 0&&(V=X.toLowerCase(),B=J[X],ee[V]=B)}(z,F)),F},parsePointsAttribute:function(k){if(!k)return null;var F,z,J=[];for(F=0,z=(k=(k=k.replace(/,/g," ").trim()).split(/\s+/)).length;F<z;F+=2)J.push({x:parseFloat(k[F]),y:parseFloat(k[F+1])});return J},getCSSRules:function(k){var F,z,J=k.getElementsByTagName("style"),ee={};for(F=0,z=J.length;F<z;F++){var V=J[F].textContent;(V=V.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&V.split("}").filter(function(B){return B.trim()}).forEach(function(B){var X=B.split("{"),ne={},K=X[1].trim().split(";").filter(function(le){return le.trim()});for(F=0,z=K.length;F<z;F++){var se=K[F].split(":"),ge=se[0].trim(),ue=se[1].trim();ne[ge]=ue}(B=X[0].trim()).split(",").forEach(function(le){(le=le.replace(/^svg/i,"").trim())!==""&&(ee[le]?c.util.object.extend(ee[le],ne):ee[le]=c.util.object.clone(ne))})})}return ee},loadSVGFromURL:function(k,F,z,J){k=k.replace(/^\n\s*/,"").trim(),new c.util.request(k,{method:"get",onComplete:function(ee){var V=ee.responseXML;if(!V||!V.documentElement)return F&&F(null),!1;c.parseSVGDocument(V.documentElement,function(B,X,ne,K){F&&F(B,X,ne,K)},z,J)}})},loadSVGFromString:function(k,F,z,J){var ee=new c.window.DOMParser().parseFromString(k.trim(),"text/xml");c.parseSVGDocument(ee.documentElement,function(V,B,X,ne){F(V,B,X,ne)},z,J)}})}(e),w.ElementsParser=function(l,c,u,f,o,s){this.elements=l,this.callback=c,this.options=u,this.reviver=f,this.svgUid=u&&u.svgUid||0,this.parsingOptions=o,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},(Y=w.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},Y.createObjects=function(){var l=this;this.elements.forEach(function(c,u){c.setAttribute("svgUid",l.svgUid),l.createObject(c,u)})},Y.findTag=function(l){return w[w.util.string.capitalize(l.tagName.replace("svg:",""))]},Y.createObject=function(l,c){var u=this.findTag(l);if(u&&u.fromElement)try{u.fromElement(l,this.createCallback(c,l),this.options)}catch(f){w.log(f)}else this.checkIfDone()},Y.createCallback=function(l,c){var u=this;return function(f){var o;u.resolveGradient(f,c,"fill"),u.resolveGradient(f,c,"stroke"),f instanceof w.Image&&f._originalElement&&(o=f.parsePreserveAspectRatioAttribute(c)),f._removeTransformMatrix(o),u.resolveClipPath(f,c),u.reviver&&u.reviver(c,f),u.instances[l]=f,u.checkIfDone()}},Y.extractPropertyDefinition=function(l,c,u){var f=l[c],o=this.regexUrl;if(o.test(f)){o.lastIndex=0;var s=o.exec(f)[1];return o.lastIndex=0,w[u][this.svgUid][s]}},Y.resolveGradient=function(l,c,u){var f=this.extractPropertyDefinition(l,u,"gradientDefs");if(f){var o=c.getAttribute(u+"-opacity"),s=w.Gradient.fromElement(f,l,o,this.options);l.set(u,s)}},Y.createClipPathCallback=function(l,c){return function(u){u._removeTransformMatrix(),u.fillRule=u.clipRule,c.push(u)}},Y.resolveClipPath=function(l,c){var u,f,o,s,h=this.extractPropertyDefinition(l,"clipPath","clipPaths");if(h){o=[],f=w.util.invertTransform(l.calcTransformMatrix());for(var m=h[0].parentNode,p=c;p.parentNode&&p.getAttribute("clip-path")!==l.clipPath;)p=p.parentNode;p.parentNode.appendChild(m);for(var g=0;g<h.length;g++)u=h[g],this.findTag(u).fromElement(u,this.createClipPathCallback(l,o),this.options);h=o.length===1?o[0]:new w.Group(o),s=w.util.multiplyTransformMatrices(f,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,p);var _=w.util.qrDecompose(s);h.flipX=!1,h.flipY=!1,h.set("scaleX",_.scaleX),h.set("scaleY",_.scaleY),h.angle=_.angle,h.skewX=_.skewX,h.skewY=0,h.setPositionByOrigin({x:_.translateX,y:_.translateY},"center","center"),l.clipPath=h}else delete l.clipPath},Y.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(l){return l!=null}),this.callback(this.instances,this.elements))},function(l){var c=l.fabric||(l.fabric={});function u(f,o){this.x=f,this.y=o}c.Point?c.warn("fabric.Point is already defined"):(c.Point=u,u.prototype={type:"point",constructor:u,add:function(f){return new u(this.x+f.x,this.y+f.y)},addEquals:function(f){return this.x+=f.x,this.y+=f.y,this},scalarAdd:function(f){return new u(this.x+f,this.y+f)},scalarAddEquals:function(f){return this.x+=f,this.y+=f,this},subtract:function(f){return new u(this.x-f.x,this.y-f.y)},subtractEquals:function(f){return this.x-=f.x,this.y-=f.y,this},scalarSubtract:function(f){return new u(this.x-f,this.y-f)},scalarSubtractEquals:function(f){return this.x-=f,this.y-=f,this},multiply:function(f){return new u(this.x*f,this.y*f)},multiplyEquals:function(f){return this.x*=f,this.y*=f,this},divide:function(f){return new u(this.x/f,this.y/f)},divideEquals:function(f){return this.x/=f,this.y/=f,this},eq:function(f){return this.x===f.x&&this.y===f.y},lt:function(f){return this.x<f.x&&this.y<f.y},lte:function(f){return this.x<=f.x&&this.y<=f.y},gt:function(f){return this.x>f.x&&this.y>f.y},gte:function(f){return this.x>=f.x&&this.y>=f.y},lerp:function(f,o){return o===void 0&&(o=.5),o=Math.max(Math.min(1,o),0),new u(this.x+(f.x-this.x)*o,this.y+(f.y-this.y)*o)},distanceFrom:function(f){var o=this.x-f.x,s=this.y-f.y;return Math.sqrt(o*o+s*s)},midPointFrom:function(f){return this.lerp(f)},min:function(f){return new u(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new u(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+","+this.y},setXY:function(f,o){return this.x=f,this.y=o,this},setX:function(f){return this.x=f,this},setY:function(f){return this.y=f,this},setFromPoint:function(f){return this.x=f.x,this.y=f.y,this},swap:function(f){var o=this.x,s=this.y;this.x=f.x,this.y=f.y,f.x=o,f.y=s},clone:function(){return new u(this.x,this.y)}})}(e),function(l){var c=l.fabric||(l.fabric={});function u(f){this.status=f,this.points=[]}c.Intersection?c.warn("fabric.Intersection is already defined"):(c.Intersection=u,c.Intersection.prototype={constructor:u,appendPoint:function(f){return this.points.push(f),this},appendPoints:function(f){return this.points=this.points.concat(f),this}},c.Intersection.intersectLineLine=function(f,o,s,h){var m,p=(h.x-s.x)*(f.y-s.y)-(h.y-s.y)*(f.x-s.x),g=(o.x-f.x)*(f.y-s.y)-(o.y-f.y)*(f.x-s.x),_=(h.y-s.y)*(o.x-f.x)-(h.x-s.x)*(o.y-f.y);if(_!==0){var E=p/_,I=g/_;0<=E&&E<=1&&0<=I&&I<=1?(m=new u("Intersection")).appendPoint(new c.Point(f.x+E*(o.x-f.x),f.y+E*(o.y-f.y))):m=new u}else m=new u(p===0||g===0?"Coincident":"Parallel");return m},c.Intersection.intersectLinePolygon=function(f,o,s){var h,m,p,g,_=new u,E=s.length;for(g=0;g<E;g++)h=s[g],m=s[(g+1)%E],p=u.intersectLineLine(f,o,h,m),_.appendPoints(p.points);return _.points.length>0&&(_.status="Intersection"),_},c.Intersection.intersectPolygonPolygon=function(f,o){var s,h=new u,m=f.length;for(s=0;s<m;s++){var p=f[s],g=f[(s+1)%m],_=u.intersectLinePolygon(p,g,o);h.appendPoints(_.points)}return h.points.length>0&&(h.status="Intersection"),h},c.Intersection.intersectPolygonRectangle=function(f,o,s){var h=o.min(s),m=o.max(s),p=new c.Point(m.x,h.y),g=new c.Point(h.x,m.y),_=u.intersectLinePolygon(h,p,f),E=u.intersectLinePolygon(p,m,f),I=u.intersectLinePolygon(m,g,f),S=u.intersectLinePolygon(g,h,f),D=new u;return D.appendPoints(_.points),D.appendPoints(E.points),D.appendPoints(I.points),D.appendPoints(S.points),D.points.length>0&&(D.status="Intersection"),D})}(e),function(l){var c=l.fabric||(l.fabric={});function u(o){o?this._tryParsingColor(o):this.setSource([0,0,0,1])}function f(o,s,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?o+6*(s-o)*h:h<.5?s:h<2/3?o+(s-o)*(2/3-h)*6:o}c.Color?c.warn("fabric.Color is already defined."):(c.Color=u,c.Color.prototype={_tryParsingColor:function(o){var s;o in u.colorNameMap&&(o=u.colorNameMap[o]),o==="transparent"&&(s=[255,255,255,0]),s||(s=u.sourceFromHex(o)),s||(s=u.sourceFromRgb(o)),s||(s=u.sourceFromHsl(o)),s||(s=[0,0,0,1]),s&&this.setSource(s)},_rgbToHsl:function(o,s,h){o/=255,s/=255,h/=255;var m,p,g,_=c.util.array.max([o,s,h]),E=c.util.array.min([o,s,h]);if(g=(_+E)/2,_===E)m=p=0;else{var I=_-E;switch(p=g>.5?I/(2-_-E):I/(_+E),_){case o:m=(s-h)/I+(s<h?6:0);break;case s:m=(h-o)/I+2;break;case h:m=(o-s)/I+4}m/=6}return[Math.round(360*m),Math.round(100*p),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(o){this._source=o},toRgb:function(){var o=this.getSource();return"rgb("+o[0]+","+o[1]+","+o[2]+")"},toRgba:function(){var o=this.getSource();return"rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")"},toHsl:function(){var o=this.getSource(),s=this._rgbToHsl(o[0],o[1],o[2]);return"hsl("+s[0]+","+s[1]+"%,"+s[2]+"%)"},toHsla:function(){var o=this.getSource(),s=this._rgbToHsl(o[0],o[1],o[2]);return"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+o[3]+")"},toHex:function(){var o,s,h,m=this.getSource();return o=(o=m[0].toString(16)).length===1?"0"+o:o,s=(s=m[1].toString(16)).length===1?"0"+s:s,h=(h=m[2].toString(16)).length===1?"0"+h:h,o.toUpperCase()+s.toUpperCase()+h.toUpperCase()},toHexa:function(){var o,s=this.getSource();return o=(o=(o=Math.round(255*s[3])).toString(16)).length===1?"0"+o:o,this.toHex()+o.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(o){var s=this.getSource();return s[3]=o,this.setSource(s),this},toGrayscale:function(){var o=this.getSource(),s=parseInt((.3*o[0]+.59*o[1]+.11*o[2]).toFixed(0),10),h=o[3];return this.setSource([s,s,s,h]),this},toBlackWhite:function(o){var s=this.getSource(),h=(.3*s[0]+.59*s[1]+.11*s[2]).toFixed(0),m=s[3];return o=o||127,h=Number(h)<Number(o)?0:255,this.setSource([h,h,h,m]),this},overlayWith:function(o){o instanceof u||(o=new u(o));var s,h=[],m=this.getAlpha(),p=this.getSource(),g=o.getSource();for(s=0;s<3;s++)h.push(Math.round(.5*p[s]+.5*g[s]));return h[3]=m,this.setSource(h),this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,c.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},c.Color.fromRgb=function(o){return u.fromSource(u.sourceFromRgb(o))},c.Color.sourceFromRgb=function(o){var s=o.match(u.reRGBa);if(s){var h=parseInt(s[1],10)/(/%$/.test(s[1])?100:1)*(/%$/.test(s[1])?255:1),m=parseInt(s[2],10)/(/%$/.test(s[2])?100:1)*(/%$/.test(s[2])?255:1),p=parseInt(s[3],10)/(/%$/.test(s[3])?100:1)*(/%$/.test(s[3])?255:1);return[parseInt(h,10),parseInt(m,10),parseInt(p,10),s[4]?parseFloat(s[4]):1]}},c.Color.fromRgba=u.fromRgb,c.Color.fromHsl=function(o){return u.fromSource(u.sourceFromHsl(o))},c.Color.sourceFromHsl=function(o){var s=o.match(u.reHSLa);if(s){var h,m,p,g=(parseFloat(s[1])%360+360)%360/360,_=parseFloat(s[2])/(/%$/.test(s[2])?100:1),E=parseFloat(s[3])/(/%$/.test(s[3])?100:1);if(_===0)h=m=p=E;else{var I=E<=.5?E*(_+1):E+_-E*_,S=2*E-I;h=f(S,I,g+1/3),m=f(S,I,g),p=f(S,I,g-1/3)}return[Math.round(255*h),Math.round(255*m),Math.round(255*p),s[4]?parseFloat(s[4]):1]}},c.Color.fromHsla=u.fromHsl,c.Color.fromHex=function(o){return u.fromSource(u.sourceFromHex(o))},c.Color.sourceFromHex=function(o){if(o.match(u.reHex)){var s=o.slice(o.indexOf("#")+1),h=s.length===3||s.length===4,m=s.length===8||s.length===4,p=h?s.charAt(0)+s.charAt(0):s.substring(0,2),g=h?s.charAt(1)+s.charAt(1):s.substring(2,4),_=h?s.charAt(2)+s.charAt(2):s.substring(4,6),E=m?h?s.charAt(3)+s.charAt(3):s.substring(6,8):"FF";return[parseInt(p,16),parseInt(g,16),parseInt(_,16),parseFloat((parseInt(E,16)/255).toFixed(2))]}},c.Color.fromSource=function(o){var s=new u;return s.setSource(o),s})}(e),function(l){var c=l.fabric||(l.fabric={}),u=["e","se","s","sw","w","nw","n","ne","e"],f=["ns","nesw","ew","nwse"],o={},s="left",h="top",m="right",p="bottom",g="center",_={top:p,bottom:h,left:m,right:s,center:g},E=c.util.radiansToDegrees,I=Math.sign||function(V){return(V>0)-(V<0)||+V};function S(V,B){var X=V.angle+E(Math.atan2(B.y,B.x))+360;return Math.round(X%360/45)}function D(V,B){var X=B.transform.target,ne=X.canvas,K=c.util.object.clone(B);K.target=X,ne&&ne.fire("object:"+V,K),X.fire(V,B)}function x(V,B){var X=B.canvas,ne=V[X.uniScaleKey];return X.uniformScaling&&!ne||!X.uniformScaling&&ne}function R(V){return V.originX===g&&V.originY===g}function j(V,B,X){var ne=V.lockScalingX,K=V.lockScalingY;return!((!ne||!K)&&(B||!ne&&!K||!X)&&(!ne||B!=="x")&&(!K||B!=="y"))}function U(V,B,X,ne){return{e:V,transform:B,pointer:{x:X,y:ne}}}function Q(V){return function(B,X,ne,K){var se=X.target,ge=se.getCenterPoint(),ue=se.translateToOriginPoint(ge,X.originX,X.originY),le=V(B,X,ne,K);return se.setPositionByOrigin(ue,X.originX,X.originY),le}}function Z(V,B){return function(X,ne,K,se){var ge=B(X,ne,K,se);return ge&&D(V,U(X,ne,K,se)),ge}}function q(V,B,X,ne,K){var se=V.target,ge=se.controls[V.corner],ue=se.canvas.getZoom(),le=se.padding/ue,fe=se.toLocalPoint(new c.Point(ne,K),B,X);return fe.x>=le&&(fe.x-=le),fe.x<=-le&&(fe.x+=le),fe.y>=le&&(fe.y-=le),fe.y<=le&&(fe.y+=le),fe.x-=ge.offsetX,fe.y-=ge.offsetY,fe}function k(V){return V.flipX!==V.flipY}function F(V,B,X,ne,K){if(V[B]!==0){var se=K/V._getTransformedDimensions()[ne]*V[X];V.set(X,se)}}function z(V,B,X,ne){var K,se=B.target,ge=se._getTransformedDimensions(0,se.skewY),ue=q(B,B.originX,B.originY,X,ne),le=Math.abs(2*ue.x)-ge.x,fe=se.skewX;le<2?K=0:(K=E(Math.atan2(le/se.scaleX,ge.y/se.scaleY)),B.originX===s&&B.originY===p&&(K=-K),B.originX===m&&B.originY===h&&(K=-K),k(se)&&(K=-K));var he=fe!==K;if(he){var ve=se._getTransformedDimensions().y;se.set("skewX",K),F(se,"skewY","scaleY","y",ve)}return he}function J(V,B,X,ne){var K,se=B.target,ge=se._getTransformedDimensions(se.skewX,0),ue=q(B,B.originX,B.originY,X,ne),le=Math.abs(2*ue.y)-ge.y,fe=se.skewY;le<2?K=0:(K=E(Math.atan2(le/se.scaleY,ge.x/se.scaleX)),B.originX===s&&B.originY===p&&(K=-K),B.originX===m&&B.originY===h&&(K=-K),k(se)&&(K=-K));var he=fe!==K;if(he){var ve=se._getTransformedDimensions().x;se.set("skewY",K),F(se,"skewX","scaleX","x",ve)}return he}function ee(V,B,X,ne,K){K=K||{};var se,ge,ue,le,fe,he,ve=B.target,Ee=ve.lockScalingX,ye=ve.lockScalingY,Ne=K.by,tt=x(V,ve),on=j(ve,Ne,tt),ei=B.gestureScale;if(on)return!1;if(ei)ge=B.scaleX*ei,ue=B.scaleY*ei;else{if(se=q(B,B.originX,B.originY,X,ne),fe=Ne!=="y"?I(se.x):1,he=Ne!=="x"?I(se.y):1,B.signX||(B.signX=fe),B.signY||(B.signY=he),ve.lockScalingFlip&&(B.signX!==fe||B.signY!==he))return!1;if(le=ve._getTransformedDimensions(),tt&&!Ne){var Lr=Math.abs(se.x)+Math.abs(se.y),ct=B.original,sn=Lr/(Math.abs(le.x*ct.scaleX/ve.scaleX)+Math.abs(le.y*ct.scaleY/ve.scaleY));ge=ct.scaleX*sn,ue=ct.scaleY*sn}else ge=Math.abs(se.x*ve.scaleX/le.x),ue=Math.abs(se.y*ve.scaleY/le.y);R(B)&&(ge*=2,ue*=2),B.signX!==fe&&Ne!=="y"&&(B.originX=_[B.originX],ge*=-1,B.signX=fe),B.signY!==he&&Ne!=="x"&&(B.originY=_[B.originY],ue*=-1,B.signY=he)}var Ho=ve.scaleX,Nr=ve.scaleY;return Ne?(Ne==="x"&&ve.set("scaleX",ge),Ne==="y"&&ve.set("scaleY",ue)):(!Ee&&ve.set("scaleX",ge),!ye&&ve.set("scaleY",ue)),Ho!==ve.scaleX||Nr!==ve.scaleY}o.scaleCursorStyleHandler=function(V,B,X){var ne=x(V,X),K="";if(B.x!==0&&B.y===0?K="x":B.x===0&&B.y!==0&&(K="y"),j(X,K,ne))return"not-allowed";var se=S(X,B);return u[se]+"-resize"},o.skewCursorStyleHandler=function(V,B,X){var ne="not-allowed";if(B.x!==0&&X.lockSkewingY||B.y!==0&&X.lockSkewingX)return ne;var K=S(X,B)%4;return f[K]+"-resize"},o.scaleSkewCursorStyleHandler=function(V,B,X){return V[X.canvas.altActionKey]?o.skewCursorStyleHandler(V,B,X):o.scaleCursorStyleHandler(V,B,X)},o.rotationWithSnapping=Z("rotating",Q(function(V,B,X,ne){var K=B,se=K.target,ge=se.translateToOriginPoint(se.getCenterPoint(),K.originX,K.originY);if(se.lockRotation)return!1;var ue,le=Math.atan2(K.ey-ge.y,K.ex-ge.x),fe=Math.atan2(ne-ge.y,X-ge.x),he=E(fe-le+K.theta);if(se.snapAngle>0){var ve=se.snapAngle,Ee=se.snapThreshold||ve,ye=Math.ceil(he/ve)*ve,Ne=Math.floor(he/ve)*ve;Math.abs(he-Ne)<Ee?he=Ne:Math.abs(he-ye)<Ee&&(he=ye)}return he<0&&(he=360+he),he%=360,ue=se.angle!==he,se.angle=he,ue})),o.scalingEqually=Z("scaling",Q(function(V,B,X,ne){return ee(V,B,X,ne)})),o.scalingX=Z("scaling",Q(function(V,B,X,ne){return ee(V,B,X,ne,{by:"x"})})),o.scalingY=Z("scaling",Q(function(V,B,X,ne){return ee(V,B,X,ne,{by:"y"})})),o.scalingYOrSkewingX=function(V,B,X,ne){return V[B.target.canvas.altActionKey]?o.skewHandlerX(V,B,X,ne):o.scalingY(V,B,X,ne)},o.scalingXOrSkewingY=function(V,B,X,ne){return V[B.target.canvas.altActionKey]?o.skewHandlerY(V,B,X,ne):o.scalingX(V,B,X,ne)},o.changeWidth=Z("resizing",Q(function(V,B,X,ne){var K=B.target,se=q(B,B.originX,B.originY,X,ne),ge=K.strokeWidth/(K.strokeUniform?K.scaleX:1),ue=R(B)?2:1,le=K.width,fe=Math.abs(se.x*ue/K.scaleX)-ge;return K.set("width",Math.max(fe,0)),le!==fe})),o.skewHandlerX=function(V,B,X,ne){var K,se=B.target,ge=se.skewX,ue=B.originY;return!se.lockSkewingX&&(ge===0?K=q(B,g,g,X,ne).x>0?s:m:(ge>0&&(K=ue===h?s:m),ge<0&&(K=ue===h?m:s),k(se)&&(K=K===s?m:s)),B.originX=K,Z("skewing",Q(z))(V,B,X,ne))},o.skewHandlerY=function(V,B,X,ne){var K,se=B.target,ge=se.skewY,ue=B.originX;return!se.lockSkewingY&&(ge===0?K=q(B,g,g,X,ne).y>0?h:p:(ge>0&&(K=ue===s?h:p),ge<0&&(K=ue===s?p:h),k(se)&&(K=K===h?p:h)),B.originY=K,Z("skewing",Q(J))(V,B,X,ne))},o.dragHandler=function(V,B,X,ne){var K=B.target,se=X-B.offsetX,ge=ne-B.offsetY,ue=!K.get("lockMovementX")&&K.left!==se,le=!K.get("lockMovementY")&&K.top!==ge;return ue&&K.set("left",se),le&&K.set("top",ge),(ue||le)&&D("moving",U(V,B,X,ne)),ue||le},o.scaleOrSkewActionName=function(V,B,X){var ne=V[X.canvas.altActionKey];return B.x===0?ne?"skewX":"scaleY":B.y===0?ne?"skewY":"scaleX":void 0},o.rotationStyleHandler=function(V,B,X){return X.lockRotation?"not-allowed":B.cursorStyle},o.fireEvent=D,o.wrapWithFixedAnchor=Q,o.wrapWithFireEvent=Z,o.getLocalPoint=q,c.controlsUtils=o}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.degreesToRadians,f=c.controlsUtils;f.renderCircleControl=function(o,s,h,m,p){m=m||{};var g,_=this.sizeX||m.cornerSize||p.cornerSize,E=this.sizeY||m.cornerSize||p.cornerSize,I=m.transparentCorners!==void 0?m.transparentCorners:p.transparentCorners,S=I?"stroke":"fill",D=!I&&(m.cornerStrokeColor||p.cornerStrokeColor),x=s,R=h;o.save(),o.fillStyle=m.cornerColor||p.cornerColor,o.strokeStyle=m.cornerStrokeColor||p.cornerStrokeColor,_>E?(g=_,o.scale(1,E/_),R=h*_/E):E>_?(g=E,o.scale(_/E,1),x=s*E/_):g=_,o.lineWidth=1,o.beginPath(),o.arc(x,R,g/2,0,2*Math.PI,!1),o[S](),D&&o.stroke(),o.restore()},f.renderSquareControl=function(o,s,h,m,p){m=m||{};var g=this.sizeX||m.cornerSize||p.cornerSize,_=this.sizeY||m.cornerSize||p.cornerSize,E=m.transparentCorners!==void 0?m.transparentCorners:p.transparentCorners,I=E?"stroke":"fill",S=!E&&(m.cornerStrokeColor||p.cornerStrokeColor),D=g/2,x=_/2;o.save(),o.fillStyle=m.cornerColor||p.cornerColor,o.strokeStyle=m.cornerStrokeColor||p.cornerStrokeColor,o.lineWidth=1,o.translate(s,h),o.rotate(u(p.angle)),o[I+"Rect"](-D,-x,g,_),S&&o.strokeRect(-D,-x,g,_),o.restore()}}(e),function(l){var c=l.fabric||(l.fabric={});c.Control=function(u){for(var f in u)this[f]=u[f]},c.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(u,f){return f.cursorStyle},getActionName:function(u,f){return f.actionName},getVisibility:function(u,f){var o=u._controlsVisibility;return o&&o[f]!==void 0?o[f]:this.visible},setVisibility:function(u){this.visible=u},positionHandler:function(u,f){return c.util.transformPoint({x:this.x*u.x+this.offsetX,y:this.y*u.y+this.offsetY},f)},calcCornerCoords:function(u,f,o,s,h){var m,p,g,_,E=h?this.touchSizeX:this.sizeX,I=h?this.touchSizeY:this.sizeY;if(E&&I&&E!==I){var S=Math.atan2(I,E),D=Math.sqrt(E*E+I*I)/2,x=S-c.util.degreesToRadians(u),R=Math.PI/2-S-c.util.degreesToRadians(u);m=D*c.util.cos(x),p=D*c.util.sin(x),g=D*c.util.cos(R),_=D*c.util.sin(R)}else D=.7071067812*(E&&I?E:f),x=c.util.degreesToRadians(45-u),m=g=D*c.util.cos(x),p=_=D*c.util.sin(x);return{tl:{x:o-_,y:s-g},tr:{x:o+m,y:s-p},bl:{x:o-m,y:s+p},br:{x:o+_,y:s+g}}},render:function(u,f,o,s,h){((s=s||{}).cornerStyle||h.cornerStyle)==="circle"?c.controlsUtils.renderCircleControl.call(this,u,f,o,s,h):c.controlsUtils.renderSquareControl.call(this,u,f,o,s,h)}}}(e),function(){function l(u,f){var o,s,h,m,p=u.getAttribute("style"),g=u.getAttribute("offset")||0;if(g=(g=parseFloat(g)/(/%$/.test(g)?100:1))<0?0:g>1?1:g,p){var _=p.split(/\s*;\s*/);for(_[_.length-1]===""&&_.pop(),m=_.length;m--;){var E=_[m].split(/\s*:\s*/),I=E[0].trim(),S=E[1].trim();I==="stop-color"?o=S:I==="stop-opacity"&&(h=S)}}return o||(o=u.getAttribute("stop-color")||"rgb(0,0,0)"),h||(h=u.getAttribute("stop-opacity")),s=(o=new w.Color(o)).getAlpha(),h=isNaN(parseFloat(h))?1:parseFloat(h),h*=s*f,{offset:g,color:o.toRgb(),opacity:h}}var c=w.util.object.clone;w.Gradient=w.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(u){u||(u={}),u.coords||(u.coords={});var f,o=this;Object.keys(u).forEach(function(s){o[s]=u[s]}),this.id?this.id+="_"+w.Object.__uid++:this.id=w.Object.__uid++,f={x1:u.coords.x1||0,y1:u.coords.y1||0,x2:u.coords.x2||0,y2:u.coords.y2||0},this.type==="radial"&&(f.r1=u.coords.r1||0,f.r2=u.coords.r2||0),this.coords=f,this.colorStops=u.colorStops.slice()},addColorStop:function(u){for(var f in u){var o=new w.Color(u[f]);this.colorStops.push({offset:parseFloat(f),color:o.toRgb(),opacity:o.getAlpha()})}return this},toObject:function(u){var f={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return w.util.populateWithProperties(this,f,u),f},toSVG:function(u,f){var o,s,h,m,p=c(this.coords,!0),g=(f=f||{},c(this.colorStops,!0)),_=p.r1>p.r2,E=this.gradientTransform?this.gradientTransform.concat():w.iMatrix.concat(),I=-this.offsetX,S=-this.offsetY,D=!!f.additionalTransform,x=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(g.sort(function(Q,Z){return Q.offset-Z.offset}),x==="objectBoundingBox"?(I/=u.width,S/=u.height):(I+=u.width/2,S+=u.height/2),u.type==="path"&&this.gradientUnits!=="percentage"&&(I-=u.pathOffset.x,S-=u.pathOffset.y),E[4]-=I,E[5]-=S,m='id="SVGID_'+this.id+'" gradientUnits="'+x+'"',m+=' gradientTransform="'+(D?f.additionalTransform+" ":"")+w.util.matrixToSVG(E)+'" ',this.type==="linear"?h=["<linearGradient ",m,' x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,`">
`]:this.type==="radial"&&(h=["<radialGradient ",m,' cx="',_?p.x1:p.x2,'" cy="',_?p.y1:p.y2,'" r="',_?p.r1:p.r2,'" fx="',_?p.x2:p.x1,'" fy="',_?p.y2:p.y1,`">
`]),this.type==="radial"){if(_)for((g=g.concat()).reverse(),o=0,s=g.length;o<s;o++)g[o].offset=1-g[o].offset;var R=Math.min(p.r1,p.r2);if(R>0){var j=R/Math.max(p.r1,p.r2);for(o=0,s=g.length;o<s;o++)g[o].offset+=j*(1-g[o].offset)}}for(o=0,s=g.length;o<s;o++){var U=g[o];h.push("<stop ",'offset="',100*U.offset+"%",'" style="stop-color:',U.color,U.opacity!==void 0?";stop-opacity: "+U.opacity:";",`"/>
`)}return h.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),h.join("")},toLive:function(u){var f,o,s,h=w.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?f=u.createLinearGradient(h.x1,h.y1,h.x2,h.y2):this.type==="radial"&&(f=u.createRadialGradient(h.x1,h.y1,h.r1,h.x2,h.y2,h.r2)),o=0,s=this.colorStops.length;o<s;o++){var m=this.colorStops[o].color,p=this.colorStops[o].opacity,g=this.colorStops[o].offset;p!==void 0&&(m=new w.Color(m).setAlpha(p).toRgba()),f.addColorStop(g,m)}return f}}}),w.util.object.extend(w.Gradient,{fromElement:function(u,f,o,s){var h=parseFloat(o)/(/%$/.test(o)?100:1);h=h<0?0:h>1?1:h,isNaN(h)&&(h=1);var m,p,g,_,E=u.getElementsByTagName("stop"),I=u.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",S=u.getAttribute("gradientTransform")||"",D=[],x=0,R=0;for(u.nodeName==="linearGradient"||u.nodeName==="LINEARGRADIENT"?(m="linear",p=function(j){return{x1:j.getAttribute("x1")||0,y1:j.getAttribute("y1")||0,x2:j.getAttribute("x2")||"100%",y2:j.getAttribute("y2")||0}}(u)):(m="radial",p=function(j){return{x1:j.getAttribute("fx")||j.getAttribute("cx")||"50%",y1:j.getAttribute("fy")||j.getAttribute("cy")||"50%",r1:0,x2:j.getAttribute("cx")||"50%",y2:j.getAttribute("cy")||"50%",r2:j.getAttribute("r")||"50%"}}(u)),g=E.length;g--;)D.push(l(E[g],h));return _=w.parseTransformAttribute(S),function(j,U,Q,Z){var q,k;Object.keys(U).forEach(function(F){(q=U[F])==="Infinity"?k=1:q==="-Infinity"?k=0:(k=parseFloat(U[F],10),typeof q=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(q)&&(k*=.01,Z==="pixels"&&(F!=="x1"&&F!=="x2"&&F!=="r2"||(k*=Q.viewBoxWidth||Q.width),F!=="y1"&&F!=="y2"||(k*=Q.viewBoxHeight||Q.height)))),U[F]=k})}(0,p,s,I),I==="pixels"&&(x=-f.left,R=-f.top),new w.Gradient({id:u.getAttribute("id"),type:m,coords:p,colorStops:D,gradientUnits:I,gradientTransform:_,offsetX:x,offsetY:R})}})}(),H=w.util.toFixed,w.Pattern=w.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(l,c){if(l||(l={}),this.id=w.Object.__uid++,this.setOptions(l),!l.source||l.source&&typeof l.source!="string")c&&c(this);else{var u=this;this.source=w.util.createImage(),w.util.loadImage(l.source,function(f,o){u.source=f,c&&c(u,o)},null,this.crossOrigin)}},toObject:function(l){var c,u,f=w.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?c=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(c=this.source.toDataURL()),u={type:"pattern",source:c,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:H(this.offsetX,f),offsetY:H(this.offsetY,f),patternTransform:this.patternTransform?this.patternTransform.concat():null},w.util.populateWithProperties(this,u,l),u},toSVG:function(l){var c=typeof this.source=="function"?this.source():this.source,u=c.width/l.width,f=c.height/l.height,o=this.offsetX/l.width,s=this.offsetY/l.height,h="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(f=1,s&&(f+=Math.abs(s))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(u=1,o&&(u+=Math.abs(o))),c.src?h=c.src:c.toDataURL&&(h=c.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+o+'" y="'+s+'" width="'+u+'" height="'+f+`">
<image x="0" y="0" width="`+c.width+'" height="'+c.height+'" xlink:href="'+h+`"></image>
</pattern>
`},setOptions:function(l){for(var c in l)this[c]=l[c]},toLive:function(l){var c=this.source;return!c||c.src!==void 0&&(!c.complete||c.naturalWidth===0||c.naturalHeight===0)?"":l.createPattern(c,this.repeat)}}),function(l){var c=l.fabric||(l.fabric={}),u=c.util.toFixed;c.Shadow?c.warn("fabric.Shadow is already defined."):(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(f){for(var o in typeof f=="string"&&(f=this._parseShadow(f)),f)this[o]=f[o];this.id=c.Object.__uid++},_parseShadow:function(f){var o=f.trim(),s=c.Shadow.reOffsetsAndBlur.exec(o)||[];return{color:(o.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(s[1],10)||0,offsetY:parseFloat(s[2],10)||0,blur:parseFloat(s[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(f){var o=40,s=40,h=c.Object.NUM_FRACTION_DIGITS,m=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-f.angle)),p=new c.Color(this.color);return f.width&&f.height&&(o=100*u((Math.abs(m.x)+this.blur)/f.width,h)+20,s=100*u((Math.abs(m.y)+this.blur)/f.height,h)+20),f.flipX&&(m.x*=-1),f.flipY&&(m.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+o+'%" width="'+(100+2*o)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+u(this.blur?this.blur/2:0,h)+`"></feGaussianBlur>
	<feOffset dx="`+u(m.x,h)+'" dy="'+u(m.y,h)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+p.toRgb()+'" flood-opacity="'+p.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var f={},o=c.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(s){this[s]!==o[s]&&(f[s]=this[s])},this),f}}),c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(w.StaticCanvas)w.warn("fabric.StaticCanvas is already defined.");else{var l=w.util.object.extend,c=w.util.getElementOffset,u=w.util.removeFromArray,f=w.util.toFixed,o=w.util.transformPoint,s=w.util.invertTransform,h=w.util.getNodeCanvas,m=w.util.createCanvasElement,p=new Error("Could not initialize `canvas` element");w.StaticCanvas=w.util.createClass(w.CommonMethods,{initialize:function(g,_){_||(_={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(g,_)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:w.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(g,_){var E=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(g),this._initOptions(_),this.interactive||this._initRetinaScaling(),_.overlayImage&&this.setOverlayImage(_.overlayImage,E),_.backgroundImage&&this.setBackgroundImage(_.backgroundImage,E),_.backgroundColor&&this.setBackgroundColor(_.backgroundColor,E),_.overlayColor&&this.setOverlayColor(_.overlayColor,E),this.calcOffset()},_isRetinaScaling:function(){return w.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,w.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var g=w.devicePixelRatio;this.__initRetinaScaling(g,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(g,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(g,_,E){_.setAttribute("width",this.width*g),_.setAttribute("height",this.height*g),E.scale(g,g)},calcOffset:function(){return this._offset=c(this.lowerCanvasEl),this},setOverlayImage:function(g,_,E){return this.__setBgOverlayImage("overlayImage",g,_,E)},setBackgroundImage:function(g,_,E){return this.__setBgOverlayImage("backgroundImage",g,_,E)},setOverlayColor:function(g,_){return this.__setBgOverlayColor("overlayColor",g,_)},setBackgroundColor:function(g,_){return this.__setBgOverlayColor("backgroundColor",g,_)},__setBgOverlayImage:function(g,_,E,I){return typeof _=="string"?w.util.loadImage(_,function(S,D){if(S){var x=new w.Image(S,I);this[g]=x,x.canvas=this}E&&E(S,D)},this,I&&I.crossOrigin):(I&&_.setOptions(I),this[g]=_,_&&(_.canvas=this),E&&E(_,!1)),this},__setBgOverlayColor:function(g,_,E){return this[g]=_,this._initGradient(_,g),this._initPattern(_,g,E),this},_createCanvasElement:function(){var g=m();if(!g||(g.style||(g.style={}),g.getContext===void 0))throw p;return g},_initOptions:function(g){var _=this.lowerCanvasEl;this._setOptions(g),this.width=this.width||parseInt(_.width,10)||0,this.height=this.height||parseInt(_.height,10)||0,this.lowerCanvasEl.style&&(_.width=this.width,_.height=this.height,_.style.width=this.width+"px",_.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(g){g&&g.getContext?this.lowerCanvasEl=g:this.lowerCanvasEl=w.util.getById(g)||this._createCanvasElement(),w.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(g,_){return this.setDimensions({width:g},_)},setHeight:function(g,_){return this.setDimensions({height:g},_)},setDimensions:function(g,_){var E;for(var I in _=_||{},g)E=g[I],_.cssOnly||(this._setBackstoreDimension(I,g[I]),E+="px",this.hasLostContext=!0),_.backstoreOnly||this._setCssDimension(I,E);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),_.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(g,_){return this.lowerCanvasEl[g]=_,this.upperCanvasEl&&(this.upperCanvasEl[g]=_),this.cacheCanvasEl&&(this.cacheCanvasEl[g]=_),this[g]=_,this},_setCssDimension:function(g,_){return this.lowerCanvasEl.style[g]=_,this.upperCanvasEl&&(this.upperCanvasEl.style[g]=_),this.wrapperEl&&(this.wrapperEl.style[g]=_),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(g){var _,E,I,S=this._activeObject,D=this.backgroundImage,x=this.overlayImage;for(this.viewportTransform=g,E=0,I=this._objects.length;E<I;E++)(_=this._objects[E]).group||_.setCoords(!0);return S&&S.setCoords(),D&&D.setCoords(!0),x&&x.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(g,_){var E=g,I=this.viewportTransform.slice(0);g=o(g,s(this.viewportTransform)),I[0]=_,I[3]=_;var S=o(g,I);return I[4]+=E.x-S.x,I[5]+=E.y-S.y,this.setViewportTransform(I)},setZoom:function(g){return this.zoomToPoint(new w.Point(0,0),g),this},absolutePan:function(g){var _=this.viewportTransform.slice(0);return _[4]=-g.x,_[5]=-g.y,this.setViewportTransform(_)},relativePan:function(g){return this.absolutePan(new w.Point(-g.x-this.viewportTransform[4],-g.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(g){this.stateful&&g.setupState(),g._set("canvas",this),g.setCoords(),this.fire("object:added",{target:g}),g.fire("added")},_onObjectRemoved:function(g){this.fire("object:removed",{target:g}),g.fire("removed"),delete g.canvas},clearContext:function(g){return g.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var g=this.contextContainer;return this.renderCanvas(g,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=w.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var g={},_=this.width,E=this.height,I=s(this.viewportTransform);return g.tl=o({x:0,y:0},I),g.br=o({x:_,y:E},I),g.tr=new w.Point(g.br.x,g.tl.y),g.bl=new w.Point(g.tl.x,g.br.y),this.vptCoords=g,g},cancelRequestedRender:function(){this.isRendering&&(w.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(g,_){var E=this.viewportTransform,I=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(g),w.util.setImageSmoothing(g,this.imageSmoothingEnabled),this.fire("before:render",{ctx:g}),this._renderBackground(g),g.save(),g.transform(E[0],E[1],E[2],E[3],E[4],E[5]),this._renderObjects(g,_),g.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),I&&(I.canvas=this,I.shouldCache(),I._transformDone=!0,I.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(g)),this._renderOverlay(g),this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),this.fire("after:render",{ctx:g})},drawClipPathOnCanvas:function(g){var _=this.viewportTransform,E=this.clipPath;g.save(),g.transform(_[0],_[1],_[2],_[3],_[4],_[5]),g.globalCompositeOperation="destination-in",E.transform(g),g.scale(1/E.zoomX,1/E.zoomY),g.drawImage(E._cacheCanvas,-E.cacheTranslationX,-E.cacheTranslationY),g.restore()},_renderObjects:function(g,_){var E,I;for(E=0,I=_.length;E<I;++E)_[E]&&_[E].render(g)},_renderBackgroundOrOverlay:function(g,_){var E=this[_+"Color"],I=this[_+"Image"],S=this.viewportTransform,D=this[_+"Vpt"];if(E||I){if(E){g.save(),g.beginPath(),g.moveTo(0,0),g.lineTo(this.width,0),g.lineTo(this.width,this.height),g.lineTo(0,this.height),g.closePath(),g.fillStyle=E.toLive?E.toLive(g,this):E,D&&g.transform(S[0],S[1],S[2],S[3],S[4],S[5]),g.transform(1,0,0,1,E.offsetX||0,E.offsetY||0);var x=E.gradientTransform||E.patternTransform;x&&g.transform(x[0],x[1],x[2],x[3],x[4],x[5]),g.fill(),g.restore()}I&&(g.save(),D&&g.transform(S[0],S[1],S[2],S[3],S[4],S[5]),I.render(g),g.restore())}},_renderBackground:function(g){this._renderBackgroundOrOverlay(g,"background")},_renderOverlay:function(g){this._renderBackgroundOrOverlay(g,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new w.Point(this.width/2,this.height/2)},centerObjectH:function(g){return this._centerObject(g,new w.Point(this.getCenterPoint().x,g.getCenterPoint().y))},centerObjectV:function(g){return this._centerObject(g,new w.Point(g.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(g){var _=this.getCenterPoint();return this._centerObject(g,_)},viewportCenterObject:function(g){var _=this.getVpCenter();return this._centerObject(g,_)},viewportCenterObjectH:function(g){var _=this.getVpCenter();return this._centerObject(g,new w.Point(_.x,g.getCenterPoint().y)),this},viewportCenterObjectV:function(g){var _=this.getVpCenter();return this._centerObject(g,new w.Point(g.getCenterPoint().x,_.y))},getVpCenter:function(){var g=this.getCenterPoint(),_=s(this.viewportTransform);return o(g,_)},_centerObject:function(g,_){return g.setPositionByOrigin(_,"center","center"),g.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(g){return this.toDatalessObject(g)},toObject:function(g){return this._toObjectMethod("toObject",g)},toDatalessObject:function(g){return this._toObjectMethod("toDatalessObject",g)},_toObjectMethod:function(g,_){var E=this.clipPath,I={version:w.version,objects:this._toObjects(g,_)};return E&&!E.excludeFromExport&&(I.clipPath=this._toObject(this.clipPath,g,_)),l(I,this.__serializeBgOverlay(g,_)),w.util.populateWithProperties(this,I,_),I},_toObjects:function(g,_){return this._objects.filter(function(E){return!E.excludeFromExport}).map(function(E){return this._toObject(E,g,_)},this)},_toObject:function(g,_,E){var I;this.includeDefaultValues||(I=g.includeDefaultValues,g.includeDefaultValues=!1);var S=g[_](E);return this.includeDefaultValues||(g.includeDefaultValues=I),S},__serializeBgOverlay:function(g,_){var E={},I=this.backgroundImage,S=this.overlayImage,D=this.backgroundColor,x=this.overlayColor;return D&&D.toObject?D.excludeFromExport||(E.background=D.toObject(_)):D&&(E.background=D),x&&x.toObject?x.excludeFromExport||(E.overlay=x.toObject(_)):x&&(E.overlay=x),I&&!I.excludeFromExport&&(E.backgroundImage=this._toObject(I,g,_)),S&&!S.excludeFromExport&&(E.overlayImage=this._toObject(S,g,_)),E},svgViewportTransformation:!0,toSVG:function(g,_){g||(g={}),g.reviver=_;var E=[];return this._setSVGPreamble(E,g),this._setSVGHeader(E,g),this.clipPath&&E.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(E,"background"),this._setSVGBgOverlayImage(E,"backgroundImage",_),this._setSVGObjects(E,_),this.clipPath&&E.push(`</g>
`),this._setSVGBgOverlayColor(E,"overlay"),this._setSVGBgOverlayImage(E,"overlayImage",_),E.push("</svg>"),E.join("")},_setSVGPreamble:function(g,_){_.suppressPreamble||g.push('<?xml version="1.0" encoding="',_.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(g,_){var E,I=_.width||this.width,S=_.height||this.height,D='viewBox="0 0 '+this.width+" "+this.height+'" ',x=w.Object.NUM_FRACTION_DIGITS;_.viewBox?D='viewBox="'+_.viewBox.x+" "+_.viewBox.y+" "+_.viewBox.width+" "+_.viewBox.height+'" ':this.svgViewportTransformation&&(E=this.viewportTransform,D='viewBox="'+f(-E[4]/E[0],x)+" "+f(-E[5]/E[3],x)+" "+f(this.width/E[0],x)+" "+f(this.height/E[3],x)+'" '),g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',I,'" ','height="',S,'" ',D,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",w.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(_),`</defs>
`)},createSVGClipPathMarkup:function(g){var _=this.clipPath;return _?(_.clipPathId="CLIPPATH_"+w.Object.__uid++,'<clipPath id="'+_.clipPathId+`" >
`+this.clipPath.toClipPathSVG(g.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var g=this;return["background","overlay"].map(function(_){var E=g[_+"Color"];if(E&&E.toLive){var I=g[_+"Vpt"],S=g.viewportTransform,D={width:g.width/(I?S[0]:1),height:g.height/(I?S[3]:1)};return E.toSVG(D,{additionalTransform:I?w.util.matrixToSVG(S):""})}}).join("")},createSVGFontFacesMarkup:function(){var g,_,E,I,S,D,x,R,j="",U={},Q=w.fontPaths,Z=[];for(this._objects.forEach(function k(F){Z.push(F),F._objects&&F._objects.forEach(k)}),x=0,R=Z.length;x<R;x++)if(_=(g=Z[x]).fontFamily,g.type.indexOf("text")!==-1&&!U[_]&&Q[_]&&(U[_]=!0,g.styles))for(S in E=g.styles)for(D in I=E[S])!U[_=I[D].fontFamily]&&Q[_]&&(U[_]=!0);for(var q in U)j+=[`		@font-face {
`,"			font-family: '",q,`';
`,"			src: url('",Q[q],`');
`,`		}
`].join("");return j&&(j=['	<style type="text/css">',`<![CDATA[
`,j,"]]>",`</style>
`].join("")),j},_setSVGObjects:function(g,_){var E,I,S,D=this._objects;for(I=0,S=D.length;I<S;I++)(E=D[I]).excludeFromExport||this._setSVGObject(g,E,_)},_setSVGObject:function(g,_,E){g.push(_.toSVG(E))},_setSVGBgOverlayImage:function(g,_,E){this[_]&&!this[_].excludeFromExport&&this[_].toSVG&&g.push(this[_].toSVG(E))},_setSVGBgOverlayColor:function(g,_){var E=this[_+"Color"],I=this.viewportTransform,S=this.width,D=this.height;if(E)if(E.toLive){var x=E.repeat,R=w.util.invertTransform(I),j=this[_+"Vpt"]?w.util.matrixToSVG(R):"";g.push('<rect transform="'+j+" translate(",S/2,",",D/2,')"',' x="',E.offsetX-S/2,'" y="',E.offsetY-D/2,'" ','width="',x==="repeat-y"||x==="no-repeat"?E.source.width:S,'" height="',x==="repeat-x"||x==="no-repeat"?E.source.height:D,'" fill="url(#SVGID_'+E.id+')"',`></rect>
`)}else g.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',E,'"',`></rect>
`)},sendToBack:function(g){if(!g)return this;var _,E,I,S=this._activeObject;if(g===S&&g.type==="activeSelection")for(_=(I=S._objects).length;_--;)E=I[_],u(this._objects,E),this._objects.unshift(E);else u(this._objects,g),this._objects.unshift(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(g){if(!g)return this;var _,E,I,S=this._activeObject;if(g===S&&g.type==="activeSelection")for(I=S._objects,_=0;_<I.length;_++)E=I[_],u(this._objects,E),this._objects.push(E);else u(this._objects,g),this._objects.push(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(g,_){if(!g)return this;var E,I,S,D,x,R=this._activeObject,j=0;if(g===R&&g.type==="activeSelection")for(x=R._objects,E=0;E<x.length;E++)I=x[E],(S=this._objects.indexOf(I))>0+j&&(D=S-1,u(this._objects,I),this._objects.splice(D,0,I)),j++;else(S=this._objects.indexOf(g))!==0&&(D=this._findNewLowerIndex(g,S,_),u(this._objects,g),this._objects.splice(D,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(g,_,E){var I,S;if(E){for(I=_,S=_-1;S>=0;--S)if(g.intersectsWithObject(this._objects[S])||g.isContainedWithinObject(this._objects[S])||this._objects[S].isContainedWithinObject(g)){I=S;break}}else I=_-1;return I},bringForward:function(g,_){if(!g)return this;var E,I,S,D,x,R=this._activeObject,j=0;if(g===R&&g.type==="activeSelection")for(E=(x=R._objects).length;E--;)I=x[E],(S=this._objects.indexOf(I))<this._objects.length-1-j&&(D=S+1,u(this._objects,I),this._objects.splice(D,0,I)),j++;else(S=this._objects.indexOf(g))!==this._objects.length-1&&(D=this._findNewUpperIndex(g,S,_),u(this._objects,g),this._objects.splice(D,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(g,_,E){var I,S,D;if(E){for(I=_,S=_+1,D=this._objects.length;S<D;++S)if(g.intersectsWithObject(this._objects[S])||g.isContainedWithinObject(this._objects[S])||this._objects[S].isContainedWithinObject(g)){I=S;break}}else I=_+1;return I},moveTo:function(g,_){return u(this._objects,g),this._objects.splice(_,0,g),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(w.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(g){g.dispose&&g.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),w.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),w.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),l(w.StaticCanvas.prototype,w.Observable),l(w.StaticCanvas.prototype,w.Collection),l(w.StaticCanvas.prototype,w.DataURLExporter),l(w.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var _=m();if(!_||!_.getContext)return null;var E=_.getContext("2d");return E&&g==="setLineDash"?E.setLineDash!==void 0:null}}),w.StaticCanvas.prototype.toJSON=w.StaticCanvas.prototype.toObject,w.isLikelyNode&&(w.StaticCanvas.prototype.createPNGStream=function(){var g=h(this.lowerCanvasEl);return g&&g.createPNGStream()},w.StaticCanvas.prototype.createJPEGStream=function(g){var _=h(this.lowerCanvasEl);return _&&_.createJPEGStream(g)})}}(),w.BaseBrush=w.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(l){l.strokeStyle=this.color,l.lineWidth=this.width,l.lineCap=this.strokeLineCap,l.miterLimit=this.strokeMiterLimit,l.lineJoin=this.strokeLineJoin,l.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(l){var c=this.canvas.viewportTransform;l.save(),l.transform(c[0],c[1],c[2],c[3],c[4],c[5])},_setShadow:function(){if(this.shadow){var l=this.canvas,c=this.shadow,u=l.contextTop,f=l.getZoom();l&&l._isRetinaScaling()&&(f*=w.devicePixelRatio),u.shadowColor=c.color,u.shadowBlur=c.blur*f,u.shadowOffsetX=c.offsetX*f,u.shadowOffsetY=c.offsetY*f}},needsFullRender:function(){return new w.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var l=this.canvas.contextTop;l.shadowColor="",l.shadowBlur=l.shadowOffsetX=l.shadowOffsetY=0},_isOutSideCanvas:function(l){return l.x<0||l.x>this.canvas.getWidth()||l.y<0||l.y>this.canvas.getHeight()}}),w.PencilBrush=w.util.createClass(w.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(l){this.canvas=l,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(l,c,u){var f=c.midPointFrom(u);return l.quadraticCurveTo(c.x,c.y,f.x,f.y),f},onMouseDown:function(l,c){this.canvas._isMainEvent(c.e)&&(this.drawStraightLine=c.e[this.straightLineKey],this._prepareForDrawing(l),this._captureDrawingPath(l),this._render())},onMouseMove:function(l,c){if(this.canvas._isMainEvent(c.e)&&(this.drawStraightLine=c.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(l))&&this._captureDrawingPath(l)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var u=this._points,f=u.length,o=this.canvas.contextTop;this._saveAndTransform(o),this.oldEnd&&(o.beginPath(),o.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(o,u[f-2],u[f-1],!0),o.stroke(),o.restore()}},onMouseUp:function(l){return!this.canvas._isMainEvent(l.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(l){var c=new w.Point(l.x,l.y);this._reset(),this._addPoint(c),this.canvas.contextTop.moveTo(c.x,c.y)},_addPoint:function(l){return!(this._points.length>1&&l.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(l),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(l){var c=new w.Point(l.x,l.y);return this._addPoint(c)},_render:function(l){var c,u,f=this._points[0],o=this._points[1];if(l=l||this.canvas.contextTop,this._saveAndTransform(l),l.beginPath(),this._points.length===2&&f.x===o.x&&f.y===o.y){var s=this.width/1e3;f=new w.Point(f.x,f.y),o=new w.Point(o.x,o.y),f.x-=s,o.x+=s}for(l.moveTo(f.x,f.y),c=1,u=this._points.length;c<u;c++)this._drawSegment(l,f,o),f=this._points[c],o=this._points[c+1];l.lineTo(f.x,f.y),l.stroke(),l.restore()},convertPointsToSVGPath:function(l){var c=this.width/1e3;return w.util.getSmoothPathFromPoints(l,c)},_isEmptySVGPath:function(l){return w.util.joinPath(l)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(l){var c=new w.Path(l,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,c.shadow=new w.Shadow(this.shadow)),c},decimatePoints:function(l,c){if(l.length<=2)return l;var u,f=this.canvas.getZoom(),o=Math.pow(c/f,2),s=l.length-1,h=l[0],m=[h];for(u=1;u<s-1;u++)Math.pow(h.x-l[u].x,2)+Math.pow(h.y-l[u].y,2)>=o&&(h=l[u],m.push(h));return m.push(l[s]),m},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var l=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(l))this.canvas.requestRenderAll();else{var c=this.createPath(l);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.requestRenderAll(),c.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:c})}}}),w.CircleBrush=w.util.createClass(w.BaseBrush,{width:10,initialize:function(l){this.canvas=l,this.points=[]},drawDot:function(l){var c=this.addPoint(l),u=this.canvas.contextTop;this._saveAndTransform(u),this.dot(u,c),u.restore()},dot:function(l,c){l.fillStyle=c.fill,l.beginPath(),l.arc(c.x,c.y,c.radius,0,2*Math.PI,!1),l.closePath(),l.fill()},onMouseDown:function(l){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(l)},_render:function(){var l,c,u=this.canvas.contextTop,f=this.points;for(this._saveAndTransform(u),l=0,c=f.length;l<c;l++)this.dot(u,f[l]);u.restore()},onMouseMove:function(l){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(l)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(l),this._render()):this.drawDot(l))},onMouseUp:function(){var l,c,u=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var f=[];for(l=0,c=this.points.length;l<c;l++){var o=this.points[l],s=new w.Circle({radius:o.radius,left:o.x,top:o.y,originX:"center",originY:"center",fill:o.fill});this.shadow&&(s.shadow=new w.Shadow(this.shadow)),f.push(s)}var h=new w.Group(f);h.canvas=this.canvas,this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},addPoint:function(l){var c=new w.Point(l.x,l.y),u=w.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,f=new w.Color(this.color).setAlpha(w.util.getRandomInt(0,100)/100).toRgba();return c.radius=u,c.fill=f,this.points.push(c),c}}),w.SprayBrush=w.util.createClass(w.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(l){this.canvas=l,this.sprayChunks=[]},onMouseDown:function(l){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(l),this.render(this.sprayChunkPoints)},onMouseMove:function(l){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(l)||(this.addSprayChunk(l),this.render(this.sprayChunkPoints))},onMouseUp:function(){var l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var c=[],u=0,f=this.sprayChunks.length;u<f;u++)for(var o=this.sprayChunks[u],s=0,h=o.length;s<h;s++){var m=new w.Rect({width:o[s].width,height:o[s].width,left:o[s].x+1,top:o[s].y+1,originX:"center",originY:"center",fill:this.color});c.push(m)}this.optimizeOverlapping&&(c=this._getOptimizedRects(c));var p=new w.Group(c);this.shadow&&p.set("shadow",new w.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:p}),this.canvas.add(p),this.canvas.fire("path:created",{path:p}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},_getOptimizedRects:function(l){var c,u,f,o={};for(u=0,f=l.length;u<f;u++)o[c=l[u].left+""+l[u].top]||(o[c]=l[u]);var s=[];for(c in o)s.push(o[c]);return s},render:function(l){var c,u,f=this.canvas.contextTop;for(f.fillStyle=this.color,this._saveAndTransform(f),c=0,u=l.length;c<u;c++){var o=l[c];o.opacity!==void 0&&(f.globalAlpha=o.opacity),f.fillRect(o.x,o.y,o.width,o.width)}f.restore()},_render:function(){var l,c,u=this.canvas.contextTop;for(u.fillStyle=this.color,this._saveAndTransform(u),l=0,c=this.sprayChunks.length;l<c;l++)this.render(this.sprayChunks[l]);u.restore()},addSprayChunk:function(l){this.sprayChunkPoints=[];var c,u,f,o,s=this.width/2;for(o=0;o<this.density;o++){c=w.util.getRandomInt(l.x-s,l.x+s),u=w.util.getRandomInt(l.y-s,l.y+s),f=this.dotWidthVariance?w.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var h=new w.Point(c,u);h.width=f,this.randomOpacity&&(h.opacity=w.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(h)}this.sprayChunks.push(this.sprayChunkPoints)}}),w.PatternBrush=w.util.createClass(w.PencilBrush,{getPatternSrc:function(){var l=w.util.createCanvasElement(),c=l.getContext("2d");return l.width=l.height=25,c.fillStyle=this.color,c.beginPath(),c.arc(10,10,10,0,2*Math.PI,!1),c.closePath(),c.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(l){return l.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(l){this.callSuper("_setBrushStyles",l),l.strokeStyle=this.getPattern(l)},createPath:function(l){var c=this.callSuper("createPath",l),u=c._getLeftTopCoords().scalarAdd(c.strokeWidth/2);return c.stroke=new w.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-u.x,offsetY:-u.y}),c}}),function(){var l=w.util.getPointer,c=w.util.degreesToRadians,u=w.util.isTouchEvent;for(var f in w.Canvas=w.util.createClass(w.StaticCanvas,{initialize:function(o,s){s||(s={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(o,s),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=w.PencilBrush&&new w.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var o,s,h,m=this.getActiveObjects();if(m.length>0&&!this.preserveObjectStacking){s=[],h=[];for(var p=0,g=this._objects.length;p<g;p++)o=this._objects[p],m.indexOf(o)===-1?s.push(o):h.push(o);m.length>1&&(this._activeObject._objects=h),s.push.apply(s,h)}else s=this._objects;return s},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var o=this.contextContainer;return this.renderCanvas(o,this._chooseObjectsToRender()),this},renderTopLayer:function(o){o.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(o),this.contextTopDirty=!0),o.restore()},renderTop:function(){var o=this.contextTop;return this.clearContext(o),this.renderTopLayer(o),this.fire("after:render"),this},_normalizePointer:function(o,s){var h=o.calcTransformMatrix(),m=w.util.invertTransform(h),p=this.restorePointerVpt(s);return w.util.transformPoint(p,m)},isTargetTransparent:function(o,s,h){if(o.shouldCache()&&o._cacheCanvas&&o!==this._activeObject){var m=this._normalizePointer(o,{x:s,y:h}),p=Math.max(o.cacheTranslationX+m.x*o.zoomX,0),g=Math.max(o.cacheTranslationY+m.y*o.zoomY,0);return w.util.isTransparent(o._cacheContext,Math.round(p),Math.round(g),this.targetFindTolerance)}var _=this.contextCache,E=o.selectionBackgroundColor,I=this.viewportTransform;return o.selectionBackgroundColor="",this.clearContext(_),_.save(),_.transform(I[0],I[1],I[2],I[3],I[4],I[5]),o.render(_),_.restore(),o.selectionBackgroundColor=E,w.util.isTransparent(_,s,h,this.targetFindTolerance)},_isSelectionKeyPressed:function(o){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(s){return o[s]===!0}):o[this.selectionKey]},_shouldClearSelection:function(o,s){var h=this.getActiveObjects(),m=this._activeObject;return!s||s&&m&&h.length>1&&h.indexOf(s)===-1&&m!==s&&!this._isSelectionKeyPressed(o)||s&&!s.evented||s&&!s.selectable&&m&&m!==s},_shouldCenterTransform:function(o,s,h){var m;if(o)return s==="scale"||s==="scaleX"||s==="scaleY"||s==="resizing"?m=this.centeredScaling||o.centeredScaling:s==="rotate"&&(m=this.centeredRotation||o.centeredRotation),m?!h:h},_getOriginFromCorner:function(o,s){var h={x:o.originX,y:o.originY};return s==="ml"||s==="tl"||s==="bl"?h.x="right":s!=="mr"&&s!=="tr"&&s!=="br"||(h.x="left"),s==="tl"||s==="mt"||s==="tr"?h.y="bottom":s!=="bl"&&s!=="mb"&&s!=="br"||(h.y="top"),h},_getActionFromCorner:function(o,s,h,m){if(!s||!o)return"drag";var p=m.controls[s];return p.getActionName(h,p,m)},_setupCurrentTransform:function(o,s,h){if(s){var m=this.getPointer(o),p=s.__corner,g=s.controls[p],_=h&&p?g.getActionHandler(o,s,g):w.controlsUtils.dragHandler,E=this._getActionFromCorner(h,p,o,s),I=this._getOriginFromCorner(s,p),S=o[this.centeredKey],D={target:s,action:E,actionHandler:_,corner:p,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,offsetX:m.x-s.left,offsetY:m.y-s.top,originX:I.x,originY:I.y,ex:m.x,ey:m.y,lastX:m.x,lastY:m.y,theta:c(s.angle),width:s.width*s.scaleX,shiftKey:o.shiftKey,altKey:S,original:w.util.saveObjectTransform(s)};this._shouldCenterTransform(s,E,S)&&(D.originX="center",D.originY="center"),D.original.originX=I.x,D.original.originY=I.y,this._currentTransform=D,this._beforeTransform(o)}},setCursor:function(o){this.upperCanvasEl.style.cursor=o},_drawSelection:function(o){var s=this._groupSelector,h=new w.Point(s.ex,s.ey),m=w.util.transformPoint(h,this.viewportTransform),p=new w.Point(s.ex+s.left,s.ey+s.top),g=w.util.transformPoint(p,this.viewportTransform),_=Math.min(m.x,g.x),E=Math.min(m.y,g.y),I=Math.max(m.x,g.x),S=Math.max(m.y,g.y),D=this.selectionLineWidth/2;this.selectionColor&&(o.fillStyle=this.selectionColor,o.fillRect(_,E,I-_,S-E)),this.selectionLineWidth&&this.selectionBorderColor&&(o.lineWidth=this.selectionLineWidth,o.strokeStyle=this.selectionBorderColor,_+=D,E+=D,I-=D,S-=D,w.Object.prototype._setLineDash.call(this,o,this.selectionDashArray),o.strokeRect(_,E,I-_,S-E))},findTarget:function(o,s){if(!this.skipTargetFind){var h,m,p=this.getPointer(o,!0),g=this._activeObject,_=this.getActiveObjects(),E=u(o),I=_.length>1&&!s||_.length===1;if(this.targets=[],I&&g._findTargetCorner(p,E)||_.length>1&&!s&&g===this._searchPossibleTargets([g],p))return g;if(_.length===1&&g===this._searchPossibleTargets([g],p)){if(!this.preserveObjectStacking)return g;h=g,m=this.targets,this.targets=[]}var S=this._searchPossibleTargets(this._objects,p);return o[this.altSelectionKey]&&S&&h&&S!==h&&(S=h,this.targets=m),S}},_checkTarget:function(o,s,h){if(s&&s.visible&&s.evented&&s.containsPoint(o)&&(!this.perPixelTargetFind&&!s.perPixelTargetFind||s.isEditing||!this.isTargetTransparent(s,h.x,h.y)))return!0},_searchPossibleTargets:function(o,s){for(var h,m,p=o.length;p--;){var g=o[p],_=g.group?this._normalizePointer(g.group,s):s;if(this._checkTarget(_,g,s)){(h=o[p]).subTargetCheck&&h instanceof w.Group&&(m=this._searchPossibleTargets(h._objects,s))&&this.targets.push(m);break}}return h},restorePointerVpt:function(o){return w.util.transformPoint(o,w.util.invertTransform(this.viewportTransform))},getPointer:function(o,s){if(this._absolutePointer&&!s)return this._absolutePointer;if(this._pointer&&s)return this._pointer;var h,m=l(o),p=this.upperCanvasEl,g=p.getBoundingClientRect(),_=g.width||0,E=g.height||0;_&&E||("top"in g&&"bottom"in g&&(E=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(_=Math.abs(g.right-g.left))),this.calcOffset(),m.x=m.x-this._offset.left,m.y=m.y-this._offset.top,s||(m=this.restorePointerVpt(m));var I=this.getRetinaScaling();return I!==1&&(m.x/=I,m.y/=I),h=_===0||E===0?{width:1,height:1}:{width:p.width/_,height:p.height/E},{x:m.x*h.width,y:m.y*h.height}},_createUpperCanvas:function(){var o=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),s=this.lowerCanvasEl,h=this.upperCanvasEl;h?h.className="":(h=this._createCanvasElement(),this.upperCanvasEl=h),w.util.addClass(h,"upper-canvas "+o),this.wrapperEl.appendChild(h),this._copyCanvasStyle(s,h),this._applyCanvasStyle(h),this.contextTop=h.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=w.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),w.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),w.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(o){var s=this.width||o.width,h=this.height||o.height;w.util.setStyle(o,{position:"absolute",width:s+"px",height:h+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),o.width=s,o.height=h,w.util.makeElementUnselectable(o)},_copyCanvasStyle:function(o,s){s.style.cssText=o.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var o=this._activeObject;return o?o.type==="activeSelection"&&o._objects?o._objects.slice(0):[o]:[]},_onObjectRemoved:function(o){o===this._activeObject&&(this.fire("before:selection:cleared",{target:o}),this._discardActiveObject(),this.fire("selection:cleared",{target:o}),o.fire("deselected")),o===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",o)},_fireSelectionEvents:function(o,s){var h=!1,m=this.getActiveObjects(),p=[],g=[];o.forEach(function(_){m.indexOf(_)===-1&&(h=!0,_.fire("deselected",{e:s,target:_}),g.push(_))}),m.forEach(function(_){o.indexOf(_)===-1&&(h=!0,_.fire("selected",{e:s,target:_}),p.push(_))}),o.length>0&&m.length>0?h&&this.fire("selection:updated",{e:s,selected:p,deselected:g}):m.length>0?this.fire("selection:created",{e:s,selected:p}):o.length>0&&this.fire("selection:cleared",{e:s,deselected:g})},setActiveObject:function(o,s){var h=this.getActiveObjects();return this._setActiveObject(o,s),this._fireSelectionEvents(h,s),this},_setActiveObject:function(o,s){return this._activeObject!==o&&!!this._discardActiveObject(s,o)&&!o.onSelect({e:s})&&(this._activeObject=o,!0)},_discardActiveObject:function(o,s){var h=this._activeObject;if(h){if(h.onDeselect({e:o,object:s}))return!1;this._activeObject=null}return!0},discardActiveObject:function(o){var s=this.getActiveObjects(),h=this.getActiveObject();return s.length&&this.fire("before:selection:cleared",{target:h,e:o}),this._discardActiveObject(o),this._fireSelectionEvents(s,o),this},dispose:function(){var o=this.wrapperEl;return this.removeListeners(),o.removeChild(this.upperCanvasEl),o.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(s){w.util.cleanUpJsdomNode(this[s]),this[s]=void 0}.bind(this)),o.parentNode&&o.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,w.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(o){var s=this._activeObject;s&&s._renderControls(o)},_toObject:function(o,s,h){var m=this._realizeGroupTransformOnObject(o),p=this.callSuper("_toObject",o,s,h);return this._unwindGroupTransformOnObject(o,m),p},_realizeGroupTransformOnObject:function(o){if(o.group&&o.group.type==="activeSelection"&&this._activeObject===o.group){var s={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(h){s[h]=o[h]}),w.util.addTransformToObject(o,this._activeObject.calcOwnMatrix()),s}return null},_unwindGroupTransformOnObject:function(o,s){s&&o.set(s)},_setSVGObject:function(o,s,h){var m=this._realizeGroupTransformOnObject(s);this.callSuper("_setSVGObject",o,s,h),this._unwindGroupTransformOnObject(s,m)},setViewportTransform:function(o){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),w.StaticCanvas.prototype.setViewportTransform.call(this,o)}}),w.StaticCanvas)f!=="prototype"&&(w.Canvas[f]=w.StaticCanvas[f])}(),function(){var l=w.util.addListener,c=w.util.removeListener,u={passive:!1};function f(o,s){return o.button&&o.button===s-1}w.util.object.extend(w.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(l,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(o,s){var h=this.upperCanvasEl,m=this._getEventPrefix();o(w.window,"resize",this._onResize),o(h,m+"down",this._onMouseDown),o(h,m+"move",this._onMouseMove,u),o(h,m+"out",this._onMouseOut),o(h,m+"enter",this._onMouseEnter),o(h,"wheel",this._onMouseWheel),o(h,"contextmenu",this._onContextMenu),o(h,"dblclick",this._onDoubleClick),o(h,"dragover",this._onDragOver),o(h,"dragenter",this._onDragEnter),o(h,"dragleave",this._onDragLeave),o(h,"drop",this._onDrop),this.enablePointerEvents||o(h,"touchstart",this._onTouchStart,u),typeof eventjs<"u"&&s in eventjs&&(eventjs[s](h,"gesture",this._onGesture),eventjs[s](h,"drag",this._onDrag),eventjs[s](h,"orientation",this._onOrientationChange),eventjs[s](h,"shake",this._onShake),eventjs[s](h,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(c,"remove");var o=this._getEventPrefix();c(w.document,o+"up",this._onMouseUp),c(w.document,"touchend",this._onTouchEnd,u),c(w.document,o+"move",this._onMouseMove,u),c(w.document,"touchmove",this._onMouseMove,u)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(o,s){this.__onTransformGesture&&this.__onTransformGesture(o,s)},_onDrag:function(o,s){this.__onDrag&&this.__onDrag(o,s)},_onMouseWheel:function(o){this.__onMouseWheel(o)},_onMouseOut:function(o){var s=this._hoveredTarget;this.fire("mouse:out",{target:s,e:o}),this._hoveredTarget=null,s&&s.fire("mouseout",{e:o});var h=this;this._hoveredTargets.forEach(function(m){h.fire("mouse:out",{target:s,e:o}),m&&s.fire("mouseout",{e:o})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(m){m.isEditing&&m.hiddenTextarea.focus()})},_onMouseEnter:function(o){this._currentTransform||this.findTarget(o)||(this.fire("mouse:over",{target:null,e:o}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(o,s){this.__onOrientationChange&&this.__onOrientationChange(o,s)},_onShake:function(o,s){this.__onShake&&this.__onShake(o,s)},_onLongPress:function(o,s){this.__onLongPress&&this.__onLongPress(o,s)},_onDragOver:function(o){o.preventDefault();var s=this._simpleEventHandler("dragover",o);this._fireEnterLeaveEvents(s,o)},_onDrop:function(o){return this._simpleEventHandler("drop:before",o),this._simpleEventHandler("drop",o)},_onContextMenu:function(o){return this.stopContextMenu&&(o.stopPropagation(),o.preventDefault()),!1},_onDoubleClick:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"dblclick"),this._resetTransformEventData(o)},getPointerId:function(o){var s=o.changedTouches;return s?s[0]&&s[0].identifier:this.enablePointerEvents?o.pointerId:-1},_isMainEvent:function(o){return o.isPrimary===!0||o.isPrimary!==!1&&(o.type==="touchend"&&o.touches.length===0||!o.changedTouches||o.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(o){o.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(o)),this.__onMouseDown(o),this._resetTransformEventData();var s=this.upperCanvasEl,h=this._getEventPrefix();l(w.document,"touchend",this._onTouchEnd,u),l(w.document,"touchmove",this._onMouseMove,u),c(s,h+"down",this._onMouseDown)},_onMouseDown:function(o){this.__onMouseDown(o),this._resetTransformEventData();var s=this.upperCanvasEl,h=this._getEventPrefix();c(s,h+"move",this._onMouseMove,u),l(w.document,h+"up",this._onMouseUp),l(w.document,h+"move",this._onMouseMove,u)},_onTouchEnd:function(o){if(!(o.touches.length>0)){this.__onMouseUp(o),this._resetTransformEventData(),this.mainTouchId=null;var s=this._getEventPrefix();c(w.document,"touchend",this._onTouchEnd,u),c(w.document,"touchmove",this._onMouseMove,u);var h=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){l(h.upperCanvasEl,s+"down",h._onMouseDown),h._willAddMouseDown=0},400)}},_onMouseUp:function(o){this.__onMouseUp(o),this._resetTransformEventData();var s=this.upperCanvasEl,h=this._getEventPrefix();this._isMainEvent(o)&&(c(w.document,h+"up",this._onMouseUp),c(w.document,h+"move",this._onMouseMove,u),l(s,h+"move",this._onMouseMove,u))},_onMouseMove:function(o){!this.allowTouchScrolling&&o.preventDefault&&o.preventDefault(),this.__onMouseMove(o)},_onResize:function(){this.calcOffset()},_shouldRender:function(o){var s=this._activeObject;return!!(!!s!=!!o||s&&o&&s!==o)||(s&&s.isEditing,!1)},__onMouseUp:function(o){var s,h=this._currentTransform,m=this._groupSelector,p=!1,g=!m||m.left===0&&m.top===0;if(this._cacheTransformEventData(o),s=this._target,this._handleEvent(o,"up:before"),f(o,3))this.fireRightClick&&this._handleEvent(o,"up",3,g);else{if(f(o,2))return this.fireMiddleClick&&this._handleEvent(o,"up",2,g),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(o);else if(this._isMainEvent(o)){if(h&&(this._finalizeCurrentTransform(o),p=h.actionPerformed),!g){var _=s===this._activeObject;this._maybeGroupObjects(o),p||(p=this._shouldRender(s)||!_&&s===this._activeObject)}var E,I;if(s){if(E=s._findTargetCorner(this.getPointer(o,!0),w.util.isTouchEvent(o)),s.selectable&&s!==this._activeObject&&s.activeOn==="up")this.setActiveObject(s,o),p=!0;else{var S=s.controls[E],D=S&&S.getMouseUpHandler(o,s,S);D&&D(o,h,(I=this.getPointer(o)).x,I.y)}s.isMoving=!1}if(h&&(h.target!==s||h.corner!==E)){var x=h.target&&h.target.controls[h.corner],R=x&&x.getMouseUpHandler(o,s,S);I=I||this.getPointer(o),R&&R(o,h,I.x,I.y)}this._setCursorFromEvent(o,s),this._handleEvent(o,"up",1,g),this._groupSelector=null,this._currentTransform=null,s&&(s.__corner=0),p?this.requestRenderAll():g||this.renderTop()}}},_simpleEventHandler:function(o,s){var h=this.findTarget(s),m=this.targets,p={e:s,target:h,subTargets:m};if(this.fire(o,p),h&&h.fire(o,p),!m)return h;for(var g=0;g<m.length;g++)m[g].fire(o,p);return h},_handleEvent:function(o,s,h,m){var p=this._target,g=this.targets||[],_={e:o,target:p,subTargets:g,button:h||1,isClick:m||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};s==="up"&&(_.currentTarget=this.findTarget(o),_.currentSubTargets=this.targets),this.fire("mouse:"+s,_),p&&p.fire("mouse"+s,_);for(var E=0;E<g.length;E++)g[E].fire("mouse"+s,_)},_finalizeCurrentTransform:function(o){var s=this._currentTransform,h=s.target,m={e:o,target:h,transform:s,action:s.action};h._scaling&&(h._scaling=!1),h.setCoords(),(s.actionPerformed||this.stateful&&h.hasStateChanged())&&this._fire("modified",m)},_onMouseDownInDrawingMode:function(o){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(o).requestRenderAll();var s=this.getPointer(o);this.freeDrawingBrush.onMouseDown(s,{e:o,pointer:s}),this._handleEvent(o,"down")},_onMouseMoveInDrawingMode:function(o){if(this._isCurrentlyDrawing){var s=this.getPointer(o);this.freeDrawingBrush.onMouseMove(s,{e:o,pointer:s})}this.setCursor(this.freeDrawingCursor),this._handleEvent(o,"move")},_onMouseUpInDrawingMode:function(o){var s=this.getPointer(o);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:o,pointer:s}),this._handleEvent(o,"up")},__onMouseDown:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"down:before");var s=this._target;if(f(o,3))this.fireRightClick&&this._handleEvent(o,"down",3);else if(f(o,2))this.fireMiddleClick&&this._handleEvent(o,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(o);else if(this._isMainEvent(o)&&!this._currentTransform){var h=this._pointer;this._previousPointer=h;var m=this._shouldRender(s),p=this._shouldGroup(o,s);if(this._shouldClearSelection(o,s)?this.discardActiveObject(o):p&&(this._handleGrouping(o,s),s=this._activeObject),!this.selection||s&&(s.selectable||s.isEditing||s===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),s){var g=s===this._activeObject;s.selectable&&s.activeOn==="down"&&this.setActiveObject(s,o);var _=s._findTargetCorner(this.getPointer(o,!0),w.util.isTouchEvent(o));if(s.__corner=_,s===this._activeObject&&(_||!p)){this._setupCurrentTransform(o,s,g);var E=s.controls[_],I=(h=this.getPointer(o),E&&E.getMouseDownHandler(o,s,E));I&&I(o,this._currentTransform,h.x,h.y)}}this._handleEvent(o,"down"),(m||p)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(o){this._resetTransformEventData(),this._pointer=this.getPointer(o,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(o)||null},_beforeTransform:function(o){var s=this._currentTransform;this.stateful&&s.target.saveState(),this.fire("before:transform",{e:o,transform:s})},__onMouseMove:function(o){var s,h;if(this._handleEvent(o,"move:before"),this._cacheTransformEventData(o),this.isDrawingMode)this._onMouseMoveInDrawingMode(o);else if(this._isMainEvent(o)){var m=this._groupSelector;m?(h=this._absolutePointer,m.left=h.x-m.ex,m.top=h.y-m.ey,this.renderTop()):this._currentTransform?this._transformObject(o):(s=this.findTarget(o)||null,this._setCursorFromEvent(o,s),this._fireOverOutEvents(s,o)),this._handleEvent(o,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(o,s){var h=this._hoveredTarget,m=this._hoveredTargets,p=this.targets,g=Math.max(m.length,p.length);this.fireSyntheticInOutEvents(o,s,{oldTarget:h,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var _=0;_<g;_++)this.fireSyntheticInOutEvents(p[_],s,{oldTarget:m[_],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(o,s){var h=this._draggedoverTarget,m=this._hoveredTargets,p=this.targets,g=Math.max(m.length,p.length);this.fireSyntheticInOutEvents(o,s,{oldTarget:h,evtOut:"dragleave",evtIn:"dragenter"});for(var _=0;_<g;_++)this.fireSyntheticInOutEvents(p[_],s,{oldTarget:m[_],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=o},fireSyntheticInOutEvents:function(o,s,h){var m,p,g,_=h.oldTarget,E=_!==o,I=h.canvasEvtIn,S=h.canvasEvtOut;E&&(m={e:s,target:o,previousTarget:_},p={e:s,target:_,nextTarget:o}),g=o&&E,_&&E&&(S&&this.fire(S,p),_.fire(h.evtOut,p)),g&&(I&&this.fire(I,m),o.fire(h.evtIn,m))},__onMouseWheel:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"wheel"),this._resetTransformEventData()},_transformObject:function(o){var s=this.getPointer(o),h=this._currentTransform;h.reset=!1,h.shiftKey=o.shiftKey,h.altKey=o[this.centeredKey],this._performTransformAction(o,h,s),h.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(o,s,h){var m=h.x,p=h.y,g=s.action,_=!1,E=s.actionHandler;E&&(_=E(o,s,m,p)),g==="drag"&&_&&(s.target.isMoving=!0,this.setCursor(s.target.moveCursor||this.moveCursor)),s.actionPerformed=s.actionPerformed||_},_fire:w.controlsUtils.fireEvent,_setCursorFromEvent:function(o,s){if(!s)return this.setCursor(this.defaultCursor),!1;var h=s.hoverCursor||this.hoverCursor,m=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,p=(!m||!m.contains(s))&&s._findTargetCorner(this.getPointer(o,!0));p?this.setCursor(this.getCornerCursor(p,s,o)):(s.subTargetCheck&&this.targets.concat().reverse().map(function(g){h=g.hoverCursor||h}),this.setCursor(h))},getCornerCursor:function(o,s,h){var m=s.controls[o];return m.cursorStyleHandler(h,m,s)}})}(),G=Math.min,W=Math.max,w.util.object.extend(w.Canvas.prototype,{_shouldGroup:function(l,c){var u=this._activeObject;return u&&this._isSelectionKeyPressed(l)&&c&&c.selectable&&this.selection&&(u!==c||u.type==="activeSelection")&&!c.onSelect({e:l})},_handleGrouping:function(l,c){var u=this._activeObject;u.__corner||(c!==u||(c=this.findTarget(l,!0))&&c.selectable)&&(u&&u.type==="activeSelection"?this._updateActiveSelection(c,l):this._createActiveSelection(c,l))},_updateActiveSelection:function(l,c){var u=this._activeObject,f=u._objects.slice(0);u.contains(l)?(u.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),u.size()===1&&this._setActiveObject(u.item(0),c)):(u.addWithUpdate(l),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(f,c)},_createActiveSelection:function(l,c){var u=this.getActiveObjects(),f=this._createGroup(l);this._hoveredTarget=f,this._setActiveObject(f,c),this._fireSelectionEvents(u,c)},_createGroup:function(l){var c=this._objects,u=c.indexOf(this._activeObject)<c.indexOf(l)?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new w.ActiveSelection(u,{canvas:this})},_groupSelectedObjects:function(l){var c,u=this._collectObjects(l);u.length===1?this.setActiveObject(u[0],l):u.length>1&&(c=new w.ActiveSelection(u.reverse(),{canvas:this}),this.setActiveObject(c,l))},_collectObjects:function(l){for(var c,u=[],f=this._groupSelector.ex,o=this._groupSelector.ey,s=f+this._groupSelector.left,h=o+this._groupSelector.top,m=new w.Point(G(f,s),G(o,h)),p=new w.Point(W(f,s),W(o,h)),g=!this.selectionFullyContained,_=f===s&&o===h,E=this._objects.length;E--&&!((c=this._objects[E])&&c.selectable&&c.visible&&(g&&c.intersectsWithRect(m,p,!0)||c.isContainedWithinRect(m,p,!0)||g&&c.containsPoint(m,null,!0)||g&&c.containsPoint(p,null,!0))&&(u.push(c),_)););return u.length>1&&(u=u.filter(function(I){return!I.onSelect({e:l})})),u},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}}),w.util.object.extend(w.StaticCanvas.prototype,{toDataURL:function(l){l||(l={});var c=l.format||"png",u=l.quality||1,f=(l.multiplier||1)*(l.enableRetinaScaling?this.getRetinaScaling():1),o=this.toCanvasElement(f,l);return w.util.toDataURL(o,c,u)},toCanvasElement:function(l,c){l=l||1;var u=((c=c||{}).width||this.width)*l,f=(c.height||this.height)*l,o=this.getZoom(),s=this.width,h=this.height,m=o*l,p=this.viewportTransform,g=(p[4]-(c.left||0))*l,_=(p[5]-(c.top||0))*l,E=this.interactive,I=[m,0,0,m,g,_],S=this.enableRetinaScaling,D=w.util.createCanvasElement(),x=this.contextTop;return D.width=u,D.height=f,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=I,this.width=u,this.height=f,this.calcViewportBoundaries(),this.renderCanvas(D.getContext("2d"),this._objects),this.viewportTransform=p,this.width=s,this.height=h,this.calcViewportBoundaries(),this.interactive=E,this.enableRetinaScaling=S,this.contextTop=x,D}}),w.util.object.extend(w.StaticCanvas.prototype,{loadFromJSON:function(l,c,u){if(l){var f=typeof l=="string"?JSON.parse(l):w.util.object.clone(l),o=this,s=f.clipPath,h=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete f.clipPath,this._enlivenObjects(f.objects,function(m){o.clear(),o._setBgOverlay(f,function(){s?o._enlivenObjects([s],function(p){o.clipPath=p[0],o.__setupCanvas.call(o,f,m,h,c)}):o.__setupCanvas.call(o,f,m,h,c)})},u),this}},__setupCanvas:function(l,c,u,f){var o=this;c.forEach(function(s,h){o.insertAt(s,h)}),this.renderOnAddRemove=u,delete l.objects,delete l.backgroundImage,delete l.overlayImage,delete l.background,delete l.overlay,this._setOptions(l),this.renderAll(),f&&f()},_setBgOverlay:function(l,c){var u={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(l.backgroundImage||l.overlayImage||l.background||l.overlay){var f=function(){u.backgroundImage&&u.overlayImage&&u.backgroundColor&&u.overlayColor&&c&&c()};this.__setBgOverlay("backgroundImage",l.backgroundImage,u,f),this.__setBgOverlay("overlayImage",l.overlayImage,u,f),this.__setBgOverlay("backgroundColor",l.background,u,f),this.__setBgOverlay("overlayColor",l.overlay,u,f)}else c&&c()},__setBgOverlay:function(l,c,u,f){var o=this;if(!c)return u[l]=!0,void(f&&f());l==="backgroundImage"||l==="overlayImage"?w.util.enlivenObjects([c],function(s){o[l]=s[0],u[l]=!0,f&&f()}):this["set"+w.util.string.capitalize(l,!0)](c,function(){u[l]=!0,f&&f()})},_enlivenObjects:function(l,c,u){l&&l.length!==0?w.util.enlivenObjects(l,function(f){c&&c(f)},null,u):c&&c([])},_toDataURL:function(l,c){this.clone(function(u){c(u.toDataURL(l))})},_toDataURLWithMultiplier:function(l,c,u){this.clone(function(f){u(f.toDataURLWithMultiplier(l,c))})},clone:function(l,c){var u=JSON.stringify(this.toJSON(c));this.cloneWithoutData(function(f){f.loadFromJSON(u,function(){l&&l(f)})})},cloneWithoutData:function(l){var c=w.util.createCanvasElement();c.width=this.width,c.height=this.height;var u=new w.Canvas(c);this.backgroundImage?(u.setBackgroundImage(this.backgroundImage.src,function(){u.renderAll(),l&&l(u)}),u.backgroundImageOpacity=this.backgroundImageOpacity,u.backgroundImageStretch=this.backgroundImageStretch):l&&l(u)}}),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.extend,f=c.util.object.clone,o=c.util.toFixed,s=c.util.string.capitalize,h=c.util.degreesToRadians,m=!c.isLikelyNode;c.Object||(c.Object=c.util.createClass(c.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:m,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(p){p&&this.setOptions(p)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=c.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(p){var g=c.perfLimitSizeTotal,_=p.width,E=p.height,I=c.maxCacheSideLimit,S=c.minCacheSideLimit;if(_<=I&&E<=I&&_*E<=g)return _<S&&(p.width=S),E<S&&(p.height=S),p;var D=_/E,x=c.util.limitDimsByArea(D,g),R=c.util.capValue,j=R(S,x.x,I),U=R(S,x.y,I);return _>j&&(p.zoomX/=_/j,p.width=j,p.capped=!0),E>U&&(p.zoomY/=E/U,p.height=U,p.capped=!0),p},_getCacheCanvasDimensions:function(){var p=this.getTotalObjectScaling(),g=this._getTransformedDimensions(0,0),_=g.x*p.scaleX/this.scaleX,E=g.y*p.scaleY/this.scaleY;return{width:_+2,height:E+2,zoomX:p.scaleX,zoomY:p.scaleY,x:_,y:E}},_updateCacheCanvas:function(){var p=this.canvas;if(this.noScaleCache&&p&&p._currentTransform){var g=p._currentTransform.target,_=p._currentTransform.action;if(this===g&&_.slice&&_.slice(0,5)==="scale")return!1}var E,I,S=this._cacheCanvas,D=this._limitCacheSize(this._getCacheCanvasDimensions()),x=c.minCacheSideLimit,R=D.width,j=D.height,U=D.zoomX,Q=D.zoomY,Z=R!==this.cacheWidth||j!==this.cacheHeight,q=this.zoomX!==U||this.zoomY!==Q,k=Z||q,F=0,z=0,J=!1;if(Z){var ee=this._cacheCanvas.width,V=this._cacheCanvas.height,B=R>ee||j>V;J=B||(R<.9*ee||j<.9*V)&&ee>x&&V>x,B&&!D.capped&&(R>x||j>x)&&(F=.1*R,z=.1*j)}return this instanceof c.Text&&this.path&&(k=!0,J=!0,F+=this.getHeightOfLine(0)*this.zoomX,z+=this.getHeightOfLine(0)*this.zoomY),!!k&&(J?(S.width=Math.ceil(R+F),S.height=Math.ceil(j+z)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,S.width,S.height)),E=D.x/2,I=D.y/2,this.cacheTranslationX=Math.round(S.width/2-E)+E,this.cacheTranslationY=Math.round(S.height/2-I)+I,this.cacheWidth=R,this.cacheHeight=j,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(U,Q),this.zoomX=U,this.zoomY=Q,!0)},setOptions:function(p){this._setOptions(p),this._initGradient(p.fill,"fill"),this._initGradient(p.stroke,"stroke"),this._initPattern(p.fill,"fill"),this._initPattern(p.stroke,"stroke")},transform:function(p){var g=this.group&&!this.group._transformDone||this.group&&this.canvas&&p===this.canvas.contextTop,_=this.calcTransformMatrix(!g);p.transform(_[0],_[1],_[2],_[3],_[4],_[5])},toObject:function(p){var g=c.Object.NUM_FRACTION_DIGITS,_={type:this.type,version:c.version,originX:this.originX,originY:this.originY,left:o(this.left,g),top:o(this.top,g),width:o(this.width,g),height:o(this.height,g),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:o(this.strokeWidth,g),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:o(this.strokeMiterLimit,g),scaleX:o(this.scaleX,g),scaleY:o(this.scaleY,g),angle:o(this.angle,g),flipX:this.flipX,flipY:this.flipY,opacity:o(this.opacity,g),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:o(this.skewX,g),skewY:o(this.skewY,g)};return this.clipPath&&!this.clipPath.excludeFromExport&&(_.clipPath=this.clipPath.toObject(p),_.clipPath.inverted=this.clipPath.inverted,_.clipPath.absolutePositioned=this.clipPath.absolutePositioned),c.util.populateWithProperties(this,_,p),this.includeDefaultValues||(_=this._removeDefaultValues(_)),_},toDatalessObject:function(p){return this.toObject(p)},_removeDefaultValues:function(p){var g=c.util.getKlass(p.type).prototype;return g.stateProperties.forEach(function(_){_!=="left"&&_!=="top"&&(p[_]===g[_]&&delete p[_],Array.isArray(p[_])&&Array.isArray(g[_])&&p[_].length===0&&g[_].length===0&&delete p[_])}),p},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var p=c.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(p.scaleX),scaleY:Math.abs(p.scaleY)}},getTotalObjectScaling:function(){var p=this.getObjectScaling(),g=p.scaleX,_=p.scaleY;if(this.canvas){var E=this.canvas.getZoom(),I=this.canvas.getRetinaScaling();g*=E*I,_*=E*I}return{scaleX:g,scaleY:_}},getObjectOpacity:function(){var p=this.opacity;return this.group&&(p*=this.group.getObjectOpacity()),p},_set:function(p,g){var _=p==="scaleX"||p==="scaleY",E=this[p]!==g,I=!1;return _&&(g=this._constrainScale(g)),p==="scaleX"&&g<0?(this.flipX=!this.flipX,g*=-1):p==="scaleY"&&g<0?(this.flipY=!this.flipY,g*=-1):p!=="shadow"||!g||g instanceof c.Shadow?p==="dirty"&&this.group&&this.group.set("dirty",g):g=new c.Shadow(g),this[p]=g,E&&(I=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(p)>-1?(this.dirty=!0,I&&this.group.set("dirty",!0)):I&&this.stateProperties.indexOf(p)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:c.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(p){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(p.save(),this._setupCompositeOperation(p),this.drawSelectionBackground(p),this.transform(p),this._setOpacity(p),this._setShadow(p,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(p)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(p),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),p.restore())},renderCache:function(p){p=p||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,p.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(p,g){if(p.save(),g.inverted?p.globalCompositeOperation="destination-out":p.globalCompositeOperation="destination-in",g.absolutePositioned){var _=c.util.invertTransform(this.calcTransformMatrix());p.transform(_[0],_[1],_[2],_[3],_[4],_[5])}g.transform(p),p.scale(1/g.zoomX,1/g.zoomY),p.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),p.restore()},drawObject:function(p,g){var _=this.fill,E=this.stroke;g?(this.fill="black",this.stroke="",this._setClippingProperties(p)):this._renderBackground(p),this._render(p),this._drawClipPath(p,this.clipPath),this.fill=_,this.stroke=E},_drawClipPath:function(p,g){g&&(g.canvas=this.canvas,g.shouldCache(),g._transformDone=!0,g.renderCache({forClipping:!0}),this.drawClipPathOnCache(p,g))},drawCacheOnCanvas:function(p){p.scale(1/this.zoomX,1/this.zoomY),p.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(p){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!p&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!p){var g=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-_/2,g,_)}return!0}return!1},_renderBackground:function(p){if(this.backgroundColor){var g=this._getNonTransformedDimensions();p.fillStyle=this.backgroundColor,p.fillRect(-g.x/2,-g.y/2,g.x,g.y),this._removeShadow(p)}},_setOpacity:function(p){this.group&&!this.group._transformDone?p.globalAlpha=this.getObjectOpacity():p.globalAlpha*=this.opacity},_setStrokeStyles:function(p,g){var _=g.stroke;_&&(p.lineWidth=g.strokeWidth,p.lineCap=g.strokeLineCap,p.lineDashOffset=g.strokeDashOffset,p.lineJoin=g.strokeLineJoin,p.miterLimit=g.strokeMiterLimit,_.toLive?_.gradientUnits==="percentage"||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(p,_):(p.strokeStyle=_.toLive(p,this),this._applyPatternGradientTransform(p,_)):p.strokeStyle=g.stroke)},_setFillStyles:function(p,g){var _=g.fill;_&&(_.toLive?(p.fillStyle=_.toLive(p,this),this._applyPatternGradientTransform(p,g.fill)):p.fillStyle=_)},_setClippingProperties:function(p){p.globalAlpha=1,p.strokeStyle="transparent",p.fillStyle="#000000"},_setLineDash:function(p,g){g&&g.length!==0&&(1&g.length&&g.push.apply(g,g),p.setLineDash(g))},_renderControls:function(p,g){var _,E,I,S=this.getViewportTransform(),D=this.calcTransformMatrix();E=(g=g||{}).hasBorders!==void 0?g.hasBorders:this.hasBorders,I=g.hasControls!==void 0?g.hasControls:this.hasControls,D=c.util.multiplyTransformMatrices(S,D),_=c.util.qrDecompose(D),p.save(),p.translate(_.translateX,_.translateY),p.lineWidth=1*this.borderScaleFactor,this.group||(p.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(_.angle-=180),p.rotate(h(this.group?_.angle:this.angle)),g.forActiveSelection||this.group?E&&this.drawBordersInGroup(p,_,g):E&&this.drawBorders(p,g),I&&this.drawControls(p,g),p.restore()},_setShadow:function(p){if(this.shadow){var g,_=this.shadow,E=this.canvas,I=E&&E.viewportTransform[0]||1,S=E&&E.viewportTransform[3]||1;g=_.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),E&&E._isRetinaScaling()&&(I*=c.devicePixelRatio,S*=c.devicePixelRatio),p.shadowColor=_.color,p.shadowBlur=_.blur*c.browserShadowBlurConstant*(I+S)*(g.scaleX+g.scaleY)/4,p.shadowOffsetX=_.offsetX*I*g.scaleX,p.shadowOffsetY=_.offsetY*S*g.scaleY}},_removeShadow:function(p){this.shadow&&(p.shadowColor="",p.shadowBlur=p.shadowOffsetX=p.shadowOffsetY=0)},_applyPatternGradientTransform:function(p,g){if(!g||!g.toLive)return{offsetX:0,offsetY:0};var _=g.gradientTransform||g.patternTransform,E=-this.width/2+g.offsetX||0,I=-this.height/2+g.offsetY||0;return g.gradientUnits==="percentage"?p.transform(this.width,0,0,this.height,E,I):p.transform(1,0,0,1,E,I),_&&p.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:E,offsetY:I}},_renderPaintInOrder:function(p){this.paintFirst==="stroke"?(this._renderStroke(p),this._renderFill(p)):(this._renderFill(p),this._renderStroke(p))},_render:function(){},_renderFill:function(p){this.fill&&(p.save(),this._setFillStyles(p,this),this.fillRule==="evenodd"?p.fill("evenodd"):p.fill(),p.restore())},_renderStroke:function(p){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(p),p.save(),this.strokeUniform&&this.group){var g=this.getObjectScaling();p.scale(1/g.scaleX,1/g.scaleY)}else this.strokeUniform&&p.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(p,this.strokeDashArray),this._setStrokeStyles(p,this),p.stroke(),p.restore()}},_applyPatternForTransformedGradient:function(p,g){var _,E=this._limitCacheSize(this._getCacheCanvasDimensions()),I=c.util.createCanvasElement(),S=this.canvas.getRetinaScaling(),D=E.x/this.scaleX/S,x=E.y/this.scaleY/S;I.width=D,I.height=x,(_=I.getContext("2d")).beginPath(),_.moveTo(0,0),_.lineTo(D,0),_.lineTo(D,x),_.lineTo(0,x),_.closePath(),_.translate(D/2,x/2),_.scale(E.zoomX/this.scaleX/S,E.zoomY/this.scaleY/S),this._applyPatternGradientTransform(_,g),_.fillStyle=g.toLive(p),_.fill(),p.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),p.scale(S*this.scaleX/E.zoomX,S*this.scaleY/E.zoomY),p.strokeStyle=_.createPattern(I,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var p=c.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",p.scaleX),this.set("scaleY",p.scaleY),this.angle=p.angle,this.skewX=p.skewX,this.skewY=0}},_removeTransformMatrix:function(p){var g=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),g=c.util.transformPoint(g,this.transformMatrix)),this.transformMatrix=null,p&&(this.scaleX*=p.scaleX,this.scaleY*=p.scaleY,this.cropX=p.cropX,this.cropY=p.cropY,g.x+=p.offsetLeft,g.y+=p.offsetTop,this.width=p.width,this.height=p.height),this.setPositionByOrigin(g,"center","center")},clone:function(p,g){var _=this.toObject(g);this.constructor.fromObject?this.constructor.fromObject(_,p):c.Object._fromObject("Object",_,p)},cloneAsImage:function(p,g){var _=this.toCanvasElement(g);return p&&p(new c.Image(_)),this},toCanvasElement:function(p){p||(p={});var g=c.util,_=g.saveObjectTransform(this),E=this.group,I=this.shadow,S=Math.abs,D=(p.multiplier||1)*(p.enableRetinaScaling?c.devicePixelRatio:1);delete this.group,p.withoutTransform&&g.resetObjectTransform(this),p.withoutShadow&&(this.shadow=null);var x,R,j,U,Q=c.util.createCanvasElement(),Z=this.getBoundingRect(!0,!0),q=this.shadow,k={x:0,y:0};q&&(R=q.blur,x=q.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),k.x=2*Math.round(S(q.offsetX)+R)*S(x.scaleX),k.y=2*Math.round(S(q.offsetY)+R)*S(x.scaleY)),j=Z.width+k.x,U=Z.height+k.y,Q.width=Math.ceil(j),Q.height=Math.ceil(U);var F=new c.StaticCanvas(Q,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});p.format==="jpeg"&&(F.backgroundColor="#fff"),this.setPositionByOrigin(new c.Point(F.width/2,F.height/2),"center","center");var z=this.canvas;F.add(this);var J=F.toCanvasElement(D||1,p);return this.shadow=I,this.set("canvas",z),E&&(this.group=E),this.set(_).setCoords(),F._objects=[],F.dispose(),F=null,J},toDataURL:function(p){return p||(p={}),c.util.toDataURL(this.toCanvasElement(p),p.format||"png",p.quality||1)},isType:function(p){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===p},complexity:function(){return 1},toJSON:function(p){return this.toObject(p)},rotate:function(p){var g=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return g&&this._setOriginToCenter(),this.set("angle",p),g&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(p,g){g=g||this.canvas.getPointer(p);var _=new c.Point(g.x,g.y),E=this._getLeftTopCoords();return this.angle&&(_=c.util.rotatePoint(_,E,h(-this.angle))),{x:_.x-E.x,y:_.y-E.y}},_setupCompositeOperation:function(p){this.globalCompositeOperation&&(p.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){c.runningAnimations&&c.runningAnimations.cancelByTarget(this)}}),c.util.createAccessors&&c.util.createAccessors(c.Object),u(c.Object.prototype,c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object.ENLIVEN_PROPS=["clipPath"],c.Object._fromObject=function(p,g,_,E){var I=c[p];g=f(g,!0),c.util.enlivenPatterns([g.fill,g.stroke],function(S){S[0]!==void 0&&(g.fill=S[0]),S[1]!==void 0&&(g.stroke=S[1]),c.util.enlivenObjectEnlivables(g,g,function(){var D=E?new I(g[E],g):new I(g);_&&_(D)})})},c.Object.__uid=0)}(e),oe=w.util.degreesToRadians,te={left:-.5,center:0,right:.5},ie={top:-.5,center:0,bottom:.5},w.util.object.extend(w.Object.prototype,{translateToGivenOrigin:function(l,c,u,f,o){var s,h,m,p=l.x,g=l.y;return typeof c=="string"?c=te[c]:c-=.5,typeof f=="string"?f=te[f]:f-=.5,typeof u=="string"?u=ie[u]:u-=.5,typeof o=="string"?o=ie[o]:o-=.5,h=o-u,((s=f-c)||h)&&(m=this._getTransformedDimensions(),p=l.x+s*m.x,g=l.y+h*m.y),new w.Point(p,g)},translateToCenterPoint:function(l,c,u){var f=this.translateToGivenOrigin(l,c,u,"center","center");return this.angle?w.util.rotatePoint(f,l,oe(this.angle)):f},translateToOriginPoint:function(l,c,u){var f=this.translateToGivenOrigin(l,"center","center",c,u);return this.angle?w.util.rotatePoint(f,l,oe(this.angle)):f},getCenterPoint:function(){var l=new w.Point(this.left,this.top);return this.translateToCenterPoint(l,this.originX,this.originY)},getPointByOrigin:function(l,c){var u=this.getCenterPoint();return this.translateToOriginPoint(u,l,c)},toLocalPoint:function(l,c,u){var f,o,s=this.getCenterPoint();return f=c!==void 0&&u!==void 0?this.translateToGivenOrigin(s,"center","center",c,u):new w.Point(this.left,this.top),o=new w.Point(l.x,l.y),this.angle&&(o=w.util.rotatePoint(o,s,-oe(this.angle))),o.subtractEquals(f)},setPositionByOrigin:function(l,c,u){var f=this.translateToCenterPoint(l,c,u),o=this.translateToOriginPoint(f,this.originX,this.originY);this.set("left",o.x),this.set("top",o.y)},adjustPosition:function(l){var c,u,f=oe(this.angle),o=this.getScaledWidth(),s=w.util.cos(f)*o,h=w.util.sin(f)*o;c=typeof this.originX=="string"?te[this.originX]:this.originX-.5,u=typeof l=="string"?te[l]:l-.5,this.left+=s*(u-c),this.top+=h*(u-c),this.setCoords(),this.originX=l},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var l=this.getCenterPoint();this.originX="center",this.originY="center",this.left=l.x,this.top=l.y},_resetOrigin:function(){var l=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=l.x,this.top=l.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var l=w.util,c=l.degreesToRadians,u=l.multiplyTransformMatrices,f=l.transformPoint;l.object.extend(w.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(o,s){return s?o?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),o?this.aCoords:this.lineCoords)},getCoords:function(o,s){return h=this._getCoords(o,s),[new w.Point(h.tl.x,h.tl.y),new w.Point(h.tr.x,h.tr.y),new w.Point(h.br.x,h.br.y),new w.Point(h.bl.x,h.bl.y)];var h},intersectsWithRect:function(o,s,h,m){var p=this.getCoords(h,m);return w.Intersection.intersectPolygonRectangle(p,o,s).status==="Intersection"},intersectsWithObject:function(o,s,h){return w.Intersection.intersectPolygonPolygon(this.getCoords(s,h),o.getCoords(s,h)).status==="Intersection"||o.isContainedWithinObject(this,s,h)||this.isContainedWithinObject(o,s,h)},isContainedWithinObject:function(o,s,h){for(var m=this.getCoords(s,h),p=s?o.aCoords:o.lineCoords,g=0,_=o._getImageLines(p);g<4;g++)if(!o.containsPoint(m[g],_))return!1;return!0},isContainedWithinRect:function(o,s,h,m){var p=this.getBoundingRect(h,m);return p.left>=o.x&&p.left+p.width<=s.x&&p.top>=o.y&&p.top+p.height<=s.y},containsPoint:function(o,s,h,m){var p=this._getCoords(h,m),g=(s=s||this._getImageLines(p),this._findCrossPoints(o,s));return g!==0&&g%2==1},isOnScreen:function(o){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.getCoords(!0,o).some(function(m){return m.x<=h.x&&m.x>=s.x&&m.y<=h.y&&m.y>=s.y})||!!this.intersectsWithRect(s,h,!0,o)||this._containsCenterOfCanvas(s,h,o)},_containsCenterOfCanvas:function(o,s,h){var m={x:(o.x+s.x)/2,y:(o.y+s.y)/2};return!!this.containsPoint(m,null,!0,h)},isPartiallyOnScreen:function(o){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.intersectsWithRect(s,h,!0,o)||this.getCoords(!0,o).every(function(m){return(m.x>=h.x||m.x<=s.x)&&(m.y>=h.y||m.y<=s.y)})&&this._containsCenterOfCanvas(s,h,o)},_getImageLines:function(o){return{topline:{o:o.tl,d:o.tr},rightline:{o:o.tr,d:o.br},bottomline:{o:o.br,d:o.bl},leftline:{o:o.bl,d:o.tl}}},_findCrossPoints:function(o,s){var h,m,p,g=0;for(var _ in s)if(!((p=s[_]).o.y<o.y&&p.d.y<o.y||p.o.y>=o.y&&p.d.y>=o.y||(p.o.x===p.d.x&&p.o.x>=o.x?m=p.o.x:(h=(p.d.y-p.o.y)/(p.d.x-p.o.x),m=-(o.y-0*o.x-(p.o.y-h*p.o.x))/(0-h)),m>=o.x&&(g+=1),g!==2)))break;return g},getBoundingRect:function(o,s){var h=this.getCoords(o,s);return l.makeBoundingBoxFromPoints(h)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(o){return Math.abs(o)<this.minScaleLimit?o<0?-this.minScaleLimit:this.minScaleLimit:o===0?1e-4:o},scale:function(o){return this._set("scaleX",o),this._set("scaleY",o),this.setCoords()},scaleToWidth:function(o,s){var h=this.getBoundingRect(s).width/this.getScaledWidth();return this.scale(o/this.width/h)},scaleToHeight:function(o,s){var h=this.getBoundingRect(s).height/this.getScaledHeight();return this.scale(o/this.height/h)},calcLineCoords:function(){var o=this.getViewportTransform(),s=this.padding,h=c(this.angle),m=l.cos(h)*s,p=l.sin(h)*s,g=m+p,_=m-p,E=this.calcACoords(),I={tl:f(E.tl,o),tr:f(E.tr,o),bl:f(E.bl,o),br:f(E.br,o)};return s&&(I.tl.x-=_,I.tl.y-=g,I.tr.x+=g,I.tr.y-=_,I.bl.x-=g,I.bl.y+=_,I.br.x+=_,I.br.y+=g),I},calcOCoords:function(){var o=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),h=this.getViewportTransform(),m=u(h,s),p=u(m,o),g=(p=u(p,[1/h[0],0,0,1/h[3],0,0]),this._calculateCurrentDimensions()),_={};return this.forEachControl(function(E,I,S){_[I]=E.positionHandler(g,p,S)}),_},calcACoords:function(){var o=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),h=u(s,o),m=this._getTransformedDimensions(),p=m.x/2,g=m.y/2;return{tl:f({x:-p,y:-g},h),tr:f({x:p,y:-g},h),bl:f({x:-p,y:g},h),br:f({x:p,y:g},h)}},setCoords:function(o){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),o||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return l.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var o=this.getCenterPoint();return[1,0,0,1,o.x,o.y]},transformMatrixKey:function(o){var s="_",h="";return!o&&this.group&&(h=this.group.transformMatrixKey(o)+s),h+this.top+s+this.left+s+this.scaleX+s+this.scaleY+s+this.skewX+s+this.skewY+s+this.angle+s+this.originX+s+this.originY+s+this.width+s+this.height+s+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(o){var s=this.calcOwnMatrix();if(o||!this.group)return s;var h=this.transformMatrixKey(o),m=this.matrixCache||(this.matrixCache={});return m.key===h?m.value:(this.group&&(s=u(this.group.calcTransformMatrix(!1),s)),m.key=h,m.value=s,s)},calcOwnMatrix:function(){var o=this.transformMatrixKey(!0),s=this.ownMatrixCache||(this.ownMatrixCache={});if(s.key===o)return s.value;var h=this._calcTranslateMatrix(),m={angle:this.angle,translateX:h[4],translateY:h[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return s.key=o,s.value=l.composeMatrix(m),s.value},_getNonTransformedDimensions:function(){var o=this.strokeWidth;return{x:this.width+o,y:this.height+o}},_getTransformedDimensions:function(o,s){o===void 0&&(o=this.skewX),s===void 0&&(s=this.skewY);var h,m,p,g=o===0&&s===0;if(this.strokeUniform?(m=this.width,p=this.height):(m=(h=this._getNonTransformedDimensions()).x,p=h.y),g)return this._finalizeDimensions(m*this.scaleX,p*this.scaleY);var _=l.sizeAfterTransform(m,p,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:o,skewY:s});return this._finalizeDimensions(_.x,_.y)},_finalizeDimensions:function(o,s){return this.strokeUniform?{x:o+this.strokeWidth,y:s+this.strokeWidth}:{x:o,y:s}},_calculateCurrentDimensions:function(){var o=this.getViewportTransform(),s=this._getTransformedDimensions();return f(s,o,!0).scalarAdd(2*this.padding)}})}(),w.util.object.extend(w.Object.prototype,{sendToBack:function(){return this.group?w.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?w.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(l){return this.group?w.StaticCanvas.prototype.sendBackwards.call(this.group,this,l):this.canvas&&this.canvas.sendBackwards(this,l),this},bringForward:function(l){return this.group?w.StaticCanvas.prototype.bringForward.call(this.group,this,l):this.canvas&&this.canvas.bringForward(this,l),this},moveTo:function(l){return this.group&&this.group.type!=="activeSelection"?w.StaticCanvas.prototype.moveTo.call(this.group,this,l):this.canvas&&this.canvas.moveTo(this,l),this}}),function(){function l(u,f){if(f){if(f.toLive)return u+": url(#SVGID_"+f.id+"); ";var o=new w.Color(f),s=u+": "+o.toRgb()+"; ",h=o.getAlpha();return h!==1&&(s+=u+"-opacity: "+h.toString()+"; "),s}return u+": none; "}var c=w.util.toFixed;w.util.object.extend(w.Object.prototype,{getSvgStyles:function(u){var f=this.fillRule?this.fillRule:"nonzero",o=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):"none",h=this.strokeDashOffset?this.strokeDashOffset:"0",m=this.strokeLineCap?this.strokeLineCap:"butt",p=this.strokeLineJoin?this.strokeLineJoin:"miter",g=this.strokeMiterLimit?this.strokeMiterLimit:"4",_=this.opacity!==void 0?this.opacity:"1",E=this.visible?"":" visibility: hidden;",I=u?"":this.getSvgFilter(),S=l("fill",this.fill);return[l("stroke",this.stroke),"stroke-width: ",o,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",m,"; ","stroke-dashoffset: ",h,"; ","stroke-linejoin: ",p,"; ","stroke-miterlimit: ",g,"; ",S,"fill-rule: ",f,"; ","opacity: ",_,";",I,E].join("")},getSvgSpanStyles:function(u,f){var o="; ",s=u.fontFamily?"font-family: "+(u.fontFamily.indexOf("'")===-1&&u.fontFamily.indexOf('"')===-1?"'"+u.fontFamily+"'":u.fontFamily)+o:"",h=u.strokeWidth?"stroke-width: "+u.strokeWidth+o:"",m=u.fontSize?"font-size: "+u.fontSize+"px"+o:"",p=u.fontStyle?"font-style: "+u.fontStyle+o:"",g=u.fontWeight?"font-weight: "+u.fontWeight+o:"",_=u.fill?l("fill",u.fill):"",E=u.stroke?l("stroke",u.stroke):"",I=this.getSvgTextDecoration(u);return I&&(I="text-decoration: "+I+o),[E,h,s,m,p,g,I,_,u.deltaY?"baseline-shift: "+-u.deltaY+"; ":"",f?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(u){return["overline","underline","line-through"].filter(function(f){return u[f.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(u,f){var o=u?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+w.util.matrixToSVG(o)+(f||"")+'" '},_setSVGBg:function(u){if(this.backgroundColor){var f=w.Object.NUM_FRACTION_DIGITS;u.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',c(-this.width/2,f),'" y="',c(-this.height/2,f),'" width="',c(this.width,f),'" height="',c(this.height,f),`"></rect>
`)}},toSVG:function(u){return this._createBaseSVGMarkup(this._toSVG(u),{reviver:u})},toClipPathSVG:function(u){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(u),{reviver:u})},_createBaseClipPathSVGMarkup:function(u,f){var o=(f=f||{}).reviver,s=f.additionalTransform||"",h=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),m=u.indexOf("COMMON_PARTS");return u[m]=h,o?o(u.join("")):u.join("")},_createBaseSVGMarkup:function(u,f){var o,s,h=(f=f||{}).noStyle,m=f.reviver,p=h?"":'style="'+this.getSvgStyles()+'" ',g=f.withShadow?'style="'+this.getSvgFilter()+'" ':"",_=this.clipPath,E=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",I=_&&_.absolutePositioned,S=this.stroke,D=this.fill,x=this.shadow,R=[],j=u.indexOf("COMMON_PARTS"),U=f.additionalTransform;return _&&(_.clipPathId="CLIPPATH_"+w.Object.__uid++,s='<clipPath id="'+_.clipPathId+`" >
`+_.toClipPathSVG(m)+`</clipPath>
`),I&&R.push("<g ",g,this.getSvgCommons(),` >
`),R.push("<g ",this.getSvgTransform(!1),I?"":g+this.getSvgCommons(),` >
`),o=[p,E,h?"":this.addPaintOrder()," ",U?'transform="'+U+'" ':""].join(""),u[j]=o,D&&D.toLive&&R.push(D.toSVG(this)),S&&S.toLive&&R.push(S.toSVG(this)),x&&R.push(x.toSVG(this)),_&&R.push(s),R.push(u.join("")),R.push(`</g>
`),I&&R.push(`</g>
`),m?m(R.join("")):R.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var l=w.util.object.extend,c="stateProperties";function u(o,s,h){var m={};h.forEach(function(p){m[p]=o[p]}),l(o[s],m,!0)}function f(o,s,h){if(o===s)return!0;if(Array.isArray(o)){if(!Array.isArray(s)||o.length!==s.length)return!1;for(var m=0,p=o.length;m<p;m++)if(!f(o[m],s[m]))return!1;return!0}if(o&&typeof o=="object"){var g,_=Object.keys(o);if(!s||typeof s!="object"||!h&&_.length!==Object.keys(s).length)return!1;for(m=0,p=_.length;m<p;m++)if((g=_[m])!=="canvas"&&g!=="group"&&!f(o[g],s[g]))return!1;return!0}}w.util.object.extend(w.Object.prototype,{hasStateChanged:function(o){var s="_"+(o=o||c);return Object.keys(this[s]).length<this[o].length||!f(this[s],this,!0)},saveState:function(o){var s=o&&o.propertySet||c,h="_"+s;return this[h]?(u(this,h,this[s]),o&&o.stateProperties&&u(this,h,o.stateProperties),this):this.setupState(o)},setupState:function(o){var s=(o=o||{}).propertySet||c;return o.propertySet=s,this["_"+s]={},this.saveState(o),this}})}(),function(){var l=w.util.degreesToRadians;w.util.object.extend(w.Object.prototype,{_findTargetCorner:function(c,u){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var f,o,s,h=c.x,m=c.y,p=Object.keys(this.oCoords),g=p.length-1;for(this.__corner=0;g>=0;g--)if(s=p[g],this.isControlVisible(s)&&(o=this._getImageLines(u?this.oCoords[s].touchCorner:this.oCoords[s].corner),(f=this._findCrossPoints({x:h,y:m},o))!==0&&f%2==1))return this.__corner=s,s;return!1},forEachControl:function(c){for(var u in this.controls)c(this.controls[u],u,this)},_setCornerCoords:function(){var c=this.oCoords;for(var u in c){var f=this.controls[u];c[u].corner=f.calcCornerCoords(this.angle,this.cornerSize,c[u].x,c[u].y,!1),c[u].touchCorner=f.calcCornerCoords(this.angle,this.touchCornerSize,c[u].x,c[u].y,!0)}},drawSelectionBackground:function(c){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;c.save();var u=this.getCenterPoint(),f=this._calculateCurrentDimensions(),o=this.canvas.viewportTransform;return c.translate(u.x,u.y),c.scale(1/o[0],1/o[3]),c.rotate(l(this.angle)),c.fillStyle=this.selectionBackgroundColor,c.fillRect(-f.x/2,-f.y/2,f.x,f.y),c.restore(),this},drawBorders:function(c,u){u=u||{};var f=this._calculateCurrentDimensions(),o=this.borderScaleFactor,s=f.x+o,h=f.y+o,m=u.hasControls!==void 0?u.hasControls:this.hasControls,p=!1;return c.save(),c.strokeStyle=u.borderColor||this.borderColor,this._setLineDash(c,u.borderDashArray||this.borderDashArray),c.strokeRect(-s/2,-h/2,s,h),m&&(c.beginPath(),this.forEachControl(function(g,_,E){g.withConnection&&g.getVisibility(E,_)&&(p=!0,c.moveTo(g.x*s,g.y*h),c.lineTo(g.x*s+g.offsetX,g.y*h+g.offsetY))}),p&&c.stroke()),c.restore(),this},drawBordersInGroup:function(c,u,f){f=f||{};var o=w.util.sizeAfterTransform(this.width,this.height,u),s=this.strokeWidth,h=this.strokeUniform,m=this.borderScaleFactor,p=o.x+s*(h?this.canvas.getZoom():u.scaleX)+m,g=o.y+s*(h?this.canvas.getZoom():u.scaleY)+m;return c.save(),this._setLineDash(c,f.borderDashArray||this.borderDashArray),c.strokeStyle=f.borderColor||this.borderColor,c.strokeRect(-p/2,-g/2,p,g),c.restore(),this},drawControls:function(c,u){u=u||{},c.save();var f,o,s=this.canvas.getRetinaScaling();return c.setTransform(s,0,0,s,0,0),c.strokeStyle=c.fillStyle=u.cornerColor||this.cornerColor,this.transparentCorners||(c.strokeStyle=u.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(c,u.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(f=this.group.calcTransformMatrix()),this.forEachControl(function(h,m,p){o=p.oCoords[m],h.getVisibility(p,m)&&(f&&(o=w.util.transformPoint(o,f)),h.render(c,o.x,o.y,u,p))}),c.restore(),this},isControlVisible:function(c){return this.controls[c]&&this.controls[c].getVisibility(this,c)},setControlVisible:function(c,u){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[c]=u,this},setControlsVisibility:function(c){for(var u in c||(c={}),c)this.setControlVisible(u,c[u]);return this},onDeselect:function(){},onSelect:function(){}})}(),w.util.object.extend(w.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(l,c){var u=function(){},f=(c=c||{}).onComplete||u,o=c.onChange||u,s=this;return w.util.animate({target:this,startValue:l.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(h){l.set("left",h),s.requestRenderAll(),o()},onComplete:function(){l.setCoords(),f()}})},fxCenterObjectV:function(l,c){var u=function(){},f=(c=c||{}).onComplete||u,o=c.onChange||u,s=this;return w.util.animate({target:this,startValue:l.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(h){l.set("top",h),s.requestRenderAll(),o()},onComplete:function(){l.setCoords(),f()}})},fxRemove:function(l,c){var u=function(){},f=(c=c||{}).onComplete||u,o=c.onChange||u,s=this;return w.util.animate({target:this,startValue:l.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(h){l.set("opacity",h),s.requestRenderAll(),o()},onComplete:function(){s.remove(l),f()}})}}),w.util.object.extend(w.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var l,c,u=[],f=[];for(l in arguments[0])u.push(l);for(var o=0,s=u.length;o<s;o++)l=u[o],c=o!==s-1,f.push(this._animate(l,arguments[0][l],arguments[1],c));return f}return this._animate.apply(this,arguments)},_animate:function(l,c,u,f){var o,s=this;c=c.toString(),u=u?w.util.object.clone(u):{},~l.indexOf(".")&&(o=l.split("."));var h=s.colorProperties.indexOf(l)>-1||o&&s.colorProperties.indexOf(o[1])>-1,m=o?this.get(o[0])[o[1]]:this.get(l);"from"in u||(u.from=m),h||(c=~c.indexOf("=")?m+parseFloat(c.replace("=","")):parseFloat(c));var p={target:this,startValue:u.from,endValue:c,byValue:u.by,easing:u.easing,duration:u.duration,abort:u.abort&&function(g,_,E){return u.abort.call(s,g,_,E)},onChange:function(g,_,E){o?s[o[0]][o[1]]=g:s.set(l,g),f||u.onChange&&u.onChange(g,_,E)},onComplete:function(g,_,E){f||(s.setCoords(),u.onComplete&&u.onComplete(g,_,E))}};return h?w.util.animateColor(p.startValue,p.endValue,p.duration,p):w.util.animate(p)}}),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.extend,f=c.util.object.clone,o={x1:1,x2:1,y1:1,y2:1};function s(h,m){var p=h.origin,g=h.axis1,_=h.axis2,E=h.dimension,I=m.nearest,S=m.center,D=m.farthest;return function(){switch(this.get(p)){case I:return Math.min(this.get(g),this.get(_));case S:return Math.min(this.get(g),this.get(_))+.5*this.get(E);case D:return Math.max(this.get(g),this.get(_))}}}c.Line?c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:c.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(h,m){h||(h=[0,0,0,0]),this.callSuper("initialize",m),this.set("x1",h[0]),this.set("y1",h[1]),this.set("x2",h[2]),this.set("y2",h[3]),this._setWidthHeight(m)},_setWidthHeight:function(h){h||(h={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in h?h.left:this._getLeftToOriginX(),this.top="top"in h?h.top:this._getTopToOriginY()},_set:function(h,m){return this.callSuper("_set",h,m),o[h]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(h){h.beginPath();var m=this.calcLinePoints();h.moveTo(m.x1,m.y1),h.lineTo(m.x2,m.y2),h.lineWidth=this.strokeWidth;var p=h.strokeStyle;h.strokeStyle=this.stroke||h.fillStyle,this.stroke&&this._renderStroke(h),h.strokeStyle=p},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(h){return u(this.callSuper("toObject",h),this.calcLinePoints())},_getNonTransformedDimensions:function(){var h=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(h.y-=this.strokeWidth),this.height===0&&(h.x-=this.strokeWidth)),h},calcLinePoints:function(){var h=this.x1<=this.x2?-1:1,m=this.y1<=this.y2?-1:1,p=h*this.width*.5,g=m*this.height*.5;return{x1:p,x2:h*this.width*-.5,y1:g,y2:m*this.height*-.5}},_toSVG:function(){var h=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,`" />
`]}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),c.Line.fromElement=function(h,m,p){p=p||{};var g=c.parseAttributes(h,c.Line.ATTRIBUTE_NAMES),_=[g.x1||0,g.y1||0,g.x2||0,g.y2||0];m(new c.Line(_,u(g,p)))},c.Line.fromObject=function(h,m){var p=f(h,!0);p.points=[h.x1,h.y1,h.x2,h.y2],c.Object._fromObject("Line",p,function(g){delete g.points,m&&m(g)},"points")})}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.degreesToRadians;c.Circle?c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:c.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(f,o){return this.callSuper("_set",f,o),f==="radius"&&this.setRadius(o),this},toObject:function(f){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(f))},_toSVG:function(){var f,o=(this.endAngle-this.startAngle)%360;if(o===0)f=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var s=u(this.startAngle),h=u(this.endAngle),m=this.radius;f=['<path d="M '+c.util.cos(s)*m+" "+c.util.sin(s)*m," A "+m+" "+m," 0 ",+(o>180?"1":"0")+" 1"," "+c.util.cos(h)*m+" "+c.util.sin(h)*m,'" ',"COMMON_PARTS",` />
`]}return f},_render:function(f){f.beginPath(),f.arc(0,0,this.radius,u(this.startAngle),u(this.endAngle),!1),this._renderPaintInOrder(f)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){return this.radius=f,this.set("width",2*f).set("height",2*f)}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),c.Circle.fromElement=function(f,o){var s,h=c.parseAttributes(f,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in(s=h)&&s.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");h.left=(h.left||0)-h.radius,h.top=(h.top||0)-h.radius,o(new c.Circle(h))},c.Circle.fromObject=function(f,o){c.Object._fromObject("Circle",f,o)})}(e),function(l){var c=l.fabric||(l.fabric={});c.Triangle?c.warn("fabric.Triangle is already defined"):(c.Triangle=c.util.createClass(c.Object,{type:"triangle",width:100,height:100,_render:function(u){var f=this.width/2,o=this.height/2;u.beginPath(),u.moveTo(-f,o),u.lineTo(0,-o),u.lineTo(f,o),u.closePath(),this._renderPaintInOrder(u)},_toSVG:function(){var u=this.width/2,f=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-u+" "+f,"0 "+-f,u+" "+f].join(","),'" />']}}),c.Triangle.fromObject=function(u,f){return c.Object._fromObject("Triangle",u,f)})}(e),function(l){var c=l.fabric||(l.fabric={}),u=2*Math.PI;c.Ellipse?c.warn("fabric.Ellipse is already defined."):(c.Ellipse=c.util.createClass(c.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:c.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this.set("rx",f&&f.rx||0),this.set("ry",f&&f.ry||0)},_set:function(f,o){switch(this.callSuper("_set",f,o),f){case"rx":this.rx=o,this.set("width",2*o);break;case"ry":this.ry=o,this.set("height",2*o)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(f){f.beginPath(),f.save(),f.transform(1,0,0,this.ry/this.rx,0,0),f.arc(0,0,this.rx,0,u,!1),f.restore(),this._renderPaintInOrder(f)}}),c.Ellipse.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),c.Ellipse.fromElement=function(f,o){var s=c.parseAttributes(f,c.Ellipse.ATTRIBUTE_NAMES);s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,o(new c.Ellipse(s))},c.Ellipse.fromObject=function(f,o){c.Object._fromObject("Ellipse",f,o)})}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.extend;c.Rect?c.warn("fabric.Rect is already defined"):(c.Rect=c.util.createClass(c.Object,{stateProperties:c.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:c.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(f){var o=this.rx?Math.min(this.rx,this.width/2):0,s=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,m=this.height,p=-this.width/2,g=-this.height/2,_=o!==0||s!==0,E=.4477152502;f.beginPath(),f.moveTo(p+o,g),f.lineTo(p+h-o,g),_&&f.bezierCurveTo(p+h-E*o,g,p+h,g+E*s,p+h,g+s),f.lineTo(p+h,g+m-s),_&&f.bezierCurveTo(p+h,g+m-E*s,p+h-E*o,g+m,p+h-o,g+m),f.lineTo(p+o,g+m),_&&f.bezierCurveTo(p+E*o,g+m,p,g+m-E*s,p,g+m-s),f.lineTo(p,g+s),_&&f.bezierCurveTo(p,g+E*s,p+E*o,g,p+o,g),f.closePath(),this._renderPaintInOrder(f)},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),c.Rect.fromElement=function(f,o,s){if(!f)return o(null);s=s||{};var h=c.parseAttributes(f,c.Rect.ATTRIBUTE_NAMES);h.left=h.left||0,h.top=h.top||0,h.height=h.height||0,h.width=h.width||0;var m=new c.Rect(u(s?c.util.object.clone(s):{},h));m.visible=m.visible&&m.width>0&&m.height>0,o(m)},c.Rect.fromObject=function(f,o){return c.Object._fromObject("Rect",f,o)})}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.extend,f=c.util.array.min,o=c.util.array.max,s=c.util.toFixed,h=c.util.projectStrokeOnPoints;c.Polyline?c.warn("fabric.Polyline is already defined"):(c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:c.Object.prototype.cacheProperties.concat("points"),initialize:function(m,p){p=p||{},this.points=m||[],this.callSuper("initialize",p),this._setPositionDimensions(p)},_projectStrokeOnPoints:function(){return h(this.points,this,!0)},_setPositionDimensions:function(m){var p,g=this._calcDimensions(m),_=this.exactBoundingBox?this.strokeWidth:0;this.width=g.width-_,this.height=g.height-_,m.fromSVG||(p=this.translateToGivenOrigin({x:g.left-this.strokeWidth/2+_/2,y:g.top-this.strokeWidth/2+_/2},"left","top",this.originX,this.originY)),m.left===void 0&&(this.left=m.fromSVG?g.left:p.x),m.top===void 0&&(this.top=m.fromSVG?g.top:p.y),this.pathOffset={x:g.left+this.width/2+_/2,y:g.top+this.height/2+_/2}},_calcDimensions:function(){var m=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,p=f(m,"x")||0,g=f(m,"y")||0;return{left:p,top:g,width:(o(m,"x")||0)-p,height:(o(m,"y")||0)-g}},toObject:function(m){return u(this.callSuper("toObject",m),{points:this.points.concat()})},_toSVG:function(){for(var m=[],p=this.pathOffset.x,g=this.pathOffset.y,_=c.Object.NUM_FRACTION_DIGITS,E=0,I=this.points.length;E<I;E++)m.push(s(this.points[E].x-p,_),",",s(this.points[E].y-g,_)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',m.join(""),`" />
`]},commonRender:function(m){var p,g=this.points.length,_=this.pathOffset.x,E=this.pathOffset.y;if(!g||isNaN(this.points[g-1].y))return!1;m.beginPath(),m.moveTo(this.points[0].x-_,this.points[0].y-E);for(var I=0;I<g;I++)p=this.points[I],m.lineTo(p.x-_,p.y-E);return!0},_render:function(m){this.commonRender(m)&&this._renderPaintInOrder(m)},complexity:function(){return this.get("points").length}}),c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polyline.fromElementGenerator=function(m){return function(p,g,_){if(!p)return g(null);_||(_={});var E=c.parsePointsAttribute(p.getAttribute("points")),I=c.parseAttributes(p,c[m].ATTRIBUTE_NAMES);I.fromSVG=!0,g(new c[m](E,u(I,_)))}},c.Polyline.fromElement=c.Polyline.fromElementGenerator("Polyline"),c.Polyline.fromObject=function(m,p){return c.Object._fromObject("Polyline",m,p,"points")})}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.projectStrokeOnPoints;c.Polygon?c.warn("fabric.Polygon is already defined"):(c.Polygon=c.util.createClass(c.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return u(this.points,this)},_render:function(f){this.commonRender(f)&&(f.closePath(),this._renderPaintInOrder(f))}}),c.Polygon.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polygon.fromElement=c.Polyline.fromElementGenerator("Polygon"),c.Polygon.fromObject=function(f,o){c.Object._fromObject("Polygon",f,o,"points")})}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.array.min,f=c.util.array.max,o=c.util.object.extend,s=c.util.object.clone,h=c.util.toFixed;c.Path?c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,cacheProperties:c.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:c.Object.prototype.stateProperties.concat("path"),initialize:function(m,p){delete(p=s(p||{})).path,this.callSuper("initialize",p),this._setPath(m||[],p)},_setPath:function(m,p){this.path=c.util.makePathSimpler(Array.isArray(m)?m:c.util.parsePath(m)),c.Polyline.prototype._setPositionDimensions.call(this,p||{})},_renderPathCommands:function(m){var p,g=0,_=0,E=0,I=0,S=0,D=0,x=-this.pathOffset.x,R=-this.pathOffset.y;m.beginPath();for(var j=0,U=this.path.length;j<U;++j)switch((p=this.path[j])[0]){case"L":E=p[1],I=p[2],m.lineTo(E+x,I+R);break;case"M":g=E=p[1],_=I=p[2],m.moveTo(E+x,I+R);break;case"C":E=p[5],I=p[6],S=p[3],D=p[4],m.bezierCurveTo(p[1]+x,p[2]+R,S+x,D+R,E+x,I+R);break;case"Q":m.quadraticCurveTo(p[1]+x,p[2]+R,p[3]+x,p[4]+R),E=p[3],I=p[4],S=p[1],D=p[2];break;case"z":case"Z":E=g,I=_,m.closePath()}},_render:function(m){this._renderPathCommands(m),this._renderPaintInOrder(m)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(m){return o(this.callSuper("toObject",m),{path:this.path.map(function(p){return p.slice()})})},toDatalessObject:function(m){var p=this.toObject(["sourcePath"].concat(m));return p.sourcePath&&delete p.path,p},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',c.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var m=c.Object.NUM_FRACTION_DIGITS;return" translate("+h(-this.pathOffset.x,m)+", "+h(-this.pathOffset.y,m)+")"},toClipPathSVG:function(m){var p=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:m,additionalTransform:p})},toSVG:function(m){var p=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:m,additionalTransform:p})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var m,p,g=[],_=[],E=0,I=0,S=0,D=0,x=0,R=this.path.length;x<R;++x){switch((m=this.path[x])[0]){case"L":S=m[1],D=m[2],p=[];break;case"M":E=S=m[1],I=D=m[2],p=[];break;case"C":p=c.util.getBoundsOfCurve(S,D,m[1],m[2],m[3],m[4],m[5],m[6]),S=m[5],D=m[6];break;case"Q":p=c.util.getBoundsOfCurve(S,D,m[1],m[2],m[1],m[2],m[3],m[4]),S=m[3],D=m[4];break;case"z":case"Z":S=E,D=I}p.forEach(function(Q){g.push(Q.x),_.push(Q.y)}),g.push(S),_.push(D)}var j=u(g)||0,U=u(_)||0;return{left:j,top:U,width:(f(g)||0)-j,height:(f(_)||0)-U}}}),c.Path.fromObject=function(m,p){if(typeof m.sourcePath=="string"){var g=m.sourcePath;c.loadSVGFromURL(g,function(_){var E=_[0];E.setOptions(m),p&&p(E)})}else c.Object._fromObject("Path",m,p,"path")},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(m,p,g){var _=c.parseAttributes(m,c.Path.ATTRIBUTE_NAMES);_.fromSVG=!0,p(new c.Path(_.d,o(_,g)))})}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.array.min,f=c.util.array.max;c.Group||(c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(o,s,h){s=s||{},this._objects=[],h&&this.callSuper("initialize",s),this._objects=o||[];for(var m=this._objects.length;m--;)this._objects[m].group=this;if(h)this._updateObjectsACoords();else{var p=s&&s.centerPoint;s.originX!==void 0&&(this.originX=s.originX),s.originY!==void 0&&(this.originY=s.originY),p||this._calcBounds(),this._updateObjectsCoords(p),delete s.centerPoint,this.callSuper("initialize",s)}this.setCoords()},_updateObjectsACoords:function(){for(var o=this._objects.length;o--;)this._objects[o].setCoords(!0)},_updateObjectsCoords:function(o){o=o||this.getCenterPoint();for(var s=this._objects.length;s--;)this._updateObjectCoords(this._objects[s],o)},_updateObjectCoords:function(o,s){var h=o.left,m=o.top;o.set({left:h-s.x,top:m-s.y}),o.group=this,o.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(o){var s=!!this.group;return this._restoreObjectsState(),c.util.resetObjectTransform(this),o&&(s&&c.util.removeTransformFromObject(o,this.group.calcTransformMatrix()),this._objects.push(o),o.group=this,o._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,s?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(o){return this._restoreObjectsState(),c.util.resetObjectTransform(this),this.remove(o),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(o){this.dirty=!0,o.group=this,o._set("canvas",this.canvas)},_onObjectRemoved:function(o){this.dirty=!0,delete o.group},_set:function(o,s){var h=this._objects.length;if(this.useSetOnGroup)for(;h--;)this._objects[h].setOnGroup(o,s);if(o==="canvas")for(;h--;)this._objects[h]._set(o,s);c.Object.prototype._set.call(this,o,s)},toObject:function(o){var s=this.includeDefaultValues,h=this._objects.filter(function(p){return!p.excludeFromExport}).map(function(p){var g=p.includeDefaultValues;p.includeDefaultValues=s;var _=p.toObject(o);return p.includeDefaultValues=g,_}),m=c.Object.prototype.toObject.call(this,o);return m.objects=h,m},toDatalessObject:function(o){var s,h=this.sourcePath;if(h)s=h;else{var m=this.includeDefaultValues;s=this._objects.map(function(g){var _=g.includeDefaultValues;g.includeDefaultValues=m;var E=g.toDatalessObject(o);return g.includeDefaultValues=_,E})}var p=c.Object.prototype.toDatalessObject.call(this,o);return p.objects=s,p},render:function(o){this._transformDone=!0,this.callSuper("render",o),this._transformDone=!1},shouldCache:function(){var o=c.Object.prototype.shouldCache.call(this);if(o){for(var s=0,h=this._objects.length;s<h;s++)if(this._objects[s].willDrawShadow())return this.ownCaching=!1,!1}return o},willDrawShadow:function(){if(c.Object.prototype.willDrawShadow.call(this))return!0;for(var o=0,s=this._objects.length;o<s;o++)if(this._objects[o].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(o){for(var s=0,h=this._objects.length;s<h;s++)this._objects[s].render(o);this._drawClipPath(o,this.clipPath)},isCacheDirty:function(o){if(this.callSuper("isCacheDirty",o))return!0;if(!this.statefullCache)return!1;for(var s=0,h=this._objects.length;s<h;s++)if(this._objects[s].isCacheDirty(!0)){if(this._cacheCanvas){var m=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-m/2,-p/2,m,p)}return!0}return!1},_restoreObjectsState:function(){var o=this.calcOwnMatrix();return this._objects.forEach(function(s){c.util.addTransformToObject(s,o),delete s.group,s.setCoords()}),this},destroy:function(){return this._objects.forEach(function(o){o.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(o){o.dispose&&o.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var o=this._objects,s=this.canvas;this._objects=[];var h=this.toObject();delete h.objects;var m=new c.ActiveSelection([]);return m.set(h),m.type="activeSelection",s.remove(this),o.forEach(function(p){p.group=m,p.dirty=!0,s.add(p)}),m.canvas=s,m._objects=o,s._activeObject=m,m.setCoords(),m}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(o){o.setCoords(!0)}),this},_calcBounds:function(o){for(var s,h,m,p,g=[],_=[],E=["tr","br","bl","tl"],I=0,S=this._objects.length,D=E.length;I<S;++I){for(m=(s=this._objects[I]).calcACoords(),p=0;p<D;p++)h=E[p],g.push(m[h].x),_.push(m[h].y);s.aCoords=m}this._getBounds(g,_,o)},_getBounds:function(o,s,h){var m=new c.Point(u(o),u(s)),p=new c.Point(f(o),f(s)),g=m.y||0,_=m.x||0,E=p.x-m.x||0,I=p.y-m.y||0;this.width=E,this.height=I,h||this.setPositionByOrigin({x:_,y:g},"left","top")},_toSVG:function(o){for(var s=["<g ","COMMON_PARTS",` >
`],h=0,m=this._objects.length;h<m;h++)s.push("		",this._objects[h].toSVG(o));return s.push(`</g>
`),s},getSvgStyles:function(){var o=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",s=this.visible?"":" visibility: hidden;";return[o,this.getSvgFilter(),s].join("")},toClipPathSVG:function(o){for(var s=[],h=0,m=this._objects.length;h<m;h++)s.push("	",this._objects[h].toClipPathSVG(o));return this._createBaseClipPathSVGMarkup(s,{reviver:o})}}),c.Group.fromObject=function(o,s){var h=o.objects,m=c.util.object.clone(o,!0);delete m.objects,typeof h!="string"?c.util.enlivenObjects(h,function(p){var g=c.util.object.clone(o,!0);delete g.objects,c.util.enlivenObjectEnlivables(o,g,function(){s&&s(new c.Group(p,g,!0))})}):c.loadSVGFromURL(h,function(p){var g=c.util.groupSVGElements(p,o,h);g.set(m),s&&s(g)})})}(e),function(l){var c=l.fabric||(l.fabric={});c.ActiveSelection||(c.ActiveSelection=c.util.createClass(c.Group,{type:"activeSelection",initialize:function(u,f){f=f||{},this._objects=u||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;f.originX&&(this.originX=f.originX),f.originY&&(this.originY=f.originY),this._calcBounds(),this._updateObjectsCoords(),c.Object.prototype.initialize.call(this,f),this.setCoords()},toGroup:function(){var u=this._objects.concat();this._objects=[];var f=c.Object.prototype.toObject.call(this),o=new c.Group([]);if(delete f.type,o.set(f),u.forEach(function(h){h.canvas.remove(h),h.group=o}),o._objects=u,!this.canvas)return o;var s=this.canvas;return s.add(o),s._activeObject=o,o.setCoords(),o},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(u,f,o){u.save(),u.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",u,f),(o=o||{}).hasControls===void 0&&(o.hasControls=!1),o.forActiveSelection=!0;for(var s=0,h=this._objects.length;s<h;s++)this._objects[s]._renderControls(u,o);u.restore()}}),c.ActiveSelection.fromObject=function(u,f){c.util.enlivenObjects(u.objects,function(o){delete u.objects,f&&f(new c.ActiveSelection(o,u,!0))})})}(e),function(l){var c=w.util.object.extend;l.fabric||(l.fabric={}),l.fabric.Image?w.warn("fabric.Image is already defined."):(w.Image=w.util.createClass(w.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:w.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:w.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(u,f){f||(f={}),this.filters=[],this.cacheKey="texture"+w.Object.__uid++,this.callSuper("initialize",f),this._initElement(u,f)},getElement:function(){return this._element||{}},setElement:function(u,f){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=u,this._originalElement=u,this._initConfig(f),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(u){var f=w.filterBackend;f&&f.evictCachesForKey&&f.evictCachesForKey(u)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(u){w.util.cleanUpJsdomNode(this[u]),this[u]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var u=this.getElement();return{width:u.naturalWidth||u.width,height:u.naturalHeight||u.height}},_stroke:function(u){if(this.stroke&&this.strokeWidth!==0){var f=this.width/2,o=this.height/2;u.beginPath(),u.moveTo(-f,-o),u.lineTo(f,-o),u.lineTo(f,o),u.lineTo(-f,o),u.lineTo(-f,-o),u.closePath()}},toObject:function(u){var f=[];this.filters.forEach(function(s){s&&f.push(s.toObject())});var o=c(this.callSuper("toObject",["cropX","cropY"].concat(u)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:f});return this.resizeFilter&&(o.resizeFilter=this.resizeFilter.toObject()),o},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var u,f=[],o=[],s=this._element,h=-this.width/2,m=-this.height/2,p="",g="";if(!s)return[];if(this.hasCrop()){var _=w.Object.__uid++;f.push('<clipPath id="imageCrop_'+_+`">
`,'	<rect x="'+h+'" y="'+m+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),p=' clip-path="url(#imageCrop_'+_+')" '}if(this.imageSmoothing||(g='" image-rendering="optimizeSpeed'),o.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',h-this.cropX,'" y="',m-this.cropY,'" width="',s.width||s.naturalWidth,'" height="',s.height||s.height,g,'"',p,`></image>
`),this.stroke||this.strokeDashArray){var E=this.fill;this.fill=null,u=["	<rect ",'x="',h,'" y="',m,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=E}return this.paintFirst!=="fill"?f.concat(u,o):f.concat(o,u)},getSrc:function(u){var f=u?this._element:this._originalElement;return f?f.toDataURL?f.toDataURL():this.srcFromAttribute?f.getAttribute("src"):f.src:this.src||""},setSrc:function(u,f,o){return w.util.loadImage(u,function(s,h){this.setElement(s,o),this._setWidthHeight(),f&&f(this,h)},this,o&&o.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var u=this.resizeFilter,f=this.minimumScaleTrigger,o=this.getTotalObjectScaling(),s=o.scaleX,h=o.scaleY,m=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!u||s>f&&h>f)return this._element=m,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,void(this._lastScaleY=h);w.filterBackend||(w.filterBackend=w.initFilterBackend());var p=w.util.createCanvasElement(),g=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,_=m.width,E=m.height;p.width=_,p.height=E,this._element=p,this._lastScaleX=u.scaleX=s,this._lastScaleY=u.scaleY=h,w.filterBackend.applyFilters([u],m,_,E,this._element,g),this._filterScalingX=p.width/this._originalElement.width,this._filterScalingY=p.height/this._originalElement.height},applyFilters:function(u){if(u=(u=u||this.filters||[]).filter(function(m){return m&&!m.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),u.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var f=this._originalElement,o=f.naturalWidth||f.width,s=f.naturalHeight||f.height;if(this._element===this._originalElement){var h=w.util.createCanvasElement();h.width=o,h.height=s,this._element=h,this._filteredEl=h}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,o,s),this._lastScaleX=1,this._lastScaleY=1;return w.filterBackend||(w.filterBackend=w.initFilterBackend()),w.filterBackend.applyFilters(u,this._originalElement,o,s,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(u){w.util.setImageSmoothing(u,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(u),this._renderPaintInOrder(u)},drawCacheOnCanvas:function(u){w.util.setImageSmoothing(u,this.imageSmoothing),w.Object.prototype.drawCacheOnCanvas.call(this,u)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(u){var f=this._element;if(f){var o=this._filterScalingX,s=this._filterScalingY,h=this.width,m=this.height,p=Math.min,g=Math.max,_=g(this.cropX,0),E=g(this.cropY,0),I=f.naturalWidth||f.width,S=f.naturalHeight||f.height,D=_*o,x=E*s,R=p(h*o,I-D),j=p(m*s,S-x),U=-h/2,Q=-m/2,Z=p(h,I/o-_),q=p(m,S/s-E);f&&u.drawImage(f,D,x,R,j,U,Q,Z,q)}},_needsResize:function(){var u=this.getTotalObjectScaling();return u.scaleX!==this._lastScaleX||u.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(u,f){this.setElement(w.util.getById(u),f),w.util.addClass(this.getElement(),w.Image.CSS_CANVAS)},_initConfig:function(u){u||(u={}),this.setOptions(u),this._setWidthHeight(u)},_initFilters:function(u,f){u&&u.length?w.util.enlivenObjects(u,function(o){f&&f(o)},"fabric.Image.filters"):f&&f()},_setWidthHeight:function(u){u||(u={});var f=this.getElement();this.width=u.width||f.naturalWidth||f.width||0,this.height=u.height||f.naturalHeight||f.height||0},parsePreserveAspectRatioAttribute:function(){var u,f=w.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),o=this._element.width,s=this._element.height,h=1,m=1,p=0,g=0,_=0,E=0,I=this.width,S=this.height,D={width:I,height:S};return!f||f.alignX==="none"&&f.alignY==="none"?(h=I/o,m=S/s):(f.meetOrSlice==="meet"&&(u=(I-o*(h=m=w.util.findScaleToFit(this._element,D)))/2,f.alignX==="Min"&&(p=-u),f.alignX==="Max"&&(p=u),u=(S-s*m)/2,f.alignY==="Min"&&(g=-u),f.alignY==="Max"&&(g=u)),f.meetOrSlice==="slice"&&(u=o-I/(h=m=w.util.findScaleToCover(this._element,D)),f.alignX==="Mid"&&(_=u/2),f.alignX==="Max"&&(_=u),u=s-S/m,f.alignY==="Mid"&&(E=u/2),f.alignY==="Max"&&(E=u),o=I/h,s=S/m)),{width:o,height:s,scaleX:h,scaleY:m,offsetLeft:p,offsetTop:g,cropX:_,cropY:E}}}),w.Image.CSS_CANVAS="canvas-img",w.Image.prototype.getSvgSrc=w.Image.prototype.getSrc,w.Image.fromObject=function(u,f){var o=w.util.object.clone(u);w.util.loadImage(o.src,function(s,h){h?f&&f(null,!0):w.Image.prototype._initFilters.call(o,o.filters,function(m){o.filters=m||[],w.Image.prototype._initFilters.call(o,[o.resizeFilter],function(p){o.resizeFilter=p[0],w.util.enlivenObjectEnlivables(o,o,function(){var g=new w.Image(s,o);f(g,!1)})})})},null,o.crossOrigin)},w.Image.fromURL=function(u,f,o){w.util.loadImage(u,function(s,h){f&&f(new w.Image(s,o),h)},null,o&&o.crossOrigin)},w.Image.ATTRIBUTE_NAMES=w.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),w.Image.fromElement=function(u,f,o){var s=w.parseAttributes(u,w.Image.ATTRIBUTE_NAMES);w.Image.fromURL(s["xlink:href"],f,c(o?w.util.object.clone(o):{},s))})}(e),w.util.object.extend(w.Object.prototype,{_getAngleValueForStraighten:function(){var l=this.angle%360;return l>0?90*Math.round((l-1)/90):90*Math.round(l/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(l){var c=function(){},u=(l=l||{}).onComplete||c,f=l.onChange||c,o=this;return w.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){o.rotate(s),f()},onComplete:function(){o.setCoords(),u()}})}}),w.util.object.extend(w.StaticCanvas.prototype,{straightenObject:function(l){return l.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(l){return l.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function l(u,f){var o="precision "+f+` float;
void main(){}`,s=u.createShader(u.FRAGMENT_SHADER);return u.shaderSource(s,o),u.compileShader(s),!!u.getShaderParameter(s,u.COMPILE_STATUS)}function c(u){u&&u.tileSize&&(this.tileSize=u.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}w.isWebglSupported=function(u){if(w.isLikelyNode)return!1;u=u||w.WebglFilterBackend.prototype.tileSize;var f=document.createElement("canvas"),o=f.getContext("webgl")||f.getContext("experimental-webgl"),s=!1;if(o){w.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),s=w.maxTextureSize>=u;for(var h=["highp","mediump","lowp"],m=0;m<3;m++)if(l(o,h[m])){w.webGlPrecision=h[m];break}}return this.isSupported=s,s},w.WebglFilterBackend=c,c.prototype={tileSize:2048,resources:{},setupGLContext:function(u,f){this.dispose(),this.createWebGLCanvas(u,f),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(u,f)},chooseFastestCopyGLTo2DMethod:function(u,f){var o,s=window.performance!==void 0;try{new ImageData(1,1),o=!0}catch{o=!1}var h=typeof ArrayBuffer<"u",m=typeof Uint8ClampedArray<"u";if(s&&o&&h&&m){var p=w.util.createCanvasElement(),g=new ArrayBuffer(u*f*4);if(w.forceGLPutImageData)return this.imageBuffer=g,void(this.copyGLTo2D=de);var _,E,I={imageBuffer:g,destinationWidth:u,destinationHeight:f,targetCanvas:p};p.width=u,p.height=f,_=window.performance.now(),pe.call(I,this.gl,I),E=window.performance.now()-_,_=window.performance.now(),de.call(I,this.gl,I),E>window.performance.now()-_?(this.imageBuffer=g,this.copyGLTo2D=de):this.copyGLTo2D=pe}},createWebGLCanvas:function(u,f){var o=w.util.createCanvasElement();o.width=u,o.height=f;var s={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},h=o.getContext("webgl",s);h||(h=o.getContext("experimental-webgl",s)),h&&(h.clearColor(0,0,0,0),this.canvas=o,this.gl=h)},applyFilters:function(u,f,o,s,h,m){var p,g=this.gl;m&&(p=this.getCachedTexture(m,f));var _={originalWidth:f.width||f.originalWidth,originalHeight:f.height||f.originalHeight,sourceWidth:o,sourceHeight:s,destinationWidth:o,destinationHeight:s,context:g,sourceTexture:this.createTexture(g,o,s,!p&&f),targetTexture:this.createTexture(g,o,s),originalTexture:p||this.createTexture(g,o,s,!p&&f),passes:u.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:h},E=g.createFramebuffer();return g.bindFramebuffer(g.FRAMEBUFFER,E),u.forEach(function(I){I&&I.applyTo(_)}),function(I){var S=I.targetCanvas,D=S.width,x=S.height,R=I.destinationWidth,j=I.destinationHeight;D===R&&x===j||(S.width=R,S.height=j)}(_),this.copyGLTo2D(g,_),g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(_.sourceTexture),g.deleteTexture(_.targetTexture),g.deleteFramebuffer(E),h.getContext("2d").setTransform(1,0,0,1,0,0),_},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(u,f,o,s){var h=u.createTexture();return u.bindTexture(u.TEXTURE_2D,h),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),s?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,s):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,f,o,0,u.RGBA,u.UNSIGNED_BYTE,null),h},getCachedTexture:function(u,f){if(this.textureCache[u])return this.textureCache[u];var o=this.createTexture(this.gl,f.width,f.height,f);return this.textureCache[u]=o,o},evictCachesForKey:function(u){this.textureCache[u]&&(this.gl.deleteTexture(this.textureCache[u]),delete this.textureCache[u])},copyGLTo2D:pe,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var u=this.gl,f={renderer:"",vendor:""};if(!u)return f;var o=u.getExtension("WEBGL_debug_renderer_info");if(o){var s=u.getParameter(o.UNMASKED_RENDERER_WEBGL),h=u.getParameter(o.UNMASKED_VENDOR_WEBGL);s&&(f.renderer=s.toLowerCase()),h&&(f.vendor=h.toLowerCase())}return this.gpuInfo=f,f}}}(),function(){var l=function(){};function c(){}w.Canvas2dFilterBackend=c,c.prototype={evictCachesForKey:l,dispose:l,clearWebGLCaches:l,resources:{},applyFilters:function(u,f,o,s,h){var m=h.getContext("2d");m.drawImage(f,0,0,o,s);var p={sourceWidth:o,sourceHeight:s,imageData:m.getImageData(0,0,o,s),originalEl:f,originalImageData:m.getImageData(0,0,o,s),canvasEl:h,ctx:m,filterBackend:this};return u.forEach(function(g){g.applyTo(p)}),p.imageData.width===o&&p.imageData.height===s||(h.width=p.imageData.width,h.height=p.imageData.height),m.putImageData(p.imageData,0,0),p}}}(),w.Image=w.Image||{},w.Image.filters=w.Image.filters||{},w.Image.filters.BaseFilter=w.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(l){l&&this.setOptions(l)},setOptions:function(l){for(var c in l)this[c]=l[c]},createProgram:function(l,c,u){c=c||this.fragmentSource,u=u||this.vertexSource,w.webGlPrecision!=="highp"&&(c=c.replace(/precision highp float/g,"precision "+w.webGlPrecision+" float"));var f=l.createShader(l.VERTEX_SHADER);if(l.shaderSource(f,u),l.compileShader(f),!l.getShaderParameter(f,l.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+l.getShaderInfoLog(f));var o=l.createShader(l.FRAGMENT_SHADER);if(l.shaderSource(o,c),l.compileShader(o),!l.getShaderParameter(o,l.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+l.getShaderInfoLog(o));var s=l.createProgram();if(l.attachShader(s,f),l.attachShader(s,o),l.linkProgram(s),!l.getProgramParameter(s,l.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+l.getProgramInfoLog(s));var h=this.getAttributeLocations(l,s),m=this.getUniformLocations(l,s)||{};return m.uStepW=l.getUniformLocation(s,"uStepW"),m.uStepH=l.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:h,uniformLocations:m}},getAttributeLocations:function(l,c){return{aPosition:l.getAttribLocation(c,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(l,c,u){var f=c.aPosition,o=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,o),l.enableVertexAttribArray(f),l.vertexAttribPointer(f,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,u,l.STATIC_DRAW)},_setupFrameBuffer:function(l){var c,u,f=l.context;l.passes>1?(c=l.destinationWidth,u=l.destinationHeight,l.sourceWidth===c&&l.sourceHeight===u||(f.deleteTexture(l.targetTexture),l.targetTexture=l.filterBackend.createTexture(f,c,u)),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l.targetTexture,0)):(f.bindFramebuffer(f.FRAMEBUFFER,null),f.finish())},_swapTextures:function(l){l.passes--,l.pass++;var c=l.targetTexture;l.targetTexture=l.sourceTexture,l.sourceTexture=c},isNeutralState:function(){var l=this.mainParameter,c=w.Image.filters[this.type].prototype;if(l){if(Array.isArray(c[l])){for(var u=c[l].length;u--;)if(this[l][u]!==c[l][u])return!1;return!0}return c[l]===this[l]}return!1},applyTo:function(l){l.webgl?(this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l)):this.applyTo2d(l)},retrieveShader:function(l){return l.programCache.hasOwnProperty(this.type)||(l.programCache[this.type]=this.createProgram(l.context)),l.programCache[this.type]},applyToWebGL:function(l){var c=l.context,u=this.retrieveShader(l);l.pass===0&&l.originalTexture?c.bindTexture(c.TEXTURE_2D,l.originalTexture):c.bindTexture(c.TEXTURE_2D,l.sourceTexture),c.useProgram(u.program),this.sendAttributeData(c,u.attributeLocations,l.aPosition),c.uniform1f(u.uniformLocations.uStepW,1/l.sourceWidth),c.uniform1f(u.uniformLocations.uStepH,1/l.sourceHeight),this.sendUniformData(c,u.uniformLocations),c.viewport(0,0,l.destinationWidth,l.destinationHeight),c.drawArrays(c.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(l,c,u){l.activeTexture(u),l.bindTexture(l.TEXTURE_2D,c),l.activeTexture(l.TEXTURE0)},unbindAdditionalTexture:function(l,c){l.activeTexture(c),l.bindTexture(l.TEXTURE_2D,null),l.activeTexture(l.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(l){this[this.mainParameter]=l},sendUniformData:function(){},createHelpLayer:function(l){if(!l.helpLayer){var c=document.createElement("canvas");c.width=l.sourceWidth,c.height=l.sourceHeight,l.helpLayer=c}},toObject:function(){var l={type:this.type},c=this.mainParameter;return c&&(l[c]=this[c]),l},toJSON:function(){return this.toObject()}}),w.Image.filters.BaseFilter.fromObject=function(l,c){var u=new w.Image.filters[l.type](l);return c&&c(u),u},function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.ColorMatrix=f(u.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(o){this.callSuper("initialize",o),this.matrix=this.matrix.slice(0)},applyTo2d:function(o){var s,h,m,p,g,_=o.imageData.data,E=_.length,I=this.matrix,S=this.colorsOnly;for(g=0;g<E;g+=4)s=_[g],h=_[g+1],m=_[g+2],S?(_[g]=s*I[0]+h*I[1]+m*I[2]+255*I[4],_[g+1]=s*I[5]+h*I[6]+m*I[7]+255*I[9],_[g+2]=s*I[10]+h*I[11]+m*I[12]+255*I[14]):(p=_[g+3],_[g]=s*I[0]+h*I[1]+m*I[2]+p*I[3]+255*I[4],_[g+1]=s*I[5]+h*I[6]+m*I[7]+p*I[8]+255*I[9],_[g+2]=s*I[10]+h*I[11]+m*I[12]+p*I[13]+255*I[14],_[g+3]=s*I[15]+h*I[16]+m*I[17]+p*I[18]+255*I[19])},getUniformLocations:function(o,s){return{uColorMatrix:o.getUniformLocation(s,"uColorMatrix"),uConstants:o.getUniformLocation(s,"uConstants")}},sendUniformData:function(o,s){var h=this.matrix,m=[h[0],h[1],h[2],h[3],h[5],h[6],h[7],h[8],h[10],h[11],h[12],h[13],h[15],h[16],h[17],h[18]],p=[h[4],h[9],h[14],h[19]];o.uniformMatrix4fv(s.uColorMatrix,!1,m),o.uniform4fv(s.uConstants,p)}}),c.Image.filters.ColorMatrix.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Brightness=f(u.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(o){if(this.brightness!==0){var s,h=o.imageData.data,m=h.length,p=Math.round(255*this.brightness);for(s=0;s<m;s+=4)h[s]=h[s]+p,h[s+1]=h[s+1]+p,h[s+2]=h[s+2]+p}},getUniformLocations:function(o,s){return{uBrightness:o.getUniformLocation(s,"uBrightness")}},sendUniformData:function(o,s){o.uniform1f(s.uBrightness,this.brightness)}}),c.Image.filters.Brightness.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.extend,f=c.Image.filters,o=c.util.createClass;f.Convolute=o(f.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(s){var h=Math.sqrt(this.matrix.length),m=this.type+"_"+h+"_"+(this.opaque?1:0),p=this.fragmentSource[m];return s.programCache.hasOwnProperty(m)||(s.programCache[m]=this.createProgram(s.context,p)),s.programCache[m]},applyTo2d:function(s){var h,m,p,g,_,E,I,S,D,x,R,j,U,Q=s.imageData,Z=Q.data,q=this.matrix,k=Math.round(Math.sqrt(q.length)),F=Math.floor(k/2),z=Q.width,J=Q.height,ee=s.ctx.createImageData(z,J),V=ee.data,B=this.opaque?1:0;for(R=0;R<J;R++)for(x=0;x<z;x++){for(_=4*(R*z+x),h=0,m=0,p=0,g=0,U=0;U<k;U++)for(j=0;j<k;j++)E=x+j-F,(I=R+U-F)<0||I>=J||E<0||E>=z||(S=4*(I*z+E),D=q[U*k+j],h+=Z[S]*D,m+=Z[S+1]*D,p+=Z[S+2]*D,B||(g+=Z[S+3]*D));V[_]=h,V[_+1]=m,V[_+2]=p,V[_+3]=B?Z[_+3]:g}s.imageData=ee},getUniformLocations:function(s,h){return{uMatrix:s.getUniformLocation(h,"uMatrix"),uOpaque:s.getUniformLocation(h,"uOpaque"),uHalfSize:s.getUniformLocation(h,"uHalfSize"),uSize:s.getUniformLocation(h,"uSize")}},sendUniformData:function(s,h){s.uniform1fv(h.uMatrix,this.matrix)},toObject:function(){return u(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),c.Image.filters.Convolute.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Grayscale=f(u.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(o){var s,h,m=o.imageData.data,p=m.length,g=this.mode;for(s=0;s<p;s+=4)g==="average"?h=(m[s]+m[s+1]+m[s+2])/3:g==="lightness"?h=(Math.min(m[s],m[s+1],m[s+2])+Math.max(m[s],m[s+1],m[s+2]))/2:g==="luminosity"&&(h=.21*m[s]+.72*m[s+1]+.07*m[s+2]),m[s]=h,m[s+1]=h,m[s+2]=h},retrieveShader:function(o){var s=this.type+"_"+this.mode;if(!o.programCache.hasOwnProperty(s)){var h=this.fragmentSource[this.mode];o.programCache[s]=this.createProgram(o.context,h)}return o.programCache[s]},getUniformLocations:function(o,s){return{uMode:o.getUniformLocation(s,"uMode")}},sendUniformData:function(o,s){o.uniform1i(s.uMode,1)},isNeutralState:function(){return!1}}),c.Image.filters.Grayscale.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Invert=f(u.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(o){var s,h=o.imageData.data,m=h.length;for(s=0;s<m;s+=4)h[s]=255-h[s],h[s+1]=255-h[s+1],h[s+2]=255-h[s+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(o,s){return{uInvert:o.getUniformLocation(s,"uInvert")}},sendUniformData:function(o,s){o.uniform1i(s.uInvert,this.invert)}}),c.Image.filters.Invert.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.extend,f=c.Image.filters,o=c.util.createClass;f.Noise=o(f.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(s){if(this.noise!==0){var h,m,p=s.imageData.data,g=p.length,_=this.noise;for(h=0,g=p.length;h<g;h+=4)m=(.5-Math.random())*_,p[h]+=m,p[h+1]+=m,p[h+2]+=m}},getUniformLocations:function(s,h){return{uNoise:s.getUniformLocation(h,"uNoise"),uSeed:s.getUniformLocation(h,"uSeed")}},sendUniformData:function(s,h){s.uniform1f(h.uNoise,this.noise/255),s.uniform1f(h.uSeed,Math.random())},toObject:function(){return u(this.callSuper("toObject"),{noise:this.noise})}}),c.Image.filters.Noise.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Pixelate=f(u.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(o){var s,h,m,p,g,_,E,I,S,D,x,R=o.imageData,j=R.data,U=R.height,Q=R.width;for(h=0;h<U;h+=this.blocksize)for(m=0;m<Q;m+=this.blocksize)for(p=j[s=4*h*Q+4*m],g=j[s+1],_=j[s+2],E=j[s+3],D=Math.min(h+this.blocksize,U),x=Math.min(m+this.blocksize,Q),I=h;I<D;I++)for(S=m;S<x;S++)j[s=4*I*Q+4*S]=p,j[s+1]=g,j[s+2]=_,j[s+3]=E},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(o,s){return{uBlocksize:o.getUniformLocation(s,"uBlocksize"),uStepW:o.getUniformLocation(s,"uStepW"),uStepH:o.getUniformLocation(s,"uStepH")}},sendUniformData:function(o,s){o.uniform1f(s.uBlocksize,this.blocksize)}}),c.Image.filters.Pixelate.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.extend,f=c.Image.filters,o=c.util.createClass;f.RemoveColor=o(f.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(s){var h,m,p,g,_=s.imageData.data,E=255*this.distance,I=new c.Color(this.color).getSource(),S=[I[0]-E,I[1]-E,I[2]-E],D=[I[0]+E,I[1]+E,I[2]+E];for(h=0;h<_.length;h+=4)m=_[h],p=_[h+1],g=_[h+2],m>S[0]&&p>S[1]&&g>S[2]&&m<D[0]&&p<D[1]&&g<D[2]&&(_[h+3]=0)},getUniformLocations:function(s,h){return{uLow:s.getUniformLocation(h,"uLow"),uHigh:s.getUniformLocation(h,"uHigh")}},sendUniformData:function(s,h){var m=new c.Color(this.color).getSource(),p=parseFloat(this.distance),g=[0+m[0]/255-p,0+m[1]/255-p,0+m[2]/255-p,1],_=[m[0]/255+p,m[1]/255+p,m[2]/255+p,1];s.uniform4fv(h.uLow,g),s.uniform4fv(h.uHigh,_)},toObject:function(){return u(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),c.Image.filters.RemoveColor.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass,o={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in o)u[s]=f(u.ColorMatrix,{type:s,matrix:o[s],mainParameter:!1,colorsOnly:!0}),c.Image.filters[s].fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric,u=c.Image.filters,f=c.util.createClass;u.BlendColor=f(u.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(o){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[o]+`}
}`},retrieveShader:function(o){var s,h=this.type+"_"+this.mode;return o.programCache.hasOwnProperty(h)||(s=this.buildSource(this.mode),o.programCache[h]=this.createProgram(o.context,s)),o.programCache[h]},applyTo2d:function(o){var s,h,m,p,g,_,E,I=o.imageData.data,S=I.length,D=1-this.alpha;s=(E=new c.Color(this.color).getSource())[0]*this.alpha,h=E[1]*this.alpha,m=E[2]*this.alpha;for(var x=0;x<S;x+=4)switch(p=I[x],g=I[x+1],_=I[x+2],this.mode){case"multiply":I[x]=p*s/255,I[x+1]=g*h/255,I[x+2]=_*m/255;break;case"screen":I[x]=255-(255-p)*(255-s)/255,I[x+1]=255-(255-g)*(255-h)/255,I[x+2]=255-(255-_)*(255-m)/255;break;case"add":I[x]=p+s,I[x+1]=g+h,I[x+2]=_+m;break;case"diff":case"difference":I[x]=Math.abs(p-s),I[x+1]=Math.abs(g-h),I[x+2]=Math.abs(_-m);break;case"subtract":I[x]=p-s,I[x+1]=g-h,I[x+2]=_-m;break;case"darken":I[x]=Math.min(p,s),I[x+1]=Math.min(g,h),I[x+2]=Math.min(_,m);break;case"lighten":I[x]=Math.max(p,s),I[x+1]=Math.max(g,h),I[x+2]=Math.max(_,m);break;case"overlay":I[x]=s<128?2*p*s/255:255-2*(255-p)*(255-s)/255,I[x+1]=h<128?2*g*h/255:255-2*(255-g)*(255-h)/255,I[x+2]=m<128?2*_*m/255:255-2*(255-_)*(255-m)/255;break;case"exclusion":I[x]=s+p-2*s*p/255,I[x+1]=h+g-2*h*g/255,I[x+2]=m+_-2*m*_/255;break;case"tint":I[x]=s+p*D,I[x+1]=h+g*D,I[x+2]=m+_*D}},getUniformLocations:function(o,s){return{uColor:o.getUniformLocation(s,"uColor")}},sendUniformData:function(o,s){var h=new c.Color(this.color).getSource();h[0]=this.alpha*h[0]/255,h[1]=this.alpha*h[1]/255,h[2]=this.alpha*h[2]/255,h[3]=this.alpha,o.uniform4fv(s.uColor,h)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),c.Image.filters.BlendColor.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric,u=c.Image.filters,f=c.util.createClass;u.BlendImage=f(u.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(o){var s=this.type+"_"+this.mode,h=this.fragmentSource[this.mode];return o.programCache.hasOwnProperty(s)||(o.programCache[s]=this.createProgram(o.context,h)),o.programCache[s]},applyToWebGL:function(o){var s=o.context,h=this.createTexture(o.filterBackend,this.image);this.bindAdditionalTexture(s,h,s.TEXTURE1),this.callSuper("applyToWebGL",o),this.unbindAdditionalTexture(s,s.TEXTURE1)},createTexture:function(o,s){return o.getCachedTexture(s.cacheKey,s._element)},calculateMatrix:function(){var o=this.image,s=o._element.width,h=o._element.height;return[1/o.scaleX,0,0,0,1/o.scaleY,0,-o.left/s,-o.top/h,1]},applyTo2d:function(o){var s,h,m,p,g,_,E,I,S,D,x,R=o.imageData,j=o.filterBackend.resources,U=R.data,Q=U.length,Z=R.width,q=R.height,k=this.image;j.blendImage||(j.blendImage=c.util.createCanvasElement()),D=(S=j.blendImage).getContext("2d"),S.width!==Z||S.height!==q?(S.width=Z,S.height=q):D.clearRect(0,0,Z,q),D.setTransform(k.scaleX,0,0,k.scaleY,k.left,k.top),D.drawImage(k._element,0,0,Z,q),x=D.getImageData(0,0,Z,q).data;for(var F=0;F<Q;F+=4)switch(g=U[F],_=U[F+1],E=U[F+2],I=U[F+3],s=x[F],h=x[F+1],m=x[F+2],p=x[F+3],this.mode){case"multiply":U[F]=g*s/255,U[F+1]=_*h/255,U[F+2]=E*m/255,U[F+3]=I*p/255;break;case"mask":U[F+3]=p}},getUniformLocations:function(o,s){return{uTransformMatrix:o.getUniformLocation(s,"uTransformMatrix"),uImage:o.getUniformLocation(s,"uImage")}},sendUniformData:function(o,s){var h=this.calculateMatrix();o.uniform1i(s.uImage,1),o.uniformMatrix3fv(s.uTransformMatrix,!1,h)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),c.Image.filters.BlendImage.fromObject=function(o,s){c.Image.fromObject(o.image,function(h){var m=c.util.object.clone(o);m.image=h,s(new c.Image.filters.BlendImage(m))})}}(e),function(l){var c=l.fabric||(l.fabric={}),u=Math.pow,f=Math.floor,o=Math.sqrt,s=Math.abs,h=Math.round,m=Math.sin,p=Math.ceil,g=c.Image.filters,_=c.util.createClass;g.Resize=_(g.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(E,I){return{uDelta:E.getUniformLocation(I,"uDelta"),uTaps:E.getUniformLocation(I,"uTaps")}},sendUniformData:function(E,I){E.uniform2fv(I.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),E.uniform1fv(I.uTaps,this.taps)},retrieveShader:function(E){var I=this.getFilterWindow(),S=this.type+"_"+I;if(!E.programCache.hasOwnProperty(S)){var D=this.generateShader(I);E.programCache[S]=this.createProgram(E.context,D)}return E.programCache[S]},getFilterWindow:function(){var E=this.tempScale;return Math.ceil(this.lanczosLobes/E)},getTaps:function(){for(var E=this.lanczosCreate(this.lanczosLobes),I=this.tempScale,S=this.getFilterWindow(),D=new Array(S),x=1;x<=S;x++)D[x-1]=E(x*I);return D},generateShader:function(E){for(var I=new Array(E),S=this.fragmentSourceTOP,D=1;D<=E;D++)I[D-1]=D+".0 * uDelta";return S+="uniform float uTaps["+E+`];
`,S+=`void main() {
`,S+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,S+=`  float sum = 1.0;
`,I.forEach(function(x,R){S+="  color += texture2D(uTexture, vTexCoord + "+x+") * uTaps["+R+`];
`,S+="  color += texture2D(uTexture, vTexCoord - "+x+") * uTaps["+R+`];
`,S+="  sum += 2.0 * uTaps["+R+`];
`}),S+=`  gl_FragColor = color / sum;
`,S+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(E){E.webgl?(E.passes++,this.width=E.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=E.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),E.destinationWidth=this.dW,this._setupFrameBuffer(E),this.applyToWebGL(E),this._swapTextures(E),E.sourceWidth=E.destinationWidth,this.height=E.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),E.destinationHeight=this.dH,this._setupFrameBuffer(E),this.applyToWebGL(E),this._swapTextures(E),E.sourceHeight=E.destinationHeight):this.applyTo2d(E)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(E){return function(I){if(I>=E||I<=-E)return 0;if(I<11920929e-14&&I>-11920929e-14)return 1;var S=(I*=Math.PI)/E;return m(I)/I*m(S)/S}},applyTo2d:function(E){var I=E.imageData,S=this.scaleX,D=this.scaleY;this.rcpScaleX=1/S,this.rcpScaleY=1/D;var x,R=I.width,j=I.height,U=h(R*S),Q=h(j*D);this.resizeType==="sliceHack"?x=this.sliceByTwo(E,R,j,U,Q):this.resizeType==="hermite"?x=this.hermiteFastResize(E,R,j,U,Q):this.resizeType==="bilinear"?x=this.bilinearFiltering(E,R,j,U,Q):this.resizeType==="lanczos"&&(x=this.lanczosResize(E,R,j,U,Q)),E.imageData=x},sliceByTwo:function(E,I,S,D,x){var R,j,U=E.imageData,Q=.5,Z=!1,q=!1,k=I*Q,F=S*Q,z=c.filterBackend.resources,J=0,ee=0,V=I,B=0;for(z.sliceByTwo||(z.sliceByTwo=document.createElement("canvas")),((R=z.sliceByTwo).width<1.5*I||R.height<S)&&(R.width=1.5*I,R.height=S),(j=R.getContext("2d")).clearRect(0,0,1.5*I,S),j.putImageData(U,0,0),D=f(D),x=f(x);!Z||!q;)I=k,S=F,D<f(k*Q)?k=f(k*Q):(k=D,Z=!0),x<f(F*Q)?F=f(F*Q):(F=x,q=!0),j.drawImage(R,J,ee,I,S,V,B,k,F),J=V,ee=B,B+=F;return j.getImageData(J,ee,D,x)},lanczosResize:function(E,I,S,D,x){var R=E.imageData.data,j=E.ctx.createImageData(D,x),U=j.data,Q=this.lanczosCreate(this.lanczosLobes),Z=this.rcpScaleX,q=this.rcpScaleY,k=2/this.rcpScaleX,F=2/this.rcpScaleY,z=p(Z*this.lanczosLobes/2),J=p(q*this.lanczosLobes/2),ee={},V={},B={};return function X(ne){var K,se,ge,ue,le,fe,he,ve,Ee,ye,Ne;for(V.x=(ne+.5)*Z,B.x=f(V.x),K=0;K<x;K++){for(V.y=(K+.5)*q,B.y=f(V.y),le=0,fe=0,he=0,ve=0,Ee=0,se=B.x-z;se<=B.x+z;se++)if(!(se<0||se>=I)){ye=f(1e3*s(se-V.x)),ee[ye]||(ee[ye]={});for(var tt=B.y-J;tt<=B.y+J;tt++)tt<0||tt>=S||(Ne=f(1e3*s(tt-V.y)),ee[ye][Ne]||(ee[ye][Ne]=Q(o(u(ye*k,2)+u(Ne*F,2))/1e3)),(ge=ee[ye][Ne])>0&&(le+=ge,fe+=ge*R[ue=4*(tt*I+se)],he+=ge*R[ue+1],ve+=ge*R[ue+2],Ee+=ge*R[ue+3]))}U[ue=4*(K*D+ne)]=fe/le,U[ue+1]=he/le,U[ue+2]=ve/le,U[ue+3]=Ee/le}return++ne<D?X(ne):j}(0)},bilinearFiltering:function(E,I,S,D,x){var R,j,U,Q,Z,q,k,F,z,J=0,ee=this.rcpScaleX,V=this.rcpScaleY,B=4*(I-1),X=E.imageData.data,ne=E.ctx.createImageData(D,x),K=ne.data;for(U=0;U<x;U++)for(Q=0;Q<D;Q++)for(Z=ee*Q-(R=f(ee*Q)),q=V*U-(j=f(V*U)),z=4*(j*I+R),k=0;k<4;k++)F=X[z+k]*(1-Z)*(1-q)+X[z+4+k]*Z*(1-q)+X[z+B+k]*q*(1-Z)+X[z+B+4+k]*Z*q,K[J++]=F;return ne},hermiteFastResize:function(E,I,S,D,x){for(var R=this.rcpScaleX,j=this.rcpScaleY,U=p(R/2),Q=p(j/2),Z=E.imageData.data,q=E.ctx.createImageData(D,x),k=q.data,F=0;F<x;F++)for(var z=0;z<D;z++){for(var J=4*(z+F*D),ee=0,V=0,B=0,X=0,ne=0,K=0,se=0,ge=(F+.5)*j,ue=f(F*j);ue<(F+1)*j;ue++)for(var le=s(ge-(ue+.5))/Q,fe=(z+.5)*R,he=le*le,ve=f(z*R);ve<(z+1)*R;ve++){var Ee=s(fe-(ve+.5))/U,ye=o(he+Ee*Ee);ye>1&&ye<-1||(ee=2*ye*ye*ye-3*ye*ye+1)>0&&(se+=ee*Z[3+(Ee=4*(ve+ue*I))],B+=ee,Z[Ee+3]<255&&(ee=ee*Z[Ee+3]/250),X+=ee*Z[Ee],ne+=ee*Z[Ee+1],K+=ee*Z[Ee+2],V+=ee)}k[J]=X/V,k[J+1]=ne/V,k[J+2]=K/V,k[J+3]=se/B}return q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),c.Image.filters.Resize.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Contrast=f(u.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(o){if(this.contrast!==0){var s,h=o.imageData.data,m=h.length,p=Math.floor(255*this.contrast),g=259*(p+255)/(255*(259-p));for(s=0;s<m;s+=4)h[s]=g*(h[s]-128)+128,h[s+1]=g*(h[s+1]-128)+128,h[s+2]=g*(h[s+2]-128)+128}},getUniformLocations:function(o,s){return{uContrast:o.getUniformLocation(s,"uContrast")}},sendUniformData:function(o,s){o.uniform1f(s.uContrast,this.contrast)}}),c.Image.filters.Contrast.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Saturation=f(u.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(o){if(this.saturation!==0){var s,h,m=o.imageData.data,p=m.length,g=-this.saturation;for(s=0;s<p;s+=4)h=Math.max(m[s],m[s+1],m[s+2]),m[s]+=h!==m[s]?(h-m[s])*g:0,m[s+1]+=h!==m[s+1]?(h-m[s+1])*g:0,m[s+2]+=h!==m[s+2]?(h-m[s+2])*g:0}},getUniformLocations:function(o,s){return{uSaturation:o.getUniformLocation(s,"uSaturation")}},sendUniformData:function(o,s){o.uniform1f(s.uSaturation,-this.saturation)}}),c.Image.filters.Saturation.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Vibrance=f(u.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(o){if(this.vibrance!==0){var s,h,m,p,g=o.imageData.data,_=g.length,E=-this.vibrance;for(s=0;s<_;s+=4)h=Math.max(g[s],g[s+1],g[s+2]),m=(g[s]+g[s+1]+g[s+2])/3,p=2*Math.abs(h-m)/255*E,g[s]+=h!==g[s]?(h-g[s])*p:0,g[s+1]+=h!==g[s+1]?(h-g[s+1])*p:0,g[s+2]+=h!==g[s+2]?(h-g[s+2])*p:0}},getUniformLocations:function(o,s){return{uVibrance:o.getUniformLocation(s,"uVibrance")}},sendUniformData:function(o,s){o.uniform1f(s.uVibrance,-this.vibrance)}}),c.Image.filters.Vibrance.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Blur=f(u.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(o){o.webgl?(this.aspectRatio=o.sourceWidth/o.sourceHeight,o.passes++,this._setupFrameBuffer(o),this.horizontal=!0,this.applyToWebGL(o),this._swapTextures(o),this._setupFrameBuffer(o),this.horizontal=!1,this.applyToWebGL(o),this._swapTextures(o)):this.applyTo2d(o)},applyTo2d:function(o){o.imageData=this.simpleBlur(o)},simpleBlur:function(o){var s,h,m=o.filterBackend.resources,p=o.imageData.width,g=o.imageData.height;m.blurLayer1||(m.blurLayer1=c.util.createCanvasElement(),m.blurLayer2=c.util.createCanvasElement()),s=m.blurLayer1,h=m.blurLayer2,s.width===p&&s.height===g||(h.width=s.width=p,h.height=s.height=g);var _,E,I,S,D=s.getContext("2d"),x=h.getContext("2d"),R=.06*this.blur*.5;for(D.putImageData(o.imageData,0,0),x.clearRect(0,0,p,g),S=-15;S<=15;S++)I=R*(E=S/15)*p+(_=(Math.random()-.5)/4),x.globalAlpha=1-Math.abs(E),x.drawImage(s,I,_),D.drawImage(h,0,0),x.globalAlpha=1,x.clearRect(0,0,h.width,h.height);for(S=-15;S<=15;S++)I=R*(E=S/15)*g+(_=(Math.random()-.5)/4),x.globalAlpha=1-Math.abs(E),x.drawImage(s,_,I),D.drawImage(h,0,0),x.globalAlpha=1,x.clearRect(0,0,h.width,h.height);o.ctx.drawImage(s,0,0);var j=o.ctx.getImageData(0,0,s.width,s.height);return D.globalAlpha=1,D.clearRect(0,0,s.width,s.height),j},getUniformLocations:function(o,s){return{delta:o.getUniformLocation(s,"uDelta")}},sendUniformData:function(o,s){var h=this.chooseRightDelta();o.uniform2fv(s.delta,h)},chooseRightDelta:function(){var o,s=1,h=[0,0];return this.horizontal?this.aspectRatio>1&&(s=1/this.aspectRatio):this.aspectRatio<1&&(s=this.aspectRatio),o=s*this.blur*.12,this.horizontal?h[0]=o:h[1]=o,h}}),u.Blur.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Gamma=f(u.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(o){this.gamma=[1,1,1],u.BaseFilter.prototype.initialize.call(this,o)},applyTo2d:function(o){var s,h=o.imageData.data,m=this.gamma,p=h.length,g=1/m[0],_=1/m[1],E=1/m[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),s=0,p=256;s<p;s++)this.rVals[s]=255*Math.pow(s/255,g),this.gVals[s]=255*Math.pow(s/255,_),this.bVals[s]=255*Math.pow(s/255,E);for(s=0,p=h.length;s<p;s+=4)h[s]=this.rVals[h[s]],h[s+1]=this.gVals[h[s+1]],h[s+2]=this.bVals[h[s+2]]},getUniformLocations:function(o,s){return{uGamma:o.getUniformLocation(s,"uGamma")}},sendUniformData:function(o,s){o.uniform3fv(s.uGamma,this.gamma)}}),c.Image.filters.Gamma.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.Composed=f(u.BaseFilter,{type:"Composed",subFilters:[],initialize:function(o){this.callSuper("initialize",o),this.subFilters=this.subFilters.slice(0)},applyTo:function(o){o.passes+=this.subFilters.length-1,this.subFilters.forEach(function(s){s.applyTo(o)})},toObject:function(){return c.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(o){return o.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(o){return!o.isNeutralState()})}}),c.Image.filters.Composed.fromObject=function(o,s){var h=(o.subFilters||[]).map(function(p){return new c.Image.filters[p.type](p)}),m=new c.Image.filters.Composed({subFilters:h});return s&&s(m),m}}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.Image.filters,f=c.util.createClass;u.HueRotation=f(u.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var o=this.rotation*Math.PI,s=c.util.cos(o),h=c.util.sin(o),m=1/3,p=Math.sqrt(m)*h,g=1-s;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=s+g/3,this.matrix[1]=m*g-p,this.matrix[2]=m*g+p,this.matrix[5]=m*g+p,this.matrix[6]=s+m*g,this.matrix[7]=m*g-p,this.matrix[10]=m*g-p,this.matrix[11]=m*g+p,this.matrix[12]=s+m*g},isNeutralState:function(o){return this.calculateMatrix(),u.BaseFilter.prototype.isNeutralState.call(this,o)},applyTo:function(o){this.calculateMatrix(),u.BaseFilter.prototype.applyTo.call(this,o)}}),c.Image.filters.HueRotation.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(l){var c=l.fabric||(l.fabric={}),u=c.util.object.clone;if(c.Text)c.warn("fabric.Text is already defined");else{var f="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:c.Object.prototype.stateProperties.concat(f),cacheProperties:c.Object.prototype.cacheProperties.concat(f),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(o,s){this.styles=s&&s.styles||{},this.text=o,this.__skipDimension=!0,this.callSuper("initialize",s),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var o=this.path;o&&(o.segmentsInfo=c.util.getPathSegmentsInfo(o.path))},getMeasuringContext:function(){return c._measuringContext||(c._measuringContext=this.canvas&&this.canvas.contextCache||c.util.createCanvasElement().getContext("2d")),c._measuringContext},_splitText:function(){var o=this._splitTextIntoLines(this.text);return this.textLines=o.lines,this._textLines=o.graphemeLines,this._unwrappedTextLines=o._unwrappedLines,this._text=o.graphemeText,o},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var o,s,h,m,p,g,_,E=0,I=this._textLines.length;E<I;E++)if((this.textAlign==="justify"||E!==I-1&&!this.isEndOfWrapping(E))&&(m=0,p=this._textLines[E],(s=this.getLineWidth(E))<this.width&&(_=this.textLines[E].match(this._reSpacesAndTabs)))){h=_.length,o=(this.width-s)/h;for(var S=0,D=p.length;S<=D;S++)g=this.__charBounds[E][S],this._reSpaceAndTab.test(p[S])?(g.width+=o,g.kernedWidth+=o,g.left+=m,m+=o):g.left+=m}},isEndOfWrapping:function(o){return o===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var o=this.callSuper("_getCacheCanvasDimensions"),s=this.fontSize;return o.width+=s*o.zoomX,o.height+=s*o.zoomY,o},_render:function(o){var s=this.path;s&&!s.isNotVisible()&&s._render(o),this._setTextStyles(o),this._renderTextLinesBackground(o),this._renderTextDecoration(o,"underline"),this._renderText(o),this._renderTextDecoration(o,"overline"),this._renderTextDecoration(o,"linethrough")},_renderText:function(o){this.paintFirst==="stroke"?(this._renderTextStroke(o),this._renderTextFill(o)):(this._renderTextFill(o),this._renderTextStroke(o))},_setTextStyles:function(o,s,h){if(o.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":o.textBaseline="middle";break;case"ascender":o.textBaseline="top";break;case"descender":o.textBaseline="bottom"}o.font=this._getFontDeclaration(s,h)},calcTextWidth:function(){for(var o=this.getLineWidth(0),s=1,h=this._textLines.length;s<h;s++){var m=this.getLineWidth(s);m>o&&(o=m)}return o},_renderTextLine:function(o,s,h,m,p,g){this._renderChars(o,s,h,m,p,g)},_renderTextLinesBackground:function(o){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var s,h,m,p,g,_,E,I=o.fillStyle,S=this._getLeftOffset(),D=this._getTopOffset(),x=0,R=0,j=this.path,U=0,Q=this._textLines.length;U<Q;U++)if(s=this.getHeightOfLine(U),this.textBackgroundColor||this.styleHas("textBackgroundColor",U)){m=this._textLines[U],h=this._getLineLeftOffset(U),R=0,x=0,p=this.getValueOfPropertyAt(U,0,"textBackgroundColor");for(var Z=0,q=m.length;Z<q;Z++)g=this.__charBounds[U][Z],_=this.getValueOfPropertyAt(U,Z,"textBackgroundColor"),j?(o.save(),o.translate(g.renderLeft,g.renderTop),o.rotate(g.angle),o.fillStyle=_,_&&o.fillRect(-g.width/2,-s/this.lineHeight*(1-this._fontSizeFraction),g.width,s/this.lineHeight),o.restore()):_!==p?(E=S+h+x,this.direction==="rtl"&&(E=this.width-E-R),o.fillStyle=p,p&&o.fillRect(E,D,R,s/this.lineHeight),x=g.left,R=g.width,p=_):R+=g.kernedWidth;_&&!j&&(E=S+h+x,this.direction==="rtl"&&(E=this.width-E-R),o.fillStyle=_,o.fillRect(E,D,R,s/this.lineHeight)),D+=s}else D+=s;o.fillStyle=I,this._removeShadow(o)}},getFontCache:function(o){var s=o.fontFamily.toLowerCase();c.charWidthsCache[s]||(c.charWidthsCache[s]={});var h=c.charWidthsCache[s],m=o.fontStyle.toLowerCase()+"_"+(o.fontWeight+"").toLowerCase();return h[m]||(h[m]={}),h[m]},_measureChar:function(o,s,h,m){var p,g,_,E,I=this.getFontCache(s),S=h+o,D=this._getFontDeclaration(s)===this._getFontDeclaration(m),x=s.fontSize/this.CACHE_FONT_SIZE;if(h&&I[h]!==void 0&&(_=I[h]),I[o]!==void 0&&(E=p=I[o]),D&&I[S]!==void 0&&(E=(g=I[S])-_),p===void 0||_===void 0||g===void 0){var R=this.getMeasuringContext();this._setTextStyles(R,s,!0)}return p===void 0&&(E=p=R.measureText(o).width,I[o]=p),_===void 0&&D&&h&&(_=R.measureText(h).width,I[h]=_),D&&g===void 0&&(g=R.measureText(S).width,I[S]=g,E=g-_),{width:p*x,kernedWidth:E*x}},getHeightOfChar:function(o,s){return this.getValueOfPropertyAt(o,s,"fontSize")},measureLine:function(o){var s=this._measureLine(o);return this.charSpacing!==0&&(s.width-=this._getWidthOfCharSpacing()),s.width<0&&(s.width=0),s},_measureLine:function(o){var s,h,m,p,g,_,E=0,I=this._textLines[o],S=new Array(I.length),D=0,x=this.path,R=this.pathSide==="right";for(this.__charBounds[o]=S,s=0;s<I.length;s++)h=I[s],p=this._getGraphemeBox(h,o,s,m),S[s]=p,E+=p.kernedWidth,m=h;if(S[s]={left:p?p.left+p.width:0,width:0,kernedWidth:0,height:this.fontSize},x){switch(_=x.segmentsInfo[x.segmentsInfo.length-1].length,(g=c.util.getPointOnPath(x.path,0,x.segmentsInfo)).x+=x.pathOffset.x,g.y+=x.pathOffset.y,this.textAlign){case"left":D=R?_-E:0;break;case"center":D=(_-E)/2;break;case"right":D=R?0:_-E}for(D+=this.pathStartOffset*(R?-1:1),s=R?I.length-1:0;R?s>=0:s<I.length;R?s--:s++)p=S[s],D>_?D%=_:D<0&&(D+=_),this._setGraphemeOnPath(D,p,g),D+=p.kernedWidth}return{width:E,numOfSpaces:0}},_setGraphemeOnPath:function(o,s,h){var m=o+s.kernedWidth/2,p=this.path,g=c.util.getPointOnPath(p.path,m,p.segmentsInfo);s.renderLeft=g.x-h.x,s.renderTop=g.y-h.y,s.angle=g.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(o,s,h,m,p){var g,_=this.getCompleteStyleDeclaration(s,h),E=m?this.getCompleteStyleDeclaration(s,h-1):{},I=this._measureChar(o,_,m,E),S=I.kernedWidth,D=I.width;this.charSpacing!==0&&(D+=g=this._getWidthOfCharSpacing(),S+=g);var x={width:D,left:0,height:_.fontSize,kernedWidth:S,deltaY:_.deltaY};if(h>0&&!p){var R=this.__charBounds[s][h-1];x.left=R.left+R.width+I.kernedWidth-I.width}return x},getHeightOfLine:function(o){if(this.__lineHeights[o])return this.__lineHeights[o];for(var s=this._textLines[o],h=this.getHeightOfChar(o,0),m=1,p=s.length;m<p;m++)h=Math.max(this.getHeightOfChar(o,m),h);return this.__lineHeights[o]=h*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var o,s=0,h=0,m=this._textLines.length;h<m;h++)o=this.getHeightOfLine(h),s+=h===m-1?o/this.lineHeight:o;return s},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(o,s){o.save();for(var h=0,m=this._getLeftOffset(),p=this._getTopOffset(),g=0,_=this._textLines.length;g<_;g++){var E=this.getHeightOfLine(g),I=E/this.lineHeight,S=this._getLineLeftOffset(g);this._renderTextLine(s,o,this._textLines[g],m+S,p+h+I,g),h+=E}o.restore()},_renderTextFill:function(o){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(o,"fillText")},_renderTextStroke:function(o){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this._setLineDash(o,this.strokeDashArray),o.beginPath(),this._renderTextCommon(o,"strokeText"),o.closePath(),o.restore())},_renderChars:function(o,s,h,m,p,g){var _,E,I,S,D,x=this.getHeightOfLine(g),R=this.textAlign.indexOf("justify")!==-1,j="",U=0,Q=this.path,Z=!R&&this.charSpacing===0&&this.isEmptyStyles(g)&&!Q,q=this.direction==="ltr",k=this.direction==="ltr"?1:-1,F=s.canvas.getAttribute("dir");if(s.save(),F!==this.direction&&(s.canvas.setAttribute("dir",q?"ltr":"rtl"),s.direction=q?"ltr":"rtl",s.textAlign=q?"left":"right"),p-=x*this._fontSizeFraction/this.lineHeight,Z)return this._renderChar(o,s,g,0,h.join(""),m,p,x),void s.restore();for(var z=0,J=h.length-1;z<=J;z++)S=z===J||this.charSpacing||Q,j+=h[z],I=this.__charBounds[g][z],U===0?(m+=k*(I.kernedWidth-I.width),U+=I.width):U+=I.kernedWidth,R&&!S&&this._reSpaceAndTab.test(h[z])&&(S=!0),S||(_=_||this.getCompleteStyleDeclaration(g,z),E=this.getCompleteStyleDeclaration(g,z+1),S=this._hasStyleChanged(_,E)),S&&(Q?(s.save(),s.translate(I.renderLeft,I.renderTop),s.rotate(I.angle),this._renderChar(o,s,g,z,j,-U/2,0,x),s.restore()):(D=m,this._renderChar(o,s,g,z,j,D,p,x)),j="",_=E,m+=k*U,U=0);s.restore()},_applyPatternGradientTransformText:function(o){var s,h=c.util.createCanvasElement(),m=this.width+this.strokeWidth,p=this.height+this.strokeWidth;return h.width=m,h.height=p,(s=h.getContext("2d")).beginPath(),s.moveTo(0,0),s.lineTo(m,0),s.lineTo(m,p),s.lineTo(0,p),s.closePath(),s.translate(m/2,p/2),s.fillStyle=o.toLive(s),this._applyPatternGradientTransform(s,o),s.fill(),s.createPattern(h,"no-repeat")},handleFiller:function(o,s,h){var m,p;return h.toLive?h.gradientUnits==="percentage"||h.gradientTransform||h.patternTransform?(m=-this.width/2,p=-this.height/2,o.translate(m,p),o[s]=this._applyPatternGradientTransformText(h),{offsetX:m,offsetY:p}):(o[s]=h.toLive(o,this),this._applyPatternGradientTransform(o,h)):(o[s]=h,{offsetX:0,offsetY:0})},_setStrokeStyles:function(o,s){return o.lineWidth=s.strokeWidth,o.lineCap=this.strokeLineCap,o.lineDashOffset=this.strokeDashOffset,o.lineJoin=this.strokeLineJoin,o.miterLimit=this.strokeMiterLimit,this.handleFiller(o,"strokeStyle",s.stroke)},_setFillStyles:function(o,s){return this.handleFiller(o,"fillStyle",s.fill)},_renderChar:function(o,s,h,m,p,g,_){var E,I,S=this._getStyleDeclaration(h,m),D=this.getCompleteStyleDeclaration(h,m),x=o==="fillText"&&D.fill,R=o==="strokeText"&&D.stroke&&D.strokeWidth;(R||x)&&(s.save(),x&&(E=this._setFillStyles(s,D)),R&&(I=this._setStrokeStyles(s,D)),s.font=this._getFontDeclaration(D),S&&S.textBackgroundColor&&this._removeShadow(s),S&&S.deltaY&&(_+=S.deltaY),x&&s.fillText(p,g-E.offsetX,_-E.offsetY),R&&s.strokeText(p,g-I.offsetX,_-I.offsetY),s.restore())},setSuperscript:function(o,s){return this._setScript(o,s,this.superscript)},setSubscript:function(o,s){return this._setScript(o,s,this.subscript)},_setScript:function(o,s,h){var m=this.get2DCursorLocation(o,!0),p=this.getValueOfPropertyAt(m.lineIndex,m.charIndex,"fontSize"),g=this.getValueOfPropertyAt(m.lineIndex,m.charIndex,"deltaY"),_={fontSize:p*h.size,deltaY:g+p*h.baseline};return this.setSelectionStyles(_,o,s),this},_hasStyleChanged:function(o,s){return o.fill!==s.fill||o.stroke!==s.stroke||o.strokeWidth!==s.strokeWidth||o.fontSize!==s.fontSize||o.fontFamily!==s.fontFamily||o.fontWeight!==s.fontWeight||o.fontStyle!==s.fontStyle||o.deltaY!==s.deltaY},_hasStyleChangedForSvg:function(o,s){return this._hasStyleChanged(o,s)||o.overline!==s.overline||o.underline!==s.underline||o.linethrough!==s.linethrough},_getLineLeftOffset:function(o){var s=this.getLineWidth(o),h=this.width-s,m=this.textAlign,p=this.direction,g=0,_=this.isEndOfWrapping(o);return m==="justify"||m==="justify-center"&&!_||m==="justify-right"&&!_||m==="justify-left"&&!_?0:(m==="center"&&(g=h/2),m==="right"&&(g=h),m==="justify-center"&&(g=h/2),m==="justify-right"&&(g=h),p==="rtl"&&(g-=h),g)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var o=this._forceClearCache;return o||(o=this.hasStateChanged("_dimensionAffectingProps")),o&&(this.dirty=!0,this._forceClearCache=!1),o},getLineWidth:function(o){if(this.__lineWidths[o]!==void 0)return this.__lineWidths[o];var s=this.measureLine(o).width;return this.__lineWidths[o]=s,s},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(o,s,h){var m=this._getStyleDeclaration(o,s);return m&&m[h]!==void 0?m[h]:this[h]},_renderTextDecoration:function(o,s){if(this[s]||this.styleHas(s)){for(var h,m,p,g,_,E,I,S,D,x,R,j,U,Q,Z,q,k=this._getLeftOffset(),F=this._getTopOffset(),z=this.path,J=this._getWidthOfCharSpacing(),ee=this.offsets[s],V=0,B=this._textLines.length;V<B;V++)if(h=this.getHeightOfLine(V),this[s]||this.styleHas(s,V)){I=this._textLines[V],Q=h/this.lineHeight,g=this._getLineLeftOffset(V),x=0,R=0,S=this.getValueOfPropertyAt(V,0,s),q=this.getValueOfPropertyAt(V,0,"fill"),D=F+Q*(1-this._fontSizeFraction),m=this.getHeightOfChar(V,0),_=this.getValueOfPropertyAt(V,0,"deltaY");for(var X=0,ne=I.length;X<ne;X++)if(j=this.__charBounds[V][X],U=this.getValueOfPropertyAt(V,X,s),Z=this.getValueOfPropertyAt(V,X,"fill"),p=this.getHeightOfChar(V,X),E=this.getValueOfPropertyAt(V,X,"deltaY"),z&&U&&Z)o.save(),o.fillStyle=q,o.translate(j.renderLeft,j.renderTop),o.rotate(j.angle),o.fillRect(-j.kernedWidth/2,ee*p+E,j.kernedWidth,this.fontSize/15),o.restore();else if((U!==S||Z!==q||p!==m||E!==_)&&R>0){var K=k+g+x;this.direction==="rtl"&&(K=this.width-K-R),S&&q&&(o.fillStyle=q,o.fillRect(K,D+ee*m+_,R,this.fontSize/15)),x=j.left,R=j.width,S=U,q=Z,m=p,_=E}else R+=j.kernedWidth;K=k+g+x,this.direction==="rtl"&&(K=this.width-K-R),o.fillStyle=Z,U&&Z&&o.fillRect(K,D+ee*m+_,R-J,this.fontSize/15),F+=h}else F+=h;this._removeShadow(o)}},_getFontDeclaration:function(o,s){var h=o||this,m=this.fontFamily,p=c.Text.genericFonts.indexOf(m.toLowerCase())>-1,g=m===void 0||m.indexOf("'")>-1||m.indexOf(",")>-1||m.indexOf('"')>-1||p?h.fontFamily:'"'+h.fontFamily+'"';return[c.isLikelyNode?h.fontWeight:h.fontStyle,c.isLikelyNode?h.fontStyle:h.fontWeight,s?this.CACHE_FONT_SIZE+"px":h.fontSize+"px",g].join(" ")},render:function(o){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",o)))},_splitTextIntoLines:function(o){for(var s=o.split(this._reNewline),h=new Array(s.length),m=[`
`],p=[],g=0;g<s.length;g++)h[g]=c.util.string.graphemeSplit(s[g]),p=p.concat(h[g],m);return p.pop(),{_unwrappedLines:h,lines:s,graphemeText:p,graphemeLines:h}},toObject:function(o){var s=f.concat(o),h=this.callSuper("toObject",s);return h.styles=u(this.styles,!0),h.path&&(h.path=this.path.toObject()),h},set:function(o,s){this.callSuper("set",o,s);var h=!1,m=!1;if(typeof o=="object")for(var p in o)p==="path"&&this.setPathInfo(),h=h||this._dimensionAffectingProps.indexOf(p)!==-1,m=m||p==="path";else h=this._dimensionAffectingProps.indexOf(o)!==-1,m=o==="path";return m&&this.setPathInfo(),h&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),c.Text.DEFAULT_SVG_FONT_SIZE=16,c.Text.fromElement=function(o,s,h){if(!o)return s(null);var m=c.parseAttributes(o,c.Text.ATTRIBUTE_NAMES),p=m.textAnchor||"left";if((h=c.util.object.extend(h?u(h):{},m)).top=h.top||0,h.left=h.left||0,m.textDecoration){var g=m.textDecoration;g.indexOf("underline")!==-1&&(h.underline=!0),g.indexOf("overline")!==-1&&(h.overline=!0),g.indexOf("line-through")!==-1&&(h.linethrough=!0),delete h.textDecoration}"dx"in m&&(h.left+=m.dx),"dy"in m&&(h.top+=m.dy),"fontSize"in h||(h.fontSize=c.Text.DEFAULT_SVG_FONT_SIZE);var _="";"textContent"in o?_=o.textContent:"firstChild"in o&&o.firstChild!==null&&"data"in o.firstChild&&o.firstChild.data!==null&&(_=o.firstChild.data),_=_.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var E=h.strokeWidth;h.strokeWidth=0;var I=new c.Text(_,h),S=I.getScaledHeight()/I.height,D=((I.height+I.strokeWidth)*I.lineHeight-I.height)*S,x=I.getScaledHeight()+D,R=0;p==="center"&&(R=I.getScaledWidth()/2),p==="right"&&(R=I.getScaledWidth()),I.set({left:I.left-R,top:I.top-(x-I.fontSize*(.07+I._fontSizeFraction))/I.lineHeight,strokeWidth:E!==void 0?E:1}),s(I)},c.Text.fromObject=function(o,s){var h=u(o),m=o.path;return delete h.path,c.Object._fromObject("Text",h,function(p){m?c.Object._fromObject("Path",m,function(g){p.set("path",g),s(p)},"path"):s(p)},"text")},c.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],c.util.createAccessors&&c.util.createAccessors(c.Text)}}(e),w.util.object.extend(w.Text.prototype,{isEmptyStyles:function(l){if(!this.styles||l!==void 0&&!this.styles[l])return!0;var c=l===void 0?this.styles:{line:this.styles[l]};for(var u in c)for(var f in c[u])for(var o in c[u][f])return!1;return!0},styleHas:function(l,c){if(!this.styles||!l||l===""||c!==void 0&&!this.styles[c])return!1;var u=c===void 0?this.styles:{0:this.styles[c]};for(var f in u)for(var o in u[f])if(u[f][o][l]!==void 0)return!0;return!1},cleanStyle:function(l){if(!this.styles||!l||l==="")return!1;var c,u,f=this.styles,o=0,s=!0,h=0;for(var m in f){for(var p in c=0,f[m]){var g;o++,(g=f[m][p]).hasOwnProperty(l)?(u?g[l]!==u&&(s=!1):u=g[l],g[l]===this[l]&&delete g[l]):s=!1,Object.keys(g).length!==0?c++:delete f[m][p]}c===0&&delete f[m]}for(var _=0;_<this._textLines.length;_++)h+=this._textLines[_].length;s&&o===h&&(this[l]=u,this.removeStyle(l))},removeStyle:function(l){if(this.styles&&l&&l!==""){var c,u,f,o=this.styles;for(u in o){for(f in c=o[u])delete c[f][l],Object.keys(c[f]).length===0&&delete c[f];Object.keys(c).length===0&&delete o[u]}}},_extendStyles:function(l,c){var u=this.get2DCursorLocation(l);this._getLineStyle(u.lineIndex)||this._setLineStyle(u.lineIndex),this._getStyleDeclaration(u.lineIndex,u.charIndex)||this._setStyleDeclaration(u.lineIndex,u.charIndex,{}),w.util.object.extend(this._getStyleDeclaration(u.lineIndex,u.charIndex),c)},get2DCursorLocation:function(l,c){l===void 0&&(l=this.selectionStart);for(var u=c?this._unwrappedTextLines:this._textLines,f=u.length,o=0;o<f;o++){if(l<=u[o].length)return{lineIndex:o,charIndex:l};l-=u[o].length+this.missingNewlineOffset(o)}return{lineIndex:o-1,charIndex:u[o-1].length<l?u[o-1].length:l}},getSelectionStyles:function(l,c,u){l===void 0&&(l=this.selectionStart||0),c===void 0&&(c=this.selectionEnd||l);for(var f=[],o=l;o<c;o++)f.push(this.getStyleAtPosition(o,u));return f},getStyleAtPosition:function(l,c){var u=this.get2DCursorLocation(l);return(c?this.getCompleteStyleDeclaration(u.lineIndex,u.charIndex):this._getStyleDeclaration(u.lineIndex,u.charIndex))||{}},setSelectionStyles:function(l,c,u){c===void 0&&(c=this.selectionStart||0),u===void 0&&(u=this.selectionEnd||c);for(var f=c;f<u;f++)this._extendStyles(f,l);return this._forceClearCache=!0,this},_getStyleDeclaration:function(l,c){var u=this.styles&&this.styles[l];return u?u[c]:null},getCompleteStyleDeclaration:function(l,c){for(var u,f=this._getStyleDeclaration(l,c)||{},o={},s=0;s<this._styleProperties.length;s++)o[u=this._styleProperties[s]]=f[u]===void 0?this[u]:f[u];return o},_setStyleDeclaration:function(l,c,u){this.styles[l][c]=u},_deleteStyleDeclaration:function(l,c){delete this.styles[l][c]},_getLineStyle:function(l){return!!this.styles[l]},_setLineStyle:function(l){this.styles[l]={}},_deleteLineStyle:function(l){delete this.styles[l]}}),function(){function l(c){c.textDecoration&&(c.textDecoration.indexOf("underline")>-1&&(c.underline=!0),c.textDecoration.indexOf("line-through")>-1&&(c.linethrough=!0),c.textDecoration.indexOf("overline")>-1&&(c.overline=!0),delete c.textDecoration)}w.IText=w.util.createClass(w.Text,w.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(c,u){this.callSuper("initialize",c,u),this.initBehavior()},setSelectionStart:function(c){c=Math.max(c,0),this._updateAndFire("selectionStart",c)},setSelectionEnd:function(c){c=Math.min(c,this.text.length),this._updateAndFire("selectionEnd",c)},_updateAndFire:function(c,u){this[c]!==u&&(this._fireSelectionChanged(),this[c]=u),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(c){this.clearContextTop(),this.callSuper("render",c),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(c){this.callSuper("_render",c)},clearContextTop:function(c){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var u=this.canvas.contextTop,f=this.canvas.viewportTransform;u.save(),u.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this.transform(u),this._clearTextArea(u),c||u.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var c=this._getCursorBoundaries(),u=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(c,u):this.renderSelection(c,u),u.restore()}},_clearTextArea:function(c){var u=this.width+4,f=this.height+4;c.clearRect(-u/2,-f/2,u,f)},_getCursorBoundaries:function(c){c===void 0&&(c=this.selectionStart);var u=this._getLeftOffset(),f=this._getTopOffset(),o=this._getCursorBoundariesOffsets(c);return{left:u,top:f,leftOffset:o.left,topOffset:o.top}},_getCursorBoundariesOffsets:function(c){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var u,f,o,s,h=0,m=0,p=this.get2DCursorLocation(c);o=p.charIndex,f=p.lineIndex;for(var g=0;g<f;g++)h+=this.getHeightOfLine(g);u=this._getLineLeftOffset(f);var _=this.__charBounds[f][o];return _&&(m=_.left),this.charSpacing!==0&&o===this._textLines[f].length&&(m-=this._getWidthOfCharSpacing()),s={top:h,left:u+(m>0?m:0)},this.direction==="rtl"&&(s.left*=-1),this.cursorOffsetCache=s,this.cursorOffsetCache},renderCursor:function(c,u){var f=this.get2DCursorLocation(),o=f.lineIndex,s=f.charIndex>0?f.charIndex-1:0,h=this.getValueOfPropertyAt(o,s,"fontSize"),m=this.scaleX*this.canvas.getZoom(),p=this.cursorWidth/m,g=c.topOffset,_=this.getValueOfPropertyAt(o,s,"deltaY");g+=(1-this._fontSizeFraction)*this.getHeightOfLine(o)/this.lineHeight-h*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(c,u),u.fillStyle=this.cursorColor||this.getValueOfPropertyAt(o,s,"fill"),u.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,u.fillRect(c.left+c.leftOffset-p/2,g+c.top+_,p,h)},renderSelection:function(c,u){for(var f=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,o=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=this.textAlign.indexOf("justify")!==-1,h=this.get2DCursorLocation(f),m=this.get2DCursorLocation(o),p=h.lineIndex,g=m.lineIndex,_=h.charIndex<0?0:h.charIndex,E=m.charIndex<0?0:m.charIndex,I=p;I<=g;I++){var S,D=this._getLineLeftOffset(I)||0,x=this.getHeightOfLine(I),R=0,j=0;if(I===p&&(R=this.__charBounds[p][_].left),I>=p&&I<g)j=s&&!this.isEndOfWrapping(I)?this.width:this.getLineWidth(I)||5;else if(I===g)if(E===0)j=this.__charBounds[g][E].left;else{var U=this._getWidthOfCharSpacing();j=this.__charBounds[g][E-1].left+this.__charBounds[g][E-1].width-U}S=x,(this.lineHeight<1||I===g&&this.lineHeight>1)&&(x/=this.lineHeight);var Q=c.left+D+R,Z=j-R,q=x,k=0;this.inCompositionMode?(u.fillStyle=this.compositionColor||"black",q=1,k=x):u.fillStyle=this.selectionColor,this.direction==="rtl"&&(Q=this.width-Q-Z),u.fillRect(Q,c.top+c.topOffset+k,Z,q),c.topOffset+=S}},getCurrentCharFontSize:function(){var c=this._getCurrentCharIndex();return this.getValueOfPropertyAt(c.l,c.c,"fontSize")},getCurrentCharColor:function(){var c=this._getCurrentCharIndex();return this.getValueOfPropertyAt(c.l,c.c,"fill")},_getCurrentCharIndex:function(){var c=this.get2DCursorLocation(this.selectionStart,!0),u=c.charIndex>0?c.charIndex-1:0;return{l:c.lineIndex,c:u}}}),w.IText.fromObject=function(c,u){if(l(c),c.styles)for(var f in c.styles)for(var o in c.styles[f])l(c.styles[f][o]);w.Object._fromObject("IText",c,u,"text")}}(),ae=w.util.object.clone,w.util.object.extend(w.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var l=this;this.on("added",function(){var c=l.canvas;c&&(c._hasITextHandlers||(c._hasITextHandlers=!0,l._initCanvasHandlers(c)),c._iTextInstances=c._iTextInstances||[],c._iTextInstances.push(l))})},initRemovedHandler:function(){var l=this;this.on("removed",function(){var c=l.canvas;c&&(c._iTextInstances=c._iTextInstances||[],w.util.removeFromArray(c._iTextInstances,l),c._iTextInstances.length===0&&(c._hasITextHandlers=!1,l._removeCanvasHandlers(c)))})},_initCanvasHandlers:function(l){l._mouseUpITextHandler=function(){l._iTextInstances&&l._iTextInstances.forEach(function(c){c.__isMousedown=!1})},l.on("mouse:up",l._mouseUpITextHandler)},_removeCanvasHandlers:function(l){l.off("mouse:up",l._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(l,c,u,f){var o;return o={isAborted:!1,abort:function(){this.isAborted=!0}},l.animate("_currentCursorOpacity",c,{duration:u,onComplete:function(){o.isAborted||l[f]()},onChange:function(){l.canvas&&l.selectionStart===l.selectionEnd&&l.renderCursorOrSelection()},abort:function(){return o.isAborted}}),o},_onTickComplete:function(){var l=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){l._currentTickCompleteState=l._animateCursor(l,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(l){var c=this,u=l?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){c._tick()},u)},abortCursorAnimation:function(){var l=this._currentTickState||this._currentTickCompleteState,c=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,l&&c&&c.clearContext(c.contextTop||c.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(l){var c=0,u=l-1;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)c++,u--;for(;/\S/.test(this._text[u])&&u>-1;)c++,u--;return l-c},findWordBoundaryRight:function(l){var c=0,u=l;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)c++,u++;for(;/\S/.test(this._text[u])&&u<this._text.length;)c++,u++;return l+c},findLineBoundaryLeft:function(l){for(var c=0,u=l-1;!/\n/.test(this._text[u])&&u>-1;)c++,u--;return l-c},findLineBoundaryRight:function(l){for(var c=0,u=l;!/\n/.test(this._text[u])&&u<this._text.length;)c++,u++;return l+c},searchWordBoundary:function(l,c){for(var u=this._text,f=this._reSpace.test(u[l])?l-1:l,o=u[f],s=w.reNonWord;!s.test(o)&&f>0&&f<u.length;)o=u[f+=c];return s.test(o)&&(f+=c===1?0:1),f},selectWord:function(l){l=l||this.selectionStart;var c=this.searchWordBoundary(l,-1),u=this.searchWordBoundary(l,1);this.selectionStart=c,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(l){l=l||this.selectionStart;var c=this.findLineBoundaryLeft(l),u=this.findLineBoundaryRight(l);return this.selectionStart=c,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(l){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(l),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(l){l._iTextInstances&&l._iTextInstances.forEach(function(c){c.selected=!1,c.isEditing&&c.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(l){if(this.__isMousedown&&this.isEditing){var c=this.getSelectionStartFromPointer(l.e),u=this.selectionStart,f=this.selectionEnd;(c===this.__selectionStartOnMouseDown&&u!==f||u!==c&&f!==c)&&(c>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=c):(this.selectionStart=c,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===u&&this.selectionEnd===f||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(l,c,u){var f=u.slice(0,l),o=w.util.string.graphemeSplit(f).length;if(l===c)return{selectionStart:o,selectionEnd:o};var s=u.slice(l,c);return{selectionStart:o,selectionEnd:o+w.util.string.graphemeSplit(s).length}},fromGraphemeToStringSelection:function(l,c,u){var f=u.slice(0,l).join("").length;return l===c?{selectionStart:f,selectionEnd:f}:{selectionStart:f,selectionEnd:f+u.slice(l,c).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var l=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=l.selectionStart,this.hiddenTextarea.selectionEnd=l.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var l=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=l.selectionEnd,this.inCompositionMode||(this.selectionStart=l.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var l=this._calcTextareaPosition();this.hiddenTextarea.style.left=l.left,this.hiddenTextarea.style.top=l.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var l=this.inCompositionMode?this.compositionStart:this.selectionStart,c=this._getCursorBoundaries(l),u=this.get2DCursorLocation(l),f=u.lineIndex,o=u.charIndex,s=this.getValueOfPropertyAt(f,o,"fontSize")*this.lineHeight,h=c.leftOffset,m=this.calcTransformMatrix(),p={x:c.left+h,y:c.top+c.topOffset+s},g=this.canvas.getRetinaScaling(),_=this.canvas.upperCanvasEl,E=_.width/g,I=_.height/g,S=E-s,D=I-s,x=_.clientWidth/E,R=_.clientHeight/I;return p=w.util.transformPoint(p,m),(p=w.util.transformPoint(p,this.canvas.viewportTransform)).x*=x,p.y*=R,p.x<0&&(p.x=0),p.x>S&&(p.x=S),p.y<0&&(p.y=0),p.y>D&&(p.y=D),p.x+=this.canvas._offset.left,p.y+=this.canvas._offset.top,{left:p.x+"px",top:p.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var l=this._textBeforeEdit!==this.text,c=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,c&&(c.blur&&c.blur(),c.parentNode&&c.parentNode.removeChild(c)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),l&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),l&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var l in this.styles)this._textLines[l]||delete this.styles[l]},removeStyleFromTo:function(l,c){var u,f,o=this.get2DCursorLocation(l,!0),s=this.get2DCursorLocation(c,!0),h=o.lineIndex,m=o.charIndex,p=s.lineIndex,g=s.charIndex;if(h!==p){if(this.styles[h])for(u=m;u<this._unwrappedTextLines[h].length;u++)delete this.styles[h][u];if(this.styles[p])for(u=g;u<this._unwrappedTextLines[p].length;u++)(f=this.styles[p][u])&&(this.styles[h]||(this.styles[h]={}),this.styles[h][m+u-g]=f);for(u=h+1;u<=p;u++)delete this.styles[u];this.shiftLineStyles(p,h-p)}else if(this.styles[h]){f=this.styles[h];var _,E,I=g-m;for(u=m;u<g;u++)delete f[u];for(E in this.styles[h])(_=parseInt(E,10))>=g&&(f[_-I]=f[E],delete f[E])}},shiftLineStyles:function(l,c){var u=ae(this.styles);for(var f in this.styles){var o=parseInt(f,10);o>l&&(this.styles[o+c]=u[o],u[o-c]||delete this.styles[o])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(l,c,u,f){var o,s={},h=!1,m=this._unwrappedTextLines[l].length===c;for(var p in u||(u=1),this.shiftLineStyles(l,u),this.styles[l]&&(o=this.styles[l][c===0?c:c-1]),this.styles[l]){var g=parseInt(p,10);g>=c&&(h=!0,s[g-c]=this.styles[l][p],m&&c===0||delete this.styles[l][p])}var _=!1;for(h&&!m&&(this.styles[l+u]=s,_=!0),_&&u--;u>0;)f&&f[u-1]?this.styles[l+u]={0:ae(f[u-1])}:o?this.styles[l+u]={0:ae(o)}:delete this.styles[l+u],u--;this._forceClearCache=!0},insertCharStyleObject:function(l,c,u,f){this.styles||(this.styles={});var o=this.styles[l],s=o?ae(o):{};for(var h in u||(u=1),s){var m=parseInt(h,10);m>=c&&(o[m+u]=s[m],s[m-u]||delete o[m])}if(this._forceClearCache=!0,f)for(;u--;)Object.keys(f[u]).length&&(this.styles[l]||(this.styles[l]={}),this.styles[l][c+u]=ae(f[u]));else if(o)for(var p=o[c?c-1:1];p&&u--;)this.styles[l][c+u]=ae(p)},insertNewStyleBlock:function(l,c,u){for(var f=this.get2DCursorLocation(c,!0),o=[0],s=0,h=0;h<l.length;h++)l[h]===`
`?o[++s]=0:o[s]++;for(o[0]>0&&(this.insertCharStyleObject(f.lineIndex,f.charIndex,o[0],u),u=u&&u.slice(o[0]+1)),s&&this.insertNewlineStyleObject(f.lineIndex,f.charIndex+o[0],s),h=1;h<s;h++)o[h]>0?this.insertCharStyleObject(f.lineIndex+h,0,o[h],u):u&&this.styles[f.lineIndex+h]&&u[0]&&(this.styles[f.lineIndex+h][0]=u[0]),u=u&&u.slice(o[h]+1);o[h]>0&&this.insertCharStyleObject(f.lineIndex+h,0,o[h],u)},setSelectionStartEndWithShift:function(l,c,u){u<=l?(c===l?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=l),this.selectionStart=u):u>l&&u<c?this._selectionDirection==="right"?this.selectionEnd=u:this.selectionStart=u:(c===l?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=c),this.selectionEnd=u)},setSelectionInBoundaries:function(){var l=this.text.length;this.selectionStart>l?this.selectionStart=l:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>l?this.selectionEnd=l:this.selectionEnd<0&&(this.selectionEnd=0)}}),w.util.object.extend(w.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(l){if(this.canvas){this.__newClickTime=+new Date;var c=l.pointer;this.isTripleClick(c)&&(this.fire("tripleclick",l),this._stopEvent(l.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=c,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(l){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===l.x&&this.__lastPointer.y===l.y},_stopEvent:function(l){l.preventDefault&&l.preventDefault(),l.stopPropagation&&l.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(l){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(l.e))},tripleClickHandler:function(l){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(l.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(l){!this.canvas||!this.editable||l.e.button&&l.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(l.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(l){!this.canvas||!this.editable||l.e.button&&l.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(l){if(this.__isMousedown=!1,!(!this.editable||this.group||l.transform&&l.transform.actionPerformed||l.e.button&&l.e.button!==1)){if(this.canvas){var c=this.canvas._activeObject;if(c&&c!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(l.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(l){var c=this.getSelectionStartFromPointer(l),u=this.selectionStart,f=this.selectionEnd;l.shiftKey?this.setSelectionStartEndWithShift(u,f,c):(this.selectionStart=c,this.selectionEnd=c),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(l){for(var c,u=this.getLocalPointer(l),f=0,o=0,s=0,h=0,m=0,p=0,g=this._textLines.length;p<g&&s<=u.y;p++)s+=this.getHeightOfLine(p)*this.scaleY,m=p,p>0&&(h+=this._textLines[p-1].length+this.missingNewlineOffset(p-1));o=this._getLineLeftOffset(m)*this.scaleX,c=this._textLines[m],this.direction==="rtl"&&(u.x=this.width*this.scaleX-u.x+o);for(var _=0,E=c.length;_<E&&(f=o,(o+=this.__charBounds[m][_].kernedWidth*this.scaleX)<=u.x);_++)h++;return this._getNewSelectionStartFromOffset(u,f,o,h,E)},_getNewSelectionStartFromOffset:function(l,c,u,f,o){var s=l.x-c,h=u-l.x,m=f+(h>s||h<0?0:1);return this.flipX&&(m=o-m),m>this._text.length&&(m=this._text.length),m}}),w.util.object.extend(w.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=w.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var l=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+l.top+"; left: "+l.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+l.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):w.document.body.appendChild(this.hiddenTextarea),w.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),w.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),w.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),w.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),w.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),w.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),w.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),w.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),w.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(w.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(l){if(this.isEditing){var c=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(l.keyCode in c)this[c[l.keyCode]](l);else{if(!(l.keyCode in this.ctrlKeysMapDown)||!l.ctrlKey&&!l.metaKey)return;this[this.ctrlKeysMapDown[l.keyCode]](l)}l.stopImmediatePropagation(),l.preventDefault(),l.keyCode>=33&&l.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(l){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:l.keyCode in this.ctrlKeysMapUp&&(l.ctrlKey||l.metaKey)&&(this[this.ctrlKeysMapUp[l.keyCode]](l),l.stopImmediatePropagation(),l.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(l){var c=this.fromPaste;if(this.fromPaste=!1,l&&l.stopPropagation(),this.isEditing){var u,f,o,s,h,m=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,p=this._text.length,g=m.length,_=g-p,E=this.selectionStart,I=this.selectionEnd,S=E!==I;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var D=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),x=E>D.selectionStart;S?(u=this._text.slice(E,I),_+=I-E):g<p&&(u=x?this._text.slice(I+_,I):this._text.slice(E,E-_)),f=m.slice(D.selectionEnd-_,D.selectionEnd),u&&u.length&&(f.length&&(o=this.getSelectionStyles(E,E+1,!1),o=f.map(function(){return o[0]})),S?(s=E,h=I):x?(s=I-u.length,h=I):(s=I,h=I+u.length),this.removeStyleFromTo(s,h)),f.length&&(c&&f.join("")===w.copiedText&&!w.disableStyleCopyPaste&&(o=w.copiedTextStyle),this.insertNewStyleBlock(f,E,o)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(l){this.compositionStart=l.target.selectionStart,this.compositionEnd=l.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(w.copiedText=this.getSelectedText(),w.disableStyleCopyPaste?w.copiedTextStyle=null:w.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(l){return l&&l.clipboardData||w.window.clipboardData},_getWidthBeforeCursor:function(l,c){var u,f=this._getLineLeftOffset(l);return c>0&&(f+=(u=this.__charBounds[l][c-1]).left+u.width),f},getDownCursorOffset:function(l,c){var u=this._getSelectionForOffset(l,c),f=this.get2DCursorLocation(u),o=f.lineIndex;if(o===this._textLines.length-1||l.metaKey||l.keyCode===34)return this._text.length-u;var s=f.charIndex,h=this._getWidthBeforeCursor(o,s),m=this._getIndexOnLine(o+1,h);return this._textLines[o].slice(s).length+m+1+this.missingNewlineOffset(o)},_getSelectionForOffset:function(l,c){return l.shiftKey&&this.selectionStart!==this.selectionEnd&&c?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(l,c){var u=this._getSelectionForOffset(l,c),f=this.get2DCursorLocation(u),o=f.lineIndex;if(o===0||l.metaKey||l.keyCode===33)return-u;var s=f.charIndex,h=this._getWidthBeforeCursor(o,s),m=this._getIndexOnLine(o-1,h),p=this._textLines[o].slice(0,s),g=this.missingNewlineOffset(o-1);return-this._textLines[o-1].length+m-p.length+(1-g)},_getIndexOnLine:function(l,c){for(var u,f,o=this._textLines[l],s=this._getLineLeftOffset(l),h=0,m=0,p=o.length;m<p;m++)if((s+=u=this.__charBounds[l][m].width)>c){f=!0;var g=s-u,_=s,E=Math.abs(g-c);h=Math.abs(_-c)<E?m:m-1;break}return f||(h=o.length-1),h},moveCursorDown:function(l){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",l)},moveCursorUp:function(l){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",l)},_moveCursorUpOrDown:function(l,c){var u=this["get"+l+"CursorOffset"](c,this._selectionDirection==="right");c.shiftKey?this.moveCursorWithShift(u):this.moveCursorWithoutShift(u),u!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(l){var c=this._selectionDirection==="left"?this.selectionStart+l:this.selectionEnd+l;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,c),l!==0},moveCursorWithoutShift:function(l){return l<0?(this.selectionStart+=l,this.selectionEnd=this.selectionStart):(this.selectionEnd+=l,this.selectionStart=this.selectionEnd),l!==0},moveCursorLeft:function(l){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",l)},_move:function(l,c,u){var f;if(l.altKey)f=this["findWordBoundary"+u](this[c]);else{if(!l.metaKey&&l.keyCode!==35&&l.keyCode!==36)return this[c]+=u==="Left"?-1:1,!0;f=this["findLineBoundary"+u](this[c])}if(typeof f!==void 0&&this[c]!==f)return this[c]=f,!0},_moveLeft:function(l,c){return this._move(l,c,"Left")},_moveRight:function(l,c){return this._move(l,c,"Right")},moveCursorLeftWithoutShift:function(l){var c=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(c=this._moveLeft(l,"selectionStart")),this.selectionEnd=this.selectionStart,c},moveCursorLeftWithShift:function(l){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(l,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(l,"selectionStart")):void 0},moveCursorRight:function(l){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",l)},_moveCursorLeftOrRight:function(l,c){var u="moveCursor"+l+"With";this._currentCursorOpacity=1,c.shiftKey?u+="Shift":u+="outShift",this[u](c)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(l){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(l,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(l,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(l){var c=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(c=this._moveRight(l,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,c},removeChars:function(l,c){c===void 0&&(c=l+1),this.removeStyleFromTo(l,c),this._text.splice(l,c-l),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(l,c,u,f){f===void 0&&(f=u),f>u&&this.removeStyleFromTo(u,f);var o=w.util.string.graphemeSplit(l);this.insertNewStyleBlock(o,u,c),this._text=[].concat(this._text.slice(0,u),o,this._text.slice(f)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var l=w.util.toFixed,c=/  +/g;w.util.object.extend(w.Text.prototype,{_toSVG:function(){var u=this._getSVGLeftTopOffsets(),f=this._getSVGTextAndBg(u.textTop,u.textLeft);return this._wrapSVGTextAndBg(f)},toSVG:function(u){return this._createBaseSVGMarkup(this._toSVG(),{reviver:u,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(u){var f=this.getSvgTextDecoration(this);return[u.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",f?'text-decoration="'+f+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",u.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(u,f){var o,s=[],h=[],m=u;this._setSVGBg(h);for(var p=0,g=this._textLines.length;p<g;p++)o=this._getLineLeftOffset(p),(this.textBackgroundColor||this.styleHas("textBackgroundColor",p))&&this._setSVGTextLineBg(h,p,f+o,m),this._setSVGTextLineText(s,p,f+o,m),m+=this.getHeightOfLine(p);return{textSpans:s,textBgRects:h}},_createTextCharSpan:function(u,f,o,s){var h=u!==u.trim()||u.match(c),m=this.getSvgSpanStyles(f,h),p=m?'style="'+m+'"':"",g=f.deltaY,_="",E=w.Object.NUM_FRACTION_DIGITS;return g&&(_=' dy="'+l(g,E)+'" '),['<tspan x="',l(o,E),'" y="',l(s,E),'" ',_,p,">",w.util.string.escapeXml(u),"</tspan>"].join("")},_setSVGTextLineText:function(u,f,o,s){var h,m,p,g,_,E=this.getHeightOfLine(f),I=this.textAlign.indexOf("justify")!==-1,S="",D=0,x=this._textLines[f];s+=E*(1-this._fontSizeFraction)/this.lineHeight;for(var R=0,j=x.length-1;R<=j;R++)_=R===j||this.charSpacing,S+=x[R],p=this.__charBounds[f][R],D===0?(o+=p.kernedWidth-p.width,D+=p.width):D+=p.kernedWidth,I&&!_&&this._reSpaceAndTab.test(x[R])&&(_=!0),_||(h=h||this.getCompleteStyleDeclaration(f,R),m=this.getCompleteStyleDeclaration(f,R+1),_=this._hasStyleChangedForSvg(h,m)),_&&(g=this._getStyleDeclaration(f,R)||{},u.push(this._createTextCharSpan(S,g,o,s)),S="",h=m,o+=D,D=0)},_pushTextBgRect:function(u,f,o,s,h,m){var p=w.Object.NUM_FRACTION_DIGITS;u.push("		<rect ",this._getFillAttributes(f),' x="',l(o,p),'" y="',l(s,p),'" width="',l(h,p),'" height="',l(m,p),`"></rect>
`)},_setSVGTextLineBg:function(u,f,o,s){for(var h,m,p=this._textLines[f],g=this.getHeightOfLine(f)/this.lineHeight,_=0,E=0,I=this.getValueOfPropertyAt(f,0,"textBackgroundColor"),S=0,D=p.length;S<D;S++)h=this.__charBounds[f][S],(m=this.getValueOfPropertyAt(f,S,"textBackgroundColor"))!==I?(I&&this._pushTextBgRect(u,I,o+E,s,_,g),E=h.left,_=h.width,I=m):_+=h.kernedWidth;m&&this._pushTextBgRect(u,m,o+E,s,_,g)},_getFillAttributes:function(u){var f=u&&typeof u=="string"?new w.Color(u):"";return f&&f.getSource()&&f.getAlpha()!==1?'opacity="'+f.getAlpha()+'" fill="'+f.setAlpha(1).toRgb()+'"':'fill="'+u+'"'},_getSVGLineTopOffset:function(u){for(var f,o=0,s=0;s<u;s++)o+=this.getHeightOfLine(s);return f=this.getHeightOfLine(s),{lineTop:o,offset:(this._fontSizeMult-this._fontSizeFraction)*f/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(u){return w.Object.prototype.getSvgStyles.call(this,u)+" white-space: pre;"}})}(),function(l){var c=l.fabric||(l.fabric={});c.Textbox=c.util.createClass(c.IText,c.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:c.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(u){for(var f=0,o=0,s=0,h={},m=0;m<u.graphemeLines.length;m++)u.graphemeText[s]===`
`&&m>0?(o=0,s++,f++):!this.splitByGrapheme&&this._reSpaceAndTab.test(u.graphemeText[s])&&m>0&&(o++,s++),h[m]={line:f,offset:o},s+=u.graphemeLines[m].length,o+=u.graphemeLines[m].length;return h},styleHas:function(u,f){if(this._styleMap&&!this.isWrapping){var o=this._styleMap[f];o&&(f=o.line)}return c.Text.prototype.styleHas.call(this,u,f)},isEmptyStyles:function(u){if(!this.styles)return!0;var f,o,s=0,h=!1,m=this._styleMap[u],p=this._styleMap[u+1];for(var g in m&&(u=m.line,s=m.offset),p&&(h=p.line===u,f=p.offset),o=u===void 0?this.styles:{line:this.styles[u]})for(var _ in o[g])if(_>=s&&(!h||_<f))for(var E in o[g][_])return!1;return!0},_getStyleDeclaration:function(u,f){if(this._styleMap&&!this.isWrapping){var o=this._styleMap[u];if(!o)return null;u=o.line,f=o.offset+f}return this.callSuper("_getStyleDeclaration",u,f)},_setStyleDeclaration:function(u,f,o){var s=this._styleMap[u];u=s.line,f=s.offset+f,this.styles[u][f]=o},_deleteStyleDeclaration:function(u,f){var o=this._styleMap[u];u=o.line,f=o.offset+f,delete this.styles[u][f]},_getLineStyle:function(u){var f=this._styleMap[u];return!!this.styles[f.line]},_setLineStyle:function(u){var f=this._styleMap[u];this.styles[f.line]={}},_wrapText:function(u,f){var o,s=[];for(this.isWrapping=!0,o=0;o<u.length;o++)s=s.concat(this._wrapLine(u[o],o,f));return this.isWrapping=!1,s},_measureWord:function(u,f,o){var s,h=0;o=o||0;for(var m=0,p=u.length;m<p;m++)h+=this._getGraphemeBox(u[m],f,m+o,s,!0).kernedWidth,s=u[m];return h},_wrapLine:function(u,f,o,s){var h=0,m=this.splitByGrapheme,p=[],g=[],_=m?c.util.string.graphemeSplit(u):u.split(this._wordJoiners),E="",I=0,S=m?"":" ",D=0,x=0,R=0,j=!0,U=this._getWidthOfCharSpacing();s=s||0,_.length===0&&_.push([]),o-=s;for(var Q=0;Q<_.length;Q++)E=m?_[Q]:c.util.string.graphemeSplit(_[Q]),D=this._measureWord(E,f,I),I+=E.length,(h+=x+D-U)>o&&!j?(p.push(g),g=[],h=D,j=!0):h+=U,j||m||g.push(S),g=g.concat(E),x=m?0:this._measureWord([S],f,I),I++,j=!1,D>R&&(R=D);return Q&&p.push(g),R+s>this.dynamicMinWidth&&(this.dynamicMinWidth=R-U+s),p},isEndOfWrapping:function(u){return!this._styleMap[u+1]||this._styleMap[u+1].line!==this._styleMap[u].line},missingNewlineOffset:function(u){return this.splitByGrapheme?this.isEndOfWrapping(u)?1:0:1},_splitTextIntoLines:function(u){for(var f=c.Text.prototype._splitTextIntoLines.call(this,u),o=this._wrapText(f.lines,this.width),s=new Array(o.length),h=0;h<o.length;h++)s[h]=o[h].join("");return f.lines=s,f.graphemeLines=o,f},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var u={};for(var f in this._styleMap)this._textLines[f]&&(u[this._styleMap[f].line]=1);for(var f in this.styles)u[f]||delete this.styles[f]},toObject:function(u){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(u))}}),c.Textbox.fromObject=function(u,f){return c.Object._fromObject("Textbox",u,f,"text")}}(e),function(){var l=w.controlsUtils,c=l.scaleSkewCursorStyleHandler,u=l.scaleCursorStyleHandler,f=l.scalingEqually,o=l.scalingYOrSkewingX,s=l.scalingXOrSkewingY,h=l.scaleOrSkewActionName,m=w.Object.prototype.controls;if(m.ml=new w.Control({x:-.5,y:0,cursorStyleHandler:c,actionHandler:s,getActionName:h}),m.mr=new w.Control({x:.5,y:0,cursorStyleHandler:c,actionHandler:s,getActionName:h}),m.mb=new w.Control({x:0,y:.5,cursorStyleHandler:c,actionHandler:o,getActionName:h}),m.mt=new w.Control({x:0,y:-.5,cursorStyleHandler:c,actionHandler:o,getActionName:h}),m.tl=new w.Control({x:-.5,y:-.5,cursorStyleHandler:u,actionHandler:f}),m.tr=new w.Control({x:.5,y:-.5,cursorStyleHandler:u,actionHandler:f}),m.bl=new w.Control({x:-.5,y:.5,cursorStyleHandler:u,actionHandler:f}),m.br=new w.Control({x:.5,y:.5,cursorStyleHandler:u,actionHandler:f}),m.mtr=new w.Control({x:0,y:-.5,actionHandler:l.rotationWithSnapping,cursorStyleHandler:l.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),w.Textbox){var p=w.Textbox.prototype.controls={};p.mtr=m.mtr,p.tr=m.tr,p.br=m.br,p.tl=m.tl,p.bl=m.bl,p.mt=m.mt,p.mb=m.mb,p.mr=new w.Control({x:.5,y:0,actionHandler:l.changeWidth,cursorStyleHandler:c,actionName:"resizing"}),p.ml=new w.Control({x:-.5,y:0,actionHandler:l.changeWidth,cursorStyleHandler:c,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Wy={};function Tr(t){var e=Wy[t];if(e!==void 0)return e.exports;var n=Wy[t]={exports:{}};return tD[t](n,n.exports,Tr),n.exports}Tr.d=(t,e)=>{for(var n in e)Tr.o(e,n)&&!Tr.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},Tr.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var n_={};(()=>{let t;Tr.d(n_,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?Tr(653).fabric:{version:"5.2.1"}})();var Rt,tn,qi,$y,$e=n_.R;(function(t){t[t.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",t[t.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",t[t.DIMT_TEXT=4]="DIMT_TEXT",t[t.DIMT_ARC=8]="DIMT_ARC",t[t.DIMT_IMAGE=16]="DIMT_IMAGE",t[t.DIMT_POLYGON=32]="DIMT_POLYGON",t[t.DIMT_LINE=64]="DIMT_LINE",t[t.DIMT_GROUP=128]="DIMT_GROUP"})(Rt||(Rt={})),function(t){t[t.DIS_DEFAULT=1]="DIS_DEFAULT",t[t.DIS_SELECTED=2]="DIS_SELECTED"}(tn||(tn={})),function(t){t[t.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",t[t.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",t[t.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(qi||(qi={})),function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}($y||($y={}));var Oo=t=>typeof t=="number"&&!Number.isNaN(t),Kd=t=>typeof t=="string",Qc,Rs,yo,Qd,Xn,El,Gi,Wi,nD,iD,$i;(function(t){t[t.ARC=0]="ARC",t[t.IMAGE=1]="IMAGE",t[t.LINE=2]="LINE",t[t.POLYGON=3]="POLYGON",t[t.QUAD=4]="QUAD",t[t.RECT=5]="RECT",t[t.TEXT=6]="TEXT",t[t.GROUP=7]="GROUP"})(Xn||(Xn={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SELECTED=1]="SELECTED"}(El||(El={}));var Pt=class{get mediaType(){return new Map([["rect",Rt.DIMT_RECTANGLE],["quad",Rt.DIMT_QUADRILATERAL],["text",Rt.DIMT_TEXT],["arc",Rt.DIMT_ARC],["image",Rt.DIMT_IMAGE],["polygon",Rt.DIMT_POLYGON],["line",Rt.DIMT_LINE],["group",Rt.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(A(this,Rs,"f")){case tn.DIS_DEFAULT:return"default";case tn.DIS_SELECTED:return"selected"}}set drawingStyleId(e){this.styleId=e}get drawingStyleId(){return this.styleId}set coordinateBase(e){if(!["view","image"].includes(e))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&(A(this,yo,"f")==="image"&&e==="view"?this.updateCoordinateBaseFromImageToView():A(this,yo,"f")==="view"&&e==="image"&&this.updateCoordinateBaseFromViewToImage()),Se(this,yo,e,"f")}get coordinateBase(){return A(this,yo,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(e,n){if(Qc.add(this),Rs.set(this,void 0),yo.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,n!=null&&!Oo(n))throw new TypeError("Invalid 'drawingStyleId'.");e&&this._setFabricObject(e),this.setState(tn.DIS_DEFAULT),this.styleId=n}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.setState(tn.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(tn.DIS_SELECTED):this.setState(tn.DIS_DEFAULT),this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(e){Se(this,Rs,e,"f")}getState(){return A(this,Rs,"f")}_on(e,n){if(!n)return;let i=e.toLowerCase(),r=this.mapEvent_Callbacks.get(i);if(!r)throw new Error(`Event '${e}' does not exist.`);let a=r.get(n);a||(a=d=>{let v=d.e;if(!v)return void(n&&n.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));let y={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let C,b,T,M,O=v.target.getBoundingClientRect();C=O.left,b=O.top,T=C+window.scrollX,M=b+window.scrollY;let{width:L,height:P}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),Y=this._drawingLayer.width,H=this._drawingLayer.height,G=L/P,W=Y/H,oe=this._drawingLayer._getObjectFit(),te,ie,ae,w,re=1;if(oe==="contain")G<W?(re=L/Y,te=C+this.get("x")*re,ie=b+this.get("y")*re+(P-H*re)/2,ae=T+this.get("x")*re,w=M+this.get("y")*re+(P-H*re)/2):(re=P/H,te=C+this.get("x")*re+(L-Y*re)/2,ie=b+this.get("y")*re,ae=T+this.get("x")*re+(L-Y*re)/2,w=M+this.get("y")*re);else if(oe==="cover")if(G<W){re=P/H;let pe=this.get("x")*re-(Y*re-L)/2;pe=Math.max(pe,0),pe=Math.min(pe,L),te=C+pe,ie=b+this.get("y")*re,ae=T+pe,w=M+this.get("y")*re}else{re=L/Y;let pe=this.get("y")*re-(H*re-P)/2;pe=Math.max(pe,0),pe=Math.min(pe,P),te=C+this.get("x")*re,ie=b+pe,ae=T+this.get("x")*re,w=M+pe}y.itemClientX=Math.round(te),y.itemClientY=Math.round(ie),y.itemPageX=Math.round(ae),y.itemPageY=Math.round(w)}for(let C of Object.getOwnPropertyNames(y))Object.defineProperty(v,C,{value:y[C],writable:!0});n&&n.apply(this,[v])},r.set(n,a),this._fabricObject.on(i==="dblclick"?"mousedblclick":i,a))}on(e,n){this._on(e,n)}_off(e,n){let i=e.toLowerCase(),r=this.mapEvent_Callbacks.get(i);if(!r)throw new Error(`Event '${e}' does not exist.`);let a=r.get(n);a&&(r.delete(n),this._fabricObject.off(i==="dblclick"?"mousedblclick":i,a))}off(e,n){this._off(e,n)}_setEditable(e){let n=this._fabricObject;e?(n.selectable=!0,n.hasControls=!0,n.hoverCursor=null):(n.selectable=!1,n.hasControls=!1,n.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,n){if(this.hasNote(e.name)&&!n)throw new Error("A note with the same name already exists, please use a different name.");let i=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[i])}getNote(e){let n=this.mapNoteName_Content.get(e);return n?n.length===1?{name:e,content:n[0]?JSON.parse(JSON.stringify(n[0])):n[0]}:{name:e,content:JSON.parse(JSON.stringify(n))}:null}getNotes(){let e=[];for(let n of this.mapNoteName_Content){let i=n[1].length===1?n[1][0]:n[1];i=i&&JSON.parse(JSON.stringify(i)),e.push({name:n[0],content:i})}return e}updateNote(e,n,i){let r=this.mapNoteName_Content.get(e);if(!r)throw new Error("The note name does not exist.");i||(r.length=0),n=n&&JSON.parse(JSON.stringify(n)),r.push(n)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}set(e,n){if(!this.extendSet(e,n))if(e==="x"){let i=this._fabricObject.group;i?(this._fabricObject.set("left",n-i.left-i.width/2),i.addWithUpdate()):this._fabricObject.set("left",n)}else if(e==="y"){let i=this._fabricObject.group;i?(this._fabricObject.set("top",n-i.top-i.height/2),i.addWithUpdate()):this._fabricObject.set("top",n)}else e==="styleId"?this.styleId=n:this._fabricObject.set(e,n);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let n=this.extendGet(e);if(n===void 0)if(e==="x"){let i=this._fabricObject.group;n=i?this._fabricObject.get("left")+i.left+i.width/2:this._fabricObject.get("left")}else if(e==="y"){let i=this._fabricObject.group;n=i?this._fabricObject.get("top")+i.top+i.height/2:this._fabricObject.get("top")}else n=e==="scaledWidth"?this._fabricObject.getScaledWidth():e==="scaledHeight"?this._fabricObject.getScaledHeight():["type","mediaType"].includes(e)?this.mediaType:e==="state"?this.getState():e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return n}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e*A(this,Qc,"m",Qd).call(this)}convertPropFromViewToImage(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e/A(this,Qc,"m",Qd).call(this)}_setLineWidth(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("strokeWidth",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",e)}}_getLineWidth(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("strokeWidth"));if(this.coordinateBase==="image")return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("fontSize",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",e)}}_getFontSize(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("fontSize"));if(this.coordinateBase==="image")return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}};Rs=new WeakMap,yo=new WeakMap,Qc=new WeakSet,Qd=function(){let t=this._drawingLayer;if(!t)return 1;let e=t.width,n=t.height,{width:i,height:r}=t.fabricCanvas.wrapperEl.getBoundingClientRect();if(i<=0||r<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");let a=i/e,d=r/n,v=t._getObjectFit(),y=1;return v==="contain"?a<d?y=i/e:y=r/n:v==="cover"&&(a<d?y=r/n:y=i/e),y},Pt.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],Pt.mapItemType=new Map([[Xn.ARC,"arc"],[Xn.IMAGE,"image"],[Xn.LINE,"line"],[Xn.POLYGON,"polygon"],[Xn.QUAD,"quad"],[Xn.RECT,"rect"],[Xn.TEXT,"text"],[Xn.GROUP,"group"]]),Pt.arrStyleSelectors=["default","selected"],Pt.mapItemState=new Map([[El.DEFAULT,"default"],[El.SELECTED,"selected"]]);var Zi=class extends Pt{constructor(e,n){if(super(null,n),Gi.set(this,void 0),!Bi(e))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new $e.Rect({left:e.x,top:e.y,width:e.width,height:e.height})),Se(this,Gi,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="rect"}extendSet(e,n){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(e){this.setRect(e)}getPosition(){return this.getRect()}updatePosition(){A(this,Gi,"f")&&this.setRect(A(this,Gi,"f"))}setRect(e){if(!Bi(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width)),this.set("height",this.convertPropFromViewToImage(e.height));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width),this.set("height",e.height)}this._drawingLayer.renderAll()}else Se(this,Gi,JSON.parse(JSON.stringify(e)),"f")}getRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return A(this,Gi,"f")?JSON.parse(JSON.stringify(A(this,Gi,"f"))):null}};function zy(t,e,n){let i=n.points[this.pointIndex].x-n.pathOffset.x,r=n.points[this.pointIndex].y-n.pathOffset.y;return $e.util.transformPoint({x:i,y:r},n.calcTransformMatrix())}function i_(t){let e=new $e.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new $e.Point(t.width+e.x,t.height+e.y)}function Yy(t,e,n,i){let r=e.target,a=r.controls[r.__corner],d=r.toLocalPoint(new $e.Point(n,i),"center","center"),v=i_(r),y=r._getTransformedDimensions(0,0),C={x:d.x*v.x/y.x+r.pathOffset.x,y:d.y*v.y/y.y+r.pathOffset.y};return r.points[a.pointIndex]=C,$e.controlsUtils.fireEvent("scaling",{e:t,transform:e,pointer:{x:n,y:i}}),!0}function Xy(t,e){return function(n,i,r,a){let d=i.target,v=$e.util.transformPoint({x:d.points[t].x-d.pathOffset.x,y:d.points[t].y-d.pathOffset.y},d.calcTransformMatrix()),y=e(n,i,r,a);d._setPositionDimensions({});let C=i_(d),b=(d.points[t].x-d.pathOffset.x)/C.x,T=(d.points[t].y-d.pathOffset.y)/C.y;return d.setPositionByOrigin(v,b+.5,T+.5),y}}Gi=new WeakMap;var Qs=class extends Pt{constructor(e,n){if(super(null,n),Wi.set(this,void 0),!xd(e))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new $e.Polygon(e.points,{objectCaching:!1}));let i=this._fabricObject,r=i.points.length-1;i.controls=i.points.reduce(function(a,d,v){return a["p"+v]=new $e.Control({positionHandler:zy,actionHandler:Xy(v>0?v-1:r,Yy),actionName:"modifyPolygon",pointIndex:v}),a},{}),Se(this,Wi,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="polygon"}extendSet(e,n){if(e==="vertices"){let i=this._fabricObject;if(i.group){let a=i.group;i.points=n.map(d=>({x:d.x-a.left-a.width/2,y:d.y-a.top-a.height/2})),a.addWithUpdate()}else i.points=n;let r=i.points.length-1;return i.controls=i.points.reduce(function(a,d,v){return a["p"+v]=new $e.Control({positionHandler:zy,actionHandler:Xy(v>0?v-1:r,Yy),actionName:"modifyPolygon",pointIndex:v}),a},{}),i._setPositionDimensions({}),!0}}extendGet(e){if(e==="vertices"){let n=[],i=this._fabricObject;if(i.selectable&&!i.group)for(let r in i.oCoords)n.push({x:i.oCoords[r].x,y:i.oCoords[r].y});else for(let r of i.points){let a=r.x-i.pathOffset.x,d=r.y-i.pathOffset.y,v=$e.util.transformPoint({x:a,y:d},i.calcTransformMatrix());n.push({x:v.x,y:v.y})}return n}}updateCoordinateBaseFromImageToView(){let e=this.get("vertices").map(n=>({x:this.convertPropFromViewToImage(n.x),y:this.convertPropFromViewToImage(n.y)}));this.set("vertices",e)}updateCoordinateBaseFromViewToImage(){let e=this.get("vertices").map(n=>({x:this.convertPropFromImageToView(n.x),y:this.convertPropFromImageToView(n.y)}));this.set("vertices",e)}setPosition(e){this.setPolygon(e)}getPosition(){return this.getPolygon()}updatePosition(){A(this,Wi,"f")&&this.setPolygon(A(this,Wi,"f"))}setPolygon(e){if(!xd(e))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if(this.coordinateBase==="view"){let n=e.points.map(i=>({x:this.convertPropFromViewToImage(i.x),y:this.convertPropFromViewToImage(i.y)}));this.set("vertices",n)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Se(this,Wi,JSON.parse(JSON.stringify(e)),"f")}getPolygon(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return A(this,Wi,"f")?JSON.parse(JSON.stringify(A(this,Wi,"f"))):null}};Wi=new WeakMap;nD=new WeakMap,iD=new WeakMap;var qy=t=>{let e=(n=>n.split(`
`).map(i=>i.split("	")))(t);return(n=>{for(let i=0;;i++){let r=-1;for(let a=0;a<n.length;a++){let d=n[a][i];d!==void 0&&d.length>r&&(r=d.length)}if(r===-1)break;for(let a=0;a<n.length;a++){if(i>=n[a].length-1)continue;let d=" ".repeat(r+2-n[a][i].length);n[a][i]=n[a][i].concat(d)}}})(e),(n=>{let i="";for(let r=0;r<n.length;r++)i=i.concat(...n[r],r===n.length-1?"":`
`);return i})(e)},Jd=class extends Pt{constructor(e,n,i){if(super(null,i),$i.set(this,void 0),!Kd(e))throw new TypeError("Invalid 'text'.");if(!Bi(n))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new $e.Textbox(qy(e),{left:n.x,top:n.y,width:n.width})),this._text=e,Se(this,$i,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="text"}extendSet(e,n){if(e==="text")return this._text=n,this._fabricObject.set("text",qy(n)),!0}extendGet(e){if(e==="text")return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(e){this.setTextRect(e)}getPosition(){return this.getTextRect()}updatePosition(){A(this,$i,"f")&&this.setTextRect(A(this,$i,"f"))}setText(e){if(!Kd(e))throw new TypeError("Invalid 'text'.");this.set("text",e)}getText(){return this.get("text")}setTextRect(e){if(!Bi(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width)}this._drawingLayer.renderAll()}else Se(this,$i,JSON.parse(JSON.stringify(e)),"f")}getTextRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return A(this,$i,"f")?JSON.parse(JSON.stringify(A(this,$i,"f"))):null}},rD,zi;$i=new WeakMap;rD=new WeakMap;var ef=class extends Qs{constructor(e,n){if(super({points:e?.points},n),zi.set(this,void 0),!Ad(e))throw new TypeError("Invalid 'quad'.");Se(this,zi,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="quad"}setPosition(e){this.setQuad(e)}getPosition(){return this.getQuad()}updatePosition(){A(this,zi,"f")&&this.setQuad(A(this,zi,"f"))}setPolygon(){}getPolygon(){return null}setQuad(e){if(!Ad(e))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if(this.coordinateBase==="view"){let n=e.points.map(i=>({x:this.convertPropFromViewToImage(i.x),y:this.convertPropFromViewToImage(i.y)}));this.set("vertices",n)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Se(this,zi,JSON.parse(JSON.stringify(e)),"f")}getQuad(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return A(this,zi,"f")?JSON.parse(JSON.stringify(A(this,zi,"f"))):null}};zi=new WeakMap;var tf=class extends Pt{constructor(e){super(new $e.Group(e.map(n=>n._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(tn.DIS_SELECTED);let n=this._fabricObject._objects;for(let i of n)setTimeout(()=>{i&&i.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(tn.DIS_DEFAULT);let n=this._fabricObject._objects;for(let i of n)setTimeout(()=>{i&&i.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(e,n){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(e=>e.getDrawingItem())}setChildDrawingItems(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"add"):this._fabricObject.addWithUpdate(e._getFabricObject())}removeChildItem(e){e&&e.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"remove"):this._fabricObject.removeWithUpdate(e._getFabricObject()))}},r_=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),Gd=t=>!!Kd(t)&&t!=="",Zy=t=>!!r_(t)&&!("id"in t&&!Oo(t.id))&&!("lineWidth"in t&&!Oo(t.lineWidth))&&!("fillStyle"in t&&!Gd(t.fillStyle))&&!("strokeStyle"in t&&!Gd(t.strokeStyle))&&!("paintMode"in t&&!["fill","stroke","strokeAndFill"].includes(t.paintMode))&&!("fontFamily"in t&&!Gd(t.fontFamily))&&!("fontSize"in t&&!Oo(t.fontSize)),Ro=class{static convert(e,n,i){let r={x:0,y:0,width:n,height:i};if(!e)return r;if(Bi(e))e.isMeasuredInPercentage?(r.x=e.x/100*n,r.y=e.y/100*i,r.width=e.width/100*n,r.height=e.height/100*i):(r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height);else{if(!Hc(e))throw TypeError("Invalid region.");e.isMeasuredInPercentage?(r.x=e.left/100*n,r.y=e.top/100*i,r.width=(e.right-e.left)/100*n,r.height=(e.bottom-e.top)/100*i):(r.x=e.left,r.y=e.top,r.width=e.right-e.left,r.height=e.bottom-e.top)}return r.x=Math.round(r.x),r.y=Math.round(r.y),r.width=Math.round(r.width),r.height=Math.round(r.height),r}},Ir,Jc,Il=class{constructor(){Ir.set(this,new Map),Jc.set(this,!1)}get disposed(){return A(this,Jc,"f")}on(e,n){e=e.toLowerCase();let i=A(this,Ir,"f").get(e);if(i){if(i.includes(n))return;i.push(n)}else A(this,Ir,"f").set(e,[n])}off(e,n){e=e.toLowerCase();let i=A(this,Ir,"f").get(e);if(!i)return;let r=i.indexOf(n);r!==-1&&i.splice(r,1)}offAll(e){e=e.toLowerCase();let n=A(this,Ir,"f").get(e);n&&(n.length=0)}fire(e,n=[],i={async:!1,copy:!0}){n||(n=[]),e=e.toLowerCase();let r=A(this,Ir,"f").get(e);if(r&&r.length){i=Object.assign({async:!1,copy:!0},i);for(let a of r){if(!a)continue;let d=[];if(i.copy)for(let y of n){try{y=JSON.parse(JSON.stringify(y))}catch{}d.push(y)}else d=n;let v=!1;if(i.async)setTimeout(()=>{this.disposed||r.includes(a)&&a.apply(i.target,d)},0);else try{v=a.apply(i.target,d)}catch{}if(v===!0)break}}}dispose(){Se(this,Jc,!0,"f")}};function oD(t,e,n){return(n.x-t.x)*(e.y-t.y)==(e.x-t.x)*(n.y-t.y)&&Math.min(t.x,e.x)<=n.x&&n.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=n.y&&n.y<=Math.max(t.y,e.y)}function Wd(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Zc(t,e,n,i){let r=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]),a=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]);return!((r^a)>=0&&r!==0&&a!==0)&&(r=n[0]*(t[1]-i[1])+i[0]*(n[1]-t[1])+t[0]*(i[1]-n[1]),a=n[0]*(e[1]-i[1])+i[0]*(n[1]-e[1])+e[0]*(i[1]-n[1]),!((r^a)>=0&&r!==0&&a!==0))}Ir=new WeakMap,Jc=new WeakMap;var sD=t=>$(void 0,null,function*(){if(typeof t!="string")throw new TypeError("Invalid url.");let e=yield fetch(t);if(!e.ok)throw Error("Network Error: "+e.statusText);let n=yield e.text();if(!n.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");let i=document.createElement("div");if(i.insertAdjacentHTML("beforeend",n),i.childElementCount===1&&i.firstChild instanceof HTMLTemplateElement)return i.firstChild.content;let r=new DocumentFragment;for(let a of i.children)r.append(a);return r}),Yi,_o,nf,wo,Ls,Co,Kt,Ns,Ps,Fs,o_,s_,a_,c_,el,rt,ks,Bs,js,It,tl,nl,il,Xi,Vs,Us,rl,Xt,ol,l_,rf,of,Hs,sl,me=class t{static createDrawingStyle(e){if(!Zy(e))throw new Error("Invalid style definition.");let n,i=t.USER_START_STYLE_ID;for(;A(t,Yi,"f",_o).has(i);)i++;n=i;let r=JSON.parse(JSON.stringify(e));r.id=n;for(let a in A(t,Yi,"f",nf))r.hasOwnProperty(a)||(r[a]=A(t,Yi,"f",nf)[a]);return A(t,Yi,"f",_o).set(n,r),r.id}static _getDrawingStyle(e,n){if(typeof e!="number")throw new Error("Invalid style id.");let i=A(t,Yi,"f",_o).get(e);return i?n?JSON.parse(JSON.stringify(i)):i:null}static getDrawingStyle(e){return this._getDrawingStyle(e,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(A(t,Yi,"f",_o).values())))}static _updateDrawingStyle(e,n){if(!Zy(n))throw new Error("Invalid style definition.");let i=A(t,Yi,"f",_o).get(e);if(i)for(let r in n)i.hasOwnProperty(r)&&(i[r]=n[r])}static updateDrawingStyle(e,n){this._updateDrawingStyle(e,n)}};Yi=me,me.STYLE_BLUE_STROKE=1,me.STYLE_GREEN_STROKE=2,me.STYLE_ORANGE_STROKE=3,me.STYLE_YELLOW_STROKE=4,me.STYLE_BLUE_STROKE_FILL=5,me.STYLE_GREEN_STROKE_FILL=6,me.STYLE_ORANGE_STROKE_FILL=7,me.STYLE_YELLOW_STROKE_FILL=8,me.STYLE_BLUE_STROKE_TRANSPARENT=9,me.STYLE_GREEN_STROKE_TRANSPARENT=10,me.STYLE_ORANGE_STROKE_TRANSPARENT=11,me.USER_START_STYLE_ID=1024,_o={value:new Map([[me.STYLE_BLUE_STROKE,{id:me.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[me.STYLE_GREEN_STROKE,{id:me.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[me.STYLE_ORANGE_STROKE,{id:me.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[me.STYLE_YELLOW_STROKE,{id:me.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[me.STYLE_BLUE_STROKE_FILL,{id:me.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[me.STYLE_GREEN_STROKE_FILL,{id:me.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[me.STYLE_ORANGE_STROKE_FILL,{id:me.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[me.STYLE_YELLOW_STROKE_FILL,{id:me.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[me.STYLE_BLUE_STROKE_TRANSPARENT,{id:me.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[me.STYLE_GREEN_STROKE_TRANSPARENT,{id:me.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[me.STYLE_ORANGE_STROKE_TRANSPARENT,{id:me.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},nf={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},typeof document<"u"&&typeof window<"u"&&($e.StaticCanvas.prototype.dispose=function(){return this.isRendering&&($e.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),$e.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},$e.Object.prototype.transparentCorners=!1,$e.Object.prototype.cornerSize=20,$e.Object.prototype.touchCornerSize=100,$e.Object.prototype.cornerColor="rgb(254,142,20)",$e.Object.prototype.cornerStyle="circle",$e.Object.prototype.strokeUniform=!0,$e.Object.prototype.hasBorders=!1,$e.Canvas.prototype.containerClass="",$e.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var n,i=this.upperCanvasEl,r=$e.util.getPointer(t,i),a=i.getBoundingClientRect(),d=a.width||0,v=a.height||0;d&&v||("top"in a&&"bottom"in a&&(v=Math.abs(a.top-a.bottom)),"right"in a&&"left"in a&&(d=Math.abs(a.right-a.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,e||(r=this.restorePointerVpt(r));var y=this.getRetinaScaling();if(y!==1&&(r.x/=y,r.y/=y),d!==0&&v!==0){var C=window.getComputedStyle(i).objectFit,b=i.width,T=i.height,M=d,O=v;n={width:b/M,height:T/O};var L,P,Y=b/T,H=M/O;return C==="contain"?Y>H?(L=M,P=M/Y,{x:r.x*n.width,y:(r.y-(O-P)/2)*n.width}):(L=O*Y,P=O,{x:(r.x-(M-L)/2)*n.height,y:r.y*n.height}):C==="cover"?Y>H?{x:(b-n.height*M)/2+r.x*n.height,y:r.y*n.height}:{x:r.x*n.width,y:(T-n.width*O)/2+r.y*n.width}:{x:r.x*n.width,y:r.y*n.height}}return n={width:1,height:1},{x:r.x*n.width,y:r.y*n.height}},$e.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var n=this.upperCanvasEl,i=this._getEventPrefix();$e.util.addListener($e.document,"touchend",this._onTouchEnd,{passive:!1}),$e.util.addListener($e.document,"touchmove",this._onMouseMove,{passive:!1}),$e.util.removeListener(n,i+"down",this._onMouseDown)},$e.Textbox.prototype._wrapLine=function(t,e,n,i){let r=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),a=!(!r||!r.length);var d=0,v=this.splitByGrapheme||a,y=[],C=[],b=v?$e.util.string.graphemeSplit(t):t.split(this._wordJoiners),T="",M=0,O=v?"":" ",L=0,P=0,Y=0,H=!0,G=this._getWidthOfCharSpacing();i=i||0,b.length===0&&b.push([]),n-=i;for(var W=0;W<b.length;W++)T=v?b[W]:$e.util.string.graphemeSplit(b[W]),L=this._measureWord(T,e,M),M+=T.length,(d+=P+L-G)>n&&!H?(y.push(C),C=[],d=L,H=!0):d+=G,H||v||C.push(O),C=C.concat(T),P=v?0:this._measureWord([O],e,M),M++,H=!1,L>Y&&(Y=L);return W&&y.push(C),Y+i>this.dynamicMinWidth&&(this.dynamicMinWidth=Y-G+i),y});var ft=class t{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(e){this.fabricCanvas.selection=e,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(e,n,i){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=e.getFabricCanvas();else{let d=this.fabricCanvas=new $e.Canvas(e,Object.assign(i,{allowTouchScrolling:!0,selection:!1}));d.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),d.lowerCanvasEl.className="",d.upperCanvasEl.className="",d.on("selection:created",function(v){let y=v.selected,C=[];for(let b of y){let T=b.getDrawingItem()._drawingLayer;T&&!C.includes(T)&&C.push(T)}for(let b of C){let T=[];for(let M of y){let O=M.getDrawingItem();O._drawingLayer===b&&T.push(O)}setTimeout(()=>{b.onSelectionChanged&&b.onSelectionChanged(T,[])},0)}}),d.on("before:selection:cleared",function(v){let y=this.getActiveObjects(),C=[];for(let b of y){let T=b.getDrawingItem()._drawingLayer;T&&!C.includes(T)&&C.push(T)}for(let b of C){let T=[];for(let M of y){let O=M.getDrawingItem();O._drawingLayer===b&&T.push(O)}setTimeout(()=>{let M=[];for(let O of T)b.hasDrawingItem(O)&&M.push(O);M.length>0&&b.onSelectionChanged&&b.onSelectionChanged([],M)},0)}}),d.on("selection:updated",function(v){let y=v.selected,C=v.deselected,b=[];for(let T of y){let M=T.getDrawingItem()._drawingLayer;M&&!b.includes(M)&&b.push(M)}for(let T of C){let M=T.getDrawingItem()._drawingLayer;M&&!b.includes(M)&&b.push(M)}for(let T of b){let M=[],O=[];for(let L of y){let P=L.getDrawingItem();P._drawingLayer===T&&M.push(P)}for(let L of C){let P=L.getDrawingItem();P._drawingLayer===T&&O.push(P)}setTimeout(()=>{T.onSelectionChanged&&T.onSelectionChanged(M,O)},0)}}),d.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas}let r,a;switch(this.id=n,n){case t.DDN_LAYER_ID:r=me.getDrawingStyle(me.STYLE_BLUE_STROKE),a=me.getDrawingStyle(me.STYLE_BLUE_STROKE_FILL);break;case t.DBR_LAYER_ID:r=me.getDrawingStyle(me.STYLE_ORANGE_STROKE),a=me.getDrawingStyle(me.STYLE_ORANGE_STROKE_FILL);break;case t.DLR_LAYER_ID:r=me.getDrawingStyle(me.STYLE_GREEN_STROKE),a=me.getDrawingStyle(me.STYLE_GREEN_STROKE_FILL);break;default:r=me.getDrawingStyle(me.STYLE_YELLOW_STROKE),a=me.getDrawingStyle(me.STYLE_YELLOW_STROKE_FILL)}for(let d of Pt.arrMediaTypes)this.mapType_StateAndStyleId.set(d,{default:r.id,selected:a.id})}getId(){return this.id}setVisible(e){if(e){for(let n of this._arrFabricObject)n.visible=!0,n.hasControls=!0;this._visible=!0}else{for(let n of this._arrFabricObject)n.visible=!1,n.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(e){return e.styleId?me.getDrawingStyle(e.styleId):me.getDrawingStyle(e._mapState_StyleId.get(e.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(e,n,i,r){let a=this.getDrawingItems(d=>d._mediaType===e);for(let d of a)d.styleSelector===n&&this._changeItemStyle(d,i,!0);r||this.fabricCanvas.renderAll()}_changeItemStyle(e,n,i){if(!e||!n)return;let r=e._getFabricObject();typeof e.styleId=="number"&&(n=me.getDrawingStyle(e.styleId)),r.strokeWidth=n.lineWidth,n.paintMode==="fill"?(r.fill=n.fillStyle,r.stroke=n.fillStyle):n.paintMode==="stroke"?(r.fill="transparent",r.stroke=n.strokeStyle):n.paintMode==="strokeAndFill"&&(r.fill=n.fillStyle,r.stroke=n.strokeStyle),r.fontFamily&&(r.fontFamily=n.fontFamily),r.fontSize&&(r.fontSize=n.fontSize),r.group||(r.dirty=!0),i||this.fabricCanvas.renderAll()}_updateGroupItem(e,n,i){if(!e||!n)return;let r=e.getChildDrawingItems();if(i==="add"){if(r.includes(n))return;let a=n._getFabricObject();if(this.fabricCanvas.getObjects().includes(a)){if(!this._arrFabricObject.includes(a))throw new Error("Existed in other drawing layers.");n._zIndex=null}else{let d;if(n.styleId)d=me.getDrawingStyle(n.styleId);else{let v=this.mapType_StateAndStyleId.get(n._mediaType);d=me.getDrawingStyle(v[e.styleSelector]);let y=()=>{this._changeItemStyle(n,me.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).selected),!0)},C=()=>{this._changeItemStyle(n,me.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).default),!0)};n._on("selected",y),n._on("deselected",C),n._funcChangeStyleToSelected=y,n._funcChangeStyleToDefault=C}n._drawingLayer=this,n._drawingLayerId=this.id,this._changeItemStyle(n,d,!0)}e._fabricObject.addWithUpdate(n._getFabricObject())}else{if(i!=="remove"||!r.includes(n))return;n._zIndex=null,n._drawingLayer=null,n._drawingLayerId=null,n._off("selected",n._funcChangeStyleToSelected),n._off("deselected",n._funcChangeStyleToDefault),n._funcChangeStyleToSelected=null,n._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(n._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,n){if(!(e instanceof Pt))throw new TypeError("Invalid 'drawingItem'.");if(e._drawingLayer){if(e._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let i=e._getFabricObject(),r=this.fabricCanvas.getObjects(),a,d;if(r.includes(i)){if(this._arrFabricObject.includes(i))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){a=e.getChildDrawingItems();for(let C of a)if(C._drawingLayer&&C._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(n&&typeof n=="object"&&!Array.isArray(n))for(let C in n)i.set(C,n[C]);if(a){for(let C of a){let b=this.mapType_StateAndStyleId.get(C._mediaType);for(let T of Pt.arrStyleSelectors)C._mapState_StyleId.set(T,b[T]);if(C.styleId)d=me.getDrawingStyle(C.styleId);else{d=me.getDrawingStyle(b.default);let T=()=>{this._changeItemStyle(C,me.getDrawingStyle(this.mapType_StateAndStyleId.get(C._mediaType).selected),!0)},M=()=>{this._changeItemStyle(C,me.getDrawingStyle(this.mapType_StateAndStyleId.get(C._mediaType).default),!0)};C._on("selected",T),C._on("deselected",M),C._funcChangeStyleToSelected=T,C._funcChangeStyleToDefault=M}C._drawingLayer=this,C._drawingLayerId=this.id,this._changeItemStyle(C,d,!0)}i.dirty=!0,this.fabricCanvas.renderAll()}else{let C=this.mapType_StateAndStyleId.get(e._mediaType);for(let b of Pt.arrStyleSelectors)e._mapState_StyleId.set(b,C[b]);if(e.styleId)d=me.getDrawingStyle(e.styleId);else{d=me.getDrawingStyle(C.default);let b=()=>{this._changeItemStyle(e,me.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected))},T=()=>{this._changeItemStyle(e,me.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default))};e._on("selected",b),e._on("deselected",T),e._funcChangeStyleToSelected=b,e._funcChangeStyleToDefault=T}this._changeItemStyle(e,d)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;let v=this._arrFabricObject.length,y=r.length;if(v)y=r.indexOf(this._arrFabricObject[v-1])+1;else for(let C=0;C<r.length;C++)if(e._zIndex<r[C].getDrawingItem()._zIndex){y=C;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(i),this._visible?i.visible=!0:i.visible=!1,this.fabricCanvas.insertAt(i,y,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e),e.updatePosition()}addDrawingItems(e){for(let n of e)this.addDrawingItem(n)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){let i=e.getChildDrawingItems();for(let r of i)r._zIndex=null,r._drawingLayer=null,r._drawingLayerId=null,r._off("selected",r._funcChangeStyleToSelected),r._off("deselected",r._funcChangeStyleToDefault),r._funcChangeStyleToSelected=null,r._funcChangeStyleToDefault=null,r._mapState_StyleId.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear();let n=e._getFabricObject();e.styleSelector==="selected"&&(n.group?n.group.removeWithUpdate(n):this.fabricCanvas._activeObject=null,e.setState(tn.DIS_DEFAULT)),this.fabricCanvas.remove(n),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(n),1)}removeDrawingItems(e){for(let n of e)this.removeDrawingItem(n)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){let e=this.fabricCanvas.getActiveObjects(),n=[];for(let i of e)this._arrFabricObject.includes(i)&&n.push(i.getDrawingItem());return n}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(e,n,i){n?n.forEach(d=>d.toLowerCase()):n=Pt.arrMediaTypes,i?i.forEach(d=>d.toLowerCase()):i=Pt.arrStyleSelectors;let r=me.getDrawingStyle(e);if(!r)throw new Error(`The 'drawingStyle' with id '${e}' doesn't exist.`);let a;for(let d of n)if(a=this.mapType_StateAndStyleId.get(d),a)for(let v of i){this._changeMediaTypeCurStyleInStyleSelector(d,v,r,!0),a[v]=e;for(let y of this._arrDrwaingItem)y._mediaType===d&&y._mapState_StyleId.set(v,e)}this.fabricCanvas.renderAll()}setDefaultStyle(e,n,i){let r=[];i&Rt.DIMT_RECTANGLE&&r.push("rect"),i&Rt.DIMT_QUADRILATERAL&&r.push("quad"),i&Rt.DIMT_TEXT&&r.push("text"),i&Rt.DIMT_ARC&&r.push("arc"),i&Rt.DIMT_IMAGE&&r.push("image"),i&Rt.DIMT_POLYGON&&r.push("polygon"),i&Rt.DIMT_LINE&&r.push("line");let a=[];n&tn.DIS_DEFAULT&&a.push("default"),n&tn.DIS_SELECTED&&a.push("selected"),this._setDefaultStyle(e,r.length?r:null,a.length?a:null)}setMode(e){if((e=e.toLowerCase())==="viewer"){for(let n of this._arrDrwaingItem)n._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let n of this._arrDrwaingItem)n._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,n){this.fabricCanvas.setDimensions(e,n)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){let n=this._getItemCurrentStyle(e);this._changeItemStyle(e,n,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}};ft.DDN_LAYER_ID=1,ft.DBR_LAYER_ID=2,ft.DLR_LAYER_ID=3,ft.USER_DEFINED_LAYER_BASE_ID=100,ft.TIP_LAYER_ID=999;var sf=class{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(e,n){if(this.getDrawingLayer(n))throw new Error("Existed drawing layer id.");let i=new ft(e,n,{enableRetinaScaling:!1});return i._manager=this,this._arrDrawingLayer.push(i),this._switchPointerEvent(),i}deleteDrawingLayer(e){let n=this.getDrawingLayer(e);if(!n)return;let i=this._arrDrawingLayer;n.dispose(),i.splice(i.indexOf(n),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let n of this._arrDrawingLayer)if(n.getId()===e)return n;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;let e=this._getFabricCanvas().getActiveObjects(),n=[];for(let i of e)n.push(i.getDrawingItem());return n}setDimensions(e,n){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,n)}setObjectFit(e){for(let n of this._arrDrawingLayer)n&&n._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){if(!this._arrDrawingLayer.length)return;let n=this._getFabricCanvas();n.wrapperEl.style.display=e?"block":"none"}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}},af=class extends Jd{constructor(e,n,i,r,a){super(e,{x:n,y:i,width:r,height:0},a),wo.set(this,void 0),Ls.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var d=0,v=0,y=this._textLines.length;v<y;v++)d+=this.getHeightOfLine(v);return d+=2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(e){Se(this,wo,e,"f"),A(this,Ls,"f")&&clearTimeout(A(this,Ls,"f")),A(this,wo,"f")>=0&&Se(this,Ls,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},A(this,wo,"f")),"f")}getDuration(){return A(this,wo,"f")}};wo=new WeakMap,Ls=new WeakMap;var cf=class{constructor(){Co.add(this),Kt.set(this,void 0),Ns.set(this,void 0),Ps.set(this,void 0),Fs.set(this,!0),this._drawingLayerManager=new sf}createDrawingLayerBaseCvs(e,n,i="contain"){if(typeof e!="number"||e<=1)throw new Error("Invalid 'width'.");if(typeof n!="number"||n<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(i))throw new Error("Unsupported 'objectFit'.");let r=document.createElement("canvas");return r.width==e&&r.height==n||(r.width=e,r.height=n),r.style.objectFit=i,r}_createDrawingLayer(e,n,i,r){if(!this._layerBaseCvs){let v;try{v=this.getContentDimensions()}catch(y){if((y.message||y)!=="Invalid content dimensions.")throw y}n||(n=v?.width||1280),i||(i=v?.height||720),r||(r=v?.objectFit||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(n,i,r)}let a=this._layerBaseCvs,d=this._drawingLayerManager.createDrawingLayer(a,e);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",a.parentElement),d}createDrawingLayer(){let e;for(let n=ft.USER_DEFINED_LAYER_BASE_ID;;n++)if(!this._drawingLayerManager.getDrawingLayer(n)&&n!==ft.TIP_LAYER_ID){e=n;break}return this._createDrawingLayer(e)}deleteDrawingLayer(e){var n;this._drawingLayerManager.deleteDrawingLayer(e),this._drawingLayerManager.getAllDrawingLayers().length||((n=this._innerComponent)===null||n===void 0||n.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(e){if(typeof e!="number")throw new TypeError("Invalid id.");if(e<ft.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${e} is not defined by users.`);this.deleteDrawingLayer(e)}_clearDrawingLayers(){let e=this.getAllDrawingLayers();for(let n of e)this.deleteDrawingLayer(n.getId())}clearUserDefinedDrawingLayers(){let e=this.getAllDrawingLayers();for(let n of e){let i=n.getId();i<ft.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(i)}}getDrawingLayer(e){return e==ft.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(e)||([ft.DDN_LAYER_ID,ft.DBR_LAYER_ID,ft.DLR_LAYER_ID].includes(e)?this._createDrawingLayer(e):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(e=>e.getId()>=0&&e.getId()!==ft.TIP_LAYER_ID)}updateDrawingLayers(e){((n,i,r)=>{if(!(n<=1||i<=1)){if(!["contain","cover"].includes(r))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:n,height:i},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(r)}})(e.width,e.height,e.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(e){if(!(r_(n=e)&&Gc(n.topLeftPoint)&&Oo(n.width))||n.width<=0||!Oo(n.duration)||"coordinateBase"in n&&!["view","image"].includes(n.coordinateBase))throw new Error("Invalid tip config.");var n;Se(this,Kt,JSON.parse(JSON.stringify(e)),"f"),A(this,Kt,"f").coordinateBase||(A(this,Kt,"f").coordinateBase="view"),Se(this,Ps,e.duration,"f"),A(this,Co,"m",c_).call(this)}getTipConfig(){return A(this,Kt,"f")?A(this,Kt,"f"):null}setTipVisible(e){if(typeof e!="boolean")throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",e),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Se(this,Fs,e,"f")}isTipVisible(){return A(this,Fs,"f")}updateTipMessage(e){if(!A(this,Kt,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=me.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(ft.TIP_LAYER_ID)||this._createDrawingLayer(ft.TIP_LAYER_ID)),this._tip?this._tip.set("text",e):this._tip=A(this,Co,"m",o_).call(this,e,A(this,Kt,"f").topLeftPoint.x,A(this,Kt,"f").topLeftPoint.y,A(this,Kt,"f").width,A(this,Kt,"f").coordinateBase,this._tipStyleId),A(this,Co,"m",s_).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",A(this,Fs,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),A(this,Ns,"f")&&clearTimeout(A(this,Ns,"f")),A(this,Ps,"f")>=0&&Se(this,Ns,setTimeout(()=>{A(this,Co,"m",a_).call(this)},A(this,Ps,"f")),"f")}};Kt=new WeakMap,Ns=new WeakMap,Ps=new WeakMap,Fs=new WeakMap,Co=new WeakSet,o_=function(t,e,n,i,r,a){let d=new af(t,e,n,i,a);return d.coordinateBase=r,d},s_=function(t,e){e.hasDrawingItem(t)||e.addDrawingItems([t])},a_=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},c_=function(){if(!this._tip)return;let t=A(this,Kt,"f");this._tip.coordinateBase=t.coordinateBase,this._tip.setTextRect({x:t.topLeftPoint.x,y:t.topLeftPoint.y,width:t.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};var lf=class extends HTMLElement{constructor(){super(),el.set(this,void 0);let e=new DocumentFragment,n=document.createElement("div");n.setAttribute("class","wrapper"),e.appendChild(n),Se(this,el,n,"f");let i=document.createElement("slot");i.setAttribute("name","single-frame-input-container"),n.append(i);let r=document.createElement("slot");r.setAttribute("name","content"),n.append(r);let a=document.createElement("slot");a.setAttribute("name","drawing-layer"),n.append(a);let d=document.createElement("style");d.textContent=`
.wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}
::slotted(canvas[slot="content"]) {
  object-fit: contain;
  pointer-events: none;
}
::slotted(div[slot="single-frame-input-container"]) {
  width: 1px;
  height: 1px;
  overflow: hidden;
  pointer-events: none;
}
::slotted(*) {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
    `,e.appendChild(d),this.attachShadow({mode:"open"}).appendChild(e)}getWrapper(){return A(this,el,"f")}setElement(e,n){if(!(n instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");this.removeElement(e),n.setAttribute("slot",e),this.appendChild(n)}getElement(e){if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${e}"]`)}removeElement(e){var n;if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");(n=this.querySelectorAll(`[slot="${e}"]`))===null||n===void 0||n.forEach(i=>i.remove())}};el=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",lf);var Ci=class t extends cf{static get engineResourcePath(){return ji(be.engineResourcePaths).dce}static set defaultUIElementURL(e){t._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=t._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",t.engineResourcePath)}static createInstance(e){return $(this,null,function*(){let n=new t;return typeof e=="string"&&(e=e.replace("@engineResourcePath/",t.engineResourcePath)),yield n.setUIElement(e||t.defaultUIElementURL),n})}static _transformCoordinates(e,n,i,r,a,d,v){let y=d/r,C=v/a;e.x=Math.round(e.x/y+n),e.y=Math.round(e.y/C+i)}set _singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(e!==A(this,Vs,"f")){if(Se(this,Vs,e,"f"),A(this,rt,"m",Xt).call(this))Se(this,It,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!A(this,It,"f")){let n=document.createElement("video");n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.objectFit=this.getVideoFit(),n.setAttribute("autoplay","true"),n.setAttribute("playsinline","true"),n.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Dt.OS)&&n.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Se(this,It,n,"f");let i=document.createElement("div");i.append(n),i.style.overflow="hidden",this._videoContainer=i,this._innerComponent.setElement("content",i)}A(this,rt,"m",Xt).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return A(this,Vs,"f")}get disposed(){return A(this,rl,"f")}constructor(){super(),rt.add(this),ks.set(this,void 0),Bs.set(this,void 0),js.set(this,void 0),this.containerClassName="dce-video-container",It.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,tl.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,nl.set(this,!1),il.set(this,!1),Xi.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{A(this,rt,"m",Hs).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&A(this,rt,"m",of).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{t._onLog&&t._onLog("window resize event triggered."),A(this,Xi,"f").width===document.documentElement.clientWidth&&A(this,Xi,"f").height===document.documentElement.clientHeight||(A(this,Xi,"f").width=document.documentElement.clientWidth,A(this,Xi,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},Vs.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!A(this,rt,"m",Xt).call(this))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),this._singleFrameMode==="camera"?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):this._singleFrameMode==="image"&&(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",()=>$(this,null,function*(){let i=e.files[0];e.value="";{let r=M=>$(this,null,function*(){let O=null,L=null;if(typeof createImageBitmap<"u")try{if(O=yield createImageBitmap(M),O)return O}catch{}var P;return O||(L=yield(P=M,new Promise((Y,H)=>{let G=URL.createObjectURL(P),W=new Image;W.src=G,W.onload=()=>{URL.revokeObjectURL(W.src),Y(W)},W.onerror=oe=>{H(new Error("Can't convert blob to image : "+(oe instanceof Event?oe.type:oe)))}}))),L}),a=(M,O,L,P)=>{M.width==L&&M.height==P||(M.width=L,M.height=P);let Y=M.getContext("2d");Y.clearRect(0,0,M.width,M.height),Y.drawImage(O,0,0)},d=yield r(i),v=d instanceof HTMLImageElement?d.naturalWidth:d.width,y=d instanceof HTMLImageElement?d.naturalHeight:d.height,C=this._cvsSingleFrameMode,b=C?.width,T=C?.height;C||(C=document.createElement("canvas"),this._cvsSingleFrameMode=C),a(C,d,v,y),this._innerComponent.setElement("content",C),b===C.width&&T===C.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout(()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)},0)})),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";let n=document.createElement("div");n.append(e),this._innerComponent.setElement("single-frame-input-container",n),this._singleFrameInputContainer=n}e?.click()},Us.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(e,n)=>{var i,r,a,d;if(this.disposed||(this.clearAllInnerDrawingItems(),!e))return;let v=e.originalImageTag;if(!v)return;let y=e.items;if(!y?.length)return;let C=((i=v.cropRegion)===null||i===void 0?void 0:i.left)||0,b=((r=v.cropRegion)===null||r===void 0?void 0:r.top)||0,T=!((a=v.cropRegion)===null||a===void 0)&&a.right?v.cropRegion.right-C:v.originalWidth,M=!((d=v.cropRegion)===null||d===void 0)&&d.bottom?v.cropRegion.bottom-b:v.originalHeight,O=v.currentWidth,L=v.currentHeight,P=(G,W,oe,te,ie,ae,w,re,pe=[],de)=>{W.forEach(c=>t._transformCoordinates(c,oe,te,ie,ae,w,re));let l=new ef({points:[{x:W[0].x,y:W[0].y},{x:W[1].x,y:W[1].y},{x:W[2].x,y:W[2].y},{x:W[3].x,y:W[3].y}]},de);for(let c of pe)l.addNote(c);G.addDrawingItems([l]),A(this,Us,"f").push(l)},Y,H;for(let G of y)switch(G.type){case _e.CRIT_ORIGINAL_IMAGE:break;case _e.CRIT_BARCODE:Y=this.getDrawingLayer(ft.DBR_LAYER_ID),H=[{name:"format",content:G.formatString},{name:"text",content:G.text}],n?.isBarcodeVerifyOpen?G.verified?P(Y,G.location.points,C,b,T,M,O,L,H):P(Y,G.location.points,C,b,T,M,O,L,H,me.STYLE_ORANGE_STROKE_TRANSPARENT):P(Y,G.location.points,C,b,T,M,O,L,H);break;case _e.CRIT_TEXT_LINE:Y=this.getDrawingLayer(ft.DLR_LAYER_ID),H=[{name:"text",content:G.text}],n.isLabelVerifyOpen?G.verified?P(Y,G.location.points,C,b,T,M,O,L,H):P(Y,G.location.points,C,b,T,M,O,L,H,me.STYLE_GREEN_STROKE_TRANSPARENT):P(Y,G.location.points,C,b,T,M,O,L,H);break;case _e.CRIT_DETECTED_QUAD:Y=this.getDrawingLayer(ft.DDN_LAYER_ID),n?.isDetectVerifyOpen?G.crossVerificationStatus===bs.CVS_PASSED?P(Y,G.location.points,C,b,T,M,O,L,[]):P(Y,G.location.points,C,b,T,M,O,L,[],me.STYLE_BLUE_STROKE_TRANSPARENT):P(Y,G.location.points,C,b,T,M,O,L,[]);break;case _e.CRIT_NORMALIZED_IMAGE:Y=this.getDrawingLayer(ft.DDN_LAYER_ID),n?.isNormalizeVerifyOpen?G.crossVerificationStatus===bs.CVS_PASSED?P(Y,G.location.points,C,b,T,M,O,L,[]):P(Y,G.location.points,C,b,T,M,O,L,[],me.STYLE_BLUE_STROKE_TRANSPARENT):P(Y,G.location.points,C,b,T,M,O,L,[]);break;case _e.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},rl.set(this,!1),this.eventHandler=new Il,this.eventHandler.on("content:updated",()=>{A(this,ks,"f")&&clearTimeout(A(this,ks,"f")),Se(this,ks,setTimeout(()=>{if(this.disposed)return;let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(n){if((n.message||n)==="Invalid content dimensions.")return;throw n}this.updateDrawingLayers(e),this.updateConvertedRegion(e)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{A(this,Bs,"f")&&clearTimeout(A(this,Bs,"f")),Se(this,Bs,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(e){this.UIElement=e,this._unbindUI(),this._bindUI()}setUIElement(e){return $(this,null,function*(){let n;if(typeof e=="string"){let i=yield sD(e);n=document.createElement("div"),Object.assign(n.style,{width:"100%",height:"100%"}),n.attachShadow({mode:"open"}).appendChild(i.cloneNode(!0))}else n=e;this._setUIElement(n)})}getUIElement(){return this.UIElement}_bindUI(){var e,n;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let i=this.UIElement;i=i.shadowRoot||i;let r=!((e=i.classList)===null||e===void 0)&&e.contains(this.containerClassName)?i:i.querySelector(`.${this.containerClassName}`);if(!r)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=document.createElement("dce-component"),r.appendChild(this._innerComponent),!A(this,rt,"m",Xt).call(this)){let a=document.createElement("video");Object.assign(a.style,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",objectFit:this.getVideoFit()}),a.setAttribute("autoplay","true"),a.setAttribute("playsinline","true"),a.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Dt.OS)&&a.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Se(this,It,a,"f");let d=document.createElement("div");d.append(a),d.style.overflow="hidden",this._videoContainer=d,this._innerComponent.setElement("content",d)}if(this._selRsl=i.querySelector(".dce-sel-resolution"),this._selMinLtr=i.querySelector(".dlr-sel-minletter"),this._divScanArea=i.querySelector(".dce-scanarea"),this._divScanLight=i.querySelector(".dce-scanlight"),this._bgLoading=i.querySelector(".dce-bg-loading"),this._bgCamera=i.querySelector(".dce-bg-camera"),this._selCam=i.querySelector(".dce-sel-camera"),this._optGotRsl=i.querySelector(".dce-opt-gotResolution"),this._btnClose=i.querySelector(".dce-btn-close"),this._optGotMinLtr=i.querySelector(".dlr-opt-gotMinLtr"),this._selRsl&&(this._hideDefaultSelection||A(this,rt,"m",Xt).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||A(this,rt,"m",Xt).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||A(this,rt,"m",Hs).call(this),A(this,rt,"m",Xt).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),A(this,rt,"m",Xt).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(d=>{var v;t._onLog&&t._onLog("resize observer triggered.");for(let y of d)y.target===((v=this._innerComponent)===null||v===void 0?void 0:v.getWrapper())&&this._videoResizeListener()}));let a=(n=this._innerComponent)===null||n===void 0?void 0:n.getWrapper();a&&this._resizeObserver.observe(a)}A(this,Xi,"f").width=document.documentElement.clientWidth,A(this,Xi,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var e,n,i,r;A(this,rt,"m",Xt).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),A(this,rt,"m",Hs).call(this),(e=this._drawingLayerManager)===null||e===void 0||e.clearDrawingLayers(),(n=this._innerComponent)===null||n===void 0||n.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,(i=this._innerComponent)===null||i===void 0||i.remove(),this._innerComponent=null,Se(this,It,null,"f"),(r=this._videoContainer)===null||r===void 0||r.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(e,n){if(this._selCam){let r;this._selCam.textContent="";for(let a of n){let d=document.createElement("option");d.value=a.deviceId,d.innerText=a.label,this._selCam.append(d),a.deviceId&&e&&e.deviceId==a.deviceId&&(r=d)}this._selCam.value=r?r.value:""}let i=this.UIElement;if(i=i.shadowRoot||i,i.querySelector(".dce-macro-use-mobile-native-like-ui")){let r=i.querySelector(".dce-mn-cameras");if(r){r.textContent="";for(let a of n){let d=document.createElement("div");d.classList.add("dce-mn-camera-option"),d.setAttribute("data-davice-id",a.deviceId),d.textContent=a.label,r.append(d)}}}}_renderResolutionInfo(e){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",e.width),this._optGotRsl.setAttribute("data-height",e.height),this._optGotRsl.innerText="got "+e.width+"x"+e.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"));{let n=this.UIElement;n=n?.shadowRoot||n;let i=n?.querySelector(".dce-mn-resolution-box");if(i){let r="";if(e&&e.width&&e.height){let a=Math.max(e.width,e.height),d=Math.min(e.width,e.height);r=d<=1080?d+"P":a<3e3?"2K":Math.round(a/1e3)+"K"}i.textContent=r}}}getVideoElement(){return A(this,It,"f")}isVideoLoaded(){return!(!A(this,It,"f")||!this.cameraEnhancer)&&this.cameraEnhancer.isOpen()}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,!A(this,It,"f")||(A(this,It,"f").style.objectFit=e,A(this,rt,"m",Xt).call(this)))return;let n;this._updateVideoContainer();try{n=this.getContentDimensions()}catch(i){if((i.message||i)==="Invalid content dimensions.")return;throw i}A(this,rt,"m",sl).call(this,n,this.getConvertedRegion()),this.updateDrawingLayers(n)}getVideoFit(){return this.videoFit}getContentDimensions(){var e,n,i,r;let a,d,v;if(A(this,rt,"m",Xt).call(this)?(a=(i=this._cvsSingleFrameMode)===null||i===void 0?void 0:i.width,d=(r=this._cvsSingleFrameMode)===null||r===void 0?void 0:r.height,v="contain"):(a=(e=A(this,It,"f"))===null||e===void 0?void 0:e.videoWidth,d=(n=A(this,It,"f"))===null||n===void 0?void 0:n.videoHeight,v=this.getVideoFit()),!a||!d)throw new Error("Invalid content dimensions.");return{width:a,height:d,objectFit:v}}updateConvertedRegion(e){let n=Ro.convert(this.scanRegion,e.width,e.height);Se(this,tl,n,"f"),A(this,js,"f")&&clearTimeout(A(this,js,"f")),Se(this,js,setTimeout(()=>{let i;try{i=this.getContentDimensions()}catch(r){if((r.message||r)==="Invalid content dimensions.")return;throw r}A(this,rt,"m",ol).call(this,i,n),A(this,rt,"m",sl).call(this,i,n)},0),"f")}getConvertedRegion(){return A(this,tl,"f")}setScanRegion(e){if(e!=null&&!Hc(e)&&!Bi(e))throw TypeError("Invalid 'region'.");let n;this.scanRegion=e?JSON.parse(JSON.stringify(e)):null;try{n=this.getContentDimensions()}catch(i){if((i.message||i)==="Invalid content dimensions.")return;throw i}this.updateConvertedRegion(n)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(e){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");let n=A(this,It,"f").videoWidth,i=A(this,It,"f").videoHeight,r=this.getVideoFit(),{width:a,height:d}=this._innerComponent.getBoundingClientRect();if(a<=0||d<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let v,y={x:0,y:0,width:n,height:i,isMeasuredInPercentage:!1};if(r==="cover"&&(a/d<n/i?(v=d/i,y.x=Math.floor((n-a/v)/2),y.y=0,y.width=Math.ceil(a/v),y.height=i):(v=a/n,y.x=0,y.y=Math.floor((i-d/v)/2),y.width=n,y.height=Math.ceil(d/v))),e?.inPixels)return y;let C=y;return C.x=Math.ceil(C.x/i*100),C.y=Math.ceil(C.y/n*100),C.width=Math.floor(C.width/n*100),C.height=Math.floor(C.height/i*100),C.isMeasuredInPercentage=!0,y}setScanRegionMask(e,n,i,r){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||A(this,rt,"m",rf).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=me.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=me.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));let a=this._drawingLayerOfMask.width,d=this._drawingLayerOfMask.height,v=new Zi({x:0,y:0,width:a,height:d},this._maskBackRectStyleId),y=new Zi({x:-a/2,y:-d/2+n,width:e,height:r}),C=new Zi({x:-a/2+e+i,y:-d/2+n,width:a-e-i<0?0:a-e-i,height:r}),b=new Zi({x:-a/2,y:-d/2,width:a,height:n}),T=new Zi({x:-a/2,y:-d/2+n+r,width:a,height:d-n-r<0?0:d-n-r});y.set("strokeWidth",0),C.set("strokeWidth",0),b.set("strokeWidth",0),T.set("strokeWidth",0);let M=new tf([y,C,b,T])._getFabricObject();v.set("clipPath",M);let O=new Zi({x:e,y:n,width:i,height:r},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([v,O])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(e){Se(this,nl,e,"f"),e?A(this,rt,"m",l_).call(this):A(this,rt,"m",rf).call(this)}setScanRegionMaskVisible(e){this._setScanRegionMaskVisible(e),this._userSetMaskVisible=e}isScanRegionMaskVisible(){return A(this,nl,"f")}setScanRegionMaskStyle(e){if(!e)return;let n;e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._maskBackRectStyleId&&me.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&me.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{n=this.getContentDimensions()}catch(i){if((i.message||i)==="Invalid content dimensions.")return;throw i}A(this,rt,"m",ol).call(this,n,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(e){Se(this,il,e,"f"),e?A(this,rt,"m",of).call(this):A(this,rt,"m",Hs).call(this)}setScanLaserVisible(e){this._setScanLaserVisible(e),this._userSetLaserVisible=e}isScanLaserVisible(){return A(this,il,"f")}_updateVideoContainer(){if(!A(this,It,"f")||A(this,rt,"m",Xt).call(this))return;let e=1,n=A(this,It,"f").style.transform.match(/scale\((.+)\)/);n&&(e=parseFloat(n[1]));let i=this._videoContainer;if(this.videoFit==="contain"&&e>1){let r=A(this,It,"f").videoWidth,a=A(this,It,"f").videoHeight,{width:d,height:v}=this._innerComponent.getBoundingClientRect(),y=r/a;if(d/v<y){let C=d/y;i.style.left="0",i.style.top=(v-C)/2/v*100+"%",i.style.width="100%",i.style.height=C/v*100+"%"}else{let C=v*y;i.style.left=(d-C)/2/d*100+"%",i.style.top="0",i.style.width=C/d*100+"%",i.style.height="100%"}}else i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%"}updateLayers(){let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(i){if((i.message||i)==="Invalid content dimensions.")return;throw i}let n=this.getConvertedRegion();A(this,rt,"m",sl).call(this,e,n),this.updateDrawingLayers(e),A(this,rt,"m",ol).call(this,e,n)}clearAllInnerDrawingItems(){A(this,Us,"f").forEach(e=>e.remove()),A(this,Us,"f").length=0}dispose(){this._unbindUI(),Se(this,rl,!0,"f")}};function N(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function He(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n}ks=new WeakMap,Bs=new WeakMap,js=new WeakMap,It=new WeakMap,tl=new WeakMap,nl=new WeakMap,il=new WeakMap,Xi=new WeakMap,Vs=new WeakMap,Us=new WeakMap,rl=new WeakMap,rt=new WeakSet,Xt=function(){return this._singleFrameMode!=="disabled"},ol=function(t,e){e&&(e.x!==0||e.y!==0||e.width!==t.width||e.height!==t.height)?this.setScanRegionMask(e.x,e.y,e.width,e.height):this.clearScanRegionMask()},l_=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},rf=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},of=function(){this._divScanLight&&this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block")},Hs=function(){this._divScanLight&&(this._divScanLight.style.display="none")},sl=function(t,e){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;let{width:n,height:i,objectFit:r}=t;e||(e={x:0,y:0,width:n,height:i});let{width:a,height:d}=this._innerComponent.getBoundingClientRect();if(a<=0||d<=0)return;let v=a/d,y=n/i,C,b,T,M,O=1;if(r==="contain")v<y?(O=a/n,C=0,b=(d-i*O)/2):(O=d/i,C=(a-n*O)/2,b=0),C+=e.x*O,b+=e.y*O,T=e.width*O,M=e.height*O;else if(r==="cover")if(v<y){O=d/i,C=e.x*O-(n*O-a)/2,C=Math.max(C,0),C=Math.min(C,a),b=e.y*O;let L=(e.x+e.width)*O-(n*O-a)/2;L=Math.max(L,0),L=Math.min(L,a),T=L-C,M=e.height*O}else{O=a/n,C=e.x*O,b=e.y*O-(i*O-d)/2,b=Math.max(b,0),b=Math.min(b,d);let L=(e.y+e.height)*O-(i*O-d)/2;L=Math.max(L,0),L=Math.min(L,d),T=e.width*O,M=L-b}else C=0,b=0,T=0,M=0;this._divScanArea.style.left=C+"px",this._divScanArea.style.top=b+"px",this._divScanArea.style.width=T+"px",this._divScanArea.style.height=M+"px"},Ci._defaultUIElementURL="@engineResourcePath/dce.ui.html",typeof SuppressedError=="function"&&SuppressedError;var Ky=typeof self>"u",Ms,Os,Kc,$d,Nt;function di(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function fi(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n}typeof navigator<"u"&&(Ms=navigator,Os=Ms.userAgent,Kc=Ms.platform,$d=Ms.mediaDevices),function(){if(!Ky){let t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ms.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Kc,search:"Win"},Mac:{str:Kc},Linux:{str:Kc}},n="unknownBrowser",i=0,r="unknownOS";for(let a in t){let d=t[a]||{},v=d.str||Os,y=d.search||a,C=d.verStr||Os,b=d.verSearch||a;if(b instanceof Array||(b=[b]),v.indexOf(y)!=-1){n=a;for(let T of b){let M=C.indexOf(T);if(M!=-1){i=parseFloat(C.substring(M+T.length+1));break}}break}}for(let a in e){let d=e[a]||{},v=d.str||Os,y=d.search||a;if(v.indexOf(y)!=-1){r=a;break}}r=="Linux"&&Os.indexOf("Windows NT")!=-1&&(r="HarmonyOS"),Nt={browser:n,version:i,OS:r}}Ky&&(Nt={browser:"ssr",version:0,OS:"ssr"})}(),$d&&$d.getUserMedia,Nt.browser==="Chrome"&&Nt.version>66||Nt.browser==="Safari"&&Nt.version>13||Nt.browser==="OPR"&&Nt.version>43||Nt.browser==="Edge"&&Nt.version,typeof SuppressedError=="function"&&SuppressedError;var Pn=class t{static multiply(e,n){let i=[];for(let r=0;r<3;r++){let a=n.slice(3*r,3*r+3);for(let d=0;d<3;d++){let v=[e[d],e[d+3],e[d+6]].reduce((y,C,b)=>y+C*a[b],0);i.push(v)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,n,i){return t.multiply(e,[1,0,0,0,1,0,n,i,1])}static rotate(e,n){var i=Math.cos(n),r=Math.sin(n);return t.multiply(e,[i,-r,0,r,i,0,0,0,1])}static scale(e,n,i){return t.multiply(e,[n,0,0,0,i,0,0,0,1])}},Ve,al,Eo,Gs,Ws,Io,cl;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Ve||(Ve={}));var uf=class t{static get version(){return"1.1.3"}static get webGLSupported(){return t._webGLSupported===void 0&&(t._webGLSupported=!!document.createElement("canvas").getContext("webgl")),t._webGLSupported}get disposed(){return di(this,cl,"f")}constructor(){al.set(this,Ve.RGBA),Eo.set(this,null),Gs.set(this,null),Ws.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,Io.set(this,null),cl.set(this,!1)}drawImage(e,n,i,r,a,d){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!r)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(d?.bUseWebGL&&!t.webGLSupported)throw new Error("Your browser or machine may not support WebGL.");if(n instanceof HTMLVideoElement&&n.readyState!==4||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let v;t._onLog&&(v=Date.now(),t._onLog("drawImage(), START: "+v));let y=0,C=0,b=i,T=r,M=0,O=0,L=i,P=r;a&&(a.sx&&(y=Math.round(a.sx)),a.sy&&(C=Math.round(a.sy)),a.sWidth&&(b=Math.round(a.sWidth)),a.sHeight&&(T=Math.round(a.sHeight)),a.dx&&(M=Math.round(a.dx)),a.dy&&(O=Math.round(a.dy)),a.dWidth&&(L=Math.round(a.dWidth)),a.dHeight&&(P=Math.round(a.dHeight)));let Y,H=Ve.RGBA;if(d?.pixelFormat&&(H=d.pixelFormat),d?.bufferContainer&&(Y=d.bufferContainer,Y.length<4*L*P))throw new Error("Unexpected size of the 'bufferContainer'.");let G=e;if(!t.webGLSupported||!(this.useWebGLByDefault&&d?.bUseWebGL==null||d?.bUseWebGL)){t._onLog&&t._onLog("drawImage() in context2d."),G.ctx2d||(G.ctx2d=G.getContext("2d",{willReadFrequently:!0}));let W=G.ctx2d;if(!W)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(G.width<M+L||G.height<O+P)&&(G.width=M+L,G.height=O+P),W.drawImage(n,y,C,b,T,M,O,L,P),t._onLog&&t._onLog("drawImage() in context2d end. Costs: "+(Date.now()-v)),{context:W,pixelFormat:Ve.RGBA,bUseWebGL:!1}}t._onLog&&t._onLog("drawImage() in WebGL.");try{(G.width<M+L||G.height<O+P)&&(G.width=M+L,G.height=O+P,G.ctxWebGL&&G.ctxWebGL.viewport(0,0,M+L,O+P));let W=G.ctxWebGL||G.getContext("webgl",{antialias:!1})||G.getContext("experimental-webgl",{antialias:!1});if(!W){t._onLog&&t._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");let w=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw w.name="WebGLError",w}if(!G.ctxWebGL||H!==di(this,al,"f")){G.ctxWebGL=W;let w=o=>{let s=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,s),o.bufferData(o.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),o.STATIC_DRAW);let h=o.createBuffer();return o.bindBuffer(o.ARRAY_BUFFER,h),o.bufferData(o.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),o.STATIC_DRAW),{positions:s,texCoords:h}},re=o=>{let s=o.createTexture();return o.bindTexture(o.TEXTURE_2D,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),s},pe=(o,s)=>{let h=o.createProgram();if(s.forEach(m=>o.attachShader(h,m)),o.linkProgram(h),!o.getProgramParameter(h,o.LINK_STATUS)){let m=new Error(`An error occured linking the program: ${o.getProgramInfoLog(h)}.`);throw m.name="WebGLError",m}return o.useProgram(h),h},de=(o,s,h)=>{let m=o.createShader(s);if(o.shaderSource(m,h),o.compileShader(m),!o.getShaderParameter(m,o.COMPILE_STATUS)){let p=new Error(`An error occured compiling the shader: ${o.getShaderInfoLog(m)}.`);throw p.name="WebGLError",p}return m},l=`
attribute vec2 a_position;
attribute vec2 a_texCoord;

uniform mat3 u_matrix;
uniform mat3 u_textureMatrix;

varying vec2 v_texCoord;
void main(void) {
gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
}`,c="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(H)&&(c=H.slice(0,3));let u=`
precision mediump float;
varying vec2 v_texCoord;
uniform sampler2D u_image;
uniform float uColorFactor;

void main() {
vec4 sample = texture2D(u_image, v_texCoord);
float grey = 0.3 * sample.r + 0.59 * sample.g + 0.11 * sample.b;
gl_FragColor = vec4(sample.${c} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
}`,f=pe(W,[de(W,W.VERTEX_SHADER,l),de(W,W.FRAGMENT_SHADER,u)]);fi(this,Gs,{program:f,attribLocations:{vertexPosition:W.getAttribLocation(f,"a_position"),texPosition:W.getAttribLocation(f,"a_texCoord")},uniformLocations:{uSampler:W.getUniformLocation(f,"u_image"),uColorFactor:W.getUniformLocation(f,"uColorFactor"),uMatrix:W.getUniformLocation(f,"u_matrix"),uTextureMatrix:W.getUniformLocation(f,"u_textureMatrix")}},"f"),fi(this,Ws,w(W),"f"),fi(this,Eo,re(W),"f"),fi(this,al,H,"f")}let oe=(w,re,pe)=>{w.bindBuffer(w.ARRAY_BUFFER,re),w.enableVertexAttribArray(pe),w.vertexAttribPointer(pe,2,w.FLOAT,!1,0,0)},te=(w,re,pe)=>{let de=w.RGBA,l=w.RGBA,c=w.UNSIGNED_BYTE;w.bindTexture(w.TEXTURE_2D,re),w.texImage2D(w.TEXTURE_2D,0,de,l,c,pe)},ie=(w,re,pe,de)=>{w.clearColor(0,0,0,1),w.clearDepth(1),w.enable(w.DEPTH_TEST),w.depthFunc(w.LEQUAL),w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT),oe(w,pe.positions,re.attribLocations.vertexPosition),oe(w,pe.texCoords,re.attribLocations.texPosition),w.activeTexture(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,de),w.uniform1i(re.uniformLocations.uSampler,0),w.uniform1f(re.uniformLocations.uColorFactor,[Ve.GREY,Ve.GREY32].includes(H)?1:0);let l,c,u=Pn.translate(Pn.identity(),-1,-1);u=Pn.scale(u,2,2),u=Pn.scale(u,1/w.canvas.width,1/w.canvas.height),l=Pn.translate(u,M,O),l=Pn.scale(l,L,P),w.uniformMatrix3fv(re.uniformLocations.uMatrix,!1,l),c=Pn.translate(Pn.identity(),y/i,C/r),c=Pn.scale(c,b/i,T/r),w.uniformMatrix3fv(re.uniformLocations.uTextureMatrix,!1,c),w.drawArrays(w.TRIANGLES,0,6)};te(W,di(this,Eo,"f"),n),ie(W,di(this,Gs,"f"),di(this,Ws,"f"),di(this,Eo,"f"));let ae=Y||new Uint8Array(4*L*P);if(W.readPixels(M,O,L,P,W.RGBA,W.UNSIGNED_BYTE,ae),ae[3]!==255){t._onLog&&t._onLog("Incorrect WebGL drawing .");let w=new Error("WebGL error: incorrect drawing.");throw w.name="WebGLError",w}return t._onLog&&t._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-v)),{context:W,pixelFormat:H===Ve.GREY?Ve.GREY32:H,bUseWebGL:!0}}catch(W){if(this.forceLoseContext(),d?.bUseWebGL==null)return t._onLog&&t._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,n,i,r,a,Object.assign({},d,{bUseWebGL:!1}));throw W.name="WebGLError",W}}readCvsData(e,n,i){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let r,a=0,d=0,v=e.canvas.width,y=e.canvas.height;if(n&&(n.x&&(a=n.x),n.y&&(d=n.y),n.width&&(v=n.width),n.height&&(y=n.height)),i?.length<4*v*y)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){let C=e;i?(C.readPixels(a,d,v,y,C.RGBA,C.UNSIGNED_BYTE,i),r=new Uint8Array(i.buffer,0,4*v*y)):(r=new Uint8Array(4*v*y),C.readPixels(a,d,v,y,C.RGBA,C.UNSIGNED_BYTE,r))}else if(e instanceof CanvasRenderingContext2D){let C;C=e.getImageData(a,d,v,y),r=new Uint8Array(C.data.buffer),i?.set(r)}return r}transformPixelFormat(e,n,i,r){let a,d;if(t._onLog&&(a=Date.now(),t._onLog("transformPixelFormat(), START: "+a)),n===i)return t._onLog&&t._onLog("transformPixelFormat() end. Costs: "+(Date.now()-a)),r?new Uint8Array(e):e;let v=[Ve.RGBA,Ve.RBGA,Ve.GRBA,Ve.GBRA,Ve.BRGA,Ve.BGRA];if(v.includes(n))if(i===Ve.GREY){d=new Uint8Array(e.length/4);for(let y=0;y<e.length;y+=4){let C=.3*e[y]+.59*e[y+1]+.11*e[y+2];d[y/4]=C}}else if(i===Ve.GREY32){d=r?new Uint8Array(e):e;for(let y=0;y<e.length;y+=4){let C=.3*e[y]+.59*e[y+1]+.11*e[y+2];d[y]=C,d[y+1]=C,d[y+2]=C}}else{if(!v.includes(i))throw new Error("Unable to transform.");if(r){d=new Uint8Array(e);let y=n.indexOf("r"),C=n.indexOf("g"),b=n.indexOf("b"),T=i.indexOf("r"),M=i.indexOf("g"),O=i.indexOf("b");for(let L=0;L<e.length;L+=4)d[L+T]=e[L+y],d[L+M]=e[L+C],d[L+O]=e[L+b]}else{d=e;let y=n.indexOf("r"),C=n.indexOf("g"),b=n.indexOf("b"),T=i.indexOf("r"),M=i.indexOf("g"),O=i.indexOf("b");for(let L=0;L<e.length;L+=4){let P=[e[L],e[L+1],e[L+2]];d[L+T]=P[y],d[L+M]=P[C],d[L+O]=P[b]}}}else if(n===Ve.GREY){if(i!==Ve.GREY32)throw new Error("Unable to transform.");d=new Uint8Array(4*e.length);for(let y=0;y<e.length;y++)d[4*y]=e[y],d[4*y+1]=e[y],d[4*y+2]=e[y],d[4*y+3]=255}else{if(n!==Ve.GREY32)throw new Error("Unable to transform.");if(i!==Ve.GREY)throw new Error("Unable to transform.");d=new Uint8Array(e.length/4);for(let y=0;y<e.length;y+=4)d[y/4]=e[y]}return t._onLog&&t._onLog("transformPixelFormat() end. Costs: "+(Date.now()-a)),d}getImageData(e,n,i){var r,a,d,v,y;if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let C,b;if(e instanceof HTMLImageElement)C=e.naturalWidth,b=e.naturalHeight;else if(e instanceof HTMLCanvasElement)C=e.width,b=e.height;else if(e instanceof HTMLVideoElement)C=e.videoWidth,b=e.videoHeight;else{if(!(e instanceof ImageBitmap))throw Error("The type of 'source' is not supported.");C=e.width,b=e.height}let T,M=t.webGLSupported&&this.useWebGLByDefault;if(n.sx<0||n.sy<0||n.sx+n.sWidth>C||n.sy+n.sHeight>b)throw new Error("Invalid position.");(r=t._onLog)===null||r===void 0||r.call(t,"getImageData(), START: "+(T=Date.now()));let O=Math.round(n.sx),L=Math.round(n.sy),P=Math.round(n.sWidth),Y=Math.round(n.sHeight),H=Math.round(n.dWidth),G=Math.round(n.dHeight),W,oe=i?.pixelFormat||Ve.RGBA,te=i?.bufferContainer;if(te&&(Ve.GREY===oe&&te.length<H*G||Ve.RGBA===oe&&te.length<H*G*4))throw new Error("Unexpected size of the 'bufferContainer'.");if(M){(a=t._onLog)===null||a===void 0||a.call(t,"getImageData() in WebGL.");let ie,ae=this._reusedWebGLCvs=this._reusedWebGLCvs||document.createElement("canvas");try{if(te)if(oe===Ve.GREY){if(W=new Uint8Array(4*H*G),ie=this.drawImage(ae,e,C,b,{sx:O,sy:L,sWidth:P,sHeight:Y,dWidth:H,dHeight:G},{pixelFormat:oe,bUseWebGL:!0,bufferContainer:W}),W=this.transformPixelFormat(W,ie.pixelFormat,oe),te){if(te.length<W.length)throw new Error("Unexpected size of the 'bufferContainer'.");te.set(W)}}else ie=this.drawImage(ae,e,C,b,{sx:O,sy:L,sWidth:P,sHeight:Y,dWidth:H,dHeight:G},{pixelFormat:oe,bUseWebGL:!0,bufferContainer:te}),W=new Uint8Array(te.buffer,0,4*H*G),W=this.transformPixelFormat(W,ie.pixelFormat,oe);else oe===Ve.GREY?((!di(this,Io,"f")||di(this,Io,"f").length<4*H*G)&&fi(this,Io,new Uint8Array(4*H*G),"f"),W=new Uint8Array(di(this,Io,"f").buffer,0,4*H*G)):W=new Uint8Array(4*H*G),ie=this.drawImage(ae,e,C,b,{sx:O,sy:L,sWidth:P,sHeight:Y,dWidth:H,dHeight:G},{pixelFormat:oe,bUseWebGL:!0,bufferContainer:W}),W=this.transformPixelFormat(W,ie.pixelFormat,oe)}catch(w){if(w.name==="WebGLError")return this.forceLoseContext(),console.warn("WebGLError: "+w?.message),(d=t._onLog)===null||d===void 0||d.call(t,"getImageData() in WebGL failed, try again in context2d."),t._webGLSupported=!1,this.getImageData(e,n,i);throw w}}else{(v=t._onLog)===null||v===void 0||v.call(t,"getImageData() in context2d.");let ie=this._reusedCvs=this._reusedCvs||document.createElement("canvas");ie.width!=H&&(ie.width=H),ie.height!=G&&(ie.height=G);let ae=ie.getContext("2d");if(ae.drawImage(e,O,L,P,P,0,0,H,G),W=new Uint8Array(ae.getImageData(0,0,H,G).data.buffer),Ve.GREY===oe){let w=te||new Uint8Array(H*G);for(let re=0;re<W.length;re+=4)w[re/4]=Math.round((W[re]+W[re+1]+W[re+2])/3);W=w}else te?.set(W)}return(y=t._onLog)===null||y===void 0||y.call(t,"getImageData() end. Costs: "+(Date.now()-T)),{data:W,pixelFormat:oe,width:H,height:G,bUseWebGL:M}}convertDataToCvs(e,n,i,r){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if(typeof n!="number"||n<=0)throw new Error("Invalid 'width'.");if(typeof i!="number"||i<=0)throw new Error("Invalid 'height'.");let a=document.createElement("canvas"),d;if(a.width=n,a.height=i,r===Ve.GREY){d=new Uint8ClampedArray(4*n*i);for(let y=0;y<d.length;y+=4)d[y]=e[y/4],d[y+1]=e[y/4],d[y+2]=e[y/4],d[y+3]=255}else d=new Uint8ClampedArray(e.buffer);let v=new ImageData(d,n,i);return a.getContext("2d").putImageData(v,0,0),a}forceLoseContext(){var e;if(!this._reusedWebGLCvs)return;let n=this._reusedWebGLCvs.ctxWebGL;n&&!n.isContextLost()&&((e=n.getExtension("WEBGL_lose_context"))===null||e===void 0||e.loseContext()),fi(this,Eo,null,"f"),fi(this,Gs,null,"f"),fi(this,Ws,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),fi(this,cl,!0,"f")}};al=new WeakMap,Eo=new WeakMap,Gs=new WeakMap,Ws=new WeakMap,Io=new WeakMap,cl=new WeakMap;var br,ll,zd,we,Le,ze,ul,hl,st,vn,mi,bo,dl,qn,wi,Jt,Do,So,$s,fl,To,Dr,vi,yi,hf,_t,df,Sr,u_,pl,gl,Qy,Nn,Yd,Xd,Ao,zs,bl,Yt,vo,ff,pf,h_,gf=class{constructor(){br.set(this,new Map),ll.set(this,!1)}get disposed(){return N(this,ll,"f")}on(e,n){e=e.toLowerCase();let i=N(this,br,"f").get(e);if(i){if(i.includes(n))return;i.push(n)}else N(this,br,"f").set(e,[n])}off(e,n){e=e.toLowerCase();let i=N(this,br,"f").get(e);if(!i)return;let r=i.indexOf(n);r!==-1&&i.splice(r,1)}offAll(e){e=e.toLowerCase();let n=N(this,br,"f").get(e);n&&(n.length=0)}fire(e,n=[],i={async:!1,copy:!0}){n||(n=[]),e=e.toLowerCase();let r=N(this,br,"f").get(e);if(r&&r.length){i=Object.assign({async:!1,copy:!0},i);for(let a of r){if(!a)continue;let d=[];if(i.copy)for(let y of n){try{y=JSON.parse(JSON.stringify(y))}catch{}d.push(y)}else d=n;let v=!1;if(i.async)setTimeout(()=>{this.disposed||r.includes(a)&&a.apply(i.target,d)},0);else try{v=a.apply(i.target,d)}catch{}if(v===!0)break}}}dispose(){He(this,ll,!0,"f")}};br=new WeakMap,ll=new WeakMap;var Ht=(t,e,n,i)=>{if(!n)return t;let r=e+Math.round((t-e)/n)*n;return i&&(r=Math.min(r,i)),r},gt=class t{static get version(){return"2.0.18"}static isStorageAvailable(e){let n;try{n=window[e];let i="__storage_test__";return n.setItem(i,i),n.removeItem(i),!0}catch(i){return i instanceof DOMException&&(i.code===22||i.code===1014||i.name==="QuotaExceededError"||i.name==="NS_ERROR_DOM_QUOTA_REACHED")&&n&&n.length!==0}}static findBestRearCameraInIOS(e,n){if(!e||!e.length)return null;let i=!1;if(n?.getMainCamera&&(i=!0),i){let r=["\uD6C4\uBA74 \uCE74\uBA54\uB77C","\u80CC\u9762\u30AB\u30E1\u30E9","\u5F8C\u7F6E\u93E1\u982D","\u540E\u7F6E\u76F8\u673A","\u0E01\u0E25\u0E49\u0E2D\u0E07\u0E14\u0E49\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07","\u092C\u0948\u0915 \u0915\u0948\u092E\u0930\u093E","\u0627\u0644\u0643\u0627\u0645\u064A\u0631\u0627 \u0627\u0644\u062E\u0644\u0641\u064A\u0629","\u05DE\u05E6\u05DC\u05DE\u05D4 \u05D0\u05D7\u05D5\u05E8\u05D9\u05EA","\u043A\u0430\u043C\u0435\u0440\u0430 \u043D\u0430 \u0437\u0430\u0434\u043D\u0435\u0439 \u043F\u0430\u043D\u0435\u043B\u0438","\u0437\u0430\u0434\u043D\u044F \u043A\u0430\u043C\u0435\u0440\u0430","\u0437\u0430\u0434\u043D\u0430 \u043A\u0430\u043C\u0435\u0440\u0430","\u0430\u0440\u0442\u049B\u044B \u043A\u0430\u043C\u0435\u0440\u0430","\u03C0\u03AF\u03C3\u03C9 \u03BA\u03AC\u03BC\u03B5\u03C1\u03B1","zadn\xED fotoapar\xE1t","zadn\xE1 kamera","tylny aparat","takakamera","stra\u017Enja kamera","r\xFCckkamera","kamera p\xE5 baksidan","kamera belakang","kamera bak","h\xE1ts\xF3 kamera","fotocamera (posteriore)","c\xE2mera traseira","c\xE2mara traseira","c\xE1mara trasera","c\xE0mera posterior","cam\xE9ra arri\xE8re","camer\u0103 spate","camera m\u1EB7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],a=e.find(d=>r.includes(d.label.toLowerCase()));return a?.deviceId}{let r=["\uD6C4\uBA74","\u80CC\u9762","\u5F8C\u7F6E","\u540E\u7F6E","\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07","\u092C\u0948\u0915","\u062E\u0644\u0641\u064A\u0629","\u05D0\u05D7\u05D5\u05E8\u05D9\u05EA","\u0437\u0430\u0434\u043D\u044F\u044F","\u0437\u0430\u0434\u043D\u0435\u0439","\u0437\u0430\u0434\u043D\u0430","\u03C0\u03AF\u03C3\u03C9","zadn\xED","zadn\xE1","tylny","trasera","traseira","taka","stra\u017Enja","spate","sau","r\xFCck","posteriore","posterior","h\xE1ts\xF3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049B\u044B","arri\xE8re","arka","achterzijde"],a=["\uD2B8\uB9AC\uD50C","\u4E09\u955C\u5934","\u4E09\u93E1\u982D","\u30C8\u30EA\u30D7\u30EB","\u0E2A\u0E32\u0E21","\u091F\u094D\u0930\u093F\u092A\u0932","\u062B\u0644\u0627\u062B\u064A\u0629","\u05DE\u05E9\u05D5\u05DC\u05E9\u05EA","\u04AF\u0448\u0442\u0456\u043A","\u0442\u0440\u043E\u0439\u043D\u0430\u044F","\u0442\u0440\u043E\u0439\u043D\u0430","\u043F\u043E\u0442\u0440\u043E\u0454\u043D\u0430","\u03C4\u03C1\u03B9\u03C0\u03BB\u03AE","\xFC\xE7l\xFC","tr\xF3jobiektywowy","trostruka","trojn\xFD","trojit\xE1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],d=["\uB4C0\uC5BC \uC640\uC774\uB4DC","\u96D9\u5EE3\u89D2","\u53CC\u5E7F\u89D2","\u30C7\u30E5\u30A2\u30EB\u5E83\u89D2","\u0E04\u0E39\u0E48\u0E14\u0E49\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07\u0E21\u0E38\u0E21\u0E01\u0E27\u0E49\u0E32\u0E07","\u0921\u094D\u092F\u0941\u0905\u0932 \u0935\u093E\u0907\u0921","\u0645\u0632\u062F\u0648\u062C\u0629 \u0639\u0631\u064A\u0636\u0629","\u05DB\u05E4\u05D5\u05DC\u05D4 \u05E8\u05D7\u05D1\u05D4","\u049B\u043E\u0441 \u043A\u0435\u04A3 \u0431\u04B1\u0440\u044B\u0448\u0442\u044B","\u0437\u0434\u0432\u043E\u0454\u043D\u0430 \u0448\u0438\u0440\u043E\u043A\u043E\u043A\u0443\u0442\u043D\u0430","\u0434\u0432\u043E\u0439\u043D\u0430\u044F \u0448\u0438\u0440\u043E\u043A\u043E\u0443\u0433\u043E\u043B\u044C\u043D\u0430\u044F","\u0434\u0432\u043E\u0439\u043D\u0430 \u0448\u0438\u0440\u043E\u043A\u043E\u044A\u0433\u044A\u043B\u043D\u0430","\u03B4\u03B9\u03C0\u03BB\u03AE \u03B5\u03C5\u03C1\u03B5\u03AF\u03B1","\xE7ift geni\u015F","laajakulmainen kaksois","k\xE9p r\u1ED9ng m\u1EB7t sau","kett\u0151s, sz\xE9les l\xE1t\xF3sz\xF6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xE1ln\xED \u0161iroko\xFAhl\xFD","du\xE1lna \u0161irokouhl\xE1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],v=e.filter(b=>{let T=b.label.toLowerCase();return r.some(M=>T.includes(M))});if(!v.length)return null;let y=v.find(b=>{let T=b.label.toLowerCase();return a.some(M=>T.includes(M))});if(y)return y.deviceId;let C=v.find(b=>{let T=b.label.toLowerCase();return d.some(M=>T.includes(M))});return C?C.deviceId:v[0].deviceId}}static findBestRearCamera(e,n){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(Nt.OS))return t.findBestRearCameraInIOS(e,{getMainCamera:n?.getMainCameraInIOS});let i=["\uD6C4","\u80CC\u9762","\u80CC\u7F6E","\u5F8C\u9762","\u5F8C\u7F6E","\u540E\u9762","\u540E\u7F6E","\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07","\u0E2B\u0E25\u0E31\u0E07","\u092C\u0948\u0915","\u062E\u0644\u0641\u064A\u0629","\u05D0\u05D7\u05D5\u05E8\u05D9\u05EA","\u0437\u0430\u0434\u043D\u044F\u044F","\u0437\u0430\u0434\u043D\u044F","\u0437\u0430\u0434\u043D\u0435\u0439","\u0437\u0430\u0434\u043D\u0430","\u03C0\u03AF\u03C3\u03C9","zadn\xED","zadn\xE1","tylny","tr\xE1s","trasera","traseira","taka","stra\u017Enja","spate","sau","r\xFCck","rear","posteriore","posterior","h\xE1ts\xF3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049B\u044B","arri\xE8re","arka","achterzijde"];for(let r of e){let a=r.label.toLowerCase();if(a&&i.some(d=>a.includes(d))&&/\b0(\b)?/.test(a))return r.deviceId}return["Android","HarmonyOS"].includes(Nt.OS)?e[e.length-1].deviceId:null}static findBestCamera(e,n,i){return e&&e.length?n==="environment"?this.findBestRearCamera(e,i):n==="user"?null:n?void 0:null:null}static playVideo(e,n,i){return $(this,null,function*(){if(!e)throw new Error("Invalid 'videoEl'.");if(!n)throw new Error("Invalid 'source'.");return new Promise((r,a)=>$(this,null,function*(){let d,v=()=>{e.removeEventListener("loadstart",T),e.removeEventListener("abort",M),e.removeEventListener("play",O),e.removeEventListener("error",L),e.removeEventListener("loadedmetadata",H)},y=!1,C=()=>{y=!0,d&&clearTimeout(d),v(),r(e)},b=G=>{d&&clearTimeout(d),v(),a(G)},T=()=>{e.addEventListener("abort",M,{once:!0})},M=()=>{let G=new Error("Video playing was interrupted.");G.name="AbortError",b(G)},O=()=>{C()},L=()=>{b(new Error(`Video error ${e.error.code}: ${e.error.message}.`))},P,Y=new Promise(G=>{P=G}),H=()=>{P()};if(e.addEventListener("loadstart",T,{once:!0}),e.addEventListener("play",O,{once:!0}),e.addEventListener("error",L,{once:!0}),e.addEventListener("loadedmetadata",H,{once:!0}),typeof n=="string"||n instanceof String?e.src=n:e.srcObject=n,e.autoplay&&(yield new Promise(G=>{setTimeout(G,1e3)})),!y){i&&(d=setTimeout(()=>{v(),a(new Error("Failed to play video. Timeout."))},i)),yield Y;try{yield e.play(),C()}catch(G){console.warn("1st play error: "+(G?.message||G))}if(!y)try{yield e.play(),C()}catch(G){console.warn("2rd play error: "+(G?.message||G)),b(G)}}}))})}static testCameraAccess(e){return $(this,null,function*(){var n,i;if(!(!((i=(n=window?.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||i===void 0)&&i.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let r;try{r=e?yield navigator.mediaDevices.getUserMedia(e):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(a){return{ok:!1,errorName:a.name,errorMessage:a.message}}finally{r?.getTracks().forEach(a=>{a.stop()})}return{ok:!0}})}get state(){if(!N(this,Jt,"f"))return"closed";if(N(this,Jt,"f")==="pending")return"opening";if(N(this,Jt,"f")==="fulfilled")return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e?t.isStorageAvailable("localStorage")?He(this,bo,!0,"f"):(He(this,bo,!1,"f"),console.warn("Local storage is unavailable")):He(this,bo,!1,"f")}get ifSaveLastUsedCamera(){return N(this,bo,"f")}get isVideoPlaying(){return!(!N(this,Le,"f")||N(this,Le,"f").paused)&&this.state==="opened"}set tapFocusEventBoundEl(e){var n,i,r;if(!(e instanceof HTMLElement)&&e!=null)throw new TypeError("Invalid 'element'.");(n=N(this,Dr,"f"))===null||n===void 0||n.removeEventListener("click",N(this,To,"f")),(i=N(this,Dr,"f"))===null||i===void 0||i.removeEventListener("touchend",N(this,To,"f")),(r=N(this,Dr,"f"))===null||r===void 0||r.removeEventListener("touchmove",N(this,fl,"f")),He(this,Dr,e,"f"),e&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(Nt.OS)?(e.addEventListener("touchend",N(this,To,"f")),e.addEventListener("touchmove",N(this,fl,"f"))):e.addEventListener("click",N(this,To,"f")))}get tapFocusEventBoundEl(){return N(this,Dr,"f")}get disposed(){return N(this,gl,"f")}constructor(e){var n,i;we.add(this),Le.set(this,null),ze.set(this,void 0),ul.set(this,()=>{this.state==="opened"&&N(this,_t,"f").fire("resumed",null,{target:this,async:!1})}),hl.set(this,()=>{N(this,_t,"f").fire("paused",null,{target:this,async:!1})}),st.set(this,void 0),vn.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],mi.set(this,void 0),bo.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,dl.set(this,void 0),qn.set(this,!0),wi.set(this,void 0),Jt.set(this,void 0),Do.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},So.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(r,a)=>{let d,v,y=window.getComputedStyle(N(this,Le,"f")).objectFit,C=this.getResolution(),b=N(this,Le,"f").getBoundingClientRect(),T=b.left,M=b.top,{width:O,height:L}=N(this,Le,"f").getBoundingClientRect();if(O<=0||L<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let P=O/L,Y=C.width/C.height,H=1;if(y==="contain")Y>P?(H=O/C.width,d=(r-T)/H,v=(a-M-(L-O/Y)/2)/H):(H=L/C.height,v=(a-M)/H,d=(r-T-(O-L*Y)/2)/H);else{if(y!=="cover")throw new Error("Unsupported object-fit.");Y>P?(H=L/C.height,v=(a-M)/H,d=(r-T+(L*Y-O)/2)/H):(H=O/C.width,d=(r-T)/H,v=(a-M+(O/Y-L)/2)/H)}return{x:d,y:v}},$s.set(this,!1),fl.set(this,()=>{He(this,$s,!0,"f")}),To.set(this,r=>$(this,null,function*(){var a;if(N(this,$s,"f"))return void He(this,$s,!1,"f");if(!N(this,So,"f")||!this.isVideoPlaying||!N(this,ze,"f")||!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(a=this.getCameraCapabilities())===null||a===void 0?void 0:a.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let d,v;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),r instanceof MouseEvent)d=r.clientX,v=r.clientY;else{if(!(r instanceof TouchEvent))throw new Error("Unknown event type.");if(!r.changedTouches.length)return;d=r.changedTouches[0].clientX,v=r.changedTouches[0].clientY}let y=this.getResolution(),C=2*Math.round(Math.min(y.width,y.height)/this._focusParameters.defaultFocusAreaSizeRatio/2),b;try{b=this.calculateCoordInVideo(d,v)}catch{}if(b.x<0||b.x>y.width||b.y<0||b.y>y.height)return;let T={x:b.x+"px",y:b.y+"px"},M=C+"px",O=M,L;t._onLog&&(L=Date.now());try{yield N(this,we,"m",ff).call(this,T,M,O,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(P){if(t._onLog)throw t._onLog(P),P}t._onLog&&t._onLog(`Tap focus costs: ${Date.now()-L} ms`),this._focusParameters.taskBackToContinous=setTimeout(()=>{var P;t._onLog&&t._onLog("Back to continuous focus."),(P=N(this,ze,"f"))===null||P===void 0||P.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime),N(this,_t,"f").fire("tapfocus",null,{target:this,async:!1})})),Dr.set(this,null),vi.set(this,1),yi.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!N(this,Le,"f"))return;let r=N(this,vi,"f");if(r<1)throw new RangeError("Invalid scale value.");if(r===1)N(this,Le,"f").style.transform="";else{let a=window.getComputedStyle(N(this,Le,"f")).objectFit,d=N(this,Le,"f").videoWidth,v=N(this,Le,"f").videoHeight,{width:y,height:C}=N(this,Le,"f").getBoundingClientRect();if(y<=0||C<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let b=y/C,T=d/v,M=1;a==="contain"?M=b<T?y/(d/r):C/(v/r):a==="cover"&&(M=T>b?C/(d/r):y/(v/r));let O=M*(1-1/r)*(d/2-N(this,yi,"f").x),L=M*(1-1/r)*(v/2-N(this,yi,"f").y);N(this,Le,"f").style.transform=`translate(${O}px, ${L}px) scale(${r})`}},hf.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");let r=document.createElement("canvas"),a;if(r.width=this.width,r.height=this.height,this.pixelFormat===Ve.GREY){a=new Uint8ClampedArray(this.width*this.height*4);for(let v=0;v<a.length;v+=4)a[v]=this.data[v/4],a[v+1]=this.data[v/4],a[v+2]=this.data[v/4],a[v+3]=255}else a=new Uint8ClampedArray(this.data.buffer);let d=new ImageData(a,this.width,this.height);return r.getContext("2d").putImageData(d,0,0),r}),_t.set(this,void 0),df.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Sr.set(this,new Map),u_.set(this,!1),pl.set(this,()=>$(this,null,function*(){var r,a;if(document.visibilityState==="visible"){if(t._onLog&&t._onLog("document visible. video paused: "+((r=N(this,Le,"f"))===null||r===void 0?void 0:r.paused)),this.state=="opening"||this.state=="opened"){let d=!1;if(!this.isVideoPlaying){t._onLog&&t._onLog("document visible. Not auto resume. 1st resume start.");try{yield this.resume(),d=!0}catch{t._onLog&&t._onLog("document visible. 1st resume video failed, try open instead.")}d||(yield N(this,we,"m",Ao).call(this))}if(yield new Promise(v=>setTimeout(v,300)),!this.isVideoPlaying){t._onLog&&t._onLog("document visible. 1st open failed. 2rd resume start."),d=!1;try{yield this.resume(),d=!0}catch{t._onLog&&t._onLog("document visible. 2rd resume video failed, try open instead.")}d||(yield N(this,we,"m",Ao).call(this))}}}else document.visibilityState==="hidden"&&(t._onLog&&t._onLog("document hidden. video paused: "+((a=N(this,Le,"f"))===null||a===void 0?void 0:a.paused)),this.state=="opening"||this.state=="opened"&&this.isVideoPlaying&&this.pause())})),gl.set(this,!1),!((i=(n=window?.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||i===void 0)&&i.getUserMedia||setTimeout(()=>{t.onWarning&&t.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),He(this,_t,new gf,"f"),this.imageDataGetter=new uf,document.addEventListener("visibilitychange",N(this,pl,"f"))}setVideoEl(e){if(!(e&&e instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");e.addEventListener("play",N(this,ul,"f")),e.addEventListener("pause",N(this,hl,"f")),He(this,Le,e,"f")}getVideoEl(){return N(this,Le,"f")}releaseVideoEl(){var e,n;(e=N(this,Le,"f"))===null||e===void 0||e.removeEventListener("play",N(this,ul,"f")),(n=N(this,Le,"f"))===null||n===void 0||n.removeEventListener("pause",N(this,hl,"f")),He(this,Le,null,"f")}isVideoLoaded(){return!!N(this,Le,"f")&&N(this,Le,"f").readyState==4}open(){return $(this,null,function*(){if(N(this,wi,"f")&&!N(this,qn,"f")){if(N(this,Jt,"f")==="pending")return N(this,wi,"f");if(N(this,Jt,"f")==="fulfilled")return}N(this,_t,"f").fire("before:open",null,{target:this}),yield N(this,we,"m",Ao).call(this),N(this,_t,"f").fire("played",null,{target:this,async:!1}),N(this,_t,"f").fire("opened",null,{target:this,async:!1})})}close(){return $(this,null,function*(){if(this.state==="closed")return;N(this,_t,"f").fire("before:close",null,{target:this});let e=N(this,wi,"f");if(N(this,we,"m",bl).call(this),e&&N(this,Jt,"f")==="pending"){try{yield e}catch{}if(N(this,qn,"f")===!1){let n=new Error("'close()' was interrupted.");throw n.name="AbortError",n}}He(this,wi,null,"f"),He(this,Jt,null,"f"),N(this,_t,"f").fire("closed",null,{target:this,async:!1})})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");N(this,Le,"f").pause()}resume(){return $(this,null,function*(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");yield N(this,Le,"f").play()})}setCamera(e){return $(this,null,function*(){if(typeof e!="string")throw new TypeError("Invalid 'deviceId'.");if(typeof N(this,st,"f").video!="object"&&(N(this,st,"f").video={}),delete N(this,st,"f").video.facingMode,N(this,st,"f").video.deviceId={exact:e},!(this.state==="closed"||this.videoSrc||this.state==="opening"&&N(this,qn,"f"))){N(this,_t,"f").fire("before:camera:change",[],{target:this,async:!1}),yield N(this,we,"m",zs).call(this);try{this.resetSoftwareScale()}catch{}return N(this,vn,"f")}})}switchToFrontCamera(e){return $(this,null,function*(){if(typeof N(this,st,"f").video!="object"&&(N(this,st,"f").video={}),e?.resolution&&(N(this,st,"f").video.width={ideal:e.resolution.width},N(this,st,"f").video.height={ideal:e.resolution.height}),delete N(this,st,"f").video.deviceId,N(this,st,"f").video.facingMode={exact:"user"},He(this,mi,null,"f"),!(this.state==="closed"||this.videoSrc||this.state==="opening"&&N(this,qn,"f"))){N(this,_t,"f").fire("before:camera:change",[],{target:this,async:!1}),N(this,we,"m",zs).call(this);try{this.resetSoftwareScale()}catch{}return N(this,vn,"f")}})}getCamera(){var e;if(N(this,vn,"f"))return N(this,vn,"f");{let n=((e=N(this,st,"f").video)===null||e===void 0?void 0:e.deviceId)||"";if(n){n=n.exact||n.ideal||n;for(let i of this._arrCameras)if(i.deviceId===n)return JSON.parse(JSON.stringify(i))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(e){return $(this,null,function*(){var n,i;if(!(!((i=(n=window?.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||i===void 0)&&i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let r;if(e){let v=yield navigator.mediaDevices.getUserMedia({video:!0});r=(yield navigator.mediaDevices.enumerateDevices()).filter(y=>y.kind==="videoinput"),v.getTracks().forEach(y=>{y.stop()})}else r=(yield navigator.mediaDevices.enumerateDevices()).filter(v=>v.kind==="videoinput");let a=[],d=[];if(this._arrCameras)for(let v of this._arrCameras)v._checked&&d.push(v);for(let v=0;v<r.length;v++){let y,C=r[v];for(let b of d)if(C.deviceId==b.deviceId){y=b;break}y||(y={deviceId:C.deviceId,label:C.label?C.label:"camera "+v,_checked:!1}),y.deviceId&&a.push(y)}return this._arrCameras=a,t._onLog&&t._onLog(JSON.stringify(this._arrCameras)),a})}getCameras(){return $(this,null,function*(){var e,n;if(!(!((n=(e=window?.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||n===void 0)&&n.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let i=(yield navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput");return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)})}getAllCameras(){return $(this,null,function*(){return this.getCameras()})}setResolution(e,n,i){return $(this,null,function*(){if(typeof e!="number"||e<=0)throw new TypeError("Invalid 'width'.");if(typeof n!="number"||n<=0)throw new TypeError("Invalid 'height'.");if(typeof N(this,st,"f").video!="object"&&(N(this,st,"f").video={}),i?(N(this,st,"f").video.width={exact:e},N(this,st,"f").video.height={exact:n}):(N(this,st,"f").video.width={ideal:e},N(this,st,"f").video.height={ideal:n}),this.state==="closed"||this.videoSrc||this.state==="opening"&&N(this,qn,"f"))return null;N(this,_t,"f").fire("before:resolution:change",[],{target:this,async:!1}),yield N(this,we,"m",zs).call(this);try{this.resetSoftwareScale()}catch{}let r=this.getResolution();return{width:r.width,height:r.height}})}getResolution(){if(this.state==="opened"&&this.videoSrc&&N(this,Le,"f"))return{width:N(this,Le,"f").videoWidth,height:N(this,Le,"f").videoHeight};if(N(this,ze,"f")){let e=N(this,ze,"f").getSettings();return{width:e.width,height:e.height}}if(this.isVideoLoaded())return{width:N(this,Le,"f").videoWidth,height:N(this,Le,"f").videoHeight};{let e={width:0,height:0},n=N(this,st,"f").video.width||0,i=N(this,st,"f").video.height||0;return n&&(e.width=n.exact||n.ideal||n),i&&(e.height=i.exact||i.ideal||i),e}}getResolutions(e){return $(this,null,function*(){var n,i,r,a,d,v,y,C,b,T,M;if(!(!((i=(n=window?.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||i===void 0)&&i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let O="",L=(P,Y)=>{let H=N(this,Sr,"f").get(P);if(!H||!H.length)return!1;for(let G of H)if(G.width===Y.width&&G.height===Y.height)return!0;return!1};if(this._mediaStream){O=(M=N(this,vn,"f"))===null||M===void 0?void 0:M.deviceId;let P=N(this,Sr,"f").get(O);if(P&&!e)return JSON.parse(JSON.stringify(P));P=[],N(this,Sr,"f").set(O,P),He(this,Do,!0,"f");try{for(let Y of this.detectedResolutions){yield N(this,ze,"f").applyConstraints({width:{ideal:Y.width},height:{ideal:Y.height}}),N(this,we,"m",Nn).call(this);let H=N(this,ze,"f").getSettings(),G={width:H.width,height:H.height};L(O,G)||P.push({width:G.width,height:G.height})}}catch(Y){throw N(this,we,"m",bl).call(this),He(this,Do,!1,"f"),Y}try{yield N(this,we,"m",Ao).call(this)}catch(Y){if(Y.name==="AbortError")return P;throw Y}finally{He(this,Do,!1,"f")}return P}{let P=(G,W,oe)=>$(this,null,function*(){let te={video:{deviceId:{exact:G},width:{ideal:W},height:{ideal:oe}}},ie=null;try{ie=yield navigator.mediaDevices.getUserMedia(te)}catch{return null}if(!ie)return null;let ae=ie.getVideoTracks(),w=null;try{let re=ae[0].getSettings();w={width:re.width,height:re.height}}catch{let pe=document.createElement("video");pe.srcObject=ie,w={width:pe.videoWidth,height:pe.videoHeight},pe.srcObject=null}return ae.forEach(re=>{re.stop()}),w}),Y=((d=(a=(r=N(this,st,"f"))===null||r===void 0?void 0:r.video)===null||a===void 0?void 0:a.deviceId)===null||d===void 0?void 0:d.exact)||((C=(y=(v=N(this,st,"f"))===null||v===void 0?void 0:v.video)===null||y===void 0?void 0:y.deviceId)===null||C===void 0?void 0:C.ideal)||((T=(b=N(this,st,"f"))===null||b===void 0?void 0:b.video)===null||T===void 0?void 0:T.deviceId);if(!Y)return[];let H=N(this,Sr,"f").get(Y);if(H&&!e)return JSON.parse(JSON.stringify(H));H=[],N(this,Sr,"f").set(Y,H);for(let G of this.detectedResolutions){let W=yield P(Y,G.width,G.height);W&&!L(Y,W)&&H.push({width:W.width,height:W.height})}return H}})}setMediaStreamConstraints(e,n){return $(this,null,function*(){if(!(i=>{return i!==null&&(r=i,Object.prototype.toString.call(r)==="[object Object]");var r})(e))throw new TypeError("Invalid 'mediaStreamConstraints'.");He(this,st,JSON.parse(JSON.stringify(e)),"f"),He(this,mi,null,"f"),n&&N(this,we,"m",zs).call(this)})}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(N(this,st,"f")))}resetMediaStreamConstraints(){He(this,st,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");return N(this,ze,"f").getCapabilities?N(this,ze,"f").getCapabilities():{}}getCameraSettings(){if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");return N(this,ze,"f").getSettings()}turnOnTorch(){return $(this,null,function*(){if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");let e=this.getCameraCapabilities();if(!e?.torch)throw Error("Not supported.");yield N(this,ze,"f").applyConstraints({advanced:[{torch:!0}]})})}turnOffTorch(){return $(this,null,function*(){if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");let e=this.getCameraCapabilities();if(!e?.torch)throw Error("Not supported.");yield N(this,ze,"f").applyConstraints({advanced:[{torch:!1}]})})}setColorTemperature(e,n){return $(this,null,function*(){var i;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");let r=(i=this.getCameraCapabilities())===null||i===void 0?void 0:i.colorTemperature;if(!r)throw Error("Not supported.");return n&&(e<r.min?e=r.min:e>r.max&&(e=r.max),e=Ht(e,r.min,r.step,r.max)),yield N(this,ze,"f").applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]}),e})}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(e,n){return $(this,null,function*(){var i;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");let r=(i=this.getCameraCapabilities())===null||i===void 0?void 0:i.exposureCompensation;if(!r)throw Error("Not supported.");return n&&(e<r.min?e=r.min:e>r.max&&(e=r.max),e=Ht(e,r.min,r.step,r.max)),yield N(this,ze,"f").applyConstraints({advanced:[{exposureCompensation:e}]}),e})}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(e,n){return $(this,null,function*(){var i;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");let r=(i=this.getCameraCapabilities())===null||i===void 0?void 0:i.frameRate;if(!r)throw Error("Not supported.");n&&(e<r.min?e=r.min:e>r.max&&(e=r.max));let a=this.getResolution();return yield N(this,ze,"f").applyConstraints({width:{ideal:Math.max(a.width,a.height)},frameRate:e}),e})}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(e,n){return $(this,null,function*(){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");let i=this.getCameraCapabilities(),r=i?.focusMode,a=i?.focusDistance;if(!r)throw Error("Not supported.");if(typeof e.mode!="string")throw TypeError("Invalid 'mode'.");let d=e.mode.toLowerCase();if(!r.includes(d))throw Error("Unsupported focus mode.");if(d==="manual"){if(!a)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let v=e.distance;n&&(v<a.min?v=a.min:v>a.max&&(v=a.max),v=Ht(v,a.min,a.step,a.max)),this._focusParameters.focusArea=null,yield N(this,ze,"f").applyConstraints({advanced:[{focusMode:d,focusDistance:v}]})}else{if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{let v=e.area.centerPoint,y=e.area.width,C=e.area.height;if(!y||!C){let b=this.getResolution();y||(y=2*Math.round(Math.min(b.width,b.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),C||(C=2*Math.round(Math.min(b.width,b.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:v.x,y:v.y},width:y,height:C},yield N(this,we,"m",ff).call(this,v,y,C)}}}else this._focusParameters.focusArea=null,yield N(this,ze,"f").applyConstraints({advanced:[{focusMode:d}]})})}getFocus(){let e=this.getCameraSettings(),n=e.focusMode;return n?n==="manual"?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:n}:null}enableTapToFocus(){return $(this,null,function*(){He(this,So,!0,"f")})}disableTapToFocus(){He(this,So,!1,"f")}isTapToFocusEnabled(){return N(this,So,"f")}setZoom(e){return $(this,null,function*(){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid 'factor'.");if(this.state!=="opened")throw new Error("Video is not playing.");e.centerPoint?N(this,we,"m",pf).call(this,e.centerPoint):this.resetScaleCenter();try{if(N(this,we,"m",h_).call(this,N(this,yi,"f"))){let n=yield this.setHardwareScale(e.factor,!0),i=this.getHardwareScale();i==1&&n!=1&&(i=n),e.factor>i?this.setSoftwareScale(e.factor/i):this.setSoftwareScale(1)}else yield this.setHardwareScale(1),this.setSoftwareScale(e.factor)}catch(n){let i=n.message||n;if(i!=="Not supported."&&i!=="Camera is not open.")throw n;this.setSoftwareScale(e.factor)}})}getZoom(){if(this.state!=="opened")throw new Error("Video is not playing.");let e=1;try{e=this.getHardwareScale()}catch(n){if((n.message||n)!=="Camera is not open.")throw n}return{factor:e*N(this,vi,"f")}}resetZoom(){return $(this,null,function*(){yield this.setZoom({factor:1})})}setHardwareScale(e,n){return $(this,null,function*(){var i;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(!N(this,ze,"f")||this.state!=="opened")throw new Error("Camera is not open.");let r=(i=this.getCameraCapabilities())===null||i===void 0?void 0:i.zoom;if(!r)throw Error("Not supported.");return n&&(e<r.min?e=r.min:e>r.max&&(e=r.max),e=Ht(e,r.min,r.step,r.max)),yield N(this,ze,"f").applyConstraints({advanced:[{zoom:e}]}),e})}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(e,n){if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(this.state!=="opened")throw new Error("Video is not playing.");n&&N(this,we,"m",pf).call(this,n),He(this,vi,e,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return N(this,vi,"f")}resetScaleCenter(){if(this.state!=="opened")throw new Error("Video is not playing.");let e=this.getResolution();He(this,yi,{x:e.width/2,y:e.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||N(this,Do,"f"))return null;let n=Date.now();t._onLog&&t._onLog("getFrameData() START: "+n);let i=N(this,Le,"f").videoWidth,r=N(this,Le,"f").videoHeight,a={sx:0,sy:0,sWidth:i,sHeight:r,dWidth:i,dHeight:r};e?.position&&(a=JSON.parse(JSON.stringify(e.position)));let d=Ve.RGBA;e?.pixelFormat&&(d=e.pixelFormat);let v=N(this,vi,"f");e?.scale&&(v=e.scale);let y=N(this,yi,"f");if(e?.scaleCenter){if(typeof e.scaleCenter.x!="string"||typeof e.scaleCenter.y!="string")throw new Error("Invalid scale center.");let M=0,O=0;if(e.scaleCenter.x.endsWith("px"))M=parseFloat(e.scaleCenter.x);else{if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");M=parseFloat(e.scaleCenter.x)/100*i}if(e.scaleCenter.y.endsWith("px"))O=parseFloat(e.scaleCenter.y);else{if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");O=parseFloat(e.scaleCenter.y)/100*r}if(isNaN(M)||isNaN(O))throw new Error("Invalid scale center.");y.x=Math.round(M),y.y=Math.round(O)}let C=null;if(e?.bufferContainer&&(C=e.bufferContainer),i==0||r==0)return null;v!==1&&(a.sWidth=Math.round(a.sWidth/v),a.sHeight=Math.round(a.sHeight/v),a.sx=Math.round((1-1/v)*y.x+a.sx/v),a.sy=Math.round((1-1/v)*y.y+a.sy/v));let b=this.imageDataGetter.getImageData(N(this,Le,"f"),a,{pixelFormat:d,bufferContainer:C});if(!b)return null;let T=Date.now();return t._onLog&&t._onLog("getFrameData() END: "+T),{data:b.data,width:b.width,height:b.height,pixelFormat:b.pixelFormat,timeSpent:T-n,timeStamp:T,toCanvas:N(this,hf,"f")}}on(e,n){if(!N(this,df,"f").includes(e.toLowerCase()))throw new Error(`Event '${e}' does not exist.`);N(this,_t,"f").on(e,n)}off(e,n){N(this,_t,"f").off(e,n)}dispose(){return $(this,null,function*(){this.tapFocusEventBoundEl=null,yield this.close(),this.releaseVideoEl(),N(this,_t,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",N(this,pl,"f")),He(this,gl,!0,"f")})}},Zs,Dl,Mo,xr,Sl,xo,Jy,d_,qt,Ys,Xs,mf,vf,Be,yf,_f,qs,pi,ml,vl,yl,Ks,Zt,_l,gi,en,lt,Ce,Yn,wl,et,f_,p_,wf,Cf;Le=new WeakMap,ze=new WeakMap,ul=new WeakMap,hl=new WeakMap,st=new WeakMap,vn=new WeakMap,mi=new WeakMap,bo=new WeakMap,dl=new WeakMap,qn=new WeakMap,wi=new WeakMap,Jt=new WeakMap,Do=new WeakMap,So=new WeakMap,$s=new WeakMap,fl=new WeakMap,To=new WeakMap,Dr=new WeakMap,vi=new WeakMap,yi=new WeakMap,hf=new WeakMap,_t=new WeakMap,df=new WeakMap,Sr=new WeakMap,u_=new WeakMap,pl=new WeakMap,gl=new WeakMap,we=new WeakSet,Qy=function(){return $(this,null,function*(){let t=this.getMediaStreamConstraints();if(typeof t.video=="boolean"&&(t.video={}),!t.video.deviceId){if(N(this,mi,"f"))delete t.video.facingMode,t.video.deviceId={exact:N(this,mi,"f")};else if(this.ifSaveLastUsedCamera&&gt.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};let e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),n=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&n&&(t.video.width=e,t.video.height=n)}else if(!this.ifSkipCameraInspection){let e=r=>$(this,null,function*(){let a=null;return r==="environment"&&["Android","HarmonyOS","iPhone","iPad"].includes(Nt.OS)?(yield this._getCameras(!1),N(this,we,"m",Nn).call(this),a=gt.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):r||["Android","HarmonyOS","iPhone","iPad"].includes(Nt.OS)||(yield this._getCameras(!1),N(this,we,"m",Nn).call(this),a=gt.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),a}),n=t.video.facingMode;n instanceof Array&&n.length&&(n=n[0]),typeof n=="object"&&(n=n.exact||n.ideal);let i=yield e(n);i&&(delete t.video.facingMode,t.video.deviceId={exact:i})}}return t})},Nn=function(){if(N(this,qn,"f")){let t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},Yd=function(t){return $(this,null,function*(){var e,n;if(!(!((n=(e=window?.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||n===void 0)&&n.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let i;try{gt._onLog&&gt._onLog("======try getUserMedia========");let r=[0,500,1e3,2e3],a=null,d=v=>$(this,null,function*(){for(let y of r){y&&(yield new Promise(C=>setTimeout(C,y)),N(this,we,"m",Nn).call(this));try{gt._onLog&&gt._onLog("ask "+JSON.stringify(v)),i=yield navigator.mediaDevices.getUserMedia(v),N(this,we,"m",Nn).call(this);break}catch(C){if(C.name==="NotFoundError"||C.name==="NotAllowedError"||C.name==="AbortError"||C.name==="OverconstrainedError")throw C;a=C,gt._onLog&&gt._onLog(C.message||C)}}});if(yield d(t),i||typeof t.video!="object"||(t.video.deviceId&&(delete t.video.deviceId,yield d(t)),!i&&t.video.facingMode&&(delete t.video.facingMode,yield d(t)),i||!t.video.width&&!t.video.height||(delete t.video.width,delete t.video.height,yield d(t))),!i)throw a;return i}catch(r){throw i?.getTracks().forEach(a=>{a.stop()}),r.name==="NotFoundError"&&(DOMException?r=new DOMException("No camera available, please use a device with an accessible camera.",r.name):(r=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),r}})},Xd=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(t=>{t.stop()}),this._mediaStream=null),He(this,ze,null,"f")},Ao=function(){return $(this,null,function*(){He(this,qn,!1,"f");let t=He(this,dl,Symbol(),"f");if(N(this,wi,"f")&&N(this,Jt,"f")==="pending"){try{yield N(this,wi,"f")}catch{}N(this,we,"m",Nn).call(this)}return t!==N(this,dl,"f")?void 0:He(this,wi,$(this,null,function*(){He(this,Jt,"pending","f");try{if(this.videoSrc){if(!N(this,Le,"f"))throw new Error("'videoEl' should be set.");yield gt.playVideo(N(this,Le,"f"),this.videoSrc,this.cameraOpenTimeout),N(this,we,"m",Nn).call(this)}else{let n=yield N(this,we,"m",Qy).call(this);N(this,we,"m",Xd).call(this);let i=yield N(this,we,"m",Yd).call(this,n);yield this._getCameras(!1),N(this,we,"m",Nn).call(this);let r=()=>{let y=i.getVideoTracks(),C,b;if(y.length&&(C=y[0]),C){let T=C.getSettings();if(T){for(let M of this._arrCameras)if(T.deviceId===M.deviceId){M._checked=!0,M.label=C.label,b=M;break}}}return b},a=N(this,st,"f");if(typeof a.video=="object"){let y=a.video.facingMode;if(y instanceof Array&&y.length&&(y=y[0]),typeof y=="object"&&(y=y.exact||y.ideal),!(N(this,mi,"f")||this.ifSaveLastUsedCamera&&gt.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||a.video.deviceId)){let C=r(),b=gt.findBestCamera(this._arrCameras,y,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});b&&b!=C?.deviceId&&(i.getTracks().forEach(T=>{T.stop()}),n.video.deviceId={exact:b},i=yield N(this,we,"m",Yd).call(this,n),N(this,we,"m",Nn).call(this))}}let d=r();d?.deviceId&&(He(this,mi,d&&d.deviceId,"f"),this.ifSaveLastUsedCamera&&gt.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",N(this,mi,"f")),typeof n.video=="object"&&n.video.width&&n.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(n.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(n.video.height))))),N(this,Le,"f")&&(yield gt.playVideo(N(this,Le,"f"),i,this.cameraOpenTimeout),N(this,we,"m",Nn).call(this)),this._mediaStream=i;let v=i.getVideoTracks();v?.length&&He(this,ze,v[0],"f"),He(this,vn,d,"f")}}catch(n){throw N(this,we,"m",bl).call(this),He(this,Jt,null,"f"),n}He(this,Jt,"fulfilled","f")}),"f")})},zs=function(){return $(this,null,function*(){var t;if(this.state==="closed"||this.videoSrc)return;let e=(t=N(this,vn,"f"))===null||t===void 0?void 0:t.deviceId,n=this.getResolution();yield N(this,we,"m",Ao).call(this);let i=this.getResolution();e&&e!==N(this,vn,"f").deviceId&&N(this,_t,"f").fire("camera:changed",[N(this,vn,"f").deviceId,e],{target:this,async:!1}),n.width==i.width&&n.height==i.height||N(this,_t,"f").fire("resolution:changed",[{width:i.width,height:i.height},{width:n.width,height:n.height}],{target:this,async:!1}),N(this,_t,"f").fire("played",null,{target:this,async:!1})})},bl=function(){N(this,we,"m",Xd).call(this),He(this,vn,null,"f"),N(this,Le,"f")&&(N(this,Le,"f").srcObject=null,this.videoSrc&&(N(this,Le,"f").pause(),N(this,Le,"f").currentTime=0)),He(this,qn,!0,"f");try{this.resetSoftwareScale()}catch{}},Yt=function t(e,n){return $(this,null,function*(){let i=P=>{if(!N(this,ze,"f")||!this.isVideoPlaying||P.focusTaskId!=this._focusParameters.curFocusTaskId){N(this,ze,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);let Y=new Error(`Focus task ${P.focusTaskId} canceled.`);throw Y.name="DeprecatedTaskError",Y}this._focusParameters.isDoingFocus===1&&Date.now()-P.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)},r;n=Ht(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield N(this,ze,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]}),i(e),r=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/n),Math.abs(1/this._focusParameters.fds.max-1/n))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/n)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=n,yield new Promise(P=>{setTimeout(P,r)}),i(e);let a=e.focusL-e.focusW/2,d=e.focusT-e.focusH/2,v=e.focusW,y=e.focusH,C=this.getResolution();a=Math.round(a),d=Math.round(d),v=Math.round(v),y=Math.round(y),v>C.width&&(v=C.width),y>C.height&&(y=C.height),a<0?a=0:a+v>C.width&&(a=C.width-v),d<0?d=0:d+y>C.height&&(d=C.height-y);let b=4*C.width*C.height*this._focusParameters.defaultTempBufferContainerLenRatio,T=4*v*y,M=this._focusParameters.tempBufferContainer;if(M){let P=M.length;b>P&&b>=T?M=new Uint8Array(b):T>P&&T>=b&&(M=new Uint8Array(T))}else M=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(b,T));if(!this.imageDataGetter.getImageData(N(this,Le,"f"),{sx:a,sy:d,sWidth:v,sHeight:y,dWidth:v,dHeight:y},{pixelFormat:Ve.RGBA,bufferContainer:M}))return N(this,we,"m",t).call(this,e,n);let O=M,L=0;for(let P=0,Y=T-8;P<Y;++P){let H=O[P]-O[P+8];++P;let G=O[P]-O[P+8];++P;let W=O[P]-O[P+8];++P,L+=H*H+G*G+W*W}return-L})},vo=function t(e,n,i,r,a,d,v){return $(this,null,function*(){let y;if(n=Ht(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=Ht(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),d?d=Ht(d,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(d=Ht(Math.sqrt((n||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),v=yield N(this,we,"m",Yt).call(this,e,d)),v<=i&&v<=a?y=3:i<a&&i<v?y=1:a<i&&a<v&&(y=2),(r-n)/2<=this._focusParameters.fds.step)return y===3||(y===1?yield N(this,ze,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]}):y===2&&(yield N(this,ze,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}))),!0;if(y===1)return yield N(this,we,"m",t).call(this,e,n,i,d,v);if(y===2)return yield N(this,we,"m",t).call(this,e,d,v,r,a);if(y!==3)return i=yield N(this,we,"m",Yt).call(this,e,n),a=yield N(this,we,"m",Yt).call(this,e,r),yield N(this,we,"m",t).call(this,e,n,i,r,a);let C=Ht(Math.sqrt((n||this._focusParameters.fds.step)*(d||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),b=Ht(Math.sqrt((r||this._focusParameters.fds.step)*(d||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/C)<=Math.abs(1/this._focusParameters.oldDistance-1/b)){let T=yield N(this,we,"m",Yt).call(this,e,C);if(T<v)return yield N(this,we,"m",t).call(this,e,n,i,d,v,C,T);if(T==v)return yield N(this,we,"m",t).call(this,e,C,T,d,v);let M=yield N(this,we,"m",Yt).call(this,e,b);if(T>v&&v<M)return yield N(this,we,"m",t).call(this,e,C,T,b,M,d,v);if(v==M)return yield N(this,we,"m",t).call(this,e,d,v,b,M);if(v>M)return yield N(this,we,"m",t).call(this,e,d,v,r,a,b,M)}else{let T=yield N(this,we,"m",Yt).call(this,e,b);if(v>T)return yield N(this,we,"m",t).call(this,e,d,v,r,a,b,T);if(v==T)return yield N(this,we,"m",t).call(this,e,d,v,b,T);let M=yield N(this,we,"m",Yt).call(this,e,C);if(M>v&&v<T)return yield N(this,we,"m",t).call(this,e,C,M,b,T,d,v);if(M==v)return yield N(this,we,"m",t).call(this,e,C,M,d,v);if(M<v)return yield N(this,we,"m",t).call(this,e,n,i,d,v,C,M)}return!1})},ff=function(t,e,n,i,r){return $(this,null,function*(){var a;if(this._focusParameters.isDoingFocus==1)return!1;if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'centerPoint'.");if(!e||typeof e!="string")throw new Error("Invalid 'width'.");if(!n||typeof n!="string")throw new Error("Invalid 'height'.");let d=this.getResolution(),v=0,y=0;if(t.x.endsWith("px"))v=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");v=parseFloat(t.x)/100*d.width}if(t.y.endsWith("px"))y=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");y=parseFloat(t.y)/100*d.height}if(isNaN(v)||isNaN(y)||v<0||v>d.width||y<0||y>d.height)throw new Error("Invalid 'centerPoint'.");let C=0;if(e.endsWith("px"))C=parseFloat(e);else{if(!e.endsWith("%"))throw new Error("Invalid 'width'.");C=parseFloat(e)/100*d.width}if(isNaN(C)||C<0)throw new Error("Invalid 'width'.");let b=0;if(n.endsWith("px"))b=parseFloat(n);else{if(!n.endsWith("%"))throw new Error("Invalid 'height'.");b=parseFloat(n)/100*d.height}if(isNaN(b)||b<0)throw new Error("Invalid 'height'.");if(N(this,vi,"f")!==1){let O=N(this,vi,"f"),L=N(this,yi,"f");C/=O,b/=O,v=(1-1/O)*L.x+v/O,y=(1-1/O)*L.y+y/O}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(a=this.getCameraCapabilities())===null||a===void 0?void 0:a.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;let T={focusL:v,focusT:y,focusW:C,focusH:b,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},M=(O,L,P)=>$(this,null,function*(){try{(L==null||L<this._focusParameters.fds.min)&&(L=this._focusParameters.fds.min),(P==null||P>this._focusParameters.fds.max)&&(P=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let Y=Ht(Math.sqrt(P*(L||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),H=Ht(Math.sqrt((L||this._focusParameters.fds.step)*Y),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),G=Ht(Math.sqrt(Y*P),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),W=yield N(this,we,"m",Yt).call(this,O,G),oe=yield N(this,we,"m",Yt).call(this,O,H),te=yield N(this,we,"m",Yt).call(this,O,Y);if(oe>te&&te<W){let ie=yield N(this,we,"m",vo).call(this,O,H,oe,G,W,Y,te);return this._focusParameters.isDoingFocus=0,ie}if(oe<te&&oe<W){let ie=yield N(this,we,"m",Yt).call(this,O,L),ae=yield N(this,we,"m",vo).call(this,O,L,ie,Y,te,H,oe);return this._focusParameters.isDoingFocus=0,ae}if(te>W&&oe>W){let ie=yield N(this,we,"m",Yt).call(this,O,P),ae=yield N(this,we,"m",vo).call(this,O,Y,te,P,ie,G,W);return this._focusParameters.isDoingFocus=0,ae}if(oe==te&&te<W){let ie=yield N(this,we,"m",vo).call(this,O,H,oe,Y,te);return this._focusParameters.isDoingFocus=0,ie}if(te==W&&oe>te){let ie=yield N(this,we,"m",vo).call(this,O,Y,te,G,W);return this._focusParameters.isDoingFocus=0,ie}return M(O,L,P)}catch(Y){if(Y.name!=="DeprecatedTaskError")throw Y}});return M(T,i,r)})},pf=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'center'.");let e=this.getResolution(),n=0,i=0;if(t.x.endsWith("px"))n=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(t.x)/100*e.width}if(t.y.endsWith("px"))i=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(t.y)/100*e.height}if(isNaN(n)||isNaN(i))throw new Error("Invalid scale center.");He(this,yi,{x:n,y:i},"f")},h_=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");let e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},gt.browserInfo=Nt,gt.onWarning=(zd=window?.console)===null||zd===void 0?void 0:zd.warn;var Lo=class t{constructor(e){Zs.add(this),Dl.set(this,void 0),Mo.set(this,0),xr.set(this,void 0),Sl.set(this,0),xo.set(this,!1),Se(this,Dl,e,"f")}startCharging(){A(this,xo,"f")||(t._onLog&&t._onLog("start charging."),A(this,Zs,"m",d_).call(this),Se(this,xo,!0,"f"))}stopCharging(){A(this,xr,"f")&&clearTimeout(A(this,xr,"f")),A(this,xo,"f")&&(t._onLog&&t._onLog("stop charging."),Se(this,Mo,Date.now()-A(this,Sl,"f"),"f"),Se(this,xo,!1,"f"))}};Dl=new WeakMap,Mo=new WeakMap,xr=new WeakMap,Sl=new WeakMap,xo=new WeakMap,Zs=new WeakSet,Jy=function(){be.cfd(1),Lo._onLog&&Lo._onLog("charge 1.")},d_=function t(){A(this,Mo,"f")==0&&A(this,Zs,"m",Jy).call(this),Se(this,Sl,Date.now(),"f"),A(this,xr,"f")&&clearTimeout(A(this,xr,"f")),Se(this,xr,setTimeout(()=>{Se(this,Mo,0,"f"),A(this,Zs,"m",t).call(this)},A(this,Dl,"f")-A(this,Mo,"f")),"f")};var bt=class t{static beep(){if(!this.allowBeep||!this.beepSoundSource)return;let e,n=Date.now();if(!(n-A(this,qt,"f",mf)<100)){if(Se(this,qt,n,"f",mf),A(this,qt,"f",Ys).size&&(e=A(this,qt,"f",Ys).values().next().value,this.beepSoundSource==e.src?(A(this,qt,"f",Ys).delete(e),e.play()):e=null),!e)if(A(this,qt,"f",Xs).size<16){e=new Audio(this.beepSoundSource);let i=null,r=()=>{e.removeEventListener("loadedmetadata",r),e.play(),i=setTimeout(()=>{A(this,qt,"f",Xs).delete(e)},2e3*e.duration)};e.addEventListener("loadedmetadata",r),e.addEventListener("ended",()=>{i!=null&&(clearTimeout(i),i=null),e.pause(),e.currentTime=0,A(this,qt,"f",Xs).delete(e),A(this,qt,"f",Ys).add(e)})}else A(this,qt,"f",vf)||(Se(this,qt,!0,"f",vf),console.warn("The requested audio tracks exceed 16 and will not be played."));e&&A(this,qt,"f",Xs).add(e)}}static vibrate(){if(this.allowVibrate){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(t.vibrateDuration)}}};qt=bt,Ys={value:new Set},Xs={value:new Set},mf={value:0},vf={value:!1},bt.allowBeep=!0,bt.beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",bt.allowVibrate=!0,bt.vibrateDuration=300;var e_=new Map([[Ve.GREY,De.IPF_GRAYSCALED],[Ve.RGBA,De.IPF_ABGR_8888]]),qd=typeof BigInt=="function"?{BF_NULL:BigInt(0),BF_ALL:BigInt(18446744073709552e3),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"},Qt=class t extends ho{static set _onLog(e){Se(t,yf,e,"f",_f),gt._onLog=e,Lo._onLog=e}static get _onLog(){return A(t,yf,"f",_f)}static detectEnvironment(){return $(this,null,function*(){return yield $(this,null,function*(){return{wasm:Qb,worker:Jb,getUserMedia:t_,camera:yield eD(),browser:Dt.browser,version:Dt.version,OS:Dt.OS}})})}static testCameraAccess(){return $(this,null,function*(){let e=yield gt.testCameraAccess();return e.ok?{ok:!0,message:"Successfully accessed the camera."}:e.errorName==="InsecureContext"?{ok:!1,message:"Insecure context."}:e.errorName==="OverconstrainedError"||e.errorName==="NotFoundError"?{ok:!1,message:"No camera detected."}:e.errorName==="NotAllowedError"?{ok:!1,message:"No permission to access camera."}:e.errorName==="AbortError"?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:e.errorName==="NotReadableError"?{ok:!1,message:"A hardware error occurred."}:e.errorName==="SecurityError"?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:e.errorMessage}})}static createInstance(e){return $(this,null,function*(){var n,i;if(e&&!(e instanceof Ci))throw new TypeError("Invalid view.");if(!((n=ht.license)===null||n===void 0)&&n.LicenseManager){if(!(!((i=ht.license)===null||i===void 0)&&i.LicenseManager.bCallInitLicense))throw new Error("License is not set.");yield be.loadWasm(["license"]),yield ht.license.dynamsoft()}let r=new t(e);return t.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{t.onWarning&&t.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{t.onWarning&&t.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),r})}get video(){return this.cameraManager.getVideoEl()}set videoSrc(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraView&&(this.cameraView._hideDefaultSelection=!0),this.cameraManager.videoSrc=e}get videoSrc(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.videoSrc}set ifSaveLastUsedCamera(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSaveLastUsedCamera=e}get ifSaveLastUsedCamera(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSkipCameraInspection=e}get ifSkipCameraInspection(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.ifSkipCameraInspection}set cameraOpenTimeout(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.cameraOpenTimeout=e}get cameraOpenTimeout(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.cameraOpenTimeout}set singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Se(this,ml,e,"f")}get singleFrameMode(){return A(this,ml,"f")}get _isFetchingStarted(){return A(this,gi,"f")}get disposed(){return A(this,wl,"f")}constructor(e){if(super(),Be.add(this),qs.set(this,"closed"),pi.set(this,void 0),this.isTorchOn=void 0,ml.set(this,void 0),this._onCameraSelChange=()=>$(this,null,function*(){this.isOpen()&&this.cameraView&&!this.cameraView.disposed&&(yield this.selectCamera(this.cameraView._selCam.value))}),this._onResolutionSelChange=()=>$(this,null,function*(){if(!this.isOpen()||!this.cameraView||this.cameraView.disposed)return;let n,i;if(this.cameraView._selRsl&&this.cameraView._selRsl.selectedIndex!=-1){let r=this.cameraView._selRsl.options[this.cameraView._selRsl.selectedIndex];n=parseInt(r.getAttribute("data-width")),i=parseInt(r.getAttribute("data-height"))}yield this.setResolution({width:n,height:i})}),this._onCloseBtnClick=()=>$(this,null,function*(){this.isOpen()&&this.cameraView&&!this.cameraView.disposed&&this.close()}),vl.set(this,(n,i,r,a)=>{let d=Date.now(),v={sx:a.x,sy:a.y,sWidth:a.width,sHeight:a.height,dWidth:a.width,dHeight:a.height},y=Math.max(v.dWidth,v.dHeight);if(this.canvasSizeLimit&&y>this.canvasSizeLimit){let T=this.canvasSizeLimit/y;v.dWidth>v.dHeight?(v.dWidth=this.canvasSizeLimit,v.dHeight=Math.round(v.dHeight*T)):(v.dWidth=Math.round(v.dWidth*T),v.dHeight=this.canvasSizeLimit)}let C=this.cameraManager.imageDataGetter.getImageData(n,v,{pixelFormat:this.getPixelFormat()===De.IPF_GRAYSCALED?Ve.GREY:Ve.RGBA}),b=null;if(C){let T=Date.now(),M;C.pixelFormat===Ve.GREY?M=C.width:M=4*C.width;let O=!0;v.sx===0&&v.sy===0&&v.sWidth===i&&v.sHeight===r&&(O=!1),b={bytes:C.data,width:C.width,height:C.height,stride:M,format:e_.get(C.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:Is.ITT_FILE_IMAGE,isCropped:O,cropRegion:{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height,isMeasuredInPercentage:!1},originalWidth:i,originalHeight:r,currentWidth:C.width,currentHeight:C.height,timeSpent:T-d,timeStamp:T},toCanvas:A(this,yl,"f"),isDCEFrame:!0}}return b}),this._onSingleFrameAcquired=n=>{let i;i=this.cameraView?this.cameraView.getConvertedRegion():Ro.convert(A(this,Zt,"f"),n.width,n.height),i||(i={x:0,y:0,width:n.width,height:n.height});let r=A(this,vl,"f").call(this,n,n.width,n.height,i);A(this,pi,"f").fire("singleFrameAcquired",[r],{async:!1,copy:!1})},yl.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");let n=document.createElement("canvas"),i;if(n.width=this.width,n.height=this.height,this.format===De.IPF_GRAYSCALED){i=new Uint8ClampedArray(this.width*this.height*4);for(let r=0;r<i.length;r+=4)i[r]=this.bytes[r/4],i[r+1]=this.bytes[r/4],i[r+2]=this.bytes[r/4],i[r+3]=255}else i=new Uint8ClampedArray(this.bytes.buffer);return n.getContext("2d").putImageData(new ImageData(i,this.width,this.height),0,0),n}),Ks.set(this,void 0),Zt.set(this,void 0),_l.set(this,De.IPF_ABGR_8888),gi.set(this,!1),this._imageId=-1,en.set(this,void 0),this.fetchInterval=0,lt.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),Ce.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),Yn.set(this,void 0),wl.set(this,!1),this.isCameraEnhancer=!0,this._taskid4AutoTorch=null,this._delay4AutoTorch=250,this.grayThreshold4AutoTorch=20,this.maxDarkCount4AutoTroch=3,e&&!(e instanceof Ci))throw new TypeError("Invalid view.");Se(this,pi,new Il,"f"),this.cameraManager=new gt,this._imageDataGetter=this.cameraManager.imageDataGetter,this.cameraManager.updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;let n=this.cameraManager.getSoftwareScale();if(n<1)throw new RangeError("Invalid scale value.");this.cameraView&&!this.cameraView.disposed?(this.video.style.transform=n===1?"":`scale(${n})`,this.cameraView._updateVideoContainer()):this.video.style.transform=n===1?"":`scale(${n})`},["iPhone","iPad","Android","HarmonyOS"].includes(Dt.OS)?this.cameraManager.setResolution(1280,720):this.cameraManager.setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",e&&(this.setCameraView(e),e.cameraEnhancer=this),this._on("before:camera:change",()=>{A(this,Yn,"f").stopCharging();let n=this.cameraView;n&&!n.disposed&&(n._startLoading(),n.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{let n=this.cameraView;n&&!n.disposed&&(n._startLoading(),n.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),e.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{A(this,Yn,"f").stopCharging();let n=this.cameraView;n&&n.disposed}),this._on("resumed",()=>{let n=this.cameraView;n&&n.disposed}),this._on("tapfocus",()=>{A(this,lt,"f").tapToFocus&&A(this,Yn,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=(n,i)=>$(this,null,function*(){var r,a,d,v;if(A(this,Be,"m",et).call(this)||!this.isOpen()||this.isPaused())return;let y=n.intermediateResultUnits;t._onLog&&(t._onLog("intermediateResultUnits:"),t._onLog(y));let C=!1,b=!1;for(let T of y){if(T.unitType===fo.IRUT_DECODED_BARCODES&&T.decodedBarcodes.length){C=!0;break}T.unitType===fo.IRUT_LOCALIZED_BARCODES&&T.localizedBarcodes.length&&(b=!0)}if(t._onLog&&(t._onLog("hasLocalizedBarcodes:"),t._onLog(b)),A(this,lt,"f").autoZoom||A(this,lt,"f").enhancedFocus)if(C)A(this,Ce,"f").autoZoomInFrameArray.length=0,A(this,Ce,"f").autoZoomOutFrameCount=0,A(this,Ce,"f").frameArrayInIdealZoom.length=0,A(this,Ce,"f").autoFocusFrameArray.length=0;else{let T=O=>$(this,null,function*(){yield this.setZoom(O),A(this,lt,"f").autoZoom&&A(this,Yn,"f").startCharging()}),M=O=>$(this,null,function*(){yield this.setFocus(O),A(this,lt,"f").enhancedFocus&&A(this,Yn,"f").startCharging()});if(b){let O=y[0].originalImageTag,L=((r=O.cropRegion)===null||r===void 0?void 0:r.left)||0,P=((a=O.cropRegion)===null||a===void 0?void 0:a.top)||0,Y=!((d=O.cropRegion)===null||d===void 0)&&d.right?O.cropRegion.right-L:O.originalWidth,H=!((v=O.cropRegion)===null||v===void 0)&&v.bottom?O.cropRegion.bottom-P:O.originalHeight,G=O.currentWidth,W=O.currentHeight,oe;{let te,ie,ae,w,re;{let l=this.video.videoWidth*(1-A(this,Ce,"f").autoZoomDetectionArea)/2,c=this.video.videoWidth*(1+A(this,Ce,"f").autoZoomDetectionArea)/2,u=c,f=l,o=this.video.videoHeight*(1-A(this,Ce,"f").autoZoomDetectionArea)/2,s=o,h=this.video.videoHeight*(1+A(this,Ce,"f").autoZoomDetectionArea)/2;re=[{x:l,y:o},{x:c,y:s},{x:u,y:h},{x:f,y:h}]}t._onLog&&(t._onLog("detectionArea:"),t._onLog(re));let pe=[];{let l=(c,u)=>{let f=(s,h)=>{if(!s&&!h)throw new Error("Invalid arguments.");return function(m,p,g){let _=!1,E=m.length;if(E<=2)return!1;for(let I=0;I<E;I++){let S=m[I],D=m[(I+1)%E];if(oD(S,D,{x:p,y:g}))return!0;Wd(S.y-g)>0!=Wd(D.y-g)>0&&Wd(p-(g-S.y)*(S.x-D.x)/(S.y-D.y)-S.x)<0&&(_=!_)}return _}(h,s.x,s.y)},o=(s,h)=>!!(Zc([s[0],s[1]],[s[2],s[3]],[h[0].x,h[0].y],[h[1].x,h[1].y])||Zc([s[0],s[1]],[s[2],s[3]],[h[1].x,h[1].y],[h[2].x,h[2].y])||Zc([s[0],s[1]],[s[2],s[3]],[h[2].x,h[2].y],[h[3].x,h[3].y])||Zc([s[0],s[1]],[s[2],s[3]],[h[3].x,h[3].y],[h[0].x,h[0].y]));return!!(f({x:c[0].x,y:c[0].y},u)||f({x:c[1].x,y:c[1].y},u)||f({x:c[2].x,y:c[2].y},u)||f({x:c[3].x,y:c[3].y},u))||!!(f({x:u[0].x,y:u[0].y},c)||f({x:u[1].x,y:u[1].y},c)||f({x:u[2].x,y:u[2].y},c)||f({x:u[3].x,y:u[3].y},c))||!!(o([u[0].x,u[0].y,u[1].x,u[1].y],c)||o([u[1].x,u[1].y,u[2].x,u[2].y],c)||o([u[2].x,u[2].y,u[3].x,u[3].y],c)||o([u[3].x,u[3].y,u[0].x,u[0].y],c))};for(let c of y)if(c.unitType===fo.IRUT_LOCALIZED_BARCODES)for(let u of c.localizedBarcodes){if(!u)continue;let f=u.location.points;f.forEach(o=>{Ci._transformCoordinates(o,L,P,Y,H,G,W)}),l(re,f)&&pe.push(u)}if(t._debug&&this.cameraView){let c=this.__layer||(this.__layer=this.cameraView._createDrawingLayer(99));c.clearDrawingItems();let u=this.__styleId2||(this.__styleId2=me.createDrawingStyle({strokeStyle:"red"}));for(let f of y)if(f.unitType===fo.IRUT_LOCALIZED_BARCODES)for(let o of f.localizedBarcodes){if(!o)continue;let s=o.location.points,h=new Qs({points:s},u);c.addDrawingItems([h])}}}if(t._onLog&&(t._onLog("intersectedResults:"),t._onLog(pe)),!pe.length)return;let de;if(pe.length){let l=pe.filter(c=>c.possibleFormats==qd.BF_QR_CODE||c.possibleFormats==qd.BF_DATAMATRIX);if(l.length||(l=pe.filter(c=>c.possibleFormats==qd.BF_ONED),l.length||(l=pe)),l.length){let c=f=>{let o=f.location.points,s=(o[0].x+o[1].x+o[2].x+o[3].x)/4,h=(o[0].y+o[1].y+o[2].y+o[3].y)/4;return(s-G/2)*(s-G/2)+(h-W/2)*(h-W/2)};de=l[0];let u=c(de);if(l.length!=1)for(let f=1;f<l.length;f++){let o=c(l[f]);(l[f].confidence>1.1*de.confidence||l[f].confidence>.9*de.confidence&&o<u)&&(de=l[f],u=o)}}}if(t._onLog&&(t._onLog("highPriorityResult:"),t._onLog(de)),de){let l=de.location.points;te=Math.min(l[0].x,l[1].x,l[2].x,l[3].x),ie=Math.max(l[0].x,l[1].x,l[2].x,l[3].x),ae=Math.min(l[0].y,l[1].y,l[2].y,l[3].y),w=Math.max(l[0].y,l[1].y,l[2].y,l[3].y),oe={points:[{x:te,y:ae},{x:ie,y:ae},{x:ie,y:w},{x:te,y:w}],result:de}}}if(t._onLog&&(t._onLog("boundingRect:"),t._onLog(oe)),!oe)return;if(t._debug&&this.cameraView&&oe?.points){let te=this.__layer||(this.__layer=this.cameraView._createDrawingLayer(99)),ie=this.__styleId1||(this.__styleId1=me.createDrawingStyle({strokeStyle:"blue"})),ae=new Qs({points:oe.points},ie);te.addDrawingItems([ae])}if(A(this,Ce,"f").autoZoomOutFrameCount=0,A(this,lt,"f").autoZoom){let te=A(this,Ce,"f").autoZoomIdealArea[1],ie=(1-A(this,Ce,"f").autoZoomTargetBorder)/2,ae=oe.points[0].x/Y,w=(Y-oe.points[2].x)/Y,re=oe.points[0].y/H,pe=(H-oe.points[2].y)/H;if(ae>te&&w>te&&re>te&&pe>te&&oe.result.moduleSize<A(this,Ce,"f").autoZoomInIdealModuleSize){if(A(this,Ce,"f").autoZoomInFrameArray.push(!0),A(this,Ce,"f").autoZoomInFrameArray.splice(0,A(this,Ce,"f").autoZoomInFrameArray.length-A(this,Ce,"f").autoZoomInFrameLimit[0]),A(this,Ce,"f").frameArrayInIdealZoom.length=0,A(this,lt,"f").enhancedFocus&&M({mode:"continuous"}).catch(()=>{}),A(this,Ce,"f").autoZoomInFrameArray.filter(de=>de===!0).length>=A(this,Ce,"f").autoZoomInFrameLimit[1]){A(this,Ce,"f").autoZoomInFrameArray.length=0;let de=[(.5-ie)/(.5-ae),(.5-ie)/(.5-w),(.5-ie)/(.5-re),(.5-ie)/(.5-pe)].filter(o=>o>0),l=Math.min(...de,A(this,Ce,"f").autoZoomInIdealModuleSize/oe.result.moduleSize),c=this.getZoomSettings().factor,u=Math.max(Math.pow(c*l,1/A(this,Ce,"f").autoZoomInMaxTimes),A(this,Ce,"f").autoZoomInMinStep);u=Math.min(u,l);let f=c*u;f=Math.max(A(this,Ce,"f").minValue,f),f=Math.min(A(this,Ce,"f").maxValue,f);try{yield T({factor:f})}catch(o){let s=o.message||o;console.warn(s)}this.clearBuffer()}}else if(A(this,Ce,"f").autoZoomInFrameArray.length=0,A(this,Ce,"f").frameArrayInIdealZoom.push(!0),A(this,Ce,"f").frameArrayInIdealZoom.splice(0,A(this,Ce,"f").frameArrayInIdealZoom.length-A(this,Ce,"f").frameLimitInIdealZoom[0]),A(this,Ce,"f").frameArrayInIdealZoom.filter(de=>de===!0).length>=A(this,Ce,"f").frameLimitInIdealZoom[1]&&(A(this,Ce,"f").frameArrayInIdealZoom.length=0,A(this,lt,"f").enhancedFocus)){let de=oe.points;try{yield M({mode:"manual",area:{centerPoint:{x:(de[0].x+de[2].x)/2+"px",y:(de[0].y+de[2].y)/2+"px"},width:de[2].x-de[0].x+"px",height:de[2].y-de[0].y+"px"}})}catch(l){let c=l.message||l;console.warn(c)}this.clearBuffer()}}if(!A(this,lt,"f").autoZoom&&A(this,lt,"f").enhancedFocus&&(A(this,Ce,"f").autoFocusFrameArray.push(!0),A(this,Ce,"f").autoFocusFrameArray.splice(0,A(this,Ce,"f").autoFocusFrameArray.length-A(this,Ce,"f").autoFocusFrameLimit[0]),A(this,Ce,"f").autoFocusFrameArray.filter(te=>te===!0).length>=A(this,Ce,"f").autoFocusFrameLimit[1])){A(this,Ce,"f").autoFocusFrameArray.length=0;try{let te=oe.points;yield M({mode:"manual",area:{centerPoint:{x:(te[0].x+te[2].x)/2+"px",y:(te[0].y+te[2].y)/2+"px"},width:te[2].x-te[0].x+"px",height:te[2].y-te[0].y+"px"}})}catch(te){let ie=te.message||te;console.warn(ie)}this.clearBuffer()}}else{if(A(this,lt,"f").autoZoom){if(A(this,Ce,"f").autoZoomInFrameArray.push(!1),A(this,Ce,"f").autoZoomInFrameArray.splice(0,A(this,Ce,"f").autoZoomInFrameArray.length-A(this,Ce,"f").autoZoomInFrameLimit[0]),A(this,Ce,"f").autoZoomOutFrameCount++,A(this,Ce,"f").frameArrayInIdealZoom.push(!1),A(this,Ce,"f").frameArrayInIdealZoom.splice(0,A(this,Ce,"f").frameArrayInIdealZoom.length-A(this,Ce,"f").frameLimitInIdealZoom[0]),A(this,Ce,"f").autoZoomOutFrameCount>=A(this,Ce,"f").autoZoomOutFrameLimit){A(this,Ce,"f").autoZoomOutFrameCount=0;let O=this.getZoomSettings().factor,L=O-Math.max((O-1)*A(this,Ce,"f").autoZoomOutStepRate,A(this,Ce,"f").autoZoomOutMinStep);L=Math.max(A(this,Ce,"f").minValue,L),L=Math.min(A(this,Ce,"f").maxValue,L);try{yield T({factor:L})}catch(P){let Y=P.message||P;console.warn(Y)}this.clearBuffer()}A(this,lt,"f").enhancedFocus&&M({mode:"continuous"}).catch(()=>{})}!A(this,lt,"f").autoZoom&&A(this,lt,"f").enhancedFocus&&(A(this,Ce,"f").autoFocusFrameArray.length=0,M({mode:"continuous"}).catch(()=>{}))}}}),Se(this,Yn,new Lo(1e4),"f")}setCameraView(e){if(!(e instanceof Ci))throw new TypeError("Invalid view.");if(e.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),e._singleFrameMode=this.singleFrameMode,e._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(this.cameraView._hideDefaultSelection=!0),A(this,Be,"m",et).call(this)||this.cameraManager.setVideoEl(e.getVideoElement()),this.cameraView=e,this.addListenerToView()}getCameraView(){return this.cameraView}releaseCameraView(){this.cameraView&&(this.removeListenerFromView(),this.cameraView.disposed||(this.cameraView._singleFrameMode="disabled",this.cameraView._onSingleFrameAcquired=null,this.cameraView._hideDefaultSelection=!1),this.cameraManager.releaseVideoEl(),this.cameraView=null)}addListenerToView(){if(!this.cameraView)return;if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");let e=this.cameraView;A(this,Be,"m",et).call(this)||this.videoSrc||(e._innerComponent&&(this.cameraManager.tapFocusEventBoundEl=e._innerComponent),e._selCam&&e._selCam.addEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.addEventListener("change",this._onResolutionSelChange)),e._btnClose&&e._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!this.cameraView||this.cameraView.disposed)return;let e=this.cameraView;this.cameraManager.tapFocusEventBoundEl=null,e._selCam&&e._selCam.removeEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.removeEventListener("change",this._onResolutionSelChange),e._btnClose&&e._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return A(this,Be,"m",et).call(this)?A(this,qs,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(this.cameraManager.state)}isOpen(){return this.getCameraState()==="open"}getVideoEl(){return this.video}open(){return $(this,null,function*(){let e=this.cameraView;if(e?.disposed)throw new Error("'cameraView' has been disposed.");e&&(e._singleFrameMode=this.singleFrameMode,A(this,Be,"m",et).call(this)?e._clickIptSingleFrameMode():(this.cameraManager.setVideoEl(e.getVideoElement()),e._startLoading()));let n={width:0,height:0,deviceId:""};if(!A(this,Be,"m",et).call(this)){try{yield this.cameraManager.open()}catch(d){throw e&&e._stopLoading(),d.name==="NotFoundError"?new Error(`No camera devices were detected. Please ensure a camera is connected and recognized by your system. ${d?.name}: ${d?.message}`):d.name==="NotAllowedError"?new Error(`Camera access is blocked. Please check your browser settings or grant permission to use the camera. ${d?.name}: ${d?.message}`):d}let i,r=e.getUIElement();if(r=r.shadowRoot||r,i=r.querySelector(".dce-macro-use-mobile-native-like-ui")){let d=r.elTorchAuto=r.querySelector(".dce-mn-torch-auto"),v=r.elTorchOn=r.querySelector(".dce-mn-torch-on"),y=r.elTorchOff=r.querySelector(".dce-mn-torch-off");d&&(v.style.display=this.isTorchOn==null?"":"none"),v&&(v.style.display=this.isTorchOn==1?"":"none"),y&&(y.style.display=this.isTorchOn==0?"":"none");let C=r.elBeepOn=r.querySelector(".dce-mn-beep-on"),b=r.elBeepOff=r.querySelector(".dce-mn-beep-off");C&&(C.style.display=bt.allowBeep?"":"none"),b&&(b.style.display=bt.allowBeep?"none":"");let T=r.elVibrateOn=r.querySelector(".dce-mn-vibrate-on"),M=r.elVibrateOff=r.querySelector(".dce-mn-vibrate-off");T&&(T.style.display=bt.allowVibrate?"":"none"),M&&(M.style.display=bt.allowVibrate?"none":""),r.elResolutionBox=r.querySelector(".dce-mn-resolution-box");let O,L=r.elZoom=r.querySelector(".dce-mn-zoom");L&&(L.style.display="none",O=r.elZoomSpan=L.querySelector("span"));let P=r.elToast=r.querySelector(".dce-mn-toast"),Y=r.elCameraClose=r.querySelector(".dce-mn-camera-close"),H=r.elTakePhoto=r.querySelector(".dce-mn-take-photo"),G=r.elCameraSwitch=r.querySelector(".dce-mn-camera-switch"),W=r.elCameraAndResolutionSettings=r.querySelector(".dce-mn-camera-and-resolution-settings");W&&(W.style.display="none");let oe=r.dceMnFs={},te=()=>{this.turnOnTorch()};d?.addEventListener("pointerdown",te);let ie=()=>{this.turnOffTorch()};v?.addEventListener("pointerdown",ie);let ae=()=>{this.turnAutoTorch()};y?.addEventListener("pointerdown",ae);let w=()=>{bt.allowBeep=!bt.allowBeep,C&&(C.style.display=bt.allowBeep?"":"none"),b&&(b.style.display=bt.allowBeep?"none":"")};for(let E of[b,C])E?.addEventListener("pointerdown",w);let re=()=>{bt.allowVibrate=!bt.allowVibrate,T&&(T.style.display=bt.allowVibrate?"":"none"),M&&(M.style.display=bt.allowVibrate?"none":"")};for(let E of[M,T])E?.addEventListener("pointerdown",re);let pe=E=>$(this,null,function*(){let I,S=E.target;if(I=S.closest(".dce-mn-camera-option"))this.selectCamera(I.getAttribute("data-davice-id"));else if(I=S.closest(".dce-mn-resolution-option")){let D,x=parseInt(I.getAttribute("data-width")),R=parseInt(I.getAttribute("data-height")),j=yield this.setResolution({width:x,height:R});{let U=Math.max(j.width,j.height),Q=Math.min(j.width,j.height);D=Q<=1080?Q+"P":U<3e3?"2K":Math.round(U/1e3)+"K"}D!=I.textContent&&c(`Fallback to ${D}`)}else S.closest(".dce-mn-camera-and-resolution-settings")||(S.closest(".dce-mn-resolution-box")?W&&(W.style.display=W.style.display?"":"none"):W&&W.style.display===""&&(W.style.display="none"))});r.addEventListener("click",pe);let de=null;oe.funcInfoZoomChange=(E,I=3e3)=>{L&&O&&(O.textContent=E.toFixed(1),L.style.display="",de!=null&&(clearTimeout(de),de=null),de=setTimeout(()=>{L.style.display="none",de=null},I))};let l=null,c=oe.funcShowToast=(E,I=3e3)=>{P&&(P.textContent=E,P.style.display="",l!=null&&(clearTimeout(l),l=null),l=setTimeout(()=>{P.style.display="none",l=null},I))},u=()=>{this.close()};Y?.addEventListener("click",u);let f=()=>{};H?.addEventListener("pointerdown",f);let o=()=>{var E,I;let S,D=this.getVideoSettings(),x=D.video.facingMode,R=(I=(E=this.cameraManager.getCamera())===null||E===void 0?void 0:E.label)===null||I===void 0?void 0:I.toLowerCase(),j=R?.indexOf("front");j===-1&&(j=R?.indexOf("\u524D"));let U=R?.indexOf("back");U===-1&&(U=R?.indexOf("\u540E")),typeof j=="number"&&j!==-1?S=!0:typeof U=="number"&&U!==-1&&(S=!1),S===void 0&&(S=(x?.ideal||x?.exact||x)==="user"),D.video.facingMode={ideal:S?"environment":"user"},delete D.video.deviceId,this.updateVideoSettings(D)};G?.addEventListener("pointerdown",o);let s=-1/0,h=1,m=E=>{let I=Date.now();I-s>1e3&&(h=this.getZoomSettings().factor),h-=E.deltaY/200,h>20&&(h=20),h<1&&(h=1),this.setZoom({factor:h}),s=I};i.addEventListener("wheel",m);let p=new Map,g=!1,_=E=>$(this,null,function*(){var I;for(E.touches.length>=2&&E.type=="touchmove"&&E.preventDefault();E.changedTouches.length>1&&E.touches.length==2;){let S=E.touches[0],D=E.touches[1],x=p.get(S.identifier),R=p.get(D.identifier);if(!x||!R)break;let j=Math.pow(Math.pow(x.x-R.x,2)+Math.pow(x.y-R.y,2),.5),U=Math.pow(Math.pow(S.clientX-D.clientX,2)+Math.pow(S.clientY-D.clientY,2),.5),Q=Date.now();if(g||Q-s<100)return;Q-s>1e3&&(h=this.getZoomSettings().factor),h*=U/j,h>20&&(h=20),h<1&&(h=1);let Z=!1;((I=Dt?.browser)===null||I===void 0?void 0:I.toLocaleLowerCase())=="safari"&&(U/j>1&&h<2?(h=2,Z=!0):U/j<1&&h<2&&(h=1,Z=!0)),g=!0,Z&&c("zooming..."),yield this.setZoom({factor:h}),Z&&(P.textContent=""),g=!1,s=Date.now();break}p.clear();for(let S of E.touches)p.set(S.identifier,{x:S.clientX,y:S.clientY})});r.addEventListener("touchstart",_),r.addEventListener("touchmove",_),r.addEventListener("touchend",_),r.addEventListener("touchcancel",_),oe.unbind=()=>{d?.removeEventListener("pointerdown",te),v?.removeEventListener("pointerdown",ie),y?.removeEventListener("pointerdown",ae);for(let E of[b,C])E?.removeEventListener("pointerdown",w);for(let E of[M,T])E?.removeEventListener("pointerdown",re);r.removeEventListener("click",pe),Y?.removeEventListener("click",u),H?.removeEventListener("pointerdown",f),G?.removeEventListener("pointerdown",o),i.removeEventListener("wheel",m),r.removeEventListener("touchstart",_),r.removeEventListener("touchmove",_),r.removeEventListener("touchend",_),r.removeEventListener("touchcancel",_),delete r.dceMnFs,i.style.display="none"},i.style.display="",d&&this.isTorchOn==null&&setTimeout(()=>{this.turnAutoTorch(1e3)},0)}this.isTorchOn&&this.turnOnTorch().catch(()=>{});let a=this.getResolution();n.width=a.width,n.height=a.height,n.deviceId=this.getSelectedCamera().deviceId}return Se(this,qs,"open","f"),e&&(e._innerComponent.style.display="",A(this,Be,"m",et).call(this)||(e._stopLoading(),e._renderCamerasInfo(this.getSelectedCamera(),this.cameraManager._arrCameras),e._renderResolutionInfo({width:n.width,height:n.height}),e.eventHandler.fire("content:updated",null,{async:!1}),e.eventHandler.fire("videoEl:resized",null,{async:!1}))),A(this,pi,"f").fire("opened",null,{target:this,async:!1}),n})}close(){var e;let n=this.cameraView;if(n?.disposed)throw new Error("'cameraView' has been disposed.");if(this.stopFetching(),this.clearBuffer(),!A(this,Be,"m",et).call(this)){this.cameraManager.close();let i=n.getUIElement();i=i.shadowRoot||i,i.querySelector(".dce-macro-use-mobile-native-like-ui")&&((e=i.dceMnFs)===null||e===void 0||e.unbind())}Se(this,qs,"closed","f"),A(this,Yn,"f").stopCharging(),n&&(n._innerComponent.style.display="none",A(this,Be,"m",et).call(this)&&n._innerComponent.removeElement("content"),n._stopLoading()),A(this,pi,"f").fire("closed",null,{target:this,async:!1})}pause(){if(A(this,Be,"m",et).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");this.cameraManager.pause()}isPaused(){var e;return!A(this,Be,"m",et).call(this)&&((e=this.video)===null||e===void 0?void 0:e.paused)===!0}resume(){return $(this,null,function*(){if(A(this,Be,"m",et).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield this.cameraManager.resume()})}selectCamera(e){return $(this,null,function*(){if(!e)throw new Error("Invalid value.");let n;n=typeof e=="string"?e:e.deviceId,yield this.cameraManager.setCamera(n),this.isTorchOn=!1;let i=this.getResolution(),r=this.cameraView;return r&&!r.disposed&&(r._stopLoading(),r._renderCamerasInfo(this.getSelectedCamera(),this.cameraManager._arrCameras),r._renderResolutionInfo({width:i.width,height:i.height})),{width:i.width,height:i.height,deviceId:this.getSelectedCamera().deviceId}})}getSelectedCamera(){return this.cameraManager.getCamera()}getAllCameras(){return $(this,null,function*(){return this.cameraManager.getCameras()})}setResolution(e){return $(this,null,function*(){yield this.cameraManager.setResolution(e.width,e.height),this.isTorchOn&&this.turnOnTorch().catch(()=>{});let n=this.getResolution(),i=this.cameraView;return i&&!i.disposed&&(i._stopLoading(),i._renderResolutionInfo({width:n.width,height:n.height})),{width:n.width,height:n.height,deviceId:this.getSelectedCamera().deviceId}})}getResolution(){return this.cameraManager.getResolution()}getAvailableResolutions(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getResolutions()}_on(e,n){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?A(this,pi,"f").on(e,n):this.cameraManager.on(e,n)}_off(e,n){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?A(this,pi,"f").off(e,n):this.cameraManager.off(e,n)}on(e,n){let i=e.toLowerCase(),r=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!r)throw new Error("Invalid event.");this._on(r,n)}off(e,n){let i=e.toLowerCase(),r=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!r)throw new Error("Invalid event.");this._off(r,n)}getVideoSettings(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getMediaStreamConstraints()}updateVideoSettings(e){return $(this,null,function*(){var n;yield(n=this.cameraManager)===null||n===void 0?void 0:n.setMediaStreamConstraints(e,!0)})}getCapabilities(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getCameraCapabilities()}getCameraSettings(){return this.cameraManager.getCameraSettings()}turnOnTorch(){return $(this,null,function*(){var e,n;if(A(this,Be,"m",et).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");try{yield(e=this.cameraManager)===null||e===void 0?void 0:e.turnOnTorch()}catch(r){let a=this.cameraView.getUIElement();throw a=a.shadowRoot||a,(n=a?.dceMnFs)===null||n===void 0||n.funcShowToast("Torch Not Supported"),r}this.isTorchOn=!0;let i=this.cameraView.getUIElement();i=i.shadowRoot||i,i.elTorchAuto&&(i.elTorchAuto.style.display="none"),i.elTorchOn&&(i.elTorchOn.style.display=""),i.elTorchOff&&(i.elTorchOff.style.display="none")})}turnOffTorch(){return $(this,null,function*(){var e;if(A(this,Be,"m",et).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield(e=this.cameraManager)===null||e===void 0?void 0:e.turnOffTorch(),this.isTorchOn=!1;let n=this.cameraView.getUIElement();n=n.shadowRoot||n,n.elTorchAuto&&(n.elTorchAuto.style.display="none"),n.elTorchOn&&(n.elTorchOn.style.display="none"),n.elTorchOff&&(n.elTorchOff.style.display="")})}turnAutoTorch(e=250){return $(this,null,function*(){if(this._taskid4AutoTorch!=null){if(!(e<this._delay4AutoTorch))return;clearInterval(this._taskid4AutoTorch),this._taskid4AutoTorch=null}this._delay4AutoTorch=e;let n=!1,i=0,r=0,a=()=>$(this,null,function*(){var v,y,C;if(this.disposed||n||this.isTorchOn!=null||!this.isOpen())return clearInterval(this._taskid4AutoTorch),void(this._taskid4AutoTorch=null);if(this.isPaused())return;if(++r>10&&this._delay4AutoTorch<1e3)return clearInterval(this._taskid4AutoTorch),this._taskid4AutoTorch=null,void this.turnAutoTorch(1e3);let b;try{b=this.fetchImage()}catch{}if(!b||!b.width||!b.height)return;let T=0;if(De.IPF_GRAYSCALED===b.format){for(let M=0;M<b.bytes.length;++M)T+=b.bytes[M];T/=b.bytes.length}else{if(De.IPF_ABGR_8888!==b.format)return;for(let M=0;M<b.bytes.length;M+=4)T+=b.bytes[M],T+=b.bytes[M+1],T+=b.bytes[M+2];T/=b.bytes.length/4*3}if(T<this.grayThreshold4AutoTorch){if(++i>=this.maxDarkCount4AutoTroch){(v=t._onLog)===null||v===void 0||v.call(t,`darkCount ${i}`);try{yield this.turnOnTorch(),this.isTorchOn=!0;let M=this.cameraView.getUIElement();M=M.shadowRoot||M,(y=M?.dceMnFs)===null||y===void 0||y.funcShowToast("Torch Auto On")}catch(M){console.warn(M),n=!0;let O=this.cameraView.getUIElement();O=O.shadowRoot||O,(C=O?.dceMnFs)===null||C===void 0||C.funcShowToast("Torch Not Supported")}}}else i=0});this._taskid4AutoTorch=setInterval(a,e),this.isTorchOn=void 0,a();let d=this.cameraView.getUIElement();d=d.shadowRoot||d,d.elTorchAuto&&(d.elTorchAuto.style.display=""),d.elTorchOn&&(d.elTorchOn.style.display="none"),d.elTorchOff&&(d.elTorchOff.style.display="none")})}setColorTemperature(e){return $(this,null,function*(){if(A(this,Be,"m",et).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield this.cameraManager.setColorTemperature(e,!0)})}getColorTemperature(){return this.cameraManager.getColorTemperature()}setExposureCompensation(e){return $(this,null,function*(){var n;if(A(this,Be,"m",et).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield(n=this.cameraManager)===null||n===void 0?void 0:n.setExposureCompensation(e,!0)})}getExposureCompensation(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getExposureCompensation()}_setZoom(e){return $(this,null,function*(){var n,i,r;if(A(this,Be,"m",et).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield(n=this.cameraManager)===null||n===void 0?void 0:n.setZoom(e);{let a=(i=this.cameraView)===null||i===void 0?void 0:i.getUIElement();a=a?.shadowRoot||a,(r=a?.dceMnFs)===null||r===void 0||r.funcInfoZoomChange(e.factor)}})}setZoom(e){return $(this,null,function*(){yield this._setZoom(e)})}getZoomSettings(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getZoom()}resetZoom(){return $(this,null,function*(){var e;if(A(this,Be,"m",et).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield(e=this.cameraManager)===null||e===void 0?void 0:e.resetZoom()})}setFrameRate(e){return $(this,null,function*(){var n;if(A(this,Be,"m",et).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield(n=this.cameraManager)===null||n===void 0?void 0:n.setFrameRate(e,!0)})}getFrameRate(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getFrameRate()}setFocus(e){return $(this,null,function*(){var n;if(A(this,Be,"m",et).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield(n=this.cameraManager)===null||n===void 0?void 0:n.setFocus(e,!0)})}getFocusSettings(){var e;return(e=this.cameraManager)===null||e===void 0?void 0:e.getFocus()}setAutoZoomRange(e){A(this,Ce,"f").minValue=e.min,A(this,Ce,"f").maxValue=e.max}getAutoZoomRange(){return{min:A(this,Ce,"f").minValue,max:A(this,Ce,"f").maxValue}}enableEnhancedFeatures(e){return $(this,null,function*(){var n,i;if(!(!((i=(n=ht.license)===null||n===void 0?void 0:n.LicenseManager)===null||i===void 0)&&i.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(be.bSupportDce4Module!==0)throw new Error("Please set a license containing the DCE module.");e&qi.EF_ENHANCED_FOCUS&&(A(this,lt,"f").enhancedFocus=!0),e&qi.EF_AUTO_ZOOM&&(A(this,lt,"f").autoZoom=!0),e&qi.EF_TAP_TO_FOCUS&&(A(this,lt,"f").tapToFocus=!0,this.cameraManager.enableTapToFocus())})}disableEnhancedFeatures(e){e&qi.EF_ENHANCED_FOCUS&&(A(this,lt,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),e&qi.EF_AUTO_ZOOM&&(A(this,lt,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),e&qi.EF_TAP_TO_FOCUS&&(A(this,lt,"f").tapToFocus=!1,this.cameraManager.disableTapToFocus()),A(this,Be,"m",p_).call(this)&&A(this,Be,"m",f_).call(this)||A(this,Yn,"f").stopCharging()}_setScanRegion(e){if(e!=null&&!Hc(e)&&!Bi(e))throw TypeError("Invalid 'region'.");Se(this,Zt,e?JSON.parse(JSON.stringify(e)):null,"f"),this.cameraView&&!this.cameraView.disposed&&this.cameraView.setScanRegion(e)}setScanRegion(e){this._setScanRegion(e),this.cameraView&&!this.cameraView.disposed&&(e===null?this.cameraView.setScanRegionMaskVisible(!1):this.cameraView.setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(A(this,Zt,"f")))}setErrorListener(e){if(!e)throw new TypeError("Invalid 'listener'");Se(this,Ks,e,"f")}hasNextImageToFetch(){return!(this.getCameraState()!=="open"||!this.cameraManager.isVideoLoaded()||A(this,Be,"m",et).call(this))}startFetching(){if(A(this,Be,"m",et).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");A(this,gi,"f")||(Se(this,gi,!0,"f"),A(this,Be,"m",wf).call(this))}stopFetching(){A(this,gi,"f")&&(t._onLog&&t._onLog("DCE: stop fetching loop: "+Date.now()),A(this,en,"f")&&clearTimeout(A(this,en,"f")),Se(this,gi,!1,"f"))}fetchImage(){if(A(this,Be,"m",et).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(this.video.readyState!==4)throw new Error("The video is not loaded.");let e=this.getResolution();if(!e?.width||!e?.height)throw new Error("The video is not loaded.");let n;if(n=Ro.convert(A(this,Zt,"f"),e.width,e.height),n||(n={x:0,y:0,width:e.width,height:e.height}),n.x>e.width||n.y>e.height)throw new Error("Invalid scan region.");n.x+n.width>e.width&&(n.width=e.width-n.x),n.y+n.height>e.height&&(n.height=e.height-n.y);let i={sx:n.x,sy:n.y,sWidth:n.width,sHeight:n.height,dWidth:n.width,dHeight:n.height},r=Math.max(i.dWidth,i.dHeight);if(this.canvasSizeLimit&&r>this.canvasSizeLimit){let y=this.canvasSizeLimit/r;i.dWidth>i.dHeight?(i.dWidth=this.canvasSizeLimit,i.dHeight=Math.round(i.dHeight*y)):(i.dWidth=Math.round(i.dWidth*y),i.dHeight=this.canvasSizeLimit)}let a=this.cameraManager.getFrameData({position:i,pixelFormat:this.getPixelFormat()===De.IPF_GRAYSCALED?Ve.GREY:Ve.RGBA});if(!a)return null;let d;a.pixelFormat===Ve.GREY?d=a.width:d=4*a.width;let v=!0;return i.sx===0&&i.sy===0&&i.sWidth===e.width&&i.sHeight===e.height&&(v=!1),{bytes:a.data,width:a.width,height:a.height,stride:d,format:e_.get(a.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:Is.ITT_VIDEO_FRAME,isCropped:v,cropRegion:{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height,isMeasuredInPercentage:!1},originalWidth:e.width,originalHeight:e.height,currentWidth:a.width,currentHeight:a.height,timeSpent:a.timeSpent,timeStamp:a.timeStamp},toCanvas:A(this,yl,"f"),isDCEFrame:!0}}setImageFetchInterval(e){this.fetchInterval=e,A(this,gi,"f")&&(A(this,en,"f")&&clearTimeout(A(this,en,"f")),Se(this,en,setTimeout(()=>{this.disposed||A(this,Be,"m",wf).call(this)},e),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(e){Se(this,_l,e,"f")}getPixelFormat(){return A(this,_l,"f")}takePhoto(e){if(!this.isOpen())throw new Error("Not open.");if(A(this,Be,"m",et).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),n.setAttribute("capture",""),n.style.position="absolute",n.style.top="-9999px",n.style.backgroundColor="transparent",n.style.color="transparent",n.addEventListener("click",()=>{let i=this.isOpen();this.close(),window.addEventListener("focus",()=>{i&&this.open(),n.remove()},{once:!0})}),n.addEventListener("change",()=>$(this,null,function*(){let i=n.files[0],r=yield(C=>$(this,null,function*(){let b=null,T=null;if(typeof createImageBitmap<"u")try{if(b=yield createImageBitmap(C),b)return b}catch{}var M;return b||(T=yield(M=C,new Promise((O,L)=>{let P=URL.createObjectURL(M),Y=new Image;Y.src=P,Y.onload=()=>{URL.revokeObjectURL(Y.src),O(Y)},Y.onerror=H=>{L(new Error("Can't convert blob to image : "+(H instanceof Event?H.type:H)))}}))),T}))(i),a=r instanceof HTMLImageElement?r.naturalWidth:r.width,d=r instanceof HTMLImageElement?r.naturalHeight:r.height,v=Ro.convert(A(this,Zt,"f"),a,d);v||(v={x:0,y:0,width:a,height:d});let y=A(this,vl,"f").call(this,r,a,d,v);e&&e(y)})),document.body.appendChild(n),n.click()}convertToPageCoordinates(e){let n=A(this,Be,"m",Cf).call(this,e);return{x:n.pageX,y:n.pageY}}convertToClientCoordinates(e){let n=A(this,Be,"m",Cf).call(this,e);return{x:n.clientX,y:n.clientY}}convertToScanRegionCoordinates(e){if(!A(this,Zt,"f"))return JSON.parse(JSON.stringify(e));let n,i,r=A(this,Zt,"f").left||A(this,Zt,"f").x||0,a=A(this,Zt,"f").top||A(this,Zt,"f").y||0;if(!A(this,Zt,"f").isMeasuredInPercentage)return{x:e.x-r,y:e.y-a};if(!this.cameraView)throw new Error("Camera view is not set.");if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!A(this,Be,"m",et).call(this)&&!this.cameraManager.isVideoLoaded())throw new Error("Video is not loaded.");if(A(this,Be,"m",et).call(this)&&!this.cameraView._cvsSingleFrameMode)throw new Error("No image is selected.");if(A(this,Be,"m",et).call(this)){let d=this.cameraView._innerComponent.getElement("content");n=d.width,i=d.height}else{let d=this.getVideoEl();n=d.videoWidth,i=d.videoHeight}return{x:e.x-Math.round(r*n/100),y:e.y-Math.round(a*i/100)}}dispose(){this.close(),this.cameraManager.dispose(),this.releaseCameraView(),Se(this,wl,!0,"f")}},aD,cD,lD,uD,hD,dD,fD,pD;yf=Qt,qs=new WeakMap,pi=new WeakMap,ml=new WeakMap,vl=new WeakMap,yl=new WeakMap,Ks=new WeakMap,Zt=new WeakMap,_l=new WeakMap,gi=new WeakMap,en=new WeakMap,lt=new WeakMap,Ce=new WeakMap,Yn=new WeakMap,wl=new WeakMap,Be=new WeakSet,et=function(){return this.singleFrameMode!=="disabled"},f_=function(){return!this.videoSrc&&this.cameraManager.state==="opened"},p_=function(){for(let t in A(this,lt,"f"))if(A(this,lt,"f")[t]==1)return!0;return!1},wf=function t(){if(this.disposed)return;if(this.getCameraState()!=="open"||!A(this,gi,"f"))return A(this,en,"f")&&clearTimeout(A(this,en,"f")),void Se(this,en,setTimeout(()=>{this.disposed||A(this,Be,"m",t).call(this)},this.fetchInterval),"f");let e=()=>{var n;let i;Qt._onLog&&Qt._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{i=this.fetchImage()}catch(r){let a=r.message||r;if(a==="The video is not loaded.")return;if(!((n=A(this,Ks,"f"))===null||n===void 0)&&n.onErrorReceived)return void setTimeout(()=>{var d;(d=A(this,Ks,"f"))===null||d===void 0||d.onErrorReceived(Vc.EC_IMAGE_READ_FAILED,a)},0);console.warn(r)}i?(this.addImageToBuffer(i),Qt._onLog&&Qt._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),A(this,pi,"f").fire("frameAddedToBuffer",null,{async:!1})):Qt._onLog&&Qt._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case Fi.BOPM_BLOCK:break;case Fi.BOPM_UPDATE:e()}else e();A(this,en,"f")&&clearTimeout(A(this,en,"f")),Se(this,en,setTimeout(()=>{this.disposed||A(this,Be,"m",t).call(this)},this.fetchInterval),"f")},Cf=function(t){if(!this.cameraView)throw new Error("Camera view is not set.");if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!A(this,Be,"m",et).call(this)&&!this.cameraManager.isVideoLoaded())throw new Error("Video is not loaded.");if(A(this,Be,"m",et).call(this)&&!this.cameraView._cvsSingleFrameMode)throw new Error("No image is selected.");let e=this.cameraView._innerComponent.getBoundingClientRect(),n=e.left,i=e.top,r=n+window.scrollX,a=i+window.scrollY,{width:d,height:v}=this.cameraView._innerComponent.getBoundingClientRect();if(d<=0||v<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let y,C,b;if(A(this,Be,"m",et).call(this)){let G=this.cameraView._innerComponent.getElement("content");y=G.width,C=G.height,b="contain"}else{let G=this.getVideoEl();y=G.videoWidth,C=G.videoHeight,b=this.cameraView.getVideoFit()}let T=d/v,M=y/C,O,L,P,Y,H=1;if(b==="contain")T<M?(H=d/y,O=n+t.x*H,L=i+t.y*H+(v-C*H)/2,P=r+t.x*H,Y=a+t.y*H+(v-C*H)/2):(H=v/C,O=n+t.x*H+(d-y*H)/2,L=i+t.y*H,P=r+t.x*H+(d-y*H)/2,Y=a+t.y*H);else if(b==="cover")if(T<M){H=v/C;let G=t.x*H-(y*H-d)/2;G=Math.max(G,0),G=Math.min(G,d),O=n+G,L=i+t.y*H,P=r+G,Y=a+t.y*H}else{H=d/y;let G=t.y*H-(C*H-v)/2;G=Math.max(G,0),G=Math.min(G,v),O=n+t.x*H,L=i+G,P=r+t.x*H,Y=a+G}return{clientX:O,clientY:L,pageX:P,pageY:Y}},Qt._debug=!1,_f={value:void 0},Qt.browserInfo=Dt;aD=new WeakMap;lD=new WeakMap,uD=new WeakMap,hD=new WeakMap,dD=new WeakMap,fD=new WeakMap,cD=new WeakSet,pD=function(){let t=document.createElement("div");return t.className=this.containerClassName,t.style.width="100%",t.style.height="100%",t};var v_=typeof self>"u",y_=typeof importScripts=="function",bf=(()=>{if(!y_){if(!v_&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"}})(),__=t=>{if(t==null&&(t="./"),!(v_||y_)){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};be.engineResourcePaths.utility={version:"1.4.32",path:bf,isInternal:!0},zt.utility={js:!0,wasm:!0};var Ef="1.4.21";typeof be.engineResourcePaths.std!="string"&&On(be.engineResourcePaths.std.version,Ef)<0&&(be.engineResourcePaths.std={version:Ef,path:__(bf+`../../dynamsoft-capture-vision-std@${Ef}/dist/`),isInternal:!0});var If="2.4.31";(!be.engineResourcePaths.dip||typeof be.engineResourcePaths.dip!="string"&&On(be.engineResourcePaths.dip.version,If)<0)&&(be.engineResourcePaths.dip={version:If,path:__(bf+`../../dynamsoft-image-processing@${If}/dist/`),isInternal:!0});function Zn(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}var Ol,Rl,Ll,Nl,Pl;function Fl(t,e){let n=!0;for(let d=0;d<t.length;d++){let v=(d+1)%t.length;if(i=t[d],r=t[v],a=e,(r.x-i.x)*(a.y-i.y)-(r.y-i.y)*(a.x-i.x)<0){n=!1;break}}var i,r,a;return n}function Tl(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function Ei(t,e){let[n,i]=t,r=n.x,a=n.y,d=i.x,v=i.y,y=e.x,C=e.y,b=(d-r)**2+(v-a)**2;if(b===0)return Math.sqrt((y-r)**2+(C-a)**2);let T=((y-r)*(d-r)+(C-a)*(v-a))/b;if(T<0)return Math.sqrt((y-r)**2+(C-a)**2);if(T>1)return Math.sqrt((y-d)**2+(C-v)**2);{let M=r+T*(d-r),O=a+T*(v-a);return Math.sqrt((y-M)**2+(C-O)**2)}}function Ki(t){let e=[];for(let n=0;n<t.length;n++){let i=t[n],r=t[(n+1)%t.length];e.push([i,r])}return e}function xl(t){let[e,n]=t;return{x:(e.x+n.x)/2,y:(e.y+n.y)/2}}function gD(t,e){let n=[];for(let i=0;i<4;i++)for(let r=0;r<4;r++){let a=mD(t[i],t[(i+1)%4],e[r],e[(r+1)%4]);a&&n.push(a)}return t.forEach(i=>{Fl(e,i)&&n.push(i)}),e.forEach(i=>{Fl(t,i)&&n.push(i)}),w_(function(i){if(i.length<=1)return i;i.sort((a,d)=>a.x-d.x||a.y-d.y);let r=i.shift();return i.sort((a,d)=>Math.atan2(a.y-r.y,a.x-r.x)-Math.atan2(d.y-r.y,d.x-r.x)),[r,...i]}(n))}function mD(t,e,n,i){let r=e.x-t.x,a=e.y-t.y,d=i.x-n.x,v=i.y-n.y,y=(-a*(t.x-n.x)+r*(t.y-n.y))/(-d*a+r*v),C=(d*(t.y-n.y)-v*(t.x-n.x))/(-d*a+r*v);return y>=0&&y<=1&&C>=0&&C<=1?{x:t.x+C*r,y:t.y+C*a}:null}function w_(t){let e=0;for(let n=0;n<t.length;n++){let i=(n+1)%t.length;e+=t[n].x*t[i].y,e-=t[i].x*t[n].y}return Math.abs(e/2)}function vD(t,e,n){let i=e.x-t.x,r=e.y-t.y,a=n.x-t.x;return i*(n.y-t.y)-r*a>0}function Al(t,e){for(let n=0;n<4;n++)if(!vD(t.points[n],t.points[(n+1)%4],e))return!1;return!0}var g_=3,yD=1,_D=1,wD=2,CD=3,ED=5,ID=15,m_=5;function bD(t,e,n,i){let r=t.points,a=e.points,d=8*n;d=Math.max(d,5);let v=Ki(r)[3],y=Ki(r)[1],C=Ki(a)[3],b=Ki(a)[1],T,M=0;if(T=Math.max(Math.abs(Ei(v,e.points[0])),Math.abs(Ei(v,e.points[3]))),T>M&&(M=T),T=Math.max(Math.abs(Ei(y,e.points[1])),Math.abs(Ei(y,e.points[2]))),T>M&&(M=T),T=Math.max(Math.abs(Ei(C,t.points[0])),Math.abs(Ei(C,t.points[3]))),T>M&&(M=T),T=Math.max(Math.abs(Ei(b,t.points[1])),Math.abs(Ei(b,t.points[2]))),T>M&&(M=T),M>d)return!1;let O=xl(Ki(r)[0]),L=xl(Ki(r)[2]),P=xl(Ki(a)[0]),Y=xl(Ki(a)[2]),H=Tl(O,Y),G=Tl(P,L),W=H>G,oe=Math.min(H,G),te=Tl(O,L),ie=Tl(P,Y),ae=12*n;return ae=Math.max(ae,5),ae=Math.min(ae,te),ae=Math.min(ae,ie),!!(oe<ae||Fl(r,W?P:Y)||Fl(a,W?L:O))&&(W?(i.points[0]=t.points[0],i.points[1]=t.points[1],i.points[2]=e.points[2],i.points[3]=e.points[3]):(i.points[0]=e.points[0],i.points[1]=e.points[1],i.points[2]=t.points[2],i.points[3]=t.points[3]),i.area=w_(i.points),!0)}var Qi=class{constructor(e,n,i,r){this.overlapCount=e,this.verificationCount=n,this.crossVerificationFrame=5,this.location=r.location,this.locationArea=r.location.area,this.locationAngle=r.angle,this.format=r.format,this.text=r.text,this.isOneD=i,this.item=r,this.locationThreshold=r.moduleSize*ED,this.strictLimit=Math.max(this.locationThreshold,1),this.strictLimit=Math.min(this.strictLimit,15)}getCenterPoint(e){let n={x:0,y:0};return e.forEach(({x:i,y:r})=>{n.x+=i,n.y+=r}),n.x/=e.length,n.y/=e.length,n}isProbablySameLocationWithOffset(e,n){let i=this.item.location,r=e.location;if(i.area<=0||Math.abs(i.area-r.area)>.4*i.area)return!1;let a=new Array(4).fill(0),d=new Array(4).fill(0),v=0,y=0;for(let C=0;C<4;++C)a[C]=Math.round(100*(r.points[C].x-i.points[C].x))/100,v+=a[C],d[C]=Math.round(100*(r.points[C].y-i.points[C].y))/100,y+=d[C];v/=4,y/=4;for(let C=0;C<4;++C)if(Math.abs(a[C]-v)>this.strictLimit||Math.abs(v)>.8||Math.abs(d[C]-y)>this.strictLimit||Math.abs(y)>.8)return!1;return n.x=v,n.y=y,!0}isLocationOverlap(e,n){if(this.locationArea>n){for(let r=0;r<4;r++)if(Al(this.location,e.points[r]))return!0;let i=this.getCenterPoint(e.points);if(Al(this.location,i))return!0}else{for(let i=0;i<4;i++)if(Al(e,this.location.points[i]))return!0;if(Al(e,this.getCenterPoint(this.location.points)))return!0}return!1}isMatchedLocationWithOffset(e,n={x:0,y:0}){if(this.isOneD){let i=Object.assign({},e.location);for(let d=0;d<4;d++)i.points[d].x-=n.x,i.points[d].y-=n.y;if(!this.isLocationOverlap(i,e.locationArea))return!1;let r=[this.location.points[0],this.location.points[3]],a=[this.location.points[1],this.location.points[2]];for(let d=0;d<4;d++){let v=i.points[d];if(Math.abs(Ei(d===0||d===3?r:a,v))>this.locationThreshold)return!1}}else for(let i=0;i<4;i++){let r=e.location.points[i],a=this.location.points[i];if(!(Math.abs(a.x+n.x-r.x)<this.locationThreshold)||Math.abs(a.y+n.y-r.y)>=this.locationThreshold)return!1}return!0}isOverlappedLocationWithOffset(e,n,i=!0){let r=Object.assign({},e.location);for(let a=0;a<4;a++)r.points[a].x-=n.x,r.points[a].y-=n.y;return this.isLocationOverlap(r,e.location.area)?i?gD([...this.location.points],r.points)>this.locationArea*.75:!0:!1}},yn={BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096)},kl={barcode:2,text_line:4,detected_quad:8,normalized_image:16},Kn=t=>Object.values(kl).includes(t)||kl.hasOwnProperty(t),Js=(t,e)=>typeof t=="string"?e[kl[t]]:e[t],ea=(t,e,n)=>{typeof t=="string"?e[kl[t]]=n:e[t]=n},Ml=(t,e,n)=>{let i=[8,16].includes(n);if(!i&&t.isResultCrossVerificationEnabled(n))for(let r=0;r<e.length;r++)e[r]&&e[r].type===n&&!e[r].verified&&(e[r].isFilter=!0);if(!i&&t.isResultDeduplicationEnabled(n))for(let r=0;r<e.length;r++)e[r]&&e[r].type===n&&e[r].duplicate&&(e[r].isFilter=!0)},Bl=class{constructor(){this.verificationEnabled={[_e.CRIT_BARCODE]:!1,[_e.CRIT_TEXT_LINE]:!0,[_e.CRIT_DETECTED_QUAD]:!0,[_e.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[_e.CRIT_BARCODE]:!1,[_e.CRIT_TEXT_LINE]:!1,[_e.CRIT_DETECTED_QUAD]:!1,[_e.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[_e.CRIT_BARCODE]:3e3,[_e.CRIT_TEXT_LINE]:3e3,[_e.CRIT_DETECTED_QUAD]:3e3,[_e.CRIT_NORMALIZED_IMAGE]:3e3},this.latestOverlappingEnabled={[_e.CRIT_BARCODE]:!1,[_e.CRIT_TEXT_LINE]:!1,[_e.CRIT_DETECTED_QUAD]:!1,[_e.CRIT_NORMALIZED_IMAGE]:!1},this.maxOverlappingFrames={[_e.CRIT_BARCODE]:5,[_e.CRIT_TEXT_LINE]:5,[_e.CRIT_DETECTED_QUAD]:5,[_e.CRIT_NORMALIZED_IMAGE]:5},this.overlapSet=[],this.stabilityCount=0,this.crossVerificationFrames=5,Ol.set(this,new Map),Rl.set(this,new Map),Ll.set(this,new Map),Nl.set(this,new Map),Pl.set(this,new Map)}_dynamsoft(){Zn(this,Ol,"f").forEach((e,n)=>{ea(n,this.verificationEnabled,e)}),Zn(this,Rl,"f").forEach((e,n)=>{ea(n,this.duplicateFilterEnabled,e)}),Zn(this,Ll,"f").forEach((e,n)=>{ea(n,this.duplicateForgetTime,e)}),Zn(this,Nl,"f").forEach((e,n)=>{ea(n,this.latestOverlappingEnabled,e)}),Zn(this,Pl,"f").forEach((e,n)=>{ea(n,this.maxOverlappingFrames,e)})}enableResultCrossVerification(e,n){Kn(e)&&Zn(this,Ol,"f").set(e,n)}isResultCrossVerificationEnabled(e){return!!Kn(e)&&Js(e,this.verificationEnabled)}enableResultDeduplication(e,n){Kn(e)&&(n&&this.enableLatestOverlapping(e,!1),Zn(this,Rl,"f").set(e,n))}isResultDeduplicationEnabled(e){return!!Kn(e)&&Js(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,n){Kn(e)&&(n>18e4&&(n=18e4),n<0&&(n=0),Zn(this,Ll,"f").set(e,n))}getDuplicateForgetTime(e){return Kn(e)?Js(e,this.duplicateForgetTime):-1}setMaxOverlappingFrames(e,n){Kn(e)&&Zn(this,Pl,"f").set(e,n)}getMaxOverlappingFrames(e){return Kn(e)?Js(e,this.maxOverlappingFrames):-1}enableLatestOverlapping(e,n){Kn(e)&&(n&&this.enableResultDeduplication(e,!1),Zn(this,Nl,"f").set(e,n))}isLatestOverlappingEnabled(e){return!!Kn(e)&&Js(e,this.latestOverlappingEnabled)}getFilteredResultItemTypes(){let e=0,n=[_e.CRIT_BARCODE,_e.CRIT_TEXT_LINE,_e.CRIT_DETECTED_QUAD,_e.CRIT_NORMALIZED_IMAGE];for(let i=0;i<n.length;i++)(this.verificationEnabled[n[i]]||this.duplicateFilterEnabled[n[i]])&&(e|=n[i]);return e}onOriginalImageResultReceived(e){}latestOverlappingFilter(e){var n,i,r;let a=this.isResultCrossVerificationEnabled(_e.CRIT_BARCODE),d=this.isLatestOverlappingEnabled(_e.CRIT_BARCODE);if(d){let C=d?this.getMaxOverlappingFrames(_e.CRIT_BARCODE):5,b=e.items.length,T=(r=(i=(n=e?.intermediateResult)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.intermediateResultUnits)===null||r===void 0?void 0:r[1].localizedBarcodes,M=T?T.length:0,O=[],L=[],P={x:0,y:0},Y=new Array(b).fill(-1),H=0,G=e.items.map(W=>{if(W.type!==1){let oe=(BigInt(W.format)&BigInt(yn.BF_ONED))!=BigInt(0)||(BigInt(W.format)&BigInt(yn.BF_GS1_DATABAR))!=BigInt(0);return new Qi(C,oe?1:2,oe,W)}}).filter(Boolean);if(this.overlapSet.length>0){let W=new Array(b).fill(new Array(this.overlapSet.length).fill(1)),oe=0;for(;oe<b;){let ie={x:0,y:0},ae=new Array(b).fill(-1),w=!1;for(;oe<b;oe++){if(!G[oe])continue;let re=G[oe].item;for(let pe=0;pe<this.overlapSet.length;pe++){if(W[oe][pe]<1)continue;let de=this.overlapSet[pe],l=de.item;if(re.format===l.format&&re.text===l.text){if(w=de.isProbablySameLocationWithOffset(G[oe],ie),w){ae[oe]=pe,W[oe][pe]=0;break}}else W[oe][pe]=0}if(w)break}if(w){for(let pe=0;pe<b;pe++){if(pe===oe||!G[pe])continue;let de=G[pe].item;for(let l=0;l<this.overlapSet.length;l++){if(W[pe][l]<1||ae.includes(l))continue;let c=this.overlapSet[l],u=c.item;if(de.format===u.format&&de.text===u.text){if(c.isMatchedLocationWithOffset(G[pe],ie)){ae[pe]=l,W[pe][l]=0;break}}else W[pe][l]=0}}let re=ae.filter(pe=>pe!==-1).length;re>H&&(H=re,Y=ae,P.x=ie.x,P.y=ie.y)}}if(H===0){for(let ie=0;ie<b;ie++){let ae=G[ie].item;for(let w=0;w<this.overlapSet.length;w++){if(W[ie][w]<1||Y.includes(w))continue;let re=this.overlapSet[w],pe=re.item;if(ae.format===pe.format&&ae.text===pe.text){if(re.isMatchedLocationWithOffset(G[ie])){Y[ie]=w,W[ie][w]=0;break}}else W[ie][w]=0}}H+=Y.filter(ie=>ie!=-1).length}let te=this.overlapSet.length<=g_?H>=yD:H>=wD;if(!te&&d&&M>0){let ie=0;for(let ae=0;ae<this.overlapSet.length;ae++){let w=this.overlapSet[ae];for(let re=0;re<M;re++)if(w.isOverlappedLocationWithOffset(T[re],P)){ie++;break}}te=this.overlapSet.length<=g_?ie>=_D:ie>=CD}te||(this.overlapSet=[])}if(this.overlapSet.length===0)this.stabilityCount=0,e.items.forEach((W,oe)=>{if(W.type!==1){let te=Object.assign({},W),ie=(BigInt(W.format)&BigInt(yn.BF_ONED))!=BigInt(0)||(BigInt(W.format)&BigInt(yn.BF_GS1_DATABAR))!=BigInt(0),ae=W.confidence<60,w=new Qi(C,ie?1:2,ie,te);a&&ie&&ae&&L.push(oe),this.overlapSet.push(w)}});else{let W=!0;d?(Math.abs(P.x)>m_||Math.abs(P.y)>m_)&&(W=!1):W=!1;for(let te=0;te<e.items.length;te++){let ie=Y[te];if(ie<0&&G[te]){let ae=G[te].item,w={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};for(let re=0;re<4;re++)w.points[re].x=W?ae.location.points[re].x-P.x:ae.location.points[re].x,w.points[re].y=W?ae.location.points[re].y-P.y:ae.location.points[re].y;for(let re=0;re<this.overlapSet.length;re++){if(Y.includes(re))continue;let pe=this.overlapSet[re].item.text,de=this.overlapSet[re].item.format;if(ae.format===de&&ae.text===pe){if(this.overlapSet[re].isOverlappedLocationWithOffset(ae,P,!1)){let l=Object.assign({},ae),c=(BigInt(l.format)&BigInt(yn.BF_ONED))!=BigInt(0)||(BigInt(l.format)&BigInt(yn.BF_GS1_DATABAR))!=BigInt(0),u=c?1:2;this.overlapSet[re]=new Qi(C,u,c,l),Y[te]=re;break}if(G[te].isOneD){let l={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};for(let u=0;u<4;u++)l.points[u].x=W?this.overlapSet[re].location.points[u].x:this.overlapSet[re].location.points[u].x+P.x,l.points[u].y=W?this.overlapSet[re].location.points[u].y:this.overlapSet[re].location.points[u].y+P.y;let c={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};if(bD(w,l,ae.moduleSize,c)){ae.location=c;let u=Object.assign({},ae),f=(BigInt(u.format)&BigInt(yn.BF_ONED))!=BigInt(0)||(BigInt(u.format)&BigInt(yn.BF_GS1_DATABAR))!=BigInt(0),o=f?1:2;this.overlapSet[re]=new Qi(C,o,f,u),Y[te]=re;break}}}}}else{if(W)G[te]&&(G[te].item.location=this.overlapSet[ie].location);else{let ae=Object.assign({},G[te].item),w=(BigInt(ae.format)&BigInt(yn.BF_ONED))!=BigInt(0)||(BigInt(ae.format)&BigInt(yn.BF_GS1_DATABAR))!=BigInt(0),re=w?1:2;this.overlapSet[ie]=new Qi(C,re,w,ae)}this.overlapSet[ie]&&(this.overlapSet[ie].overlapCount=C,this.overlapSet[ie].verificationCount=2,this.overlapSet[ie].crossVerificationFrame=5)}}W?this.stabilityCount<ID&&this.stabilityCount++:this.stabilityCount=0;let oe=!0;for(let te=0;te<this.overlapSet.length;te++){if(Y.includes(te))continue;let ie=this.overlapSet[te];ie.overlapCount--,ie.crossVerificationFrame--;let ae=ie.overlapCount+this.stabilityCount;if(d&&ae>0){for(let re=0;re<b;re++)if(ie.isOverlappedLocationWithOffset(G[re],P,!1)){oe=!1;break}if(!oe)break;let w=ie.item;if(!W){for(let re=0;re<4;re++)ie.location.points[re].x+=P.x,ie.location.points[re].y+=P.y;w.location=ie.location}ie.verificationCount===2&&O.push(w)}}if(d&&!oe){O=[];for(let te=0;te<this.overlapSet.length;te++){if(Y.includes(te))continue;let ie=this.overlapSet[te];ie.overlapCount=0-this.stabilityCount,ie.crossVerificationFrame=0,ie.verificationCount=0}}for(let te=0;te<b;te++){if(Y[te]!==-1||!G[te])continue;let ie=G[te].item;if(W){for(let l=0;l<4;l++)G[te].location.points[l].x-=P.x,G[te].location.points[l].y-=P.y;ie.location=G[te].location}let ae=!1;for(let l of this.overlapSet)if(!(l.crossVerificationFrame<=0&&l.verificationCount<=0)&&(ae=l.isLocationOverlap(G[te].location,G[te].locationArea),ae))break;if(ae){L.push(te);continue}let w=Object.assign({},ie),re=(BigInt(ie.format)&BigInt(yn.BF_ONED))!=BigInt(0)||(BigInt(ie.format)&BigInt(yn.BF_GS1_DATABAR))!=BigInt(0),pe=ie.confidence<60,de=new Qi(C,re?1:2,re,w);a&&re&&pe?L.push(te):de.verificationCount=2,this.overlapSet.push(de)}this.overlapSet=this.overlapSet.filter(te=>!(te.overlapCount+this.stabilityCount<=0&&te.crossVerificationFrame<=0))}L.sort((W,oe)=>oe-W).forEach((W,oe)=>{e.items.splice(W,1)}),O.forEach(W=>{e.items.push(Object.assign(Object.assign({},W),{overlapped:!0}))})}}onDecodedBarcodesReceived(e){this.latestOverlappingFilter(e),Ml(this,e.items,_e.CRIT_BARCODE)}onRecognizedTextLinesReceived(e){Ml(this,e.items,_e.CRIT_TEXT_LINE)}onDetectedQuadsReceived(e){Ml(this,e.items,_e.CRIT_DETECTED_QUAD)}onNormalizedImagesReceived(e){Ml(this,e.items,_e.CRIT_NORMALIZED_IMAGE)}};Ol=new WeakMap,Rl=new WeakMap,Ll=new WeakMap,Nl=new WeakMap,Pl=new WeakMap;var Pe="primary",ma=Symbol("RouteTitle"),Af=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){let n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}};function Bo(t){return new Af(t)}function DD(t,e,n){let i=n.path.split("/");if(i.length>t.length||n.pathMatch==="full"&&(e.hasChildren()||i.length<t.length))return null;let r={};for(let a=0;a<i.length;a++){let d=i[a],v=t[a];if(d.startsWith(":"))r[d.substring(1)]=v;else if(d!==v.path)return null}return{consumed:t.slice(0,i.length),posParams:r}}function SD(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Qn(t[n],e[n]))return!1;return!0}function Qn(t,e){let n=t?Mf(t):void 0,i=e?Mf(e):void 0;if(!n||!i||n.length!=i.length)return!1;let r;for(let a=0;a<n.length;a++)if(r=n[a],!S_(t[r],e[r]))return!1;return!0}function Mf(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function S_(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;let n=[...t].sort(),i=[...e].sort();return n.every((r,a)=>i[a]===r)}else return t===e}function T_(t){return t.length>0?t[t.length-1]:null}function tr(t){return gu(t)?t:fs(t)?Ct(Promise.resolve(t)):Oe(t)}var TD={exact:A_,subset:M_},x_={exact:xD,subset:AD,ignored:()=>!0};function C_(t,e,n){return TD[n.paths](t.root,e.root,n.matrixParams)&&x_[n.queryParams](t.queryParams,e.queryParams)&&!(n.fragment==="exact"&&t.fragment!==e.fragment)}function xD(t,e){return Qn(t,e)}function A_(t,e,n){if(!Mr(t.segments,e.segments)||!Ul(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(let i in e.children)if(!t.children[i]||!A_(t.children[i],e.children[i],n))return!1;return!0}function AD(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>S_(t[n],e[n]))}function M_(t,e,n){return O_(t,e,e.segments,n)}function O_(t,e,n,i){if(t.segments.length>n.length){let r=t.segments.slice(0,n.length);return!(!Mr(r,n)||e.hasChildren()||!Ul(r,n,i))}else if(t.segments.length===n.length){if(!Mr(t.segments,n)||!Ul(t.segments,n,i))return!1;for(let r in e.children)if(!t.children[r]||!M_(t.children[r],e.children[r],i))return!1;return!0}else{let r=n.slice(0,t.segments.length),a=n.slice(t.segments.length);return!Mr(t.segments,r)||!Ul(t.segments,r,i)||!t.children[Pe]?!1:O_(t.children[Pe],e,a,i)}}function Ul(t,e,n){return e.every((i,r)=>x_[n](t[r].parameters,i.parameters))}var Ji=class{constructor(e=new it([],{}),n={},i=null){this.root=e,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap??=Bo(this.queryParams),this._queryParamMap}toString(){return RD.serialize(this)}},it=class{constructor(e,n){this.segments=e,this.children=n,this.parent=null,Object.values(n).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Hl(this)}},Ar=class{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap??=Bo(this.parameters),this._parameterMap}toString(){return L_(this)}};function MD(t,e){return Mr(t,e)&&t.every((n,i)=>Qn(n.parameters,e[i].parameters))}function Mr(t,e){return t.length!==e.length?!1:t.every((n,i)=>n.path===e[i].path)}function OD(t,e){let n=[];return Object.entries(t.children).forEach(([i,r])=>{i===Pe&&(n=n.concat(e(r,i)))}),Object.entries(t.children).forEach(([i,r])=>{i!==Pe&&(n=n.concat(e(r,i)))}),n}var np=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:()=>new Wl,providedIn:"root"})}}return t})(),Wl=class{parse(e){let n=new Rf(e);return new Ji(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){let n=`/${ta(e.root,!0)}`,i=PD(e.queryParams),r=typeof e.fragment=="string"?`#${LD(e.fragment)}`:"";return`${n}${i}${r}`}},RD=new Wl;function Hl(t){return t.segments.map(e=>L_(e)).join("/")}function ta(t,e){if(!t.hasChildren())return Hl(t);if(e){let n=t.children[Pe]?ta(t.children[Pe],!1):"",i=[];return Object.entries(t.children).forEach(([r,a])=>{r!==Pe&&i.push(`${r}:${ta(a,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}else{let n=OD(t,(i,r)=>r===Pe?[ta(t.children[Pe],!1)]:[`${r}:${ta(i,!1)}`]);return Object.keys(t.children).length===1&&t.children[Pe]!=null?`${Hl(t)}/${n[0]}`:`${Hl(t)}/(${n.join("//")})`}}function R_(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function jl(t){return R_(t).replace(/%3B/gi,";")}function LD(t){return encodeURI(t)}function Of(t){return R_(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Gl(t){return decodeURIComponent(t)}function E_(t){return Gl(t.replace(/\+/g,"%20"))}function L_(t){return`${Of(t.path)}${ND(t.parameters)}`}function ND(t){return Object.entries(t).map(([e,n])=>`;${Of(e)}=${Of(n)}`).join("")}function PD(t){let e=Object.entries(t).map(([n,i])=>Array.isArray(i)?i.map(r=>`${jl(n)}=${jl(r)}`).join("&"):`${jl(n)}=${jl(i)}`).filter(n=>n);return e.length?`?${e.join("&")}`:""}var FD=/^[^\/()?;#]+/;function Df(t){let e=t.match(FD);return e?e[0]:""}var kD=/^[^\/()?;=#]+/;function BD(t){let e=t.match(kD);return e?e[0]:""}var jD=/^[^=?&#]+/;function VD(t){let e=t.match(jD);return e?e[0]:""}var UD=/^[^&#]+/;function HD(t){let e=t.match(UD);return e?e[0]:""}var Rf=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new it([],{}):new it([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(i[Pe]=new it(e,n)),i}parseSegment(){let e=Df(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new Ae(4009,!1);return this.capture(e),new Ar(Gl(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let n=BD(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){let r=Df(this.remaining);r&&(i=r,this.capture(i))}e[Gl(n)]=Gl(i)}parseQueryParam(e){let n=VD(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){let d=HD(this.remaining);d&&(i=d,this.capture(i))}let r=E_(n),a=E_(i);if(e.hasOwnProperty(r)){let d=e[r];Array.isArray(d)||(d=[d],e[r]=d),d.push(a)}else e[r]=a}parseParens(e){let n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let i=Df(this.remaining),r=this.remaining[i.length];if(r!=="/"&&r!==")"&&r!==";")throw new Ae(4010,!1);let a;i.indexOf(":")>-1?(a=i.slice(0,i.indexOf(":")),this.capture(a),this.capture(":")):e&&(a=Pe);let d=this.parseChildren();n[a]=Object.keys(d).length===1?d[Pe]:new it([],d),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new Ae(4011,!1)}};function N_(t){return t.segments.length>0?new it([],{[Pe]:t}):t}function P_(t){let e={};for(let[i,r]of Object.entries(t.children)){let a=P_(r);if(i===Pe&&a.segments.length===0&&a.hasChildren())for(let[d,v]of Object.entries(a.children))e[d]=v;else(a.segments.length>0||a.hasChildren())&&(e[i]=a)}let n=new it(t.segments,e);return GD(n)}function GD(t){if(t.numberOfChildren===1&&t.children[Pe]){let e=t.children[Pe];return new it(t.segments.concat(e.segments),e.children)}return t}function jo(t){return t instanceof Ji}function WD(t,e,n=null,i=null){let r=F_(t);return k_(r,e,n,i)}function F_(t){let e;function n(a){let d={};for(let y of a.children){let C=n(y);d[y.outlet]=C}let v=new it(a.url,d);return a===t&&(e=v),v}let i=n(t.root),r=N_(i);return e??r}function k_(t,e,n,i){let r=t;for(;r.parent;)r=r.parent;if(e.length===0)return Sf(r,r,r,n,i);let a=$D(e);if(a.toRoot())return Sf(r,r,new it([],{}),n,i);let d=zD(a,r,t),v=d.processChildren?ra(d.segmentGroup,d.index,a.commands):j_(d.segmentGroup,d.index,a.commands);return Sf(r,d.segmentGroup,v,n,i)}function $l(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function aa(t){return typeof t=="object"&&t!=null&&t.outlets}function Sf(t,e,n,i,r){let a={};i&&Object.entries(i).forEach(([y,C])=>{a[y]=Array.isArray(C)?C.map(b=>`${b}`):`${C}`});let d;t===e?d=n:d=B_(t,e,n);let v=N_(P_(d));return new Ji(v,a,r)}function B_(t,e,n){let i={};return Object.entries(t.children).forEach(([r,a])=>{a===e?i[r]=n:i[r]=B_(a,e,n)}),new it(t.segments,i)}var zl=class{constructor(e,n,i){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=i,e&&i.length>0&&$l(i[0]))throw new Ae(4003,!1);let r=i.find(aa);if(r&&r!==T_(i))throw new Ae(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function $D(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new zl(!0,0,t);let e=0,n=!1,i=t.reduce((r,a,d)=>{if(typeof a=="object"&&a!=null){if(a.outlets){let v={};return Object.entries(a.outlets).forEach(([y,C])=>{v[y]=typeof C=="string"?C.split("/"):C}),[...r,{outlets:v}]}if(a.segmentPath)return[...r,a.segmentPath]}return typeof a!="string"?[...r,a]:d===0?(a.split("/").forEach((v,y)=>{y==0&&v==="."||(y==0&&v===""?n=!0:v===".."?e++:v!=""&&r.push(v))}),r):[...r,a]},[]);return new zl(n,e,i)}var Fo=class{constructor(e,n,i){this.segmentGroup=e,this.processChildren=n,this.index=i}};function zD(t,e,n){if(t.isAbsolute)return new Fo(e,!0,0);if(!n)return new Fo(e,!1,NaN);if(n.parent===null)return new Fo(n,!0,0);let i=$l(t.commands[0])?0:1,r=n.segments.length-1+i;return YD(n,r,t.numberOfDoubleDots)}function YD(t,e,n){let i=t,r=e,a=n;for(;a>r;){if(a-=r,i=i.parent,!i)throw new Ae(4005,!1);r=i.segments.length}return new Fo(i,!1,r-a)}function XD(t){return aa(t[0])?t[0].outlets:{[Pe]:t}}function j_(t,e,n){if(t??=new it([],{}),t.segments.length===0&&t.hasChildren())return ra(t,e,n);let i=qD(t,e,n),r=n.slice(i.commandIndex);if(i.match&&i.pathIndex<t.segments.length){let a=new it(t.segments.slice(0,i.pathIndex),{});return a.children[Pe]=new it(t.segments.slice(i.pathIndex),t.children),ra(a,0,r)}else return i.match&&r.length===0?new it(t.segments,{}):i.match&&!t.hasChildren()?Lf(t,e,n):i.match?ra(t,0,r):Lf(t,e,n)}function ra(t,e,n){if(n.length===0)return new it(t.segments,{});{let i=XD(n),r={};if(Object.keys(i).some(a=>a!==Pe)&&t.children[Pe]&&t.numberOfChildren===1&&t.children[Pe].segments.length===0){let a=ra(t.children[Pe],e,n);return new it(t.segments,a.children)}return Object.entries(i).forEach(([a,d])=>{typeof d=="string"&&(d=[d]),d!==null&&(r[a]=j_(t.children[a],e,d))}),Object.entries(t.children).forEach(([a,d])=>{i[a]===void 0&&(r[a]=d)}),new it(t.segments,r)}}function qD(t,e,n){let i=0,r=e,a={match:!1,pathIndex:0,commandIndex:0};for(;r<t.segments.length;){if(i>=n.length)return a;let d=t.segments[r],v=n[i];if(aa(v))break;let y=`${v}`,C=i<n.length-1?n[i+1]:null;if(r>0&&y===void 0)break;if(y&&C&&typeof C=="object"&&C.outlets===void 0){if(!b_(y,C,d))return a;i+=2}else{if(!b_(y,{},d))return a;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}function Lf(t,e,n){let i=t.segments.slice(0,e),r=0;for(;r<n.length;){let a=n[r];if(aa(a)){let y=ZD(a.outlets);return new it(i,y)}if(r===0&&$l(n[0])){let y=t.segments[e];i.push(new Ar(y.path,I_(n[0]))),r++;continue}let d=aa(a)?a.outlets[Pe]:`${a}`,v=r<n.length-1?n[r+1]:null;d&&v&&$l(v)?(i.push(new Ar(d,I_(v))),r+=2):(i.push(new Ar(d,{})),r++)}return new it(i,{})}function ZD(t){let e={};return Object.entries(t).forEach(([n,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(e[n]=Lf(new it([],{}),0,i))}),e}function I_(t){let e={};return Object.entries(t).forEach(([n,i])=>e[n]=`${i}`),e}function b_(t,e,n){return t==n.path&&Qn(e,n.parameters)}var oa="imperative",Lt=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(Lt||{}),_n=class{constructor(e,n){this.id=e,this.url=n}},ca=class extends _n{constructor(e,n,i="imperative",r=null){super(e,n),this.type=Lt.NavigationStart,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Or=class extends _n{constructor(e,n,i){super(e,n),this.urlAfterRedirects=i,this.type=Lt.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},rn=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(rn||{}),Nf=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(Nf||{}),er=class extends _n{constructor(e,n,i,r){super(e,n),this.reason=i,this.code=r,this.type=Lt.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Rr=class extends _n{constructor(e,n,i,r){super(e,n),this.reason=i,this.code=r,this.type=Lt.NavigationSkipped}},la=class extends _n{constructor(e,n,i,r){super(e,n),this.error=i,this.target=r,this.type=Lt.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Yl=class extends _n{constructor(e,n,i,r){super(e,n),this.urlAfterRedirects=i,this.state=r,this.type=Lt.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Pf=class extends _n{constructor(e,n,i,r){super(e,n),this.urlAfterRedirects=i,this.state=r,this.type=Lt.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ff=class extends _n{constructor(e,n,i,r,a){super(e,n),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=a,this.type=Lt.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},kf=class extends _n{constructor(e,n,i,r){super(e,n),this.urlAfterRedirects=i,this.state=r,this.type=Lt.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Bf=class extends _n{constructor(e,n,i,r){super(e,n),this.urlAfterRedirects=i,this.state=r,this.type=Lt.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},jf=class{constructor(e){this.route=e,this.type=Lt.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Vf=class{constructor(e){this.route=e,this.type=Lt.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Uf=class{constructor(e){this.snapshot=e,this.type=Lt.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Hf=class{constructor(e){this.snapshot=e,this.type=Lt.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Gf=class{constructor(e){this.snapshot=e,this.type=Lt.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Wf=class{constructor(e){this.snapshot=e,this.type=Lt.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var ua=class{},ha=class{constructor(e){this.url=e}};var $f=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Jl,this.attachRef=null}},Jl=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(n,i){let r=this.getOrCreateContext(n);r.outlet=i,this.contexts.set(n,r)}onChildOutletDestroyed(n){let i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new $f,this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Xl=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){let n=zf(e,this._root);return n?n.children.map(i=>i.value):[]}firstChild(e){let n=zf(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){let n=Yf(e,this._root);return n.length<2?[]:n[n.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return Yf(e,this._root).map(n=>n.value)}};function zf(t,e){if(t===e.value)return e;for(let n of e.children){let i=zf(t,n);if(i)return i}return null}function Yf(t,e){if(t===e.value)return[e];for(let n of e.children){let i=Yf(t,n);if(i.length)return i.unshift(e),i}return[]}var nn=class{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}};function Po(t){let e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}var ql=class extends Xl{constructor(e,n){super(e),this.snapshot=n,rp(this,e)}toString(){return this.snapshot.toString()}};function V_(t){let e=KD(t),n=new xt([new Ar("",{})]),i=new xt({}),r=new xt({}),a=new xt({}),d=new xt(""),v=new da(n,i,a,d,r,Pe,t,e.root);return v.snapshot=e.root,new ql(new nn(v,[]),e)}function KD(t){let e={},n={},i={},r="",a=new fa([],e,i,r,n,Pe,t,null,{});return new Zl("",new nn(a,[]))}var da=class{constructor(e,n,i,r,a,d,v,y){this.urlSubject=e,this.paramsSubject=n,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=a,this.outlet=d,this.component=v,this._futureSnapshot=y,this.title=this.dataSubject?.pipe(qe(C=>C[ma]))??Oe(void 0),this.url=e,this.params=n,this.queryParams=i,this.fragment=r,this.data=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(qe(e=>Bo(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(qe(e=>Bo(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function ip(t,e,n="emptyOnly"){let i,{routeConfig:r}=t;return e!==null&&(n==="always"||r?.path===""||!e.component&&!e.routeConfig?.loadComponent)?i={params:Te(Te({},e.params),t.params),data:Te(Te({},e.data),t.data),resolve:Te(Te(Te(Te({},t.data),e.data),r?.data),t._resolvedData)}:i={params:Te({},t.params),data:Te({},t.data),resolve:Te(Te({},t.data),t._resolvedData??{})},r&&H_(r)&&(i.resolve[ma]=r.title),i}var fa=class{get title(){return this.data?.[ma]}constructor(e,n,i,r,a,d,v,y,C){this.url=e,this.params=n,this.queryParams=i,this.fragment=r,this.data=a,this.outlet=d,this.component=v,this.routeConfig=y,this._resolve=C}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Bo(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Bo(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(i=>i.toString()).join("/"),n=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${n}')`}},Zl=class extends Xl{constructor(e,n){super(n),this.url=e,rp(this,n)}toString(){return U_(this._root)}};function rp(t,e){e.value._routerState=t,e.children.forEach(n=>rp(t,n))}function U_(t){let e=t.children.length>0?` { ${t.children.map(U_).join(", ")} } `:"";return`${t.value}${e}`}function Tf(t){if(t.snapshot){let e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Qn(e.queryParams,n.queryParams)||t.queryParamsSubject.next(n.queryParams),e.fragment!==n.fragment&&t.fragmentSubject.next(n.fragment),Qn(e.params,n.params)||t.paramsSubject.next(n.params),SD(e.url,n.url)||t.urlSubject.next(n.url),Qn(e.data,n.data)||t.dataSubject.next(n.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function Xf(t,e){let n=Qn(t.params,e.params)&&MD(t.url,e.url),i=!t.parent!=!e.parent;return n&&!i&&(!t.parent||Xf(t.parent,e.parent))}function H_(t){return typeof t.title=="string"||t.title===null}var QD=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=Pe,this.activateEvents=new ln,this.deactivateEvents=new ln,this.attachEvents=new ln,this.detachEvents=new ln,this.parentContexts=Ie(Jl),this.location=Ie(ao),this.changeDetector=Ie(ps),this.environmentInjector=Ie(un),this.inputBinder=Ie(op,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){let{firstChange:i,previousValue:r}=n.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ae(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ae(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ae(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Ae(4013,!1);this._activatedRoute=n;let r=this.location,d=n.snapshot.component,v=this.parentContexts.getOrCreateContext(this.name).children,y=new qf(n,v,r.injector);this.activated=r.createComponent(d,{index:r.length,injector:y,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275dir=fc({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[vc]})}}return t})(),qf=class t{__ngOutletInjector(e){return new t(this.route,this.childContexts,e)}constructor(e,n,i){this.route=e,this.childContexts=n,this.parent=i}get(e,n){return e===da?this.route:e===Jl?this.childContexts:this.parent.get(e,n)}},op=new nt("");function JD(t,e,n){let i=pa(t,e._root,n?n._root:void 0);return new ql(i,e)}function pa(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){let i=n.value;i._futureSnapshot=e.value;let r=eS(t,e,n);return new nn(i,r)}else{if(t.shouldAttach(e.value)){let a=t.retrieve(e.value);if(a!==null){let d=a.route;return d.value._futureSnapshot=e.value,d.children=e.children.map(v=>pa(t,v)),d}}let i=tS(e.value),r=e.children.map(a=>pa(t,a));return new nn(i,r)}}function eS(t,e,n){return e.children.map(i=>{for(let r of n.children)if(t.shouldReuseRoute(i.value,r.value.snapshot))return pa(t,i,r);return pa(t,i)})}function tS(t){return new da(new xt(t.url),new xt(t.params),new xt(t.queryParams),new xt(t.fragment),new xt(t.data),t.outlet,t.component,t)}var G_="ngNavigationCancelingError";function W_(t,e){let{redirectTo:n,navigationBehaviorOptions:i}=jo(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=$_(!1,rn.Redirect);return r.url=n,r.navigationBehaviorOptions=i,r}function $_(t,e){let n=new Error(`NavigationCancelingError: ${t||""}`);return n[G_]=!0,n.cancellationCode=e,n}function nS(t){return z_(t)&&jo(t.url)}function z_(t){return!!t&&t[G_]}var iS=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Mi({type:t,selectors:[["ng-component"]],standalone:!0,features:[Pi],decls:1,vars:0,template:function(i,r){i&1&&ci(0,"router-outlet")},dependencies:[QD],encapsulation:2})}}return t})();function rS(t,e){return t.providers&&!t._injector&&(t._injector=cd(t.providers,e,`Route: ${t.path}`)),t._injector??e}function sp(t){let e=t.children&&t.children.map(sp),n=e?mt(Te({},t),{children:e}):Te({},t);return!n.component&&!n.loadComponent&&(e||n.loadChildren)&&n.outlet&&n.outlet!==Pe&&(n.component=iS),n}function Jn(t){return t.outlet||Pe}function oS(t,e){let n=t.filter(i=>Jn(i)===e);return n.push(...t.filter(i=>Jn(i)!==e)),n}function va(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let e=t.parent;e;e=e.parent){let n=e.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}var sS=(t,e,n,i)=>qe(r=>(new Zf(e,r.targetRouterState,r.currentRouterState,n,i).activate(t),r)),Zf=class{constructor(e,n,i,r,a){this.routeReuseStrategy=e,this.futureState=n,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=a}activate(e){let n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,e),Tf(this.futureState.root),this.activateChildRoutes(n,i,e)}deactivateChildRoutes(e,n,i){let r=Po(n);e.children.forEach(a=>{let d=a.value.outlet;this.deactivateRoutes(a,r[d],i),delete r[d]}),Object.values(r).forEach(a=>{this.deactivateRouteAndItsChildren(a,i)})}deactivateRoutes(e,n,i){let r=e.value,a=n?n.value:null;if(r===a)if(r.component){let d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(e,n,d.children)}else this.deactivateChildRoutes(e,n,i);else a&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){let i=n.getContext(e.value.outlet),r=i&&e.value.component?i.children:n,a=Po(e);for(let d of Object.values(a))this.deactivateRouteAndItsChildren(d,r);if(i&&i.outlet){let d=i.outlet.detach(),v=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:d,route:e,contexts:v})}}deactivateRouteAndOutlet(e,n){let i=n.getContext(e.value.outlet),r=i&&e.value.component?i.children:n,a=Po(e);for(let d of Object.values(a))this.deactivateRouteAndItsChildren(d,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(e,n,i){let r=Po(n);e.children.forEach(a=>{this.activateRoutes(a,r[a.value.outlet],i),this.forwardEvent(new Wf(a.value.snapshot))}),e.children.length&&this.forwardEvent(new Hf(e.value.snapshot))}activateRoutes(e,n,i){let r=e.value,a=n?n.value:null;if(Tf(r),r===a)if(r.component){let d=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,n,d.children)}else this.activateChildRoutes(e,n,i);else if(r.component){let d=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let v=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),d.children.onOutletReAttached(v.contexts),d.attachRef=v.componentRef,d.route=v.route.value,d.outlet&&d.outlet.attach(v.componentRef,v.route.value),Tf(v.route.value),this.activateChildRoutes(e,null,d.children)}else{let v=va(r.snapshot);d.attachRef=null,d.route=r,d.injector=v,d.outlet&&d.outlet.activateWith(r,d.injector),this.activateChildRoutes(e,null,d.children)}}else this.activateChildRoutes(e,null,i)}},Kl=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},ko=class{constructor(e,n){this.component=e,this.route=n}};function aS(t,e,n){let i=t._root,r=e?e._root:null;return na(i,r,n,[i.value])}function cS(t){let e=t.routeConfig?t.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:t,guards:e}}function Uo(t,e){let n=Symbol(),i=e.get(t,n);return i===n?typeof t=="function"&&!Ag(t)?t:e.get(t):i}function na(t,e,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let a=Po(e);return t.children.forEach(d=>{lS(d,a[d.value.outlet],n,i.concat([d.value]),r),delete a[d.value.outlet]}),Object.entries(a).forEach(([d,v])=>sa(v,n.getContext(d),r)),r}function lS(t,e,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let a=t.value,d=e?e.value:null,v=n?n.getContext(t.value.outlet):null;if(d&&a.routeConfig===d.routeConfig){let y=uS(d,a,a.routeConfig.runGuardsAndResolvers);y?r.canActivateChecks.push(new Kl(i)):(a.data=d.data,a._resolvedData=d._resolvedData),a.component?na(t,e,v?v.children:null,i,r):na(t,e,n,i,r),y&&v&&v.outlet&&v.outlet.isActivated&&r.canDeactivateChecks.push(new ko(v.outlet.component,d))}else d&&sa(e,v,r),r.canActivateChecks.push(new Kl(i)),a.component?na(t,null,v?v.children:null,i,r):na(t,null,n,i,r);return r}function uS(t,e,n){if(typeof n=="function")return n(t,e);switch(n){case"pathParamsChange":return!Mr(t.url,e.url);case"pathParamsOrQueryParamsChange":return!Mr(t.url,e.url)||!Qn(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Xf(t,e)||!Qn(t.queryParams,e.queryParams);case"paramsChange":default:return!Xf(t,e)}}function sa(t,e,n){let i=Po(t),r=t.value;Object.entries(i).forEach(([a,d])=>{r.component?e?sa(d,e.children.getContext(a),n):sa(d,null,n):sa(d,e,n)}),r.component?e&&e.outlet&&e.outlet.isActivated?n.canDeactivateChecks.push(new ko(e.outlet.component,r)):n.canDeactivateChecks.push(new ko(null,r)):n.canDeactivateChecks.push(new ko(null,r))}function ya(t){return typeof t=="function"}function hS(t){return typeof t=="boolean"}function dS(t){return t&&ya(t.canLoad)}function fS(t){return t&&ya(t.canActivate)}function pS(t){return t&&ya(t.canActivateChild)}function gS(t){return t&&ya(t.canDeactivate)}function mS(t){return t&&ya(t.canMatch)}function Y_(t){return t instanceof ti||t?.name==="EmptyError"}var Vl=Symbol("INITIAL_VALUE");function Vo(){return En(t=>Ba(t.map(e=>e.pipe(ni(1),wu(Vl)))).pipe(qe(e=>{for(let n of e)if(n!==!0){if(n===Vl)return Vl;if(n===!1||n instanceof Ji)return n}return!0}),Cn(e=>e!==Vl),ni(1)))}function vS(t,e){return Et(n=>{let{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:a,canDeactivateChecks:d}}=n;return d.length===0&&a.length===0?Oe(mt(Te({},n),{guardsResult:!0})):yS(d,i,r,t).pipe(Et(v=>v&&hS(v)?_S(i,a,t,e):Oe(v)),qe(v=>mt(Te({},n),{guardsResult:v})))})}function yS(t,e,n,i){return Ct(t).pipe(Et(r=>bS(r.component,r.route,n,e,i)),Fn(r=>r!==!0,!0))}function _S(t,e,n,i){return Ct(e).pipe($r(r=>Wr(CS(r.route.parent,i),wS(r.route,i),IS(t,r.path,n),ES(t,r.route,n))),Fn(r=>r!==!0,!0))}function wS(t,e){return t!==null&&e&&e(new Gf(t)),Oe(!0)}function CS(t,e){return t!==null&&e&&e(new Uf(t)),Oe(!0)}function ES(t,e,n){let i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||i.length===0)return Oe(!0);let r=i.map(a=>ja(()=>{let d=va(e)??n,v=Uo(a,d),y=fS(v)?v.canActivate(e,t):gr(d,()=>v(e,t));return tr(y).pipe(Fn())}));return Oe(r).pipe(Vo())}function IS(t,e,n){let i=e[e.length-1],a=e.slice(0,e.length-1).reverse().map(d=>cS(d)).filter(d=>d!==null).map(d=>ja(()=>{let v=d.guards.map(y=>{let C=va(d.node)??n,b=Uo(y,C),T=pS(b)?b.canActivateChild(i,t):gr(C,()=>b(i,t));return tr(T).pipe(Fn())});return Oe(v).pipe(Vo())}));return Oe(a).pipe(Vo())}function bS(t,e,n,i,r){let a=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!a||a.length===0)return Oe(!0);let d=a.map(v=>{let y=va(e)??r,C=Uo(v,y),b=gS(C)?C.canDeactivate(t,e,n,i):gr(y,()=>C(t,e,n,i));return tr(b).pipe(Fn())});return Oe(d).pipe(Vo())}function DS(t,e,n,i){let r=e.canLoad;if(r===void 0||r.length===0)return Oe(!0);let a=r.map(d=>{let v=Uo(d,t),y=dS(v)?v.canLoad(e,n):gr(t,()=>v(e,n));return tr(y)});return Oe(a).pipe(Vo(),X_(i))}function X_(t){return hu(At(e=>{if(jo(e))throw W_(t,e)}),qe(e=>e===!0))}function SS(t,e,n,i){let r=e.canMatch;if(!r||r.length===0)return Oe(!0);let a=r.map(d=>{let v=Uo(d,t),y=mS(v)?v.canMatch(e,n):gr(t,()=>v(e,n));return tr(y)});return Oe(a).pipe(Vo(),X_(i))}var ga=class{constructor(e){this.segmentGroup=e||null}},Ql=class extends Error{constructor(e){super(),this.urlTree=e}};function No(t){return Gr(new ga(t))}function TS(t){return Gr(new Ae(4e3,!1))}function xS(t){return Gr($_(!1,rn.GuardRejected))}var Kf=class{constructor(e,n){this.urlSerializer=e,this.urlTree=n}lineralizeSegments(e,n){let i=[],r=n.root;for(;;){if(i=i.concat(r.segments),r.numberOfChildren===0)return Oe(i);if(r.numberOfChildren>1||!r.children[Pe])return TS(e.redirectTo);r=r.children[Pe]}}applyRedirectCommands(e,n,i){let r=this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),e,i);if(n.startsWith("/"))throw new Ql(r);return r}applyRedirectCreateUrlTree(e,n,i,r){let a=this.createSegmentGroup(e,n.root,i,r);return new Ji(a,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){let i={};return Object.entries(e).forEach(([r,a])=>{if(typeof a=="string"&&a.startsWith(":")){let v=a.substring(1);i[r]=n[v]}else i[r]=a}),i}createSegmentGroup(e,n,i,r){let a=this.createSegments(e,n.segments,i,r),d={};return Object.entries(n.children).forEach(([v,y])=>{d[v]=this.createSegmentGroup(e,y,i,r)}),new it(a,d)}createSegments(e,n,i,r){return n.map(a=>a.path.startsWith(":")?this.findPosParam(e,a,r):this.findOrReturn(a,i))}findPosParam(e,n,i){let r=i[n.path.substring(1)];if(!r)throw new Ae(4001,!1);return r}findOrReturn(e,n){let i=0;for(let r of n){if(r.path===e.path)return n.splice(i),r;i++}return e}},Qf={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function AS(t,e,n,i,r){let a=ap(t,e,n);return a.matched?(i=rS(e,i),SS(i,e,n,r).pipe(qe(d=>d===!0?a:Te({},Qf)))):Oe(a)}function ap(t,e,n){if(e.path==="**")return MS(n);if(e.path==="")return e.pathMatch==="full"&&(t.hasChildren()||n.length>0)?Te({},Qf):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};let r=(e.matcher||DD)(n,t,e);if(!r)return Te({},Qf);let a={};Object.entries(r.posParams??{}).forEach(([v,y])=>{a[v]=y.path});let d=r.consumed.length>0?Te(Te({},a),r.consumed[r.consumed.length-1].parameters):a;return{matched:!0,consumedSegments:r.consumed,remainingSegments:n.slice(r.consumed.length),parameters:d,positionalParamSegments:r.posParams??{}}}function MS(t){return{matched:!0,parameters:t.length>0?T_(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function D_(t,e,n,i){return n.length>0&&LS(t,n,i)?{segmentGroup:new it(e,RS(i,new it(n,t.children))),slicedSegments:[]}:n.length===0&&NS(t,n,i)?{segmentGroup:new it(t.segments,OS(t,n,i,t.children)),slicedSegments:n}:{segmentGroup:new it(t.segments,t.children),slicedSegments:n}}function OS(t,e,n,i){let r={};for(let a of n)if(eu(t,e,a)&&!i[Jn(a)]){let d=new it([],{});r[Jn(a)]=d}return Te(Te({},i),r)}function RS(t,e){let n={};n[Pe]=e;for(let i of t)if(i.path===""&&Jn(i)!==Pe){let r=new it([],{});n[Jn(i)]=r}return n}function LS(t,e,n){return n.some(i=>eu(t,e,i)&&Jn(i)!==Pe)}function NS(t,e,n){return n.some(i=>eu(t,e,i))}function eu(t,e,n){return(t.hasChildren()||e.length>0)&&n.pathMatch==="full"?!1:n.path===""}function PS(t,e,n,i){return Jn(t)!==i&&(i===Pe||!eu(e,n,t))?!1:ap(e,t,n).matched}function FS(t,e,n){return e.length===0&&!t.children[n]}var Jf=class{};function kS(t,e,n,i,r,a,d="emptyOnly"){return new ep(t,e,n,i,r,d,a).recognize()}var BS=31,ep=class{constructor(e,n,i,r,a,d,v){this.injector=e,this.configLoader=n,this.rootComponentType=i,this.config=r,this.urlTree=a,this.paramsInheritanceStrategy=d,this.urlSerializer=v,this.applyRedirects=new Kf(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new Ae(4002,`'${e.segmentGroup}'`)}recognize(){let e=D_(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(qe(n=>{let i=new fa([],Object.freeze({}),Object.freeze(Te({},this.urlTree.queryParams)),this.urlTree.fragment,{},Pe,this.rootComponentType,null,{}),r=new nn(i,n),a=new Zl("",r),d=WD(i,[],this.urlTree.queryParams,this.urlTree.fragment);return d.queryParams=this.urlTree.queryParams,a.url=this.urlSerializer.serialize(d),this.inheritParamsAndData(a._root,null),{state:a,tree:d}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,Pe).pipe(bi(i=>{if(i instanceof Ql)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof ga?this.noMatchError(i):i}))}inheritParamsAndData(e,n){let i=e.value,r=ip(i,n,this.paramsInheritanceStrategy);i.params=Object.freeze(r.params),i.data=Object.freeze(r.data),e.children.forEach(a=>this.inheritParamsAndData(a,i))}processSegmentGroup(e,n,i,r){return i.segments.length===0&&i.hasChildren()?this.processChildren(e,n,i):this.processSegment(e,n,i,i.segments,r,!0).pipe(qe(a=>a instanceof nn?[a]:[]))}processChildren(e,n,i){let r=[];for(let a of Object.keys(i.children))a==="primary"?r.unshift(a):r.push(a);return Ct(r).pipe($r(a=>{let d=i.children[a],v=oS(n,a);return this.processSegmentGroup(e,v,d,a)}),_u((a,d)=>(a.push(...d),a)),Di(null),yu(),Et(a=>{if(a===null)return No(i);let d=q_(a);return jS(d),Oe(d)}))}processSegment(e,n,i,r,a,d){return Ct(n).pipe($r(v=>this.processSegmentAgainstRoute(v._injector??e,n,v,i,r,a,d).pipe(bi(y=>{if(y instanceof ga)return Oe(null);throw y}))),Fn(v=>!!v),bi(v=>{if(Y_(v))return FS(i,r,a)?Oe(new Jf):No(i);throw v}))}processSegmentAgainstRoute(e,n,i,r,a,d,v){return PS(i,r,a,d)?i.redirectTo===void 0?this.matchSegmentAgainstRoute(e,r,i,a,d):this.allowRedirects&&v?this.expandSegmentAgainstRouteUsingRedirect(e,r,n,i,a,d):No(r):No(r)}expandSegmentAgainstRouteUsingRedirect(e,n,i,r,a,d){let{matched:v,consumedSegments:y,positionalParamSegments:C,remainingSegments:b}=ap(n,r,a);if(!v)return No(n);r.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>BS&&(this.allowRedirects=!1));let T=this.applyRedirects.applyRedirectCommands(y,r.redirectTo,C);return this.applyRedirects.lineralizeSegments(r,T).pipe(Et(M=>this.processSegment(e,i,n,M.concat(b),d,!1)))}matchSegmentAgainstRoute(e,n,i,r,a){let d=AS(n,i,r,e,this.urlSerializer);return i.path==="**"&&(n.children={}),d.pipe(En(v=>v.matched?(e=i._injector??e,this.getChildConfig(e,i,r).pipe(En(({routes:y})=>{let C=i._loadedInjector??e,{consumedSegments:b,remainingSegments:T,parameters:M}=v,O=new fa(b,M,Object.freeze(Te({},this.urlTree.queryParams)),this.urlTree.fragment,US(i),Jn(i),i.component??i._loadedComponent??null,i,HS(i)),{segmentGroup:L,slicedSegments:P}=D_(n,b,T,y);if(P.length===0&&L.hasChildren())return this.processChildren(C,y,L).pipe(qe(H=>H===null?null:new nn(O,H)));if(y.length===0&&P.length===0)return Oe(new nn(O,[]));let Y=Jn(i)===a;return this.processSegment(C,y,L,P,Y?Pe:a,!0).pipe(qe(H=>new nn(O,H instanceof nn?[H]:[])))}))):No(n)))}getChildConfig(e,n,i){return n.children?Oe({routes:n.children,injector:e}):n.loadChildren?n._loadedRoutes!==void 0?Oe({routes:n._loadedRoutes,injector:n._loadedInjector}):DS(e,n,i,this.urlSerializer).pipe(Et(r=>r?this.configLoader.loadChildren(e,n).pipe(At(a=>{n._loadedRoutes=a.routes,n._loadedInjector=a.injector})):xS(n))):Oe({routes:[],injector:e})}};function jS(t){t.sort((e,n)=>e.value.outlet===Pe?-1:n.value.outlet===Pe?1:e.value.outlet.localeCompare(n.value.outlet))}function VS(t){let e=t.value.routeConfig;return e&&e.path===""}function q_(t){let e=[],n=new Set;for(let i of t){if(!VS(i)){e.push(i);continue}let r=e.find(a=>i.value.routeConfig===a.value.routeConfig);r!==void 0?(r.children.push(...i.children),n.add(r)):e.push(i)}for(let i of n){let r=q_(i.children);e.push(new nn(i.value,r))}return e.filter(i=>!n.has(i))}function US(t){return t.data||{}}function HS(t){return t.resolve||{}}function GS(t,e,n,i,r,a){return Et(d=>kS(t,e,n,i,d.extractedUrl,r,a).pipe(qe(({state:v,tree:y})=>mt(Te({},d),{targetSnapshot:v,urlAfterRedirects:y}))))}function WS(t,e){return Et(n=>{let{targetSnapshot:i,guards:{canActivateChecks:r}}=n;if(!r.length)return Oe(n);let a=new Set(r.map(y=>y.route)),d=new Set;for(let y of a)if(!d.has(y))for(let C of Z_(y))d.add(C);let v=0;return Ct(d).pipe($r(y=>a.has(y)?$S(y,i,t,e):(y.data=ip(y,y.parent,t).resolve,Oe(void 0))),At(()=>v++),zr(1),Et(y=>v===d.size?Oe(n):Wt))})}function Z_(t){let e=t.children.map(n=>Z_(n)).flat();return[t,...e]}function $S(t,e,n,i){let r=t.routeConfig,a=t._resolve;return r?.title!==void 0&&!H_(r)&&(a[ma]=r.title),zS(a,t,e,i).pipe(qe(d=>(t._resolvedData=d,t.data=ip(t,t.parent,n).resolve,null)))}function zS(t,e,n,i){let r=Mf(t);if(r.length===0)return Oe({});let a={};return Ct(r).pipe(Et(d=>YS(t[d],e,n,i).pipe(Fn(),At(v=>{a[d]=v}))),zr(1),vu(a),bi(d=>Y_(d)?Wt:Gr(d)))}function YS(t,e,n,i){let r=va(e)??i,a=Uo(t,r),d=a.resolve?a.resolve(e,n):gr(r,()=>a(e,n));return tr(d)}function xf(t){return En(e=>{let n=t(e);return n?Ct(n).pipe(qe(()=>e)):Oe(e)})}var K_=(()=>{class t{buildTitle(n){let i,r=n.root;for(;r!==void 0;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(a=>a.outlet===Pe);return i}getResolvedTitleForRoute(n){return n.data[ma]}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:()=>Ie(XS),providedIn:"root"})}}return t})(),XS=(()=>{class t extends K_{constructor(n){super(),this.title=n}updateTitle(n){let i=this.buildTitle(n);i!==void 0&&this.title.setTitle(i)}static{this.\u0275fac=function(i){return new(i||t)(Ze(Qv))}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),cp=new nt("",{providedIn:"root",factory:()=>({})}),Q_=new nt(""),qS=(()=>{class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Ie(pd)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Oe(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let i=tr(n.loadComponent()).pipe(qe(J_),At(a=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=a}),Yo(()=>{this.componentLoaders.delete(n)})),r=new Hr(i,()=>new Bt).pipe(Ur());return this.componentLoaders.set(n,r),r}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Oe({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let a=ZS(i,this.compiler,n,this.onLoadEndListener).pipe(Yo(()=>{this.childrenLoaders.delete(i)})),d=new Hr(a,()=>new Bt).pipe(Ur());return this.childrenLoaders.set(i,d),d}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function ZS(t,e,n,i){return tr(t.loadChildren()).pipe(qe(J_),Et(r=>r instanceof as||Array.isArray(r)?Oe(r):Ct(e.compileModuleAsync(r))),qe(r=>{i&&i(t);let a,d,v=!1;return Array.isArray(r)?(d=r,v=!0):(a=r.create(n).injector,d=a.get(Q_,[],{optional:!0,self:!0}).flat()),{routes:d.map(sp),injector:a}}))}function KS(t){return t&&typeof t=="object"&&"default"in t}function J_(t){return KS(t)?t.default:t}var lp=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:()=>Ie(QS),providedIn:"root"})}}return t})(),QS=(()=>{class t{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),JS=new nt("");var eT=(()=>{class t{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Bt,this.transitionAbortSubject=new Bt,this.configLoader=Ie(qS),this.environmentInjector=Ie(un),this.urlSerializer=Ie(np),this.rootContexts=Ie(Jl),this.location=Ie(gs),this.inputBindingEnabled=Ie(op,{optional:!0})!==null,this.titleStrategy=Ie(K_),this.options=Ie(cp,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Ie(lp),this.createViewTransition=Ie(JS,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Oe(void 0),this.rootComponentType=null;let n=r=>this.events.next(new jf(r)),i=r=>this.events.next(new Vf(r));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=n}complete(){this.transitions?.complete()}handleNavigationRequest(n){let i=++this.navigationId;this.transitions?.next(mt(Te(Te({},this.transitions.value),n),{id:i}))}setupNavigations(n,i,r){return this.transitions=new xt({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:oa,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Cn(a=>a.id!==0),qe(a=>mt(Te({},a),{extractedUrl:this.urlHandlingStrategy.extract(a.rawUrl)})),En(a=>{let d=!1,v=!1;return Oe(a).pipe(En(y=>{if(this.navigationId>a.id)return this.cancelNavigationTransition(a,"",rn.SupersededByNewNavigation),Wt;this.currentTransition=a,this.currentNavigation={id:y.id,initialUrl:y.rawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?mt(Te({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let C=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),b=y.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!C&&b!=="reload"){let T="";return this.events.next(new Rr(y.id,this.urlSerializer.serialize(y.rawUrl),T,Nf.IgnoredSameUrlNavigation)),y.resolve(null),Wt}if(this.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return Oe(y).pipe(En(T=>{let M=this.transitions?.getValue();return this.events.next(new ca(T.id,this.urlSerializer.serialize(T.extractedUrl),T.source,T.restoredState)),M!==this.transitions?.getValue()?Wt:Promise.resolve(T)}),GS(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),At(T=>{a.targetSnapshot=T.targetSnapshot,a.urlAfterRedirects=T.urlAfterRedirects,this.currentNavigation=mt(Te({},this.currentNavigation),{finalUrl:T.urlAfterRedirects});let M=new Yl(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(M)}));if(C&&this.urlHandlingStrategy.shouldProcessUrl(y.currentRawUrl)){let{id:T,extractedUrl:M,source:O,restoredState:L,extras:P}=y,Y=new ca(T,this.urlSerializer.serialize(M),O,L);this.events.next(Y);let H=V_(this.rootComponentType).snapshot;return this.currentTransition=a=mt(Te({},y),{targetSnapshot:H,urlAfterRedirects:M,extras:mt(Te({},P),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=M,Oe(a)}else{let T="";return this.events.next(new Rr(y.id,this.urlSerializer.serialize(y.extractedUrl),T,Nf.IgnoredByUrlHandlingStrategy)),y.resolve(null),Wt}}),At(y=>{let C=new Pf(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot);this.events.next(C)}),qe(y=>(this.currentTransition=a=mt(Te({},y),{guards:aS(y.targetSnapshot,y.currentSnapshot,this.rootContexts)}),a)),vS(this.environmentInjector,y=>this.events.next(y)),At(y=>{if(a.guardsResult=y.guardsResult,jo(y.guardsResult))throw W_(this.urlSerializer,y.guardsResult);let C=new Ff(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.events.next(C)}),Cn(y=>y.guardsResult?!0:(this.cancelNavigationTransition(y,"",rn.GuardRejected),!1)),xf(y=>{if(y.guards.canActivateChecks.length)return Oe(y).pipe(At(C=>{let b=new kf(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(b)}),En(C=>{let b=!1;return Oe(C).pipe(WS(this.paramsInheritanceStrategy,this.environmentInjector),At({next:()=>b=!0,complete:()=>{b||this.cancelNavigationTransition(C,"",rn.NoDataFromResolver)}}))}),At(C=>{let b=new Bf(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(b)}))}),xf(y=>{let C=b=>{let T=[];b.routeConfig?.loadComponent&&!b.routeConfig._loadedComponent&&T.push(this.configLoader.loadComponent(b.routeConfig).pipe(At(M=>{b.component=M}),qe(()=>{})));for(let M of b.children)T.push(...C(M));return T};return Ba(C(y.targetSnapshot.root)).pipe(Di(null),ni(1))}),xf(()=>this.afterPreactivation()),En(()=>{let{currentSnapshot:y,targetSnapshot:C}=a,b=this.createViewTransition?.(this.environmentInjector,y.root,C.root);return b?Ct(b).pipe(qe(()=>a)):Oe(a)}),qe(y=>{let C=JD(n.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return this.currentTransition=a=mt(Te({},y),{targetRouterState:C}),this.currentNavigation.targetRouterState=C,a}),At(()=>{this.events.next(new ua)}),sS(this.rootContexts,n.routeReuseStrategy,y=>this.events.next(y),this.inputBindingEnabled),ni(1),At({next:y=>{d=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Or(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects))),this.titleStrategy?.updateTitle(y.targetRouterState.snapshot),y.resolve(!0)},complete:()=>{d=!0}}),Cu(this.transitionAbortSubject.pipe(At(y=>{throw y}))),Yo(()=>{!d&&!v&&this.cancelNavigationTransition(a,"",rn.SupersededByNewNavigation),this.currentTransition?.id===a.id&&(this.currentNavigation=null,this.currentTransition=null)}),bi(y=>{if(v=!0,z_(y))this.events.next(new er(a.id,this.urlSerializer.serialize(a.extractedUrl),y.message,y.cancellationCode)),nS(y)?this.events.next(new ha(y.url)):a.resolve(!1);else{this.events.next(new la(a.id,this.urlSerializer.serialize(a.extractedUrl),y,a.targetSnapshot??void 0));try{a.resolve(n.errorHandler(y))}catch(C){this.options.resolveNavigationPromiseOnError?a.resolve(!1):a.reject(C)}}return Wt}))}))}cancelNavigationTransition(n,i,r){let a=new er(n.id,this.urlSerializer.serialize(n.extractedUrl),i,r);this.events.next(a),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function tT(t){return t!==oa}var nT=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:()=>Ie(iT),providedIn:"root"})}}return t})(),tp=class{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}},iT=(()=>{class t extends tp{static{this.\u0275fac=(()=>{let n;return function(r){return(n||(n=Wh(t)))(r||t)}})()}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),ew=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:()=>Ie(rT),providedIn:"root"})}}return t})(),rT=(()=>{class t extends ew{constructor(){super(...arguments),this.location=Ie(gs),this.urlSerializer=Ie(np),this.options=Ie(cp,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Ie(lp),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Ji,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=V_(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(i=>{i.type==="popstate"&&n(i.url,i.state)})}handleRouterEvent(n,i){if(n instanceof ca)this.stateMemento=this.createStateMemento();else if(n instanceof Rr)this.rawUrlTree=i.initialUrl;else if(n instanceof Yl){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(r,i)}}else n instanceof ua?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):n instanceof er&&(n.code===rn.GuardRejected||n.code===rn.NoDataFromResolver)?this.restoreHistory(i):n instanceof la?this.restoreHistory(i,!0):n instanceof Or&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,i){let r=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){let a=this.browserPageId,d=Te(Te({},i.extras.state),this.generateNgRouterState(i.id,a));this.location.replaceState(r,"",d)}else{let a=Te(Te({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(r,"",a)}}restoreHistory(n,i=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,a=this.currentPageId-r;a!==0?this.location.historyGo(a):this.currentUrlTree===n.finalUrl&&a===0&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}static{this.\u0275fac=(()=>{let n;return function(r){return(n||(n=Wh(t)))(r||t)}})()}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),ia=function(t){return t[t.COMPLETE=0]="COMPLETE",t[t.FAILED=1]="FAILED",t[t.REDIRECTING=2]="REDIRECTING",t}(ia||{});function oT(t,e){t.events.pipe(Cn(n=>n instanceof Or||n instanceof er||n instanceof la||n instanceof Rr),qe(n=>n instanceof Or||n instanceof Rr?ia.COMPLETE:(n instanceof er?n.code===rn.Redirect||n.code===rn.SupersededByNewNavigation:!1)?ia.REDIRECTING:ia.FAILED),Cn(n=>n!==ia.REDIRECTING),ni(1)).subscribe(()=>{e()})}function sT(t){throw t}var aT={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},cT={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},tw=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Ie(xc),this.stateManager=Ie(ew),this.options=Ie(cp,{optional:!0})||{},this.pendingTasks=Ie(Dc),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Ie(eT),this.urlSerializer=Ie(np),this.location=Ie(gs),this.urlHandlingStrategy=Ie(lp),this._events=new Bt,this.errorHandler=this.options.errorHandler||sT,this.navigated=!1,this.routeReuseStrategy=Ie(nT),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Ie(Q_,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Ie(op,{optional:!0}),this.eventsSubscription=new wt,this.isNgZoneEnabled=Ie(vt)instanceof vt&&vt.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(i=>{try{let r=this.navigationTransitions.currentTransition,a=this.navigationTransitions.currentNavigation;if(r!==null&&a!==null){if(this.stateManager.handleRouterEvent(i,a),i instanceof er&&i.code!==rn.Redirect&&i.code!==rn.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Or)this.navigated=!0;else if(i instanceof ha){let d=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),v={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||tT(r.source)};this.scheduleNavigation(d,oa,null,v,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}uT(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),oa,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",i)},0)})}navigateToSyncWithBrowser(n,i,r){let a={replaceUrl:!0},d=r?.navigationId?r:null;if(r){let y=Te({},r);delete y.navigationId,delete y.\u0275routerPageId,Object.keys(y).length!==0&&(a.state=y)}let v=this.parseUrl(n);this.scheduleNavigation(v,i,d,a)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(sp),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,i={}){let{relativeTo:r,queryParams:a,fragment:d,queryParamsHandling:v,preserveFragment:y}=i,C=y?this.currentUrlTree.fragment:d,b=null;switch(v){case"merge":b=Te(Te({},this.currentUrlTree.queryParams),a);break;case"preserve":b=this.currentUrlTree.queryParams;break;default:b=a||null}b!==null&&(b=this.removeEmptyProps(b));let T;try{let M=r?r.snapshot:this.routerState.snapshot.root;T=F_(M)}catch{(typeof n[0]!="string"||!n[0].startsWith("/"))&&(n=[]),T=this.currentUrlTree.root}return k_(T,n,b,C??null)}navigateByUrl(n,i={skipLocationChange:!1}){let r=jo(n)?n:this.parseUrl(n),a=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(a,oa,null,i)}navigate(n,i={skipLocationChange:!1}){return lT(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,i){let r;if(i===!0?r=Te({},aT):i===!1?r=Te({},cT):r=i,jo(n))return C_(this.currentUrlTree,n,r);let a=this.parseUrl(n);return C_(this.currentUrlTree,a,r)}removeEmptyProps(n){return Object.entries(n).reduce((i,[r,a])=>(a!=null&&(i[r]=a),i),{})}scheduleNavigation(n,i,r,a,d){if(this.disposed)return Promise.resolve(!1);let v,y,C;d?(v=d.resolve,y=d.reject,C=d.promise):C=new Promise((T,M)=>{v=T,y=M});let b=this.pendingTasks.add();return oT(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(b))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:a,resolve:v,reject:y,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(T=>Promise.reject(T))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function lT(t){for(let e=0;e<t.length;e++)if(t[e]==null)throw new Ae(4008,!1)}function uT(t){return!(t instanceof ua)&&!(t instanceof ha)}var dT=["cameraViewContainer"],nr="VideoCapture Component Destroyed",nw=(()=>{class t{constructor(n){this.route=n,this.resultText="",this.pInit=new Promise(i=>{this.resolveInit=i}),this.isDestroyed=!1}ngAfterViewInit(){return $(this,null,function*(){try{let n=yield Ci.createInstance();if(n.setUIElement(document.getElementById("div-ui-container")),n.setVideoFit("cover"),this.isDestroyed||(this.cameraEnhancer=yield Qt.createInstance(n),this.isDestroyed)||(this.cameraViewContainer.nativeElement.append(n.getUIElement()),this.cvRouter=yield Er.createInstance(),this.isDestroyed))throw Error(nr);this.cvRouter.setInput(this.cameraEnhancer),this.cvRouter.addResultReceiver({onDecodedBarcodesReceived:r=>{if(!r.barcodeResultItems.length)return;this.resultText="";for(let d of r.barcodeResultItems)this.resultText+=`${d.text}`;let a={result:this.resultText}}});let i=new Bl;if(i.enableResultCrossVerification("barcode",!0),i.enableResultDeduplication("barcode",!0),yield this.cvRouter.addResultFilter(i),this.isDestroyed||(yield this.cameraEnhancer.open(),n.setScanLaserVisible(!0),this.isDestroyed)||(yield this.cvRouter.startCapturing("ReadSingleBarcode"),this.isDestroyed))throw Error(nr)}catch(n){if(n?.message===nr)console.log(nr);else{let i=n.message||n;console.error(i),alert(i)}}this.resolveInit()})}ngOnDestroy(){return $(this,null,function*(){this.isDestroyed=!0;try{yield this.pInit,this.cvRouter?.dispose(),this.cameraEnhancer?.dispose()}catch{}})}static{this.\u0275fac=function(i){return new(i||t)(Ni(tw))}}static{this.\u0275cmp=Mi({type:t,selectors:[["app-video-capture"]],viewQuery:function(i,r){if(i&1&&Ev(dT,5),i&2){let a;ud(a=hd())&&(r.cameraViewContainer=a.first)}},standalone:!0,features:[Pi],decls:5,vars:0,consts:[["cameraViewContainer",""],["id","UIElement"],["id","div-ui-container",2,"width","100%","height","100%","position","relative"],[1,"dce-video-container",2,"position","absolute","width","100%","height","100%"],[1,"camera-view-container",2,"width","100%","height","100vh","position","absolute","z-index","99","top","0"]],template:function(i,r){i&1&&(xn(0,"div",1)(1,"div",2),ci(2,"div",3),hn()(),ci(3,"div",4,0))},styles:[".results[_ngcontent-%COMP%]{width:100%;height:10vh;overflow:auto;white-space:pre-wrap}"]})}}return t})();var iw=t=>({"background-color":t});function fT(t,e){t&1&&ci(0,"app-video-capture")}function pT(t,e){t&1&&ci(0,"app-image-capture")}var rw=(()=>{class t{constructor(){this.title="dbrjs-angular-sample",this.mode="video"}switchMode(n){this.mode=n}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=Mi({type:t,selectors:[["app-root"]],standalone:!0,features:[Pi],decls:11,vars:7,consts:[[1,"App"],[1,"title"],[1,"title-text"],[1,"buttons-container"],[3,"click","ngStyle"]],template:function(i,r){i&1&&(xn(0,"div",0)(1,"div",1)(2,"h2",2),co(3,"Hello World for Angular"),hn()(),xn(4,"div",3)(5,"button",4),mr("click",function(){return r.switchMode("video")}),co(6,"Decode Video"),hn(),xn(7,"button",4),mr("click",function(){return r.switchMode("image")}),co(8,"Decode Image"),hn()(),ld(9,fT,1,0,"app-video-capture")(10,pT,1,0),hn()),i&2&&(so(5),Tc("ngStyle",fd(3,iw,r.mode==="video"?"rgb(255,174,55)":"white")),so(2),Tc("ngStyle",fd(5,iw,r.mode==="image"?"rgb(255,174,55)":"white")),so(2),Cv(9,r.mode==="video"?9:10))},dependencies:[Hv,Gy,nw],styles:[".title[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px}.buttons-container[_ngcontent-%COMP%]{width:30%;margin:20px auto}.buttons-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:inline-block;border:1px solid black;padding:5px 15px;background-color:transparent;cursor:pointer}.buttons-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px;border-right:transparent}.buttons-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){border-top-right-radius:10px;border-bottom-right-radius:10px;border-left:transparent}@media screen and (max-width: 800px){.buttons-container[_ngcontent-%COMP%]{width:70%}}@keyframes _ngcontent-%COMP%_retate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})}}return t})();Kv(rw).catch(t=>console.error(t));
